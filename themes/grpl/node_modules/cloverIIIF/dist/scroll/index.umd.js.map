{"version":3,"file":"index.umd.js","sources":["../../src/context/scroll-context.tsx","../../src/lib/label-helpers.ts","../../src/lib/html-element.ts","../../src/styles/stitches.config.tsx","../../src/components/Primitives/Label/Label.tsx","../../src/components/Primitives/ContentResource/ContentResource.tsx","../../src/components/Primitives/Homepage/Homepage.tsx","../../src/context/primitives-context.tsx","../../src/components/Primitives/Markup/Markup.tsx","../../src/components/Primitives/Value/CustomValue.tsx","../../src/components/Primitives/Metadata/Metadata.tsx","../../src/components/Primitives/PartOf/PartOf.tsx","../../src/components/Primitives/Rendering/Rendering.tsx","../../src/components/Primitives/RequiredStatement/RequiredStatement.tsx","../../src/components/Primitives/SeeAlso/SeeAlso.tsx","../../src/components/Primitives/Summary/Summary.tsx","../../src/components/Scroll/Layout/Layout.styled.tsx","../../src/components/Scroll/Layout/Header.tsx","../../src/components/Scroll/Items/Items.styled.tsx","../../src/components/Scroll/Figure/Caption.tsx","../../src/lib/openseadragon-svg.ts","../../src/lib/iiif.ts","../../src/types/open-seadragon.ts","../../src/lib/openseadragon-helpers.ts","../../src/components/UI/ErrorFallback/ErrorFallback.styled.tsx","../../src/components/UI/ErrorFallback/ErrorFallback.tsx","../../src/components/Image/Image.styled.tsx","../../src/components/Image/Controls/Button.styled.tsx","../../src/components/Image/Controls/Button.tsx","../../src/components/Image/Controls/Controls.styled.tsx","../../src/context/viewer-context.tsx","../../src/components/Image/Controls/Controls.tsx","../../src/components/Image/OSD/OSD.tsx","../../src/components/Image/OSD/defaults.ts","../../src/components/Image/index.tsx","../../src/components/Scroll/Figure/ImageViewer.styled.tsx","../../src/components/Scroll/Figure/ImageViewer.tsx","../../src/components/Scroll/Figure/Figure.styled.tsx","../../src/hooks/use-iiif/getCanvasByCriteria.ts","../../src/hooks/use-iiif/getPaintingResource.ts","../../src/components/Scroll/Figure/Figure.tsx","../../src/components/Scroll/Annotation/Body.styled.tsx","../../src/lib/search-helpers.ts","../../src/components/Scroll/Annotation/Body.tsx","../../src/components/Scroll/Items/Item.tsx","../../src/components/Scroll/Panel/Search/Search.styled.tsx","../../src/components/Scroll/Panel/Search/Results.tsx","../../src/components/Scroll/Panel/Search/Search.tsx","../../src/components/Scroll/Panel/Search/Form.tsx","../../src/components/Scroll/Panel/Panel.styled.tsx","../../src/hooks/useDistanceFromViewportTop.ts","../../src/components/Scroll/Panel/Panel.tsx","../../src/components/Scroll/Items/Items.tsx","../../src/hooks/useManifestAnnotations.ts","../../src/components/Scroll/index.tsx"],"sourcesContent":["import { AnnotationNormalized, ManifestNormalized } from \"@iiif/presentation-3\";\nimport React, { Dispatch, createContext, useReducer } from \"react\";\n\nimport { Vault } from \"@iiif/vault\";\nimport { Vault as VaultShape } from \"@iiif/vault/dist/index\";\n\ninterface StateType {\n  annotations?: AnnotationNormalized[];\n  manifest?: ManifestNormalized;\n  searchString?: string;\n  options: {\n    offset: number;\n  };\n  vault?: VaultShape;\n}\n\ninterface ActionType {\n  payload?: any;\n  type: string;\n}\n\nconst initialState: StateType = {\n  annotations: [],\n  manifest: undefined,\n  searchString: undefined,\n  options: {\n    offset: 0,\n  },\n  vault: new Vault(),\n};\n\nfunction reducer(state: StateType, action: ActionType): StateType {\n  switch (action.type) {\n    case \"updateAnnotations\":\n      return {\n        ...state,\n        annotations: action.payload,\n      };\n    case \"updateSearchString\":\n      return {\n        ...state,\n        searchString: action.payload,\n      };\n    default:\n      return state;\n  }\n}\n\nexport const ScrollContext = createContext<{\n  dispatch: Dispatch<ActionType>;\n  state: StateType;\n}>({\n  dispatch: () => null,\n  state: initialState,\n});\n\ninterface ScrollProviderProps {\n  annotations?: AnnotationNormalized[];\n  children: React.ReactNode;\n  manifest?: ManifestNormalized;\n  options?: {\n    offset?: number;\n  };\n  vault?: VaultShape;\n}\n\nexport const ScrollProvider: React.FC<ScrollProviderProps> = (props) => {\n  const { children, manifest } = props;\n  const options = {\n    ...initialState.options,\n    ...props.options,\n  };\n\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <ScrollContext.Provider\n      value={{\n        state: { ...state, manifest, options },\n        dispatch,\n      }}\n    >\n      {children}\n    </ScrollContext.Provider>\n  );\n};\n","import { InternationalString } from \"@iiif/presentation-3\";\n\nexport const getLabelEntries = (\n  label?: InternationalString,\n  lang: string = \"none\",\n) => {\n  /*\n   * If no label exists, return an empty string.\n   */\n  if (!label) return null;\n\n  /*\n   * If label is not a IIIF Presentation API 3.0 shape, return the string\n   */\n  if (typeof label === \"string\") return [label];\n\n  /*\n   * If InternationalString code does not exist on label, then\n   * return what may be there, ex: label.none[0] OR label.fr[0]\n   */\n  if (!label[lang]) {\n    const codes: Array<string> = Object.getOwnPropertyNames(label);\n    if (codes.length > 0) return label[codes[0]];\n  }\n\n  /*\n   * Return label value for InternationalString code `en`\n   */\n  if (!label[lang]) return null;\n  if (!Array.isArray(label[lang])) return null;\n\n  return label[lang] as string[];\n};\n\nexport const getLabelAsString = (\n  label: InternationalString | undefined,\n  lang: string = \"none\",\n  delimiter: string = \", \",\n) => {\n  const entries = getLabelEntries(label, lang);\n  return Array.isArray(entries) ? entries.join(`${delimiter}`) : entries;\n};\n","import sanitizeHtml from \"sanitize-html\";\n\nfunction createMarkup(html: string) {\n  return { __html: sanitizeHTML(html) };\n}\n\nfunction sanitizeAttributes(props: any, remove: string[]) {\n  const entries = Object.keys(props).filter((key) =>\n    !remove.includes(key) ? key : null,\n  );\n\n  const attributes = new Object();\n  entries.forEach((key) => {\n    attributes[key] = props[key];\n  });\n\n  return attributes as React.HTMLAttributes<HTMLElement>;\n}\n\nfunction sanitizeHTML(html: string) {\n  return sanitizeHtml(html, {\n    allowedAttributes: {\n      a: [\"href\"],\n      img: [\"alt\", \"src\", \"height\", \"width\"],\n    },\n    allowedSchemes: [\"http\", \"https\", \"mailto\"],\n    allowedTags: [\n      \"a\",\n      \"b\",\n      \"br\",\n      \"i\",\n      \"img\",\n      \"p\",\n      \"small\",\n      \"span\",\n      \"sub\",\n      \"sup\",\n    ],\n  });\n}\n\nexport { createMarkup, sanitizeAttributes, sanitizeHTML };\n","import { createStitches } from \"@stitches/react\";\n\nconst hue = 209;\n\nexport const theme = {\n  colors: {\n    /*\n     * Black and dark grays in a light theme.\n     * Must contrast to 4.5 or greater with `secondary`.\n     */\n    primary: \"#1a1d1e\",\n    primaryMuted: \"#26292b\",\n    primaryAlt: \"#151718\",\n\n    /*\n     * Key brand color(s).\n     * Must contrast to 4.5 or greater with `secondary`.\n     */\n    accent: `hsl(${hue} 100% 38.2%)`,\n    accentMuted: `hsl(${hue} 80% 61.8%)`,\n    accentAlt: `hsl(${hue} 80% 30%)`,\n\n    /*\n     * White and light grays in a light theme.\n     * Must contrast to 4.5 or greater with `primary` and  `accent`.\n     */\n    secondary: \"#FFFFFF\",\n    secondaryMuted: \"#e6e8eb\",\n    secondaryAlt: \"#c1c8cd\",\n  },\n  fontSizes: {\n    1: \"12px\",\n    2: \"13px\",\n    3: \"15px\",\n    4: \"17px\",\n    5: \"19px\",\n    6: \"21px\",\n    7: \"27px\",\n    8: \"35px\",\n    9: \"59px\",\n  },\n  lineHeights: {\n    1: \"12px\",\n    2: \"13px\",\n    3: \"15px\",\n    4: \"17px\",\n    5: \"19px\",\n    6: \"21px\",\n    7: \"27px\",\n    8: \"35px\",\n    9: \"59px\",\n  },\n  sizes: {\n    1: \"5px\",\n    2: \"10px\",\n    3: \"15px\",\n    4: \"20px\",\n    5: \"25px\",\n    6: \"35px\",\n    7: \"45px\",\n    8: \"65px\",\n    9: \"80px\",\n  },\n  space: {\n    1: \"5px\",\n    2: \"10px\",\n    3: \"15px\",\n    4: \"20px\",\n    5: \"25px\",\n    6: \"35px\",\n    7: \"45px\",\n    8: \"65px\",\n    9: \"80px\",\n  },\n  radii: {\n    1: \"4px\",\n    2: \"6px\",\n    3: \"8px\",\n    4: \"12px\",\n    round: \"50%\",\n    pill: \"9999px\",\n  },\n  transitions: {\n    all: \"all 300ms cubic-bezier(0.16, 1, 0.3, 1)\",\n  },\n  zIndices: {\n    1: \"100\",\n    2: \"200\",\n    3: \"300\",\n    4: \"400\",\n    max: \"999\",\n  },\n};\n\nexport const media = {\n  xxs: \"(max-width: 349px)\",\n  xs: \"(max-width: 575px)\",\n  sm: \"(max-width: 767px)\",\n  md: \"(max-width: 991px)\",\n  lg: \"(max-width: 90rem)\",\n  xl: \"(min-width: calc(90rem + 1px))\",\n};\n\nexport type { CSS, VariantProps } from \"@stitches/react\";\n\nexport const { styled, css, keyframes, createTheme } = createStitches({\n  theme,\n  media,\n});\n","import { PrimitivesLabel } from \"src/types/primitives\";\nimport React from \"react\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\nimport { styled } from \"src/styles/stitches.config\";\n\nconst StyledLabel = styled(\"span\", {});\n\nconst Label: React.FC<PrimitivesLabel> = (props) => {\n  const { as, label } = props;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"label\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <StyledLabel as={as} {...attributes}>\n      {getLabelAsString(label, attributes.lang as string) as string}\n    </StyledLabel>\n  );\n};\n\nexport default Label;\n","import React, { useCallback, useEffect, useRef } from \"react\";\n\nimport Hls from \"hls.js\";\nimport { PrimitivesContentResource } from \"src/types/primitives\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { useGetImageResource } from \"src/hooks/useGetImageResource\";\n\nconst StyledResource = styled(\"img\", { objectFit: \"cover\" });\n\nconst ContentResource: React.FC<PrimitivesContentResource> = (props) => {\n  const mediaRef = useRef(null);\n  const { contentResource, altAsLabel, region = \"full\" } = props;\n\n  let alt: string | undefined;\n  if (altAsLabel) alt = getLabelAsString(altAsLabel) as string;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"contentResource\", \"altAsLabel\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  const { type, id, width = 200, height = 200, duration } = contentResource;\n\n  useEffect(() => {\n    /**\n     * Check that IIIF content resource ID exists and\n     * we have a reffed <video> for attaching HLS\n     */\n    if (!id && !mediaRef.current) return;\n    if ([\"Image\"].includes(type)) return;\n\n    /**\n     * Eject HLS attachment if file extension from\n     * the IIIF content resource ID is not .m3u8\n     */\n    if (!id.includes(\"m3u8\")) return;\n\n    // Bind hls.js package to our <video /> element and then load the media source\n    const hls = new Hls();\n\n    if (mediaRef.current) {\n      hls.attachMedia(mediaRef.current);\n      hls.on(Hls.Events.MEDIA_ATTACHED, function () {\n        hls.loadSource(id as string);\n      });\n    }\n\n    // Handle errors\n    hls.on(Hls.Events.ERROR, function (event, data) {\n      if (data.fatal) {\n        switch (data.type) {\n          case Hls.ErrorTypes.NETWORK_ERROR:\n            // try to recover network error\n            console.error(\n              `fatal ${event} network error encountered, try to recover`,\n            );\n            hls.startLoad();\n            break;\n          case Hls.ErrorTypes.MEDIA_ERROR:\n            console.error(\n              `fatal ${event} media error encountered, try to recover`,\n            );\n            hls.recoverMediaError();\n            break;\n          default:\n            // cannot recover\n            hls.destroy();\n            break;\n        }\n      }\n    });\n\n    return () => {\n      if (hls) {\n        hls.detachMedia();\n        hls.destroy();\n      }\n    };\n  }, [id, type]);\n\n  const playLoop = useCallback(() => {\n    if (!mediaRef.current) return;\n\n    let startTime = 0;\n    let loopTime = 30;\n\n    if (duration) loopTime = duration;\n    if (!id.split(\"#t=\") && duration) startTime = duration * 0.1;\n\n    if (id.split(\"#t=\").pop()) {\n      const fragment = id.split(\"#t=\").pop();\n      if (fragment) startTime = parseInt(fragment.split(\",\")[0]);\n    }\n\n    const media: HTMLVideoElement = mediaRef.current;\n    media.autoplay = true;\n    media.currentTime = startTime;\n\n    setTimeout(() => playLoop(), loopTime * 1000);\n  }, [duration, id]);\n\n  useEffect(() => playLoop(), [playLoop]);\n\n  const imgSrc = useGetImageResource(\n    contentResource,\n    `${width},${height}`,\n    region,\n  );\n\n  switch (type) {\n    case \"Image\":\n      return (\n        <StyledResource\n          as=\"img\"\n          alt={alt}\n          css={{ width: width, height: height }}\n          key={id}\n          src={imgSrc}\n          {...attributes}\n        />\n      );\n\n    case \"Video\":\n      return (\n        <StyledResource\n          as=\"video\"\n          css={{ width: width, height: height }}\n          disablePictureInPicture\n          key={id}\n          loop\n          muted\n          onPause={playLoop}\n          ref={mediaRef}\n          src={id}\n        />\n      );\n\n    default:\n      console.warn(\n        `Resource type: ${type} is not valid or not yet supported in Primitives.`,\n      );\n      return <></>;\n  }\n};\n\nexport default ContentResource;\n","import React from \"react\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { PrimitivesHomepage } from \"src/types/primitives\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\n\nconst StyledHomepage = styled(\"a\", {});\n\nconst Homepage: React.FC<PrimitivesHomepage> = (props) => {\n  const { children, homepage } = props;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"children\", \"homepage\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <>\n      {homepage &&\n        homepage.map((resource) => {\n          const label = getLabelAsString(\n            resource.label,\n            attributes.lang,\n          ) as string;\n          return (\n            <StyledHomepage\n              aria-label={children ? label : undefined}\n              href={resource.id}\n              key={resource.id}\n              {...attributes}\n            >\n              {children ? children : label}\n            </StyledHomepage>\n          );\n        })}\n    </>\n  );\n};\n\nexport default Homepage;\n","import { createContext, useContext } from \"react\";\n\nimport React from \"react\";\n\ntype PrimitivesContextStore =\n  | {\n      delimiter: string; // Separator for multi-value items\n    }\n  | undefined;\ninterface ProviderProps {\n  children: React.ReactNode;\n  initialState?: PrimitivesContextStore;\n}\n\nconst defaultState = {\n  delimiter: \", \",\n};\n\nconst PrimitivesContext = createContext<PrimitivesContextStore>(undefined);\n\nconst usePrimitivesContext = () => {\n  const context = useContext(PrimitivesContext);\n  if (context === undefined) {\n    throw new Error(\n      \"usePrimitivesContext must be used with a PrimitivesProvider\",\n    );\n  }\n  return context;\n};\n\nconst PrimitivesProvider: React.FC<ProviderProps> = ({\n  children,\n  initialState = defaultState,\n}) => {\n  const delimiter = getRealPropertyValue(initialState, \"delimiter\");\n\n  return (\n    <PrimitivesContext.Provider value={{ delimiter }}>\n      {children}\n    </PrimitivesContext.Provider>\n  );\n};\n\nconst getRealPropertyValue = (\n  obj: { [key: string]: any },\n  property: string,\n) => {\n  const value = Object.hasOwn(obj, property)\n    ? obj[property].toString()\n    : undefined;\n  return value;\n};\n\nexport {\n  PrimitivesContext,\n  PrimitivesProvider,\n  getRealPropertyValue,\n  usePrimitivesContext,\n};\n","import {\n  PrimitivesContext,\n  PrimitivesProvider,\n  usePrimitivesContext,\n} from \"src/context/primitives-context\";\nimport { createMarkup, sanitizeAttributes } from \"src/lib/html-element\";\n\nimport { PrimitivesMarkup } from \"src/types/primitives\";\nimport React from \"react\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { styled } from \"src/styles/stitches.config\";\n\nconst StyledMarkup = styled(\"span\", {});\n\nconst Markup: React.FC<PrimitivesMarkup> = (props) => {\n  const { as, markup } = props;\n  const { delimiter } = usePrimitivesContext();\n\n  if (!markup) return <></>;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"markup\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  const html = createMarkup(\n    getLabelAsString(markup, attributes.lang as string, delimiter) as string,\n  );\n\n  return (\n    <StyledMarkup as={as} {...attributes} dangerouslySetInnerHTML={html} />\n  );\n};\n\nconst MarkupWrapper: React.FC<PrimitivesMarkup> = (props) => {\n  const context = React.useContext(PrimitivesContext);\n\n  return context ? (\n    <Markup {...props} />\n  ) : (\n    <PrimitivesProvider>\n      <Markup {...props} />\n    </PrimitivesProvider>\n  );\n};\n\nexport default MarkupWrapper;\n","import React, { Fragment, cloneElement } from \"react\";\n\nimport { PrimitivesCustomValue } from \"src/types/primitives\";\nimport { getLabelEntries } from \"src/lib/label-helpers\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { usePrimitivesContext } from \"src/context/primitives-context\";\n\nconst StyledCustomValue = styled(\"span\", {});\n\nconst CustomValue: React.FC<PrimitivesCustomValue> = ({\n  as = \"dd\",\n  customValueContent,\n  lang,\n  value,\n}) => {\n  const { delimiter } = usePrimitivesContext();\n\n  const entries = getLabelEntries(value, lang)?.map((entry) => {\n    return cloneElement(customValueContent, {\n      value: entry,\n    });\n  });\n\n  return (\n    <StyledCustomValue as={as} lang={lang}>\n      {entries?.map((entry, index) => [\n        index > 0 && `${delimiter}`,\n        <Fragment key={index}>{entry}</Fragment>,\n      ])}\n    </StyledCustomValue>\n  );\n};\n\nexport default CustomValue;\n","import MetadataItem from \"src/components/Primitives/Metadata/Item\";\nimport { PrimitivesMetadata } from \"src/types/primitives\";\nimport { PrimitivesProvider } from \"src/context/primitives-context\";\nimport React from \"react\";\nimport { getRealPropertyValue } from \"src/lib/utils\";\nimport { parseCustomContent } from \"src/lib/custom\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\nimport { styled } from \"src/styles/stitches.config\";\n\nconst StyledMetadata = styled(\"dl\", {});\n\nconst Metadata: React.FC<PrimitivesMetadata> = (props) => {\n  const { as, customValueContent, metadata } = props;\n\n  if (!Array.isArray(metadata)) return <></>;\n\n  const delimiter = getRealPropertyValue(props, \"customValueDelimiter\");\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\n    \"as\",\n    \"customValueContent\",\n    \"customValueDelimiter\",\n    \"metadata\",\n  ];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <PrimitivesProvider\n      {...(typeof delimiter === \"string\"\n        ? { initialState: { delimiter: delimiter as string } }\n        : undefined)}\n    >\n      {metadata.length > 0 && (\n        <StyledMetadata as={as} {...attributes}>\n          {metadata.map((item, index) => {\n            const customValue = customValueContent\n              ? parseCustomContent(item.label, customValueContent)\n              : undefined;\n\n            return (\n              <MetadataItem\n                customValueContent={customValue}\n                item={item}\n                key={index}\n                lang={attributes?.lang}\n              />\n            );\n          })}\n        </StyledMetadata>\n      )}\n    </PrimitivesProvider>\n  );\n};\n\nexport default Metadata;\n","import React from \"react\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { PrimitivesPartOf } from \"src/types/primitives\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\n\nconst StyledPartOf = styled(\"li\", {});\nconst StyledWrapper = styled(\"ul\", {});\n\nconst PartOf: React.FC<PrimitivesPartOf> = (props) => {\n  const { as, partOf } = props;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"partOf\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <StyledWrapper as={as}>\n      {partOf &&\n        partOf.map((resource) => {\n          const label = resource.label\n            ? (getLabelAsString(resource.label, attributes.lang) as string)\n            : undefined;\n          return (\n            <StyledPartOf key={resource.id}>\n              <a href={resource.id} {...attributes}>\n                {label ? label : resource.id}\n              </a>\n            </StyledPartOf>\n          );\n        })}\n    </StyledWrapper>\n  );\n};\n\nexport default PartOf;\n","import React from \"react\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { PrimitivesRendering } from \"src/types/primitives\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\n\nconst StyledRendering = styled(\"li\", {});\nconst StyledWrapper = styled(\"ul\", {});\n\nconst Rendering: React.FC<PrimitivesRendering> = (props) => {\n  const { as, rendering } = props;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"rendering\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <StyledWrapper as={as}>\n      {rendering &&\n        rendering.map((resource) => {\n          const label = getLabelAsString(\n            resource.label,\n            attributes.lang,\n          ) as string;\n          return (\n            <StyledRendering key={resource.id}>\n              <a href={resource.id} {...attributes} target=\"_blank\">\n                {label ? label : resource.id}\n              </a>\n            </StyledRendering>\n          );\n        })}\n    </StyledWrapper>\n  );\n};\n\nexport default Rendering;\n","import MetadataItem from \"src/components/Primitives/Metadata/Item\";\nimport { PrimitivesProvider } from \"src/context/primitives-context\";\nimport { PrimitivesRequiredStatement } from \"src/types/primitives\";\nimport React from \"react\";\nimport { getRealPropertyValue } from \"src/lib/utils\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\nimport { styled } from \"src/styles/stitches.config\";\n\nconst StyledRequiredStatement = styled(\"dl\", {});\n\nconst RequiredStatement: React.FC<PrimitivesRequiredStatement> = (props) => {\n  const { as, requiredStatement } = props;\n\n  if (!requiredStatement) return <></>;\n\n  const delimiter = getRealPropertyValue(props, \"customValueDelimiter\");\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"customValueDelimiter\", \"requiredStatement\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <PrimitivesProvider\n      {...(typeof delimiter === \"string\"\n        ? { initialState: { delimiter: delimiter as string } }\n        : undefined)}\n    >\n      <StyledRequiredStatement as={as} {...attributes}>\n        <MetadataItem item={requiredStatement} lang={attributes.lang} />\n      </StyledRequiredStatement>\n    </PrimitivesProvider>\n  );\n};\n\nexport default RequiredStatement;\n","import React from \"react\";\nimport { styled } from \"src/styles/stitches.config\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { PrimitivesSeeAlso } from \"src/types/primitives\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\n\nconst StyledSeeAlso = styled(\"li\", {});\nconst StyledWrapper = styled(\"ul\", {});\n\nconst SeeAlso: React.FC<PrimitivesSeeAlso> = (props) => {\n  const { as, seeAlso } = props;\n\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"seeAlso\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return (\n    <StyledWrapper as={as}>\n      {seeAlso &&\n        seeAlso.map((resource) => {\n          const label = getLabelAsString(\n            resource.label,\n            attributes.lang,\n          ) as string;\n          return (\n            <StyledSeeAlso key={resource.id}>\n              <a href={resource.id} {...attributes}>\n                {label ? label : resource.id}\n              </a>\n            </StyledSeeAlso>\n          );\n        })}\n    </StyledWrapper>\n  );\n};\n\nexport default SeeAlso;\n","import Markup from \"src/components/Primitives/Markup/Markup\";\nimport { PrimitivesSummary } from \"src/types/primitives\";\nimport React from \"react\";\nimport { sanitizeAttributes } from \"src/lib/html-element\";\n\nconst Summary: React.FC<PrimitivesSummary> = (props) => {\n  const { as, summary } = props;\n  /**\n   * Create attributes and remove React props\n   */\n  const remove = [\"as\", \"customValueDelimiter\", \"summary\"];\n  const attributes = sanitizeAttributes(props, remove);\n\n  return <Markup as={as} markup={summary} {...attributes} />;\n};\n\nexport default Summary;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst StyledScrollFixed = styled(\"div\", {\n  display: \"flex\",\n  flexDirection: \"column\",\n  justifyContent: \"space-between\",\n});\n\nconst StyledScrollAside = styled(\"aside\", {\n  margin: \"0\",\n  padding: \"0\",\n  position: \"relative\",\n  zIndex: 2,\n  flexGrow: \"1\",\n  flexShrink: \"0\",\n\n  [`& ${StyledScrollFixed}`]: {\n    position: \"absolute\",\n    width: \"50%\",\n    top: 0,\n  },\n\n  \"&.anchor\": {\n    [`& ${StyledScrollFixed}`]: {\n      position: \"fixed\",\n      width: \"50%\",\n    },\n  },\n});\n\nconst StyledScrollHeader = styled(\"header\", {\n  display: \"flex\",\n  justifyContent: \"space-between\",\n  fontSize: \"1\",\n  flexGrow: \"1\",\n  flexShrink: \"0\",\n  marginBottom: \"1.618rem\",\n\n  strong: {\n    fontWeight: \"400\",\n    fontSize: \"1.33rem\",\n  },\n});\n\nconst StyledScrollWrapper = styled(\"section\", {\n  margin: \"0\",\n  gap: \"1rem\",\n});\n\nexport {\n  StyledScrollAside,\n  StyledScrollFixed,\n  StyledScrollHeader,\n  StyledScrollWrapper,\n};\n","import { InternationalString } from \"@iiif/presentation-3\";\nimport { Label } from \"src/components/Primitives\";\nimport React from \"react\";\nimport { StyledScrollHeader } from \"src/components/Scroll/Layout/Layout.styled\";\n\ninterface ScrollHeaderProps {\n  label: InternationalString;\n}\n\nconst ScrollHeader: React.FC<ScrollHeaderProps> = ({ label }) => {\n  return (\n    <StyledScrollHeader>\n      <strong>\n        <Label label={label} />\n      </strong>\n    </StyledScrollHeader>\n  );\n};\n\nexport default ScrollHeader;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst StyledItem = styled(\"article\", {\n  transition: \"all 0.382s ease-in-out\",\n  display: \"flex\",\n  flexDirection: \"row\",\n  flexWrap: \"nowrap\",\n  gap: \"2.618rem\",\n});\n\nconst StyledItemFigure = styled(\"div\", {\n  transition: \"$all\",\n  width: \"50%\",\n  opacity: 0,\n  transform: \"translateX(2.618rem)\",\n  zIndex: -1,\n});\n\nconst StyledItemTextualBodies = styled(\"div\", {\n  width: \"50%\",\n  display: \"flex\",\n  flexDirection: \"column\",\n  justifyContent: \"flex-start\",\n});\n\nconst PageBreak = styled(\"hr\", {\n  margin: \"0\",\n  borderColor: \"transparent\",\n  height: \"1.618rem\",\n  position: \"relative\",\n  zIndex: 0,\n  display: \"flex\",\n  justifyContent: \"flex-end\",\n  marginTop: \"2.618rem\",\n\n  \"&::before\": {\n    content: \"attr(aria-label)\",\n    position: \"absolute\",\n    right: \"1.618rem\",\n    bottom: \"0\",\n    zIndex: 1,\n    display: \"flex\",\n    fontSize: \"0.7222rem\",\n    fontWeight: \"400\",\n    lineHeight: \"1rem\",\n    background: \"inherit\",\n    opacity: 0.7,\n  },\n\n  \"&::after\": {\n    content: \"\",\n    width: \"100%\",\n    position: \"absolute\",\n    zIndex: 0,\n    height: \"1px\",\n    background: \"#6662\",\n  },\n});\n\nconst StyledScrollItems = styled(\"div\", {\n  position: \"relative\",\n  zIndex: \"1\",\n  display: \"flex\",\n  flexDirection: \"column\",\n  gap: \"2.618rem\",\n\n  \"&[data-figures-visible='true']\": {\n    [`& ${StyledItemFigure}`]: {\n      opacity: 1,\n      zIndex: 0,\n      transform: \"translateX(0)\",\n    },\n  },\n});\n\nexport {\n  StyledScrollItems,\n  StyledItem,\n  StyledItemFigure,\n  StyledItemTextualBodies,\n  PageBreak,\n};\n","import { Label, Summary } from \"src/components/Primitives\";\n\nimport { CanvasNormalized } from \"@iiif/presentation-3\";\nimport React from \"react\";\n\ninterface FigureCaptionProps {\n  canvas?: CanvasNormalized;\n  canvasInfo: {\n    current: number;\n    total: number;\n  };\n}\n\nconst FigureCaption: React.FC<FigureCaptionProps> = ({\n  canvas,\n  canvasInfo: { current, total },\n}) => {\n  return (\n    <figcaption>\n      <em>\n        {current} / {total}\n      </em>\n      {canvas?.label && <Label label={canvas?.label} />}\n      {canvas?.summary && <Summary summary={canvas?.summary} as=\"p\" />}\n    </figcaption>\n  );\n};\n\nexport default FigureCaption;\n","// OpenSeadragon SVG Overlay plugin 0.0.5\n// https://github.com/openseadragon/svg-overlay/issues/34#issuecomment-1147992921\nimport OpenSeadragon from \"openseadragon\";\n\nlet $ = window.OpenSeadragon;\n\nif (!$) {\n  $ = OpenSeadragon;\n  if (!$) {\n    throw new Error(\"OpenSeadragon is missing.\");\n  }\n}\n\nconst svgNS = \"http://www.w3.org/2000/svg\";\n\n// ----------\nif ($.Viewer) {\n  // @ts-expect-error: svgOverlay does not exist on Viewer\n  $.Viewer.prototype.svgOverlay = function () {\n    if (this._svgOverlayInfo) {\n      return this._svgOverlayInfo;\n    }\n\n    this._svgOverlayInfo = new Overlay(this);\n    return this._svgOverlayInfo;\n  };\n}\n// ----------\nconst Overlay = function (viewer) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const self = this;\n\n  this._viewer = viewer;\n  this._containerWidth = 0;\n  this._containerHeight = 0;\n\n  this._svg = document.createElementNS(svgNS, \"svg\");\n  this._svg.style.position = \"absolute\";\n  this._svg.style.left = 0;\n  this._svg.style.top = 0;\n  this._svg.style.width = \"100%\";\n  this._svg.style.height = \"100%\";\n  this._viewer.canvas.appendChild(this._svg);\n\n  this._node = document.createElementNS(svgNS, \"g\");\n  this._svg.appendChild(this._node);\n\n  this._viewer.addHandler(\"animation\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"open\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"rotate\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"flip\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"resize\", function () {\n    self.resize();\n  });\n\n  this.resize();\n};\n\n// ----------\nOverlay.prototype = {\n  // ----------\n  node: function () {\n    return this._node;\n  },\n\n  // ----------\n  resize: function () {\n    if (this._containerWidth !== this._viewer.container.clientWidth) {\n      this._containerWidth = this._viewer.container.clientWidth;\n      this._svg.setAttribute(\"width\", this._containerWidth);\n    }\n\n    if (this._containerHeight !== this._viewer.container.clientHeight) {\n      this._containerHeight = this._viewer.container.clientHeight;\n      this._svg.setAttribute(\"height\", this._containerHeight);\n    }\n\n    const p = this._viewer.viewport.pixelFromPoint(new $.Point(0, 0), true);\n    const zoom = this._viewer.viewport.getZoom(true);\n    const rotation = this._viewer.viewport.getRotation();\n    const flipped = this._viewer.viewport.getFlip();\n    // TODO: Expose an accessor for _containerInnerSize in the OSD API so we don't have to use the private variable.\n    const containerSizeX = this._viewer.viewport._containerInnerSize.x;\n    let scaleX = containerSizeX * zoom;\n    const scaleY = scaleX;\n\n    if (flipped) {\n      // Makes the x component of the scale negative to flip the svg\n      scaleX = -scaleX;\n      // Translates svg back into the correct coordinates when the x scale is made negative.\n      p.x = -p.x + containerSizeX;\n    }\n\n    this._node.setAttribute(\n      \"transform\",\n      \"translate(\" +\n        p.x +\n        \",\" +\n        p.y +\n        \") scale(\" +\n        scaleX +\n        \",\" +\n        scaleY +\n        \") rotate(\" +\n        rotation +\n        \")\",\n    );\n  },\n  // ----------\n  onClick: function (node, handler) {\n    // TODO: Fast click for mobile browsers\n\n    new $.MouseTracker({\n      element: node,\n      clickHandler: handler,\n    }).setTracking(true);\n  },\n};\n\nexport const OsdSvgOverlay = (viewer) => {\n  return new Overlay(viewer);\n};\n","import {\n  Canvas,\n  CollectionNormalized,\n  IIIFExternalWebResource,\n  ImageService,\n  ManifestNormalized,\n  Service,\n} from \"@iiif/presentation-3\";\nimport { decodeContentState } from \"@iiif/vault-helpers\";\n\nexport const getCanvasResource = (canvas: Canvas) => {\n  if (canvas?.items) {\n    const annotationPage = canvas?.items[0];\n    if (annotationPage?.items) {\n      const resource = annotationPage?.items[0].body as IIIFExternalWebResource;\n      if (resource?.hasOwnProperty(\"id\")) {\n        return resource.id as string;\n      }\n    }\n  }\n};\n\nexport const getInfoResponse = (id: string) =>\n  fetch(`${id.replace(/\\/$/, \"\")}/info.json`)\n    .then((response) => response.json())\n    .then((json) => json)\n    .catch((error: any) => {\n      console.error(\n        `The IIIF tilesource ${id.replace(\n          /\\/$/,\n          \"\",\n        )}/info.json failed to load: ${error}`,\n      );\n    });\n\nexport const getImageServiceURI = (service: Service[] | undefined) => {\n  let imageService: ImageService;\n  let imageServiceURI: string | undefined;\n\n  if (Array.isArray(service)) {\n    imageService = service[0] as ImageService;\n    if (imageService) {\n      let id: string | undefined;\n      \"@id\" in imageService\n        ? (id = imageService[\"@id\"])\n        : (id = imageService.id);\n\n      imageServiceURI = id;\n    }\n  }\n\n  return imageServiceURI;\n};\n\nconst parseIiifContent = (iiifContent: string) => {\n  let resourceId;\n  let active;\n  if (isURL(iiifContent)) {\n    resourceId = iiifContent;\n    active = {};\n  } else {\n    const json = JSON.parse(decodeContentState(iiifContent));\n    switch (json?.type) {\n      // https://iiif.io/api/content-state/1.0/#51-a-region-of-a-canvas-in-a-manifest\n      // https://iiif.io/api/content-state/1.0/#52-start-playing-at-a-point-in-a-recording\n      // https://iiif.io/api/content-state/1.0/#53-multiple-targets-for-a-comparison-view\n      // https://iiif.io/api/content-state/1.0/#54-search-results\n      case \"SpecificResource\":\n      case \"Range\":\n      case \"Annotation\":\n        resourceId = json?.target.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.target.id,\n        };\n        break;\n      case \"Canvas\":\n        resourceId = json?.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.id,\n        };\n        break;\n      case \"Manifest\":\n        resourceId = json?.id;\n        active = {\n          collection: json?.partOf[0]?.id,\n          manifest: json?.id,\n        };\n        break;\n      case \"Collection\":\n        resourceId = json?.id;\n        active = {\n          collection: resourceId,\n        };\n        break;\n    }\n  }\n  return { resourceId, active };\n};\n\nexport const decodeContentStateContainerURI = (iiifContent: string) => {\n  const { resourceId, active } = parseIiifContent(iiifContent);\n  return active.collection || active.manifest || resourceId;\n};\n\nexport const getActiveCanvas = (\n  iiifContent: string,\n  manifest: ManifestNormalized,\n) => {\n  const canvases = manifest.items.map((item) => item.id);\n  const { active } = parseIiifContent(iiifContent);\n  const canvas = active.canvas;\n  return canvases.includes(canvas) ? canvas : canvases[0];\n};\n\nexport const getActiveManifest = (\n  iiifContent: string,\n  collection: CollectionNormalized,\n) => {\n  const { active } = parseIiifContent(iiifContent);\n  const manifest = active.manifest;\n  const manifests = collection.items\n    .filter((item) => item.type === \"Manifest\")\n    .map((manifest) => manifest.id);\n  if (manifests.length == 0) return null;\n  return manifests.includes(manifest) ? manifest : manifests[0];\n};\n\nconst isURL = (url: string) => {\n  try {\n    new URL(url);\n  } catch {\n    return false;\n  }\n  return true;\n};\n","export enum OpenSeadragonImageTypes {\n  TiledImage = \"tiledImage\",\n  SimpleImage = \"simpleImage\",\n}\n","import {\n  Annotation,\n  AnnotationNormalized,\n  IIIFExternalWebResource,\n  type CanvasNormalized,\n  AnnotationPageNormalized,\n} from \"@iiif/presentation-3\";\nimport OpenSeadragon from \"openseadragon\";\nimport {\n  type OverlayOptions,\n  type ViewerConfigOptions,\n} from \"src/context/viewer-context\";\nimport { OsdSvgOverlay } from \"src/lib/openseadragon-svg\";\nimport { parseAnnotationTarget } from \"src/lib/annotation-helpers\";\n\nimport { ParsedAnnotationTarget } from \"src/types/annotations\";\nimport { getImageServiceURI } from \"src/lib/iiif\";\nimport { OpenSeadragonImageTypes } from \"src/types/open-seadragon\";\n\nexport function addOverlaysToViewer(\n  viewer: OpenSeadragon.Viewer,\n  canvas: CanvasNormalized,\n  configOptions: OverlayOptions,\n  annotations: Annotation[] | AnnotationNormalized[],\n  overlaySelector: string,\n): void {\n  if (!viewer) return;\n\n  const scale = 1 / canvas.width;\n\n  annotations.forEach((annotation) => {\n    if (!annotation.target) return;\n\n    const parsedAnnotationTarget = parseAnnotationTarget(annotation.target);\n    const { point, rect, svg } = parsedAnnotationTarget;\n\n    if (rect) {\n      const { x, y, w, h } = rect;\n      addRectangularOverlay(\n        viewer,\n        x * scale,\n        y * scale,\n        w * scale,\n        h * scale,\n        configOptions,\n        overlaySelector,\n      );\n    }\n\n    if (point) {\n      const { x, y } = point;\n      const svg = `\n        <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"${x}\" cy=\"${y}\" r=\"20\" />\n        </svg>\n      `;\n\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n\n    if (svg) {\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n  });\n}\n\nexport function createOpenSeadragonRect(\n  canvas: CanvasNormalized,\n  parsedAnnotationTarget: ParsedAnnotationTarget,\n  zoomLevel: number,\n) {\n  let x,\n    y,\n    w = 40,\n    h = 40;\n\n  if (parsedAnnotationTarget.rect) {\n    x = parsedAnnotationTarget.rect.x;\n    y = parsedAnnotationTarget.rect.y;\n    w = parsedAnnotationTarget.rect.w;\n    h = parsedAnnotationTarget.rect.h;\n  }\n\n  if (parsedAnnotationTarget.point) {\n    x = parsedAnnotationTarget.point.x;\n    y = parsedAnnotationTarget.point.y;\n  }\n\n  // TODO: How to handle SVG where no rect or point exists?\n  // @ts-ignore\n  if (parseAnnotationTarget.svg) {\n  }\n\n  const scale = 1 / canvas.width;\n  const rect = new OpenSeadragon.Rect(\n    x * scale - ((w * scale) / 2) * (zoomLevel - 1),\n    y * scale - ((h * scale) / 2) * (zoomLevel - 1),\n    w * scale * zoomLevel,\n    h * scale * zoomLevel,\n  );\n\n  return rect;\n}\n\n/**\n * Add a rectangular overlay to an OpenSeadragon viewer\n */\nfunction addRectangularOverlay(\n  viewer: OpenSeadragon.Viewer,\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n  configOptions: OverlayOptions,\n  overlaySelector: string,\n): void {\n  const rect = new OpenSeadragon.Rect(x, y, w, h);\n  const div = document.createElement(\"div\");\n\n  if (configOptions) {\n    const { backgroundColor, opacity, borderType, borderColor, borderWidth } =\n      configOptions;\n\n    div.style.backgroundColor = backgroundColor as string;\n    div.style.opacity = opacity as string;\n    div.style.border = `${borderType} ${borderWidth} ${borderColor}`;\n    div.className = overlaySelector;\n  }\n\n  viewer.addOverlay(div, rect);\n}\n\nfunction convertSVGStringToHTML(svgString) {\n  if (!svgString) return null;\n  const template = document.createElement(\"template\");\n  template.innerHTML = svgString.trim();\n  const result = template.content.children;\n\n  return result[0];\n}\n\nexport function addSvgOverlay(\n  viewer: any,\n  svgString: string,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  const svgEl = convertSVGStringToHTML(svgString);\n  if (svgEl) {\n    for (const child of svgEl.children) {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    }\n  }\n}\n\nfunction svg_processChild(\n  viewer: any,\n  child: ChildNode,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  if (child.nodeName === \"#text\") {\n    svg_handleTextNode(child);\n  } else {\n    const newElement = svg_handleElementNode(child, configOptions, scale);\n    const overlay = OsdSvgOverlay(viewer);\n    overlay.node().append(newElement);\n    overlay._svg?.setAttribute(\"class\", overlaySelector);\n\n    // BUG: svg with children elements aren't formated correctly.\n    child.childNodes.forEach((child) => {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    });\n  }\n}\n\nexport function svg_handleElementNode(\n  child: any,\n  configOptions: OverlayOptions,\n  scale: number,\n) {\n  let hasStrokeColor = false;\n  let hasStrokeWidth = false;\n  let hasFillColor = false;\n  let hasFillOpacity = false;\n\n  const newElement = document.createElementNS(\n    \"http://www.w3.org/2000/svg\",\n    child.nodeName,\n  );\n\n  if (child.attributes.length > 0) {\n    for (let index = 0; index < child.attributes.length; index++) {\n      const element = child.attributes[index];\n      switch (element.name) {\n        case \"fill\":\n          hasFillColor = true;\n          break;\n        case \"stroke\":\n          hasStrokeColor = true;\n          break;\n        case \"stroke-width\":\n          hasStrokeWidth = true;\n          break;\n        case \"fill-opacity\":\n          hasFillOpacity = true;\n          break;\n      }\n      newElement.setAttribute(element.name, element.textContent);\n    }\n  }\n\n  if (!hasStrokeColor) {\n    newElement.style.stroke = configOptions?.borderColor as string;\n  }\n  if (!hasStrokeWidth) {\n    newElement.style.strokeWidth = configOptions?.borderWidth as string;\n  }\n  if (!hasFillColor) {\n    newElement.style.fill = configOptions?.backgroundColor as string;\n  }\n  if (!hasFillOpacity) {\n    newElement.style.fillOpacity = configOptions?.opacity as string;\n  }\n  newElement.setAttribute(\"transform\", `scale(${scale})`);\n\n  return newElement;\n}\n\nfunction svg_handleTextNode(child: ChildNode) {\n  if (!child.textContent) {\n    return;\n  }\n  if (child.textContent.includes(\"\\n\")) {\n    return;\n  }\n  console.log(\n    \"nodeName:\",\n    child.nodeName,\n    \", textContent:\",\n    child.textContent,\n    \", childNodes.length\",\n    child.childNodes.length,\n  );\n}\n\nexport const parseImageBody = (body: IIIFExternalWebResource) => {\n  const hasImageService =\n    Array.isArray(body?.service) && body?.service.length > 0;\n\n  const uri = hasImageService ? getImageServiceURI(body?.service) : body?.id;\n  const imageType: OpenSeadragonImageTypes = hasImageService\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri,\n    imageType,\n  };\n};\n\nexport const parseSrc = (src: string, isTiledImage: boolean) => {\n  const imageType = isTiledImage\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri: src,\n    imageType,\n  };\n};\nexport function removeOverlaysFromViewer(\n  viewer: OpenSeadragon.Viewer,\n  overlaySelector: string,\n) {\n  if (!viewer) return;\n\n  if (!overlaySelector.startsWith(\".\")) {\n    overlaySelector = \".\" + overlaySelector;\n  }\n  const elements = document.querySelectorAll(overlaySelector);\n  if (elements) {\n    elements.forEach((element) => viewer.removeOverlay(element));\n  }\n}\n\nexport function panToTarget(openSeadragonViewer, zoomLevel, target, canvas) {\n  const parsedAnnotationTarget = parseAnnotationTarget(target);\n\n  const { point, rect, svg } = parsedAnnotationTarget;\n\n  if (point || rect || svg) {\n    const rect = createOpenSeadragonRect(\n      canvas,\n      parsedAnnotationTarget,\n      zoomLevel,\n    );\n    openSeadragonViewer?.viewport.fitBounds(rect);\n  }\n}\n\nexport function addContentSearchOverlays(\n  contentSearchVault: any,\n  contentSearch: AnnotationPageNormalized,\n  openSeadragonViewer,\n  canvas: CanvasNormalized,\n  configOptions: ViewerConfigOptions,\n) {\n  if (!contentSearch?.items) return;\n  if (contentSearch?.items.length === 0) return;\n\n  const annotations: Array<AnnotationNormalized> = [];\n  contentSearch.items.forEach((item) => {\n    const annotation = contentSearchVault.get(item.id) as AnnotationNormalized;\n\n    if (typeof annotation.target === \"string\") {\n      if (annotation.target.startsWith(canvas.id)) {\n        annotations.push(annotation as unknown as AnnotationNormalized);\n      }\n    }\n  });\n\n  if (openSeadragonViewer && configOptions.contentSearch?.overlays) {\n    addOverlaysToViewer(\n      openSeadragonViewer,\n      canvas,\n      configOptions.contentSearch.overlays,\n      annotations,\n      \"content-search-overlay\",\n    );\n  }\n}\n","import { styled } from \"src/styles/stitches.config\";\n\nconst ErrorFallbackStyled = styled(\"div\", {\n  display: \"flex\",\n  flexDirection: \"column\",\n  alignItems: \"center\",\n});\n\nconst Headline = styled(\"p\", {\n  fontWeight: \"bold\",\n  fontSize: \"x-large\",\n});\n\nconst ErrorBody = styled(\"span\", {\n  fontSize: \"medium\",\n});\n\nexport { ErrorFallbackStyled, ErrorBody, Headline };\n","import {\n  ErrorBody,\n  ErrorFallbackStyled,\n  Headline,\n} from \"src/components/UI/ErrorFallback/ErrorFallback.styled\";\n\nimport React from \"react\";\n\ninterface ErrorFallbackProps {\n  error: Error;\n}\n\nconst ErrorFallback: React.FC<ErrorFallbackProps> = ({ error }) => {\n  const { message } = error;\n\n  return (\n    <ErrorFallbackStyled role=\"alert\">\n      <Headline data-testid=\"headline\">Something went wrong</Headline>\n      {message && <ErrorBody>{`Error message: ${message}`} </ErrorBody>}\n    </ErrorFallbackStyled>\n  );\n};\n\nexport default ErrorFallback;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Navigator = styled(\"div\", {\n  position: \"absolute !important\",\n  zIndex: \"1\",\n  top: \"1rem\",\n  left: \"1rem\",\n  width: \"161.8px\",\n  height: \"100px\",\n  backgroundColor: \"#000D\",\n  boxShadow: \"5px 5px 5px #0002\",\n  borderRadius: \"3px\",\n\n  \".displayregion\": {\n    border: \" 3px solid $accent !important\",\n    boxShadow: \"0 0 3px #0006\",\n  },\n\n  \"@sm\": {\n    width: \"123px\",\n    height: \"76px\",\n  },\n\n  \"@xs\": {\n    width: \"100px\",\n    height: \"61.8px\",\n  },\n});\n\nconst Viewport = styled(\"div\", {\n  position: \"relative\",\n  width: \"100%\",\n  height: \"100%\",\n  zIndex: \"0\",\n});\n\nconst Wrapper = styled(\"div\", {\n  width: \"100%\",\n  height: \"100%\",\n  maxHeight: \"100vh\",\n  background: \"transparent\",\n  backgroundSize: \"contain\",\n  color: \"white\",\n  position: \"relative\",\n  zIndex: \"0\",\n  overflow: \"hidden\",\n\n  variants: {\n    hasNavigator: {\n      true: {\n        [`${Navigator}`]: {\n          display: \"block\",\n        },\n      },\n      false: {\n        [`${Navigator}`]: {\n          display: \"none\",\n        },\n      },\n    },\n  },\n});\n\nexport { Navigator, Viewport, Wrapper };\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Item = styled(\"button\", {\n  display: \"flex\",\n  height: \"2rem\",\n  width: \"2rem\",\n  borderRadius: \"2rem\",\n  padding: \"0\",\n  margin: \"0\",\n  fontFamily: \"inherit\",\n  background: \"none\",\n  backgroundColor: \"$primary\",\n  border: \"none\",\n  color: \"white\",\n  cursor: \"pointer\",\n  marginLeft: \"0.618rem\",\n  filter: \"drop-shadow(2px 2px 5px #0003)\",\n  transition: \"$all\",\n  boxSizing: \"content-box !important\",\n\n  \"&:first-child\": {\n    marginLeft: \"0\",\n  },\n\n  \"@xs\": {\n    marginBottom: \"0.618rem\",\n    marginLeft: \"0\",\n\n    \"&:last-child\": {\n      marginBottom: \"0\",\n    },\n  },\n\n  svg: {\n    height: \"60%\",\n    width: \"60%\",\n    padding: \"20%\",\n    fill: \"$secondary\",\n    stroke: \"$secondary\",\n    filter: \"drop-shadow(2px 2px 5px #0003)\",\n    transition: \"$all\",\n    boxSizing: \"inherit\",\n  },\n\n  \"&:hover, &:focus\": {\n    backgroundColor: \"$accent\",\n  },\n\n  \"&[data-button=rotate-right]\": {\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"45deg\",\n      },\n    },\n  },\n\n  \"&[data-button=rotate-left]\": {\n    transform: \"scaleX(-1)\",\n\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"45deg\",\n      },\n    },\n  },\n\n  \"&[data-button=reset]\": {\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"-15deg\",\n      },\n    },\n  },\n});\n\nexport { Item };\n","import { Item } from \"src/components/Image/Controls/Button.styled\";\nimport React from \"react\";\n\ninterface ButtonProps {\n  className?: string;\n  id: string;\n  label: string;\n  children: React.ReactChild;\n}\n\nconst Button: React.FC<ButtonProps> = ({ className, id, label, children }) => {\n  const dataButton = label.toLowerCase().replace(/\\s/g, \"-\");\n  return (\n    <Item\n      id={id}\n      className={className}\n      data-testid=\"openseadragon-button\"\n      data-button={dataButton}\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-labelledby={`${id}-svg-title`}\n        data-testid=\"openseadragon-button-svg\"\n        focusable=\"false\"\n        viewBox=\"0 0 512 512\"\n        role=\"img\"\n      >\n        <title id={`${id}-svg-title`}>{label}</title>\n        {children}\n      </svg>\n    </Item>\n  );\n};\n\nexport default Button;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Wrapper = styled(\"div\", {\n  position: \"absolute\",\n  zIndex: \"1\",\n  top: \"1rem\",\n  right: \"1rem\",\n  display: \"flex\",\n\n  \"@xs\": {\n    flexDirection: \"column\",\n    zIndex: \"2\",\n  },\n\n  variants: {\n    hasPlaceholder: {\n      true: {\n        right: \"3.618rem\",\n\n        \"@xs\": {\n          top: \"3.618rem\",\n          right: \"1rem\",\n        },\n      },\n\n      false: {\n        right: \"1rem\",\n\n        \"@xs\": {\n          top: \"1rem\",\n          right: \"1rem\",\n        },\n      },\n    },\n  },\n});\n\nexport { Wrapper };\n","import OpenSeadragon, { Options as OpenSeadragonOptions } from \"openseadragon\";\nimport React, { useReducer } from \"react\";\n\nimport { CollectionNormalized } from \"@iiif/presentation-3\";\nimport { IncomingHttpHeaders } from \"http\";\nimport { Vault } from \"@iiif/vault\";\nimport { deepMerge } from \"src/lib/utils\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport type AutoScrollSettings = {\n  behavior: string; // ScrollBehavior (\"auto\" | \"instant\" | \"smooth\")\n  block: string; // ScrollLogicalPosition (\"center\" | \"end\" | \"nearest\" | \"start\")\n};\n\nexport type AutoScrollOptions = {\n  enabled: boolean;\n  settings: AutoScrollSettings;\n};\n\nexport type ViewerConfigOptions = {\n  annotationOverlays?: OverlayOptions;\n  background?: string;\n  canvasBackgroundColor?: string;\n  canvasHeight?: string;\n  contentSearch?: {\n    searchResultsLimit?: number;\n    overlays?: OverlayOptions;\n  };\n  ignoreCaptionLabels?: string[];\n  pages?: {\n  \tshow?: boolean,\n  \ttoggleLabel?: string;\n  };\n  informationPanel?: {\n    open?: boolean;\n    renderAbout?: boolean;\n    renderSupplementing?: boolean;\n    renderToggle?: boolean;\n    renderAnnotation?: boolean;\n    toggleLabel?: string;\n    vtt?: {\n      autoScroll?: AutoScrollOptions | AutoScrollSettings | boolean;\n    };\n    renderContentSearch?: boolean;\n    defaultTab?: string;\n  };\n  openSeadragon?: OpenSeadragonOptions;\n  requestHeaders?: IncomingHttpHeaders;\n  showDownload?: boolean;\n  headerNavigation?: string;\n  showIIIFBadge?: boolean;\n  showTitle?: boolean;\n  withCredentials?: boolean;\n  localeText?: {\n    contentSearch?: {\n      tabLabel?: string;\n      formPlaceholder?: string;\n      noSearchResults?: string;\n      loading?: string;\n      moreResults?: string;\n    };\n  };\n  initialSearch?: string;\n  initialPage?: number;\n};\n\nexport type OverlayOptions = {\n  backgroundColor?: string;\n  borderColor?: string;\n  borderType?: string;\n  borderWidth?: string;\n  opacity?: string;\n  renderOverlays?: boolean;\n  zoomLevel?: number;\n};\n\nconst defaultAutoScrollSettings: AutoScrollSettings = {\n  behavior: \"smooth\",\n  block: \"center\",\n};\n\nconst defaultConfigOptions = {\n  annotationOverlays: {\n    backgroundColor: \"#6666ff\",\n    borderColor: \"#000099\",\n    borderType: \"solid\",\n    borderWidth: \"1px\",\n    opacity: \"0.5\",\n    renderOverlays: true,\n    zoomLevel: 2,\n  },\n  background: \"transparent\",\n  canvasBackgroundColor: \"#6662\",\n  canvasHeight: \"500px\",\n  contentSearch: {\n    searchResultsLimit: 20,\n    overlays: {\n      backgroundColor: \"#ff6666\",\n      borderColor: \"#990000\",\n      borderType: \"solid\",\n      borderWidth: \"1px\",\n      opacity: \"0.5\",\n      renderOverlays: true,\n      zoomLevel: 4,\n    },\n  },\n  ignoreCaptionLabels: [],\n  pages: {\n  \tshow: true,\n  \ttoggleLabel: \"Pages\"\n  },\n  informationPanel: {\n    vtt: {\n      autoScroll: {\n        enabled: true,\n        settings: defaultAutoScrollSettings,\n      },\n    },\n    open: true,\n    renderAbout: true,\n    renderSupplementing: true,\n    renderToggle: true,\n    renderAnnotation: true,\n    renderContentSearch: true,\n  },\n  openSeadragon: {},\n  requestHeaders: { \"Content-Type\": \"application/json\" },\n  showDownload: true,\n  showIIIFBadge: true,\n  showTitle: true,\n  withCredentials: false,\n  localeText: {\n    contentSearch: {\n      tabLabel: \"Search Results\",\n      formPlaceholder: \"Enter search words\",\n      noSearchResults: \"No search results\",\n      loading: \"Loading...\",\n      moreResults: \"more results\",\n    },\n  },\n};\n\nexport type CustomDisplay = {\n  display: {\n    component: React.ElementType;\n    componentProps?: Record<string, unknown>;\n  };\n  target: {\n    canvasId?: string[];\n    paintingFormat?: string[];\n  };\n};\nexport type PluginConfig = {\n  id: string;\n  imageViewer?: {\n    menu?: {\n      component: React.ElementType;\n      componentProps?: Record<string, unknown>;\n    };\n  };\n  informationPanel?: {\n    component: React.ElementType;\n    componentProps?: Record<string, unknown>;\n    label: string;\n  };\n};\n\nexport interface ViewerContextStore {\n  activeCanvas: string;\n  activeManifest: string;\n  OSDImageLoaded?: boolean;\n  collection?: CollectionNormalized | Record<string, never>;\n  configOptions: ViewerConfigOptions;\n  customDisplays: Array<CustomDisplay>;\n  plugins: Array<PluginConfig>;\n  isAutoScrollEnabled?: boolean;\n  isAutoScrolling?: boolean;\n  isInformationOpen: boolean;\n  showPageNavigation: boolean;\n  isLoaded: boolean;\n  isUserScrolling?: number | undefined;\n  vault: Vault;\n  contentSearchVault: Vault;\n  openSeadragonViewer: OpenSeadragon.Viewer | null;\n  openSeadragonId?: string;\n  viewerId?: string;\n}\n\nexport interface ViewerAction {\n  type: string;\n  canvasId: string;\n  collection: CollectionNormalized;\n  configOptions: ViewerConfigOptions;\n  isAutoScrollEnabled: boolean;\n  isAutoScrolling: boolean;\n  isInformationOpen: boolean;\n  showPageNavigation: boolean;\n  isLoaded: boolean;\n  isUserScrolling: number | undefined;\n  manifestId: string;\n  OSDImageLoaded?: boolean;\n  vault: Vault;\n  contentSearchVault: Vault;\n  openSeadragonViewer: OpenSeadragon.Viewer;\n  viewerId: string;\n}\n\nexport function expandAutoScrollOptions(\n  value: AutoScrollOptions | AutoScrollSettings | boolean | undefined,\n): AutoScrollOptions {\n  let result: AutoScrollOptions = {\n    ...defaultConfigOptions.informationPanel.vtt.autoScroll,\n  };\n  if (typeof value === \"object\") {\n    result = \"enabled\" in value ? value : { enabled: true, settings: value };\n  }\n  if (value === false) result.enabled = false;\n  validateAutoScrollSettings(result.settings);\n  return result;\n}\n\nfunction validateAutoScrollSettings({ behavior, block }: AutoScrollSettings) {\n  const validBehaviors = [\"auto\", \"instant\", \"smooth\"];\n  const validPositions = [\"center\", \"end\", \"nearest\", \"start\"];\n  if (!validBehaviors.includes(behavior))\n    throw TypeError(`'${behavior}' not in ${validBehaviors.join(\" | \")}`);\n  if (!validPositions.includes(block))\n    throw TypeError(`'${block}' not in ${validPositions.join(\" | \")}`);\n}\n\nconst expandedAutoScrollOptions = expandAutoScrollOptions(\n  defaultConfigOptions?.informationPanel?.vtt?.autoScroll,\n);\n\nexport const defaultState: ViewerContextStore = {\n  activeCanvas: \"\",\n  activeManifest: \"\",\n  OSDImageLoaded: false,\n  collection: {},\n  configOptions: defaultConfigOptions,\n  customDisplays: [],\n  plugins: [],\n  isAutoScrollEnabled: expandedAutoScrollOptions.enabled,\n  isAutoScrolling: false,\n  isInformationOpen: defaultConfigOptions?.informationPanel?.open,\n  showPageNavigation: defaultConfigOptions?.pages?.show,\n  isLoaded: false,\n  isUserScrolling: undefined,\n  vault: new Vault(),\n  contentSearchVault: new Vault(),\n  openSeadragonViewer: null,\n  viewerId: uuidv4(),\n};\n\nconst ViewerStateContext =\n  React.createContext<ViewerContextStore>(defaultState);\nconst ViewerDispatchContext =\n  React.createContext<ViewerContextStore>(defaultState);\n\nfunction viewerReducer(state: ViewerContextStore, action: ViewerAction) {\n  switch (action.type) {\n    case \"updateActiveCanvas\": {\n      /**\n       * Set canvasId to empty string if it comes back undefined.\n       */\n      if (!action.canvasId) action.canvasId = \"\";\n      return {\n        ...state,\n        activeCanvas: action.canvasId,\n      };\n    }\n    case \"updateActiveManifest\": {\n      return {\n        ...state,\n        activeManifest: action.manifestId,\n      };\n    }\n    case \"updateOSDImageLoaded\": {\n      return {\n        ...state,\n        OSDImageLoaded: action.OSDImageLoaded,\n      };\n    }\n    case \"updateAutoScrollAnnotationEnabled\": {\n      return {\n        ...state,\n        isAutoScrollEnabled: action.isAutoScrollEnabled,\n      };\n    }\n    case \"updateAutoScrolling\": {\n      return {\n        ...state,\n        isAutoScrolling: action.isAutoScrolling,\n      };\n    }\n    case \"updateCollection\": {\n      return {\n        ...state,\n        collection: action.collection,\n      };\n    }\n    case \"updateConfigOptions\": {\n      return {\n        ...state,\n        configOptions: deepMerge(state.configOptions, action.configOptions),\n      };\n    }\n    case \"updateInformationOpen\": {\n      return {\n        ...state,\n        isInformationOpen: action.isInformationOpen,\n      };\n    }\n    case \"updateShowPageNavigation\": {\n      return {\n        ...state,\n        showPageNavigation: action.showPageNavigation,\n      };\n    }\n    case \"updateIsLoaded\": {\n      return {\n        ...state,\n        isLoaded: action.isLoaded,\n      };\n    }\n    case \"updateUserScrolling\": {\n      return {\n        ...state,\n        isUserScrolling: action.isUserScrolling,\n      };\n    }\n    case \"updateOpenSeadragonViewer\": {\n      return {\n        ...state,\n        openSeadragonViewer: action.openSeadragonViewer,\n      };\n    }\n    case \"updateViewerId\": {\n      return {\n        ...state,\n        viewerId: action.viewerId,\n      };\n    }\n    default: {\n      throw new Error(`Unhandled action type: ${action.type}`);\n    }\n  }\n}\n\ninterface ViewerProviderProps {\n  initialState?: ViewerContextStore;\n  children: React.ReactNode;\n}\n\nconst ViewerProvider: React.FC<ViewerProviderProps> = ({\n  initialState = defaultState,\n  children,\n}) => {\n  const [state, dispatch] = useReducer<\n    React.Reducer<ViewerContextStore, ViewerAction>\n  >(viewerReducer, initialState);\n\n  return (\n    <ViewerStateContext.Provider value={state}>\n      <ViewerDispatchContext.Provider\n        value={dispatch as unknown as ViewerContextStore}\n      >\n        {children}\n      </ViewerDispatchContext.Provider>\n    </ViewerStateContext.Provider>\n  );\n};\n\nfunction useViewerState() {\n  const context = React.useContext(ViewerStateContext);\n  if (context === undefined) {\n    throw new Error(\"useViewerState must be used within a ViewerProvider\");\n  }\n  return context;\n}\n\nfunction useViewerDispatch() {\n  const context = React.useContext(ViewerDispatchContext);\n  if (context === undefined) {\n    throw new Error(\"useViewerDispatch must be used within a ViewerProvider\");\n  }\n  return context;\n}\n\nexport { ViewerProvider, useViewerState, useViewerDispatch };\n","import Button from \"src/components/Image/Controls/Button\";\nimport { Options } from \"openseadragon\";\nimport React from \"react\";\nimport { Wrapper } from \"src/components/Image/Controls/Controls.styled\";\nimport {\n  ViewerContextStore,\n  useViewerState,\n  useViewerDispatch,\n} from \"src/context/viewer-context\";\nimport { CanvasNormalized } from \"@iiif/presentation-3\";\n\nconst ZoomIn = () => {\n  return (\n    <path\n      strokeLinecap=\"round\"\n      strokeMiterlimit=\"10\"\n      strokeWidth=\"45\"\n      d=\"M256 112v288M400 256H112\"\n    />\n  );\n};\n\nconst ZoomOut = () => {\n  return (\n    <path\n      strokeLinecap=\"round\"\n      strokeMiterlimit=\"10\"\n      strokeWidth=\"45\"\n      d=\"M400 256H112\"\n    />\n  );\n};\n\nconst ZoomFullScreen = () => {\n  return (\n    <path\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      strokeWidth=\"32\"\n      d=\"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304\"\n    />\n  );\n};\n\nconst Reset = () => {\n  return (\n    <path d=\"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z\" />\n  );\n};\n\nconst Rotate = () => {\n  return (\n    <>\n      <path\n        fill=\"none\"\n        strokeLinecap=\"round\"\n        strokeMiterlimit=\"10\"\n        strokeWidth=\"45\"\n        d=\"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128\"\n      />\n      <path d=\"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z\" />\n    </>\n  );\n};\n\nconst Controls = ({\n  _cloverViewerHasPlaceholder,\n  config,\n}: {\n  _cloverViewerHasPlaceholder: boolean;\n  config: Options;\n}) => {\n  const viewerState: ViewerContextStore = useViewerState();\n  const {\n    activeCanvas,\n    configOptions,\n    openSeadragonViewer,\n    plugins,\n    vault,\n    activeManifest,\n  } = viewerState;\n\n  const canvas: CanvasNormalized = vault.get({\n    id: activeCanvas,\n    type: \"Canvas\",\n  });\n\n  function renderPlugins() {\n    return plugins\n      .filter((plugin) => plugin.imageViewer?.menu)\n      .map((plugin, i) => {\n        const PluginComponent = plugin.imageViewer?.menu\n          ?.component as unknown as React.ElementType;\n        return (\n          <PluginComponent\n            key={i}\n            {...plugin?.imageViewer?.menu?.componentProps}\n            activeManifest={activeManifest}\n            canvas={canvas}\n            viewerConfigOptions={configOptions}\n            openSeadragonViewer={openSeadragonViewer}\n            useViewerDispatch={useViewerDispatch}\n            useViewerState={useViewerState}\n          ></PluginComponent>\n        );\n      });\n  }\n\n  return (\n    <Wrapper\n      data-testid=\"clover-iiif-image-openseadragon-controls\"\n      hasPlaceholder={_cloverViewerHasPlaceholder}\n    >\n      {config.showZoomControl && (\n        <>\n          <Button id={config.zoomInButton as string} label=\"zoom in\">\n            <ZoomIn />\n          </Button>\n          <Button id={config.zoomOutButton as string} label=\"zoom out\">\n            <ZoomOut />\n          </Button>\n        </>\n      )}\n      {config.showFullPageControl && (\n        <Button id={config.fullPageButton as string} label=\"full page\">\n          <ZoomFullScreen />\n        </Button>\n      )}\n      {config.showRotationControl && (\n        <>\n          <Button id={config.rotateRightButton as string} label=\"rotate right\">\n            <Rotate />\n          </Button>\n          <Button id={config.rotateLeftButton as string} label=\"rotate left\">\n            <Rotate />\n          </Button>\n        </>\n      )}\n      {config.showHomeControl && (\n        <Button id={config.homeButton as string} label=\"reset\">\n          <Reset />\n        </Button>\n      )}\n      {renderPlugins()}\n    </Wrapper>\n  );\n};\n\nexport default Controls;\n","import {\n  Navigator,\n  Viewport,\n  Wrapper,\n} from \"src/components/Image/Image.styled\";\nimport OpenSeadragon, { Options } from \"openseadragon\";\nimport React, { useEffect, useRef, useState } from \"react\";\n\nimport Controls from \"src/components/Image/Controls/Controls\";\nimport { OpenSeadragonImageTypes } from \"src/types/open-seadragon\";\nimport { getInfoResponse } from \"src/lib/iiif\";\nimport { useViewerDispatch } from \"src/context/viewer-context\";\n\ninterface OSDProps {\n  _cloverViewerHasPlaceholder: boolean;\n  ariaLabel?: string | null;\n  config: Options;\n  uri: string | undefined;\n  imageType: OpenSeadragonImageTypes;\n  openSeadragonCallback?: (viewer: OpenSeadragon.Viewer) => void;\n}\n\nconst OSD: React.FC<OSDProps> = ({\n  ariaLabel,\n  config,\n  uri,\n  _cloverViewerHasPlaceholder,\n  imageType,\n  openSeadragonCallback,\n}) => {\n  const [osdUri, setOsdUri] = useState<string>();\n  const [openSeadragon, setOpenSeadragon] = useState<OpenSeadragon.Viewer>();\n  const dispatch: any = useViewerDispatch();\n\n  const initializeOSD = useRef(false);\n\n  useEffect(() => {\n    if (!initializeOSD.current) {\n      initializeOSD.current = true;\n\n      if (!openSeadragon) setOpenSeadragon(OpenSeadragon(config));\n    }\n\n    return () => openSeadragon?.destroy();\n  }, []);\n\n  useEffect(() => {\n    if (openSeadragon && openSeadragonCallback)\n      openSeadragonCallback(openSeadragon);\n  }, [openSeadragon, openSeadragonCallback]);\n\n  useEffect(() => {\n    if (openSeadragon && uri !== osdUri) {\n      openSeadragon?.forceRedraw();\n      setOsdUri(uri);\n    }\n  }, [openSeadragon, osdUri, uri]);\n\n  useEffect(() => {\n    if (osdUri && openSeadragon) {\n      switch (imageType) {\n        case \"simpleImage\":\n          openSeadragon?.addSimpleImage({\n            url: osdUri,\n          });\n          break;\n        case \"tiledImage\":\n          getInfoResponse(osdUri).then((tileSource) => {\n            try {\n              if (!tileSource)\n                throw new Error(`No tile source found for ${osdUri}`);\n\n              openSeadragon?.addTiledImage({\n                tileSource,\n                success: () => {\n                  // NOTE: need to check dispatch is a function, because when\n                  // using dev server, dispatch sometimes is set to\n                  // ViewerContext.defaultState object instead of a function\n                  if (typeof dispatch === \"function\") {\n                    dispatch({\n                      type: \"updateOSDImageLoaded\",\n                      OSDImageLoaded: true,\n                    });\n                  }\n                },\n              });\n            } catch (e) {\n              console.error(e);\n            }\n          });\n          break;\n        default:\n          openSeadragon?.close();\n          console.warn(\n            `Unable to render ${osdUri} in OpenSeadragon as type: \"${imageType}\"`,\n          );\n          break;\n      }\n    }\n  }, [imageType, osdUri]);\n\n  return (\n    <Wrapper\n      className=\"clover-iiif-image-openseadragon\"\n      data-testid=\"clover-iiif-image-openseadragon\"\n      data-openseadragon-instance={config.id}\n      hasNavigator={config.showNavigator}\n    >\n      <Controls\n        _cloverViewerHasPlaceholder={_cloverViewerHasPlaceholder}\n        config={config}\n      />\n      {config.showNavigator && (\n        <Navigator\n          id={config.navigatorId}\n          data-testid=\"clover-iiif-image-openseadragon-navigator\"\n        />\n      )}\n      <Viewport\n        id={config.id}\n        data-testid=\"clover-iiif-image-openseadragon-viewport\"\n        role=\"img\"\n        {...(ariaLabel && { \"aria-label\": ariaLabel })}\n      />\n    </Wrapper>\n  );\n};\n\nexport default OSD;\n","import { Options } from \"openseadragon\";\n\nfunction defaultOpenSeadragonConfiguration(\n  openSeadragonInstance: string,\n): Options {\n  return {\n    id: `openseadragon-${openSeadragonInstance}`,\n    navigatorId: `openseadragon-navigator-${openSeadragonInstance}`,\n    loadTilesWithAjax: true,\n    fullPageButton: `fullPage-${openSeadragonInstance}`,\n    homeButton: `reset-${openSeadragonInstance}`,\n    rotateLeftButton: `rotateLeft-${openSeadragonInstance}`,\n    rotateRightButton: `rotateRight-${openSeadragonInstance}`,\n    zoomInButton: `zoomIn-${openSeadragonInstance}`,\n    zoomOutButton: `zoomOut-${openSeadragonInstance}`,\n    showNavigator: true,\n    showFullPageControl: true,\n    showHomeControl: true,\n    showRotationControl: true,\n    showZoomControl: true,\n    navigatorBorderColor: \"transparent\",\n    gestureSettingsMouse: {\n      clickToZoom: true,\n      dblClickToZoom: true,\n      pinchToZoom: true,\n      scrollToZoom: false,\n    },\n  };\n}\n\nexport default defaultOpenSeadragonConfiguration;\n","import { parseImageBody, parseSrc } from \"src/lib/openseadragon-helpers\";\n\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport ErrorFallback from \"src/components/UI/ErrorFallback/ErrorFallback\";\nimport { InternationalString } from \"@iiif/presentation-3\";\nimport { LabeledIIIFExternalWebResource } from \"src/types/presentation-3\";\nimport OSD from \"src/components/Image/OSD/OSD\";\nimport { Options } from \"openseadragon\";\nimport React from \"react\";\nimport defaultOpenSeadragonConfig from \"src/components/Image/OSD/defaults\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { v4 as uuidv4 } from \"uuid\";\n\ninterface CloverImageProps {\n  _cloverViewerHasPlaceholder?: boolean;\n  body?: LabeledIIIFExternalWebResource;\n  instanceId?: string;\n  isTiledImage?: boolean;\n  label?: InternationalString | string;\n  src?: string;\n  openSeadragonCallback?: (viewer: any) => void;\n  openSeadragonConfig?: Options;\n}\n\nconst CloverImage: React.FC<CloverImageProps> = ({\n  _cloverViewerHasPlaceholder = false,\n  body,\n  instanceId,\n  isTiledImage = false,\n  label,\n  src = \"\",\n  openSeadragonCallback,\n  openSeadragonConfig = {},\n}) => {\n  const instance = instanceId ? instanceId : uuidv4();\n  const ariaLabel = typeof label === \"string\" ? label : getLabelAsString(label);\n  const config = {\n    ...defaultOpenSeadragonConfig(instance),\n    ...openSeadragonConfig,\n  };\n\n  const { imageType, uri } = body\n    ? parseImageBody(body)\n    : parseSrc(src, isTiledImage);\n\n  if (!uri) return null;\n\n  return (\n    <ErrorBoundary FallbackComponent={ErrorFallback}>\n      <OSD\n        _cloverViewerHasPlaceholder={_cloverViewerHasPlaceholder}\n        ariaLabel={ariaLabel}\n        config={config}\n        imageType={imageType}\n        key={instance}\n        uri={uri}\n        openSeadragonCallback={openSeadragonCallback}\n      />\n    </ErrorBoundary>\n  );\n};\n\nexport default CloverImage;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst StyledImageViewer = styled(\"div\", {\n  width: \"100%\",\n  height: \"400px\",\n  background: \"#6662\",\n  backgroundSize: \"contain\",\n  color: \"white\",\n  position: \"relative\",\n  zIndex: \"1\",\n  overflow: \"hidden\",\n});\n\nexport { StyledImageViewer };\n","import {\n  IIIFExternalWebResource,\n  InternationalString,\n} from \"@iiif/presentation-3\";\n\nimport CloverImage from \"src/components/Image\";\nimport React from \"react\";\nimport { StyledImageViewer } from \"src/components/Scroll/Figure/ImageViewer.styled\";\n\ninterface ImageViewerProps {\n  body: IIIFExternalWebResource;\n  label?: InternationalString | null;\n}\n\nconst ImageViewer: React.FC<ImageViewerProps> = ({ body, label }) => {\n  return (\n    <StyledImageViewer data-testid=\"scroll-figure-image\">\n      <CloverImage\n        body={body}\n        openSeadragonConfig={{ showNavigator: false, showHomeControl: false }}\n        {...(label && { label: label })}\n      />\n    </StyledImageViewer>\n  );\n};\n\nexport default ImageViewer;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst StyledFigure = styled(\"figure\", {\n  figcaption: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    margin: \"1.618rem 0 0\",\n    opacity: 0.9,\n\n    em: {\n      fontSize: \"0.9em\",\n      fontStyle: \"normal\",\n      opacity: 0.7,\n    },\n  },\n});\n\nexport { StyledFigure };\n","import {\n  Annotation,\n  AnnotationPageNormalized,\n  Canvas,\n  CanvasNormalized,\n  ContentResource,\n  ExternalResourceTypes,\n  IIIFExternalWebResource,\n} from \"@iiif/presentation-3\";\n\nexport interface CanvasEntity {\n  canvas: CanvasNormalized | undefined;\n  accompanyingCanvas: Canvas | undefined;\n  annotationPage: AnnotationPageNormalized | undefined;\n  annotations: Array<Annotation | undefined>;\n}\n\nexport const getCanvasByCriteria = (\n  vault: any,\n  item: Canvas,\n  motivation: string,\n  paintingType: Array<ExternalResourceTypes>,\n): CanvasEntity => {\n  const entity: CanvasEntity = {\n    canvas: undefined,\n    accompanyingCanvas: undefined,\n    annotationPage: undefined,\n    annotations: [],\n  };\n\n  const filterAnnotations = (annotation: Annotation) => {\n    if (annotation) {\n      // Handle invalid annotations\n      if (!annotation.body || !annotation.motivation) {\n        console.error(\n          `Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'`,\n          annotation,\n        );\n        return;\n      }\n\n      let annotationBody = annotation.body as\n        | ContentResource\n        | ContentResource[];\n\n      if (Array.isArray(annotationBody)) annotationBody = annotationBody[0];\n\n      // console.log(\"annotationBody\", annotationBody);\n\n      const resource: IIIFExternalWebResource = vault.get(annotationBody.id);\n\n      if (!resource) return;\n      switch (motivation) {\n        case \"painting\":\n          if (\n            annotation.target === item.id &&\n            annotation.motivation &&\n            annotation.motivation[0] === \"painting\" &&\n            paintingType.includes(resource.type)\n          )\n            annotation.body = resource;\n          return !!annotation;\n        case \"supplementing\":\n          return;\n        default: {\n          throw new Error(`Invalid annotation motivation.`);\n        }\n      }\n    }\n  };\n\n  entity.canvas = vault.get(item);\n\n  if (entity.canvas) {\n    entity.annotationPage = vault.get(entity.canvas.items[0]);\n    entity.accompanyingCanvas = entity.canvas?.accompanyingCanvas\n      ? vault.get(entity.canvas?.accompanyingCanvas)\n      : undefined;\n  }\n\n  /**\n   * get all annotations on an annotation page resource\n   * and add them to the annotations array on the canvas entity\n   */\n  if (entity.annotationPage) {\n    /**\n     * get all initial annotation page resources\n     */\n    const annotationPageResources = vault\n      .get(entity.annotationPage.items)\n      .map((item) => {\n        return {\n          body: vault.get(item.body[0].id),\n          motivation: item.motivation,\n          type: \"Annotation\",\n        };\n      });\n\n    const annotations: Annotation[] = [];\n    annotationPageResources.forEach((annotation) => {\n      /**\n       * determine if type is a choice of multiple annotations\n       * if so, add each annotation to the annotations array\n       */\n      if (annotation.body.type === \"Choice\") {\n        annotation.body.items.forEach((item) =>\n          annotations.push({\n            ...annotation,\n            id: item.id,\n            body: vault.get(item.id),\n          }),\n        );\n\n        /**\n         * if not, add the single annotation to the annotations array\n         */\n      } else {\n        annotations.push(annotation);\n      }\n    });\n\n    /**\n     * filter annotations and scrub invalid annotations\n     */\n    entity.annotations = annotations.filter(filterAnnotations);\n  }\n\n  return entity;\n};\n","import { IIIFExternalWebResource } from \"@iiif/presentation-3\";\nimport { getCanvasByCriteria } from \"src/hooks/use-iiif\";\n\nexport const getPaintingResource = (\n  vault: any,\n  id: string,\n): IIIFExternalWebResource[] | undefined => {\n  const canvasEntity = getCanvasByCriteria(\n    vault,\n    { id, type: \"Canvas\" },\n    \"painting\",\n    [\"Image\", \"Sound\", \"Video\"],\n  );\n\n  if (canvasEntity.annotations.length === 0) return;\n\n  if (canvasEntity.annotations && canvasEntity.annotations)\n    return canvasEntity.annotations.map(\n      (item) => item?.body,\n    ) as IIIFExternalWebResource[];\n\n  return;\n};\n","import React, { useContext } from \"react\";\n\nimport { CanvasNormalized } from \"@iiif/presentation-3\";\nimport FigureCaption from \"src/components/Scroll/Figure/Caption\";\nimport ImageViewer from \"src/components/Scroll/Figure/ImageViewer\";\nimport { ScrollContext } from \"src/context/scroll-context\";\nimport { StyledFigure } from \"src/components/Scroll/Figure/Figure.styled\";\nimport { getPaintingResource } from \"src/hooks/use-iiif\";\n\ninterface CanvasProps {\n  canvas: CanvasNormalized;\n  canvasInfo: {\n    current: number;\n    total: number;\n  };\n}\n\nconst ScrollCanvasFigure: React.FC<CanvasProps> = ({ canvas, canvasInfo }) => {\n  const { state } = useContext(ScrollContext);\n  const { vault } = state;\n\n  const painting = getPaintingResource(vault, canvas.id);\n\n  if (!painting) return null;\n\n  return (\n    <StyledFigure>\n      {painting?.map((body) => (\n        <ImageViewer body={body} key={body?.id} label={canvas?.label} />\n      ))}\n      <FigureCaption canvas={canvas} canvasInfo={canvasInfo} />\n    </StyledFigure>\n  );\n};\n\nexport default ScrollCanvasFigure;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst highlightColor = \"255, 197, 32\"; // #FFC520\n\nconst TextualBody = styled(\"div\", {\n  ul: {\n    padding: \"1rem\",\n  },\n\n  li: {\n    listStyleType: \"disc\",\n\n    li: {\n      listStyleType: \"circle\",\n    },\n  },\n\n  \"span.highlight\": {\n    position: \"relative\",\n    fontWeight: \"bold\",\n\n    \"&::before\": {\n      top: \"0\",\n      position: \"absolute\",\n      display: \"inline\",\n      content: \"\",\n      width: \"calc(100% + 4px)\",\n      height: \"calc(100% + 2px) \",\n      marginLeft: \"-2px\",\n      borderRadius: \"3px\",\n      border: `1px solid rgba(${highlightColor}, 0.2)`,\n      borderBottom: `1px solid rgba(${highlightColor}, 0.618)`,\n      boxShadow: `1px 1px 1px #6661`,\n    },\n\n    \"&::after\": {\n      left: \"0\",\n      top: \"0\",\n      position: \"absolute\",\n      display: \"inline\",\n      content: \"\",\n      width: \"calc(100% + 4px)\",\n      height: \"calc(100% + 2px) \",\n      marginLeft: \"-2px\",\n      marginTop: \"-1px\",\n      borderRadius: \"3px\",\n      backgroundColor: `rgba(${highlightColor}, 0.2)`,\n      zIndex: -1,\n    },\n  },\n});\n\nexport { TextualBody };\n","const getSearchResultSnippet = ({\n  searchString = \"\",\n  content,\n  stringLength = 150,\n}: {\n  searchString?: string;\n  content: string;\n  stringLength?: number;\n}) => {\n  const index = content.toLowerCase().indexOf(searchString.toLowerCase());\n  if (index !== -1) {\n    // Try to find the start of the context slice without breaking words\n    let start = Math.max(0, index - stringLength / 2);\n    let end = Math.min(\n      content.length,\n      index + searchString.length + stringLength / 2,\n    );\n\n    if (start > 0) {\n      const startSpaceIndex = content.lastIndexOf(\" \", start + 1);\n      start = startSpaceIndex > 0 ? startSpaceIndex + 1 : start;\n    }\n    if (end < content.length) {\n      const endSpaceIndex = content.indexOf(\" \", end - 1);\n      end = endSpaceIndex > -1 ? endSpaceIndex : end;\n    }\n\n    content =\n      (start > 0 ? \"... \" : \"\") +\n      content.substring(start, end) +\n      (end < content.length ? \" ...\" : \"\");\n  } else {\n    // If the searchString is not found, return the first stringLength characters without breaking words\n    content = String(content.substring(0, stringLength) + \"...\");\n  }\n\n  return content;\n};\n\nexport { getSearchResultSnippet };\n","import React, { useContext } from \"react\";\n\nimport { EmbeddedResource } from \"@iiif/presentation-3\";\nimport { ScrollContext } from \"src/context/scroll-context\";\nimport { TextualBody } from \"src/components/Scroll/Annotation/Body.styled\";\nimport { getSearchResultSnippet } from \"src/lib/search-helpers\";\nimport useMarkdown from \"@nulib/use-markdown\";\n\nconst ScrollAnnotationBody = ({\n  body,\n  stringLength,\n  type = \"content\",\n}: {\n  body: EmbeddedResource;\n  stringLength?: number;\n  type?: string;\n}) => {\n  const { state } = useContext(ScrollContext);\n  const { searchString } = state;\n\n  let value = String(body.value);\n\n  // Extracting the contextual slice around the searchString without breaking words\n  if (type == \"snippet\")\n    value = getSearchResultSnippet({\n      searchString,\n      content: value,\n      stringLength,\n    });\n\n  let innerHtml: string | undefined;\n  const markdownContent = useMarkdown(value);\n\n  // Converting plain text to HTML if needed\n  if (body.format === \"text/plain\") {\n    const regex = /\\n/g;\n    innerHtml = value?.replace(regex, \"<br />\");\n  }\n\n  // Using the processed markdown as HTML\n  if (body.format === \"text/markdown\") {\n    innerHtml = markdownContent?.html;\n  }\n\n  // If already HTML, use it directly\n  if (body.format === \"text/html\") {\n    innerHtml = value;\n  }\n\n  // Highlighting the searchString\n  if (searchString && innerHtml) {\n    const regex = new RegExp(`(${searchString})`, \"gi\");\n    innerHtml = innerHtml?.replace(\n      regex,\n      (match) => `<span class=\"highlight\">${match}</span>`,\n    );\n  }\n\n  const id = [body.id, type].join(\"-\");\n  const isRtl = [\"ar\"].includes(String(body.language));\n  const dir = isRtl ? \"rtl\" : \"ltr\";\n  const fontSize = isRtl ? \"1.3em\" : \"1em\";\n\n  if (!innerHtml) return null;\n\n  return (\n    <TextualBody\n      dangerouslySetInnerHTML={{ __html: innerHtml }}\n      data-body-id={id}\n      data-testid=\"scroll-item-body\"\n      id={id}\n      dir={dir}\n      css={{ fontSize }}\n    />\n  );\n};\n\nexport default ScrollAnnotationBody;\n","import {\n  CanvasNormalized,\n  EmbeddedResource,\n  Reference,\n} from \"@iiif/presentation-3\";\nimport {\n  PageBreak,\n  StyledItem,\n  StyledItemFigure,\n  StyledItemTextualBodies,\n} from \"src/components/Scroll/Items/Items.styled\";\n\nimport { Label } from \"src/components/Primitives\";\nimport React from \"react\";\nimport { ScrollContext } from \"src/context/scroll-context\";\nimport ScrollFigure from \"src/components/Scroll/Figure/Figure\";\nimport ScrollItemBody from \"src/components/Scroll/Annotation/Body\";\n\ninterface ScrollItemProps {\n  hasItemBreak: boolean;\n  isLastItem: boolean;\n  item: Reference<\"Canvas\">;\n  itemCount: number;\n  itemNumber: number;\n}\n\n// design svg for page break that  a line with triangles symbolizing a page break\n\nconst ScrollItem: React.FC<ScrollItemProps> = ({\n  hasItemBreak,\n  isLastItem,\n  item,\n  itemCount,\n  itemNumber,\n}) => {\n  const { state } = React.useContext(ScrollContext);\n  const { annotations, vault } = state;\n\n  const canvas: CanvasNormalized | undefined = vault?.get(item);\n\n  const annotationBody = annotations\n    ?.filter((annotation) => annotation.target === item.id)\n    ?.map((annotation) => {\n      return annotation?.body?.map((body, index) => (\n        <ScrollItemBody\n          body={body as unknown as EmbeddedResource}\n          key={index}\n        />\n      ));\n    });\n\n  const canvasInfo = {\n    current: itemNumber,\n    total: itemCount,\n  };\n\n  return (\n    <StyledItem\n      data-page-break={hasItemBreak}\n      data-page-number={itemNumber}\n      data-last-item={isLastItem}\n    >\n      <StyledItemFigure>\n        {canvas && <ScrollFigure canvas={canvas} canvasInfo={canvasInfo} />}\n      </StyledItemFigure>\n      <StyledItemTextualBodies>\n        {canvas?.label && (\n          <strong>\n            <Label label={canvas?.label} />{\" \"}\n            {`(${canvasInfo.current} / ${canvasInfo.total})`}\n          </strong>\n        )}\n        <div>{annotationBody ? annotationBody : <p>[Blank]</p>}</div>\n\n        {hasItemBreak && <PageBreak aria-label=\"Page Break\" />}\n      </StyledItemTextualBodies>\n    </StyledItem>\n  );\n};\n\nexport default React.memo(ScrollItem);\n","import { styled } from \"src/styles/stitches.config\";\n\nconst highlightColor = \"255, 197, 32\"; // #FFC520\n\nconst StyledSearchTag = styled(\"span\", {\n  fontWeight: \"700\",\n});\n\nconst StyledSearchAnnotationInformation = styled(\"div\", {\n  display: \"flex\",\n  gap: \"0.25rem\",\n});\n\nconst StyledSearchAnnotationsResultsLabel = styled(\"div\", {\n  fontSize: \"0.9rem\",\n  padding: \"1rem 0.618rem\",\n});\n\nconst StyledSearchAnnotations = styled(\"div\", {\n  display: \"flex\",\n  flexDirection: \"column\",\n  gap: \"0.5rem\",\n\n  hr: {\n    margin: \"0.618rem\",\n    border: \"none\",\n    borderBottom: \"1px solid #6662\",\n  },\n\n  button: {\n    backgroundColor: \"#6660\",\n    opacity: \"0.7\",\n    transition: \"$all\",\n    padding: \"0.5rem 0.618rem\",\n    fontSize: \"0.9rem\",\n    lineHeight: \"1.1rem\",\n    textAlign: \"left\",\n    borderRadius: \"6px\",\n    border: \"1px solid #6662\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: \"0.25rem\",\n\n    \"&:hover\": {\n      opacity: \"1\",\n      boxShadow: \"5px 5px 13px #6662\",\n    },\n\n    \"&[data-result=true]\": {\n      backgroundColor: `rgba(${highlightColor}, 0.2)`,\n      borderColor: `rgba(${highlightColor}, 0.2)`,\n      opacity: \"1\",\n\n      \"&:hover\": {\n        backgroundColor: `rgba(${highlightColor}, 0.2)`,\n      },\n    },\n  },\n});\n\nconst StyledSearchInput = styled(\"input\", {\n  margin: \"0\",\n  padding: \"0 1rem 0 2rem\",\n  background: \"none\",\n  zIndex: \"2\",\n  height: \"2rem\",\n  marginLeft: \"1rem\",\n  marginTop: \"1rem\",\n  justifyContent: \"center\",\n  display: \"flex\",\n  alignItems: \"center\",\n  fontSize: \"1rem\",\n  borderRadius: \"2rem\",\n  fontFamily: \"inherit\",\n  backgroundColor: \"$primary\",\n  border: \"none\",\n  color: \"$secondary\",\n  cursor: \"text\",\n  filter: \"drop-shadow(2px 2px 5px #0003)\",\n  transition: \"$all\",\n  boxSizing: \"content-box !important\",\n  flexGrow: \"0\",\n  width: \"100%\",\n\n  \"&:placeholder\": {\n    color: \"inherit\",\n  },\n});\n\nconst StyledSearchIcon = styled(\"span\", {\n  position: \"absolute\",\n  zIndex: \"3\",\n  width: \"2rem\",\n  height: \"2rem\",\n  padding: \"8px\",\n  marginTop: \"1rem\",\n  marginLeft: \"1rem\",\n  color: \"$secondary\",\n  fill: \"$secondary\",\n  stroke: \"$secondary\",\n  transition: \"$all\",\n  cursor: \"text\",\n});\n\nconst StyledSearchBackButton = styled(\"button\", {\n  opacity: \"1\",\n  display: \"flex\",\n  alignItems: \"center\",\n  borderRadius: \"2rem\",\n  width: \"2rem\",\n  height: \"2rem\",\n  alignSelf: \"center\",\n  marginTop: \"1rem\",\n  gap: \"0.35rem\",\n  backgroundColor: \"$accent\",\n  fill: \"$secondary\",\n  flexShrink: \"0\",\n\n  svg: {\n    padding: \"6px\",\n    color: \"inherit\",\n    fill: \"inherit\",\n  },\n\n  '&[aria-disabled=\"true\"]': {\n    opacity: \"0\",\n    display: \"none\",\n  },\n});\n\nconst StyledSearchForm = styled(\"form\", {\n  display: \"flex\",\n  justifyContent: \"space-between\",\n  gap: \"1rem\",\n  width: \"100%\",\n\n  variants: {\n    isPanelExpanded: {\n      true: {\n        [`${StyledSearchIcon}`]: {\n          marginLeft: \"0\",\n        },\n\n        [`& ${StyledSearchInput}`]: {\n          marginLeft: \"0\",\n          backgroundColor: \"$primary\",\n          width: \"auto\",\n          flexGrow: \"1\",\n          //\n        },\n      },\n      false: {\n        //\n      },\n    },\n  },\n});\n\nconst StyledSearch = styled(\"div\", {});\n\nexport {\n  StyledSearch,\n  StyledSearchAnnotations,\n  StyledSearchAnnotationsResultsLabel,\n  StyledSearchAnnotationInformation,\n  StyledSearchBackButton,\n  StyledSearchForm,\n  StyledSearchIcon,\n  StyledSearchInput,\n  StyledSearchTag,\n};\n","import {\n  StyledSearchAnnotationInformation,\n  StyledSearchAnnotations,\n  StyledSearchTag,\n} from \"src/components/Scroll/Panel/Search/Search.styled\";\n\nimport { AnnotationFlattened } from \"src/types/annotations\";\nimport React from \"react\";\nimport ScrollAnnotationBody from \"src/components/Scroll/Annotation/Body\";\n\nconst ScrollSearchResultsButton = ({\n  annotation,\n  isResult,\n}: {\n  annotation: AnnotationFlattened;\n  isResult?: boolean;\n}) => {\n  const bodyId = [annotation?.body?.id, \"content\"].join(\"-\");\n\n  const handleScrollToId = (id) => {\n    if (id) document.getElementById(id)?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  return (\n    <button\n      data-result={isResult ? \"true\" : \"false\"}\n      onClick={() => handleScrollToId(bodyId)}\n      key={bodyId}\n    >\n      <StyledSearchAnnotationInformation>\n        <StyledSearchTag>{annotation.motivation}</StyledSearchTag>\n        <span>{annotation?.body?.language}</span>\n      </StyledSearchAnnotationInformation>\n      <ScrollAnnotationBody\n        body={annotation.body}\n        stringLength={144}\n        type=\"snippet\"\n      />\n    </button>\n  );\n};\n\nconst ScrollSearchResults = ({\n  results,\n}: {\n  results: {\n    found: AnnotationFlattened[];\n    notFound: AnnotationFlattened[];\n  };\n}) => {\n  return (\n    <StyledSearchAnnotations>\n      {results.found.map((annotation) => (\n        <ScrollSearchResultsButton\n          annotation={annotation}\n          isResult\n          key={annotation.id}\n        />\n      ))}\n      <hr />\n      {results.notFound.map((annotation) => (\n        <ScrollSearchResultsButton\n          annotation={annotation}\n          key={annotation.id}\n        />\n      ))}\n    </StyledSearchAnnotations>\n  );\n};\n\nexport default ScrollSearchResults;\n","import FlexSearch, { IndexOptionsForDocumentSearch } from \"flexsearch\";\nimport React, { useContext } from \"react\";\nimport {\n  StyledSearch,\n  StyledSearchAnnotationsResultsLabel,\n} from \"src/components/Scroll/Panel/Search/Search.styled\";\n\nimport { AnnotationFlattened } from \"src/types/annotations\";\nimport { ScrollContext } from \"src/context/scroll-context\";\nimport ScrollSearchResults from \"src/components/Scroll/Panel/Search/Results\";\n\nconst config: IndexOptionsForDocumentSearch<{\n  id: string;\n  content: string;\n}> = {\n  charset: \"latin:extra, arabic:extra, cyrillic:extra, cjk:extra\",\n  optimize: true,\n  tokenize: \"full\",\n  resolution: 9,\n  document: {\n    id: \"id\",\n    index: \"content\",\n  },\n};\n\nconst ScrollSearch = () => {\n  const { state } = useContext(ScrollContext);\n  const { annotations, searchString = \"\" } = state;\n\n  const index = new FlexSearch.Document(config);\n  const indexIds: string[] = [];\n  annotations?.forEach((annotation) => {\n    annotation?.body?.forEach((body) => {\n      // @ts-expect-error\n      const content = body?.value?.replace(/\\n/g, \"\");\n      indexIds.push(body?.id);\n      index.add({\n        id: body?.id,\n        content,\n      });\n    });\n  });\n\n  function mapAnnotationBodies(array): AnnotationFlattened[] {\n    return array.map((id) => {\n      return annotations\n        ?.filter((annotation) => {\n          return annotation.body.find((body) => body.id === id);\n        })\n        .map((annotation) => {\n          const bodyIndex = annotation.body.findIndex((body) => body.id === id);\n          return {\n            ...annotation,\n            body: annotation.body[bodyIndex],\n          };\n        })\n        .shift();\n    });\n  }\n\n  const searchResults = index?.search(searchString).reduce((acc, curr) => {\n    return [...new Set([...acc, ...curr.result])];\n  }, []);\n\n  const results: {\n    found: AnnotationFlattened[];\n    notFound: AnnotationFlattened[];\n  } = {\n    found: mapAnnotationBodies(searchResults),\n    notFound: mapAnnotationBodies(\n      indexIds.filter((id) => !searchResults.includes(id)),\n    ),\n  };\n\n  return (\n    <StyledSearch>\n      {searchString && (\n        <StyledSearchAnnotationsResultsLabel>\n          {results.found?.length} results for <strong>{searchString}</strong>\n        </StyledSearchAnnotationsResultsLabel>\n      )}\n      <ScrollSearchResults results={results} />\n    </StyledSearch>\n  );\n};\n\nexport default ScrollSearch;\n","import React, { useContext, useEffect, useRef } from \"react\";\nimport {\n  StyledSearchBackButton,\n  StyledSearchForm,\n  StyledSearchIcon,\n  StyledSearchInput,\n} from \"src/components/Scroll/Panel/Search/Search.styled\";\n\nimport { ScrollContext } from \"src/context/scroll-context\";\n\nconst SearchIcon: React.FC = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n      <title>Search</title>\n      <path d=\"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z\" />\n    </svg>\n  );\n};\n\nconst CloseIcon: React.FC = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\">\n      <title>Close</title>\n      <path d=\"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z\" />\n    </svg>\n  );\n};\n\ninterface PanelToggleProps {\n  togglePanel: (isPanelExpanded: boolean) => void;\n  isPanelExpanded: boolean;\n}\n\nconst PanelToggle: React.FC<PanelToggleProps> = ({\n  togglePanel,\n  isPanelExpanded,\n}) => {\n  const { dispatch, state } = useContext(ScrollContext);\n  const { searchString } = state;\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const handleFocus = () =>\n    inputRef.current === document.activeElement && togglePanel(true);\n\n  const focusInput = () => inputRef?.current?.focus();\n\n  const blurInput = () => {\n    inputRef.current?.blur();\n    clearInput();\n    togglePanel(false);\n    dispatch({\n      payload: \"\",\n      type: \"updateSearchString\",\n    });\n  };\n\n  const clearInput = () => {\n    if (inputRef.current) {\n      inputRef.current.value = \"\";\n    }\n  };\n\n  const handleClose = (e) => {\n    e.preventDefault();\n    blurInput();\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === \"Escape\") {\n      e.preventDefault();\n      blurInput();\n    }\n  };\n\n  useEffect(() => {\n    document?.addEventListener(\"keydown\", handleKeyDown);\n\n    return () => {\n      document?.removeEventListener(\"keydown\", handleKeyDown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!inputRef?.current) return;\n\n    inputRef.current.addEventListener(\"focus\", handleFocus);\n    inputRef.current.addEventListener(\"blur\", handleFocus);\n\n    return () => {\n      if (inputRef.current) {\n        inputRef.current.removeEventListener(\"focus\", handleFocus);\n        inputRef.current.removeEventListener(\"blur\", handleFocus);\n      }\n    };\n  }, []);\n\n  const handleSearchChange = (e) => {\n    dispatch({\n      payload: e?.target?.value,\n      type: \"updateSearchString\",\n    });\n  };\n\n  return (\n    <StyledSearchForm\n      id=\"scroll-search\"\n      autoComplete=\"off\"\n      isPanelExpanded={isPanelExpanded}\n    >\n      <StyledSearchIcon onClick={focusInput}>\n        <SearchIcon />\n      </StyledSearchIcon>\n      <StyledSearchInput\n        ref={inputRef}\n        name=\"clover-search\"\n        type=\"text\"\n        placeholder=\"Search...\"\n        defaultValue={searchString}\n        onChange={handleSearchChange}\n      />\n      <StyledSearchBackButton\n        aria-disabled={!isPanelExpanded}\n        aria-label=\"Close search panel\"\n        onClick={handleClose}\n        disabled={!isPanelExpanded}\n      >\n        <CloseIcon />\n      </StyledSearchBackButton>\n    </StyledSearchForm>\n  );\n};\n\nexport default PanelToggle;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst StyledPanel = styled(\"div\", {\n  display: \"flex\",\n  flexDirection: \"column\",\n  flexGrow: \"1\",\n  flexShrink: \"0\",\n  position: \"relative\",\n  zIndex: \"1\",\n  maxWidth: \"100%\",\n  marginTop: \"1rem\",\n  transition: \"$all\",\n\n  variants: {\n    isPanelExpanded: {\n      true: {\n        zIndex: 1,\n        opacity: 1,\n        transform: \"translateX(0)\",\n      },\n      false: {\n        zIndex: -1,\n        opacity: 0,\n        transform: \"translateX(-2.618rem)\",\n        transitionDelay: \"0\",\n        transition: \"none\",\n      },\n    },\n  },\n});\n\nexport { StyledPanel };\n","import { useEffect, useState } from \"react\";\n\ninterface Position {\n  top: number;\n  left: number;\n}\n\n/**\n * Hook that returns an element's distance from the top of the visible window.\n */\nexport const useDistanceFromViewportTop = (\n  ref: React.RefObject<HTMLElement>,\n): Position => {\n  const [position, setPosition] = useState<Position>({ top: 0, left: 0 });\n\n  useEffect(() => {\n    const handleUpdatePosition = () => {\n      if (ref.current) {\n        const rect = ref.current.getBoundingClientRect();\n        setPosition({\n          top: rect.top,\n          left: rect.left,\n        });\n      }\n    };\n\n    // Update position for both scroll and resize events\n    window.addEventListener(\"scroll\", handleUpdatePosition);\n    window.addEventListener(\"resize\", handleUpdatePosition);\n    handleUpdatePosition(); // Call once to set the initial value.\n\n    return () => {\n      window.removeEventListener(\"scroll\", handleUpdatePosition);\n      window.removeEventListener(\"resize\", handleUpdatePosition);\n    };\n  }, [ref]);\n\n  return position;\n};\n","import React, { useContext, useRef } from \"react\";\nimport {\n  StyledScrollAside,\n  StyledScrollFixed,\n} from \"src/components/Scroll/Layout/Layout.styled\";\n\nimport { ScrollContext } from \"src/context/scroll-context\";\nimport ScrollSearchResults from \"src/components/Scroll/Panel/Search/Search\";\nimport SearchForm from \"src/components/Scroll/Panel/Search/Form\";\nimport { StyledPanel } from \"src/components/Scroll/Panel/Panel.styled\";\nimport { useDistanceFromViewportTop } from \"src/hooks/useDistanceFromViewportTop\";\n\ninterface ScrollToggleProps {\n  isPanelExpanded: boolean;\n  handlePanel: (status: boolean) => void;\n}\n\nconst ScrollPanel: React.FC<ScrollToggleProps> = ({\n  isPanelExpanded,\n  handlePanel,\n}) => {\n  const scrollAsideRef = useRef<HTMLDivElement>(null);\n\n  const { state } = useContext(ScrollContext);\n  const { options } = state;\n  const { offset } = options;\n\n  const { top } = useDistanceFromViewportTop(scrollAsideRef);\n  const isAnchored = top ? top < offset : false;\n  const articleWidth = scrollAsideRef?.current?.offsetWidth;\n  const panelWidth = articleWidth ? articleWidth * 0.5 : articleWidth;\n  const defaultFormWidth = panelWidth ? panelWidth - 315 : 180;\n\n  const fixedStyles = {\n    top: isAnchored ? offset : 0,\n    width: `calc(${panelWidth}px - 1.318rem)`,\n    maxWidth: isPanelExpanded ? \"100%\" : `${defaultFormWidth}px`,\n    minWidth: \"130px\",\n  };\n\n  return (\n    <StyledScrollAside\n      ref={scrollAsideRef}\n      className={isAnchored ? \"anchor\" : \"\"}\n      data-testid=\"scroll-panel\"\n    >\n      <StyledScrollFixed style={fixedStyles}>\n        <SearchForm\n          togglePanel={handlePanel}\n          isPanelExpanded={isPanelExpanded}\n        />\n        <StyledPanel\n          data-testid=\"scroll-panel-results\"\n          data-panel-expanded={isPanelExpanded}\n          isPanelExpanded={isPanelExpanded}\n        >\n          {isPanelExpanded && <ScrollSearchResults />}\n        </StyledPanel>\n      </StyledScrollFixed>\n    </StyledScrollAside>\n  );\n};\n\nexport default ScrollPanel;\n","import React, { useState } from \"react\";\n\nimport { Reference } from \"@iiif/presentation-3\";\nimport ScrollItem from \"src/components/Scroll/Items/Item\";\nimport ScrollPanel from \"src/components/Scroll/Panel/Panel\";\nimport { StyledScrollItems } from \"src/components/Scroll/Items/Items.styled\";\n\nconst ScrollItems = ({ items }: { items: Reference<\"Canvas\">[] }) => {\n  const [isPanelExpanded, setIsPanelExpanded] = useState(false);\n\n  const handlePanel = (status) => setIsPanelExpanded(status);\n  return (\n    <>\n      <ScrollPanel\n        isPanelExpanded={isPanelExpanded}\n        handlePanel={handlePanel}\n      />\n      <StyledScrollItems data-figures-visible={!isPanelExpanded}>\n        {items.map((item, index) => {\n          const itemNumber = index + 1;\n          const isLastItem = itemNumber === items.length;\n\n          return (\n            <ScrollItem\n              item={item}\n              hasItemBreak={itemNumber < items.length}\n              isLastItem={isLastItem}\n              key={item.id}\n              itemCount={items.length}\n              itemNumber={itemNumber}\n            />\n          );\n        })}\n      </StyledScrollItems>\n    </>\n  );\n};\n\nexport default ScrollItems;\n","import {\n  AnnotationNormalized,\n  AnnotationPageNormalized,\n  CanvasNormalized,\n  Reference,\n} from \"@iiif/presentation-3\";\nimport { useEffect, useState } from \"react\";\n\nconst useManifestAnnotations = (items, vault) => {\n  const [processedAnnotations, setProcessedAnnotations] = useState<\n    AnnotationNormalized[]\n  >([]);\n\n  useEffect(() => {\n    if (!vault) return;\n\n    const allAnnotations: AnnotationNormalized[] = [];\n\n    items?.forEach((canvasRef: Reference<\"Canvas\">) => {\n      const canvas: CanvasNormalized = vault.get(canvasRef);\n      canvas?.annotations?.forEach(\n        (annotationPageRef: Reference<\"AnnotationPage\">) => {\n          const annotationPage: AnnotationPageNormalized =\n            vault.get(annotationPageRef);\n          annotationPage?.items?.forEach(\n            (annotationRef: Reference<\"Annotation\">) => {\n              const annotation: AnnotationNormalized = vault.get(annotationRef);\n              if (annotation) {\n                allAnnotations.push({\n                  ...annotation,\n                  body: annotation?.body?.map((bodyRef) => vault.get(bodyRef)),\n                });\n              }\n            },\n          );\n        },\n      );\n    });\n\n    /**\n     * Removes duplicate annotations if they exist\n     */\n    const uniqueAnnotations = allAnnotations.reduce(\n      (accumulator: AnnotationNormalized[], current: AnnotationNormalized) => {\n        if (!accumulator.some((a: AnnotationNormalized) => a.id === current.id))\n          accumulator.push(current);\n        return accumulator;\n      },\n      [],\n    );\n\n    setProcessedAnnotations(uniqueAnnotations);\n  }, [items, vault]);\n\n  return processedAnnotations;\n};\n\nexport default useManifestAnnotations;\n","import React, { useContext, useEffect, useState } from \"react\";\nimport { ScrollContext, ScrollProvider } from \"src/context/scroll-context\";\n\nimport { ManifestNormalized } from \"@iiif/presentation-3\";\nimport ScrollHeader from \"src/components/Scroll/Layout/Header\";\nimport ScrollItems from \"src/components/Scroll/Items/Items\";\nimport { StyledScrollWrapper } from \"src/components/Scroll/Layout/Layout.styled\";\nimport useManifestAnnotations from \"src/hooks/useManifestAnnotations\";\n\nexport interface CloverScrollProps {\n  iiifContent: string;\n  options;\n}\n\nconst RenderCloverScroll = ({ iiifContent }: { iiifContent: string }) => {\n  const [manifest, setManifest] = useState<ManifestNormalized>();\n\n  const { state, dispatch } = useContext(ScrollContext);\n  const { vault } = state;\n\n  const annotations = useManifestAnnotations(manifest?.items, vault);\n\n  useEffect(() => {\n    if (!vault) return;\n\n    vault\n      .load(iiifContent)\n      .then((data: ManifestNormalized) => data && setManifest(data))\n      .catch((error: Error) =>\n        console.error(`Manifest ${iiifContent} failed to load: ${error}`),\n      );\n  }, [iiifContent, vault]);\n\n  useEffect(() => {\n    dispatch({\n      type: \"updateAnnotations\",\n      payload: annotations,\n    });\n  }, [annotations, dispatch]);\n\n  if (!manifest) return null;\n\n  return (\n    <StyledScrollWrapper>\n      {manifest.label && <ScrollHeader label={manifest.label} />}\n      {manifest.items && <ScrollItems items={manifest.items} />}\n    </StyledScrollWrapper>\n  );\n};\n\nconst CloverScroll: React.FC<CloverScrollProps> = ({\n  iiifContent,\n  options,\n}) => {\n  return (\n    <ScrollProvider options={options}>\n      <RenderCloverScroll iiifContent={iiifContent} />\n    </ScrollProvider>\n  );\n};\n\nexport default CloverScroll;\n"],"names":["initialState","Vault","reducer","state","action","ScrollContext","createContext","ScrollProvider","props","children","manifest","options","dispatch","useReducer","React","getLabelEntries","label","lang","codes","getLabelAsString","delimiter","entries","createMarkup","html","sanitizeHTML","sanitizeAttributes","remove","key","attributes","sanitizeHtml","hue","theme","media","styled","css","keyframes","createTheme","createStitches","StyledLabel","Label","as","defaultState","PrimitivesContext","usePrimitivesContext","context","useContext","PrimitivesProvider","getRealPropertyValue","obj","property","StyledMarkup","Markup","markup","MarkupWrapper","Summary","summary","StyledScrollFixed","StyledScrollAside","StyledScrollHeader","StyledScrollWrapper","ScrollHeader","StyledItem","StyledItemFigure","StyledItemTextualBodies","PageBreak","StyledScrollItems","FigureCaption","canvas","current","total","$","OpenSeadragon","svgNS","Overlay","viewer","self","p","zoom","rotation","flipped","containerSizeX","scaleX","scaleY","node","handler","getInfoResponse","id","response","json","error","getImageServiceURI","service","imageService","imageServiceURI","OpenSeadragonImageTypes","parseImageBody","body","hasImageService","uri","imageType","parseSrc","src","isTiledImage","ErrorFallbackStyled","Headline","ErrorBody","ErrorFallback","message","Navigator","Viewport","Wrapper","Item","Button","className","dataButton","defaultConfigOptions","expandAutoScrollOptions","value","result","validateAutoScrollSettings","behavior","block","validBehaviors","validPositions","expandedAutoScrollOptions","_b","_a","_c","_d","uuidv4","ViewerStateContext","ViewerDispatchContext","useViewerState","useViewerDispatch","ZoomIn","ZoomOut","ZoomFullScreen","Reset","Rotate","Controls","_cloverViewerHasPlaceholder","config","viewerState","activeCanvas","configOptions","openSeadragonViewer","plugins","vault","activeManifest","renderPlugins","plugin","i","PluginComponent","OSD","ariaLabel","openSeadragonCallback","osdUri","setOsdUri","useState","openSeadragon","setOpenSeadragon","initializeOSD","useRef","useEffect","tileSource","e","defaultOpenSeadragonConfiguration","openSeadragonInstance","CloverImage","instanceId","openSeadragonConfig","instance","defaultOpenSeadragonConfig","ErrorBoundary","StyledImageViewer","ImageViewer","StyledFigure","getCanvasByCriteria","item","motivation","paintingType","entity","filterAnnotations","annotation","annotationBody","resource","annotationPageResources","annotations","getPaintingResource","canvasEntity","ScrollCanvasFigure","canvasInfo","painting","highlightColor","TextualBody","getSearchResultSnippet","searchString","content","stringLength","index","start","end","startSpaceIndex","endSpaceIndex","ScrollAnnotationBody","type","innerHtml","markdownContent","useMarkdown","regex","match","isRtl","dir","fontSize","ScrollItem","hasItemBreak","isLastItem","itemCount","itemNumber","ScrollItemBody","ScrollFigure","ScrollItem$1","StyledSearchTag","StyledSearchAnnotationInformation","StyledSearchAnnotationsResultsLabel","StyledSearchAnnotations","StyledSearchInput","StyledSearchIcon","StyledSearchBackButton","StyledSearchForm","StyledSearch","ScrollSearchResultsButton","isResult","bodyId","handleScrollToId","ScrollSearchResults","results","ScrollSearch","FlexSearch","indexIds","mapAnnotationBodies","array","bodyIndex","searchResults","acc","curr","SearchIcon","CloseIcon","PanelToggle","togglePanel","isPanelExpanded","inputRef","handleFocus","focusInput","blurInput","clearInput","handleClose","handleKeyDown","handleSearchChange","StyledPanel","useDistanceFromViewportTop","ref","position","setPosition","handleUpdatePosition","rect","ScrollPanel","handlePanel","scrollAsideRef","offset","top","isAnchored","articleWidth","panelWidth","defaultFormWidth","fixedStyles","SearchForm","ScrollItems","items","setIsPanelExpanded","status","useManifestAnnotations","processedAnnotations","setProcessedAnnotations","allAnnotations","canvasRef","annotationPageRef","annotationPage","annotationRef","bodyRef","uniqueAnnotations","accumulator","RenderCloverScroll","iiifContent","setManifest","data","CloverScroll"],"mappings":"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"}