{"version":3,"file":"index.umd.js","sources":["../../src/lib/openseadragon-svg.ts","../../src/lib/iiif.ts","../../src/types/open-seadragon.ts","../../src/lib/openseadragon-helpers.ts","../../src/styles/stitches.config.tsx","../../src/components/UI/ErrorFallback/ErrorFallback.styled.tsx","../../src/components/UI/ErrorFallback/ErrorFallback.tsx","../../src/components/Image/Image.styled.tsx","../../src/components/Image/Controls/Button.styled.tsx","../../src/components/Image/Controls/Button.tsx","../../src/components/Image/Controls/Controls.styled.tsx","../../src/context/viewer-context.tsx","../../src/components/Image/Controls/Controls.tsx","../../src/components/Image/OSD/OSD.tsx","../../src/components/Image/OSD/defaults.ts","../../src/lib/label-helpers.ts","../../src/components/Image/index.tsx"],"sourcesContent":["// OpenSeadragon SVG Overlay plugin 0.0.5\n// https://github.com/openseadragon/svg-overlay/issues/34#issuecomment-1147992921\nimport OpenSeadragon from \"openseadragon\";\n\nlet $ = window.OpenSeadragon;\n\nif (!$) {\n  $ = OpenSeadragon;\n  if (!$) {\n    throw new Error(\"OpenSeadragon is missing.\");\n  }\n}\n\nconst svgNS = \"http://www.w3.org/2000/svg\";\n\n// ----------\nif ($.Viewer) {\n  // @ts-expect-error: svgOverlay does not exist on Viewer\n  $.Viewer.prototype.svgOverlay = function () {\n    if (this._svgOverlayInfo) {\n      return this._svgOverlayInfo;\n    }\n\n    this._svgOverlayInfo = new Overlay(this);\n    return this._svgOverlayInfo;\n  };\n}\n// ----------\nconst Overlay = function (viewer) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const self = this;\n\n  this._viewer = viewer;\n  this._containerWidth = 0;\n  this._containerHeight = 0;\n\n  this._svg = document.createElementNS(svgNS, \"svg\");\n  this._svg.style.position = \"absolute\";\n  this._svg.style.left = 0;\n  this._svg.style.top = 0;\n  this._svg.style.width = \"100%\";\n  this._svg.style.height = \"100%\";\n  this._viewer.canvas.appendChild(this._svg);\n\n  this._node = document.createElementNS(svgNS, \"g\");\n  this._svg.appendChild(this._node);\n\n  this._viewer.addHandler(\"animation\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"open\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"rotate\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"flip\", function () {\n    self.resize();\n  });\n\n  this._viewer.addHandler(\"resize\", function () {\n    self.resize();\n  });\n\n  this.resize();\n};\n\n// ----------\nOverlay.prototype = {\n  // ----------\n  node: function () {\n    return this._node;\n  },\n\n  // ----------\n  resize: function () {\n    if (this._containerWidth !== this._viewer.container.clientWidth) {\n      this._containerWidth = this._viewer.container.clientWidth;\n      this._svg.setAttribute(\"width\", this._containerWidth);\n    }\n\n    if (this._containerHeight !== this._viewer.container.clientHeight) {\n      this._containerHeight = this._viewer.container.clientHeight;\n      this._svg.setAttribute(\"height\", this._containerHeight);\n    }\n\n    const p = this._viewer.viewport.pixelFromPoint(new $.Point(0, 0), true);\n    const zoom = this._viewer.viewport.getZoom(true);\n    const rotation = this._viewer.viewport.getRotation();\n    const flipped = this._viewer.viewport.getFlip();\n    // TODO: Expose an accessor for _containerInnerSize in the OSD API so we don't have to use the private variable.\n    const containerSizeX = this._viewer.viewport._containerInnerSize.x;\n    let scaleX = containerSizeX * zoom;\n    const scaleY = scaleX;\n\n    if (flipped) {\n      // Makes the x component of the scale negative to flip the svg\n      scaleX = -scaleX;\n      // Translates svg back into the correct coordinates when the x scale is made negative.\n      p.x = -p.x + containerSizeX;\n    }\n\n    this._node.setAttribute(\n      \"transform\",\n      \"translate(\" +\n        p.x +\n        \",\" +\n        p.y +\n        \") scale(\" +\n        scaleX +\n        \",\" +\n        scaleY +\n        \") rotate(\" +\n        rotation +\n        \")\",\n    );\n  },\n  // ----------\n  onClick: function (node, handler) {\n    // TODO: Fast click for mobile browsers\n\n    new $.MouseTracker({\n      element: node,\n      clickHandler: handler,\n    }).setTracking(true);\n  },\n};\n\nexport const OsdSvgOverlay = (viewer) => {\n  return new Overlay(viewer);\n};\n","import {\n  Canvas,\n  CollectionNormalized,\n  IIIFExternalWebResource,\n  ImageService,\n  ManifestNormalized,\n  Service,\n} from \"@iiif/presentation-3\";\nimport { decodeContentState } from \"@iiif/vault-helpers\";\n\nexport const getCanvasResource = (canvas: Canvas) => {\n  if (canvas?.items) {\n    const annotationPage = canvas?.items[0];\n    if (annotationPage?.items) {\n      const resource = annotationPage?.items[0].body as IIIFExternalWebResource;\n      if (resource?.hasOwnProperty(\"id\")) {\n        return resource.id as string;\n      }\n    }\n  }\n};\n\nexport const getInfoResponse = (id: string) =>\n  fetch(`${id.replace(/\\/$/, \"\")}/info.json`)\n    .then((response) => response.json())\n    .then((json) => json)\n    .catch((error: any) => {\n      console.error(\n        `The IIIF tilesource ${id.replace(\n          /\\/$/,\n          \"\",\n        )}/info.json failed to load: ${error}`,\n      );\n    });\n\nexport const getImageServiceURI = (service: Service[] | undefined) => {\n  let imageService: ImageService;\n  let imageServiceURI: string | undefined;\n\n  if (Array.isArray(service)) {\n    imageService = service[0] as ImageService;\n    if (imageService) {\n      let id: string | undefined;\n      \"@id\" in imageService\n        ? (id = imageService[\"@id\"])\n        : (id = imageService.id);\n\n      imageServiceURI = id;\n    }\n  }\n\n  return imageServiceURI;\n};\n\nconst parseIiifContent = (iiifContent: string) => {\n  let resourceId;\n  let active;\n  if (isURL(iiifContent)) {\n    resourceId = iiifContent;\n    active = {};\n  } else {\n    const json = JSON.parse(decodeContentState(iiifContent));\n    switch (json?.type) {\n      // https://iiif.io/api/content-state/1.0/#51-a-region-of-a-canvas-in-a-manifest\n      // https://iiif.io/api/content-state/1.0/#52-start-playing-at-a-point-in-a-recording\n      // https://iiif.io/api/content-state/1.0/#53-multiple-targets-for-a-comparison-view\n      // https://iiif.io/api/content-state/1.0/#54-search-results\n      case \"SpecificResource\":\n      case \"Range\":\n      case \"Annotation\":\n        resourceId = json?.target.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.target.id,\n        };\n        break;\n      case \"Canvas\":\n        resourceId = json?.partOf[0].id;\n        active = {\n          manifest: resourceId,\n          canvas: json?.id,\n        };\n        break;\n      case \"Manifest\":\n        resourceId = json?.id;\n        active = {\n          collection: json?.partOf[0]?.id,\n          manifest: json?.id,\n        };\n        break;\n      case \"Collection\":\n        resourceId = json?.id;\n        active = {\n          collection: resourceId,\n        };\n        break;\n    }\n  }\n  return { resourceId, active };\n};\n\nexport const decodeContentStateContainerURI = (iiifContent: string) => {\n  const { resourceId, active } = parseIiifContent(iiifContent);\n  return active.collection || active.manifest || resourceId;\n};\n\nexport const getActiveCanvas = (\n  iiifContent: string,\n  manifest: ManifestNormalized,\n) => {\n  const canvases = manifest.items.map((item) => item.id);\n  const { active } = parseIiifContent(iiifContent);\n  const canvas = active.canvas;\n  return canvases.includes(canvas) ? canvas : canvases[0];\n};\n\nexport const getActiveManifest = (\n  iiifContent: string,\n  collection: CollectionNormalized,\n) => {\n  const { active } = parseIiifContent(iiifContent);\n  const manifest = active.manifest;\n  const manifests = collection.items\n    .filter((item) => item.type === \"Manifest\")\n    .map((manifest) => manifest.id);\n  if (manifests.length == 0) return null;\n  return manifests.includes(manifest) ? manifest : manifests[0];\n};\n\nconst isURL = (url: string) => {\n  try {\n    new URL(url);\n  } catch {\n    return false;\n  }\n  return true;\n};\n","export enum OpenSeadragonImageTypes {\n  TiledImage = \"tiledImage\",\n  SimpleImage = \"simpleImage\",\n}\n","import {\n  Annotation,\n  AnnotationNormalized,\n  IIIFExternalWebResource,\n  type CanvasNormalized,\n  AnnotationPageNormalized,\n} from \"@iiif/presentation-3\";\nimport OpenSeadragon from \"openseadragon\";\nimport {\n  type OverlayOptions,\n  type ViewerConfigOptions,\n} from \"src/context/viewer-context\";\nimport { OsdSvgOverlay } from \"src/lib/openseadragon-svg\";\nimport { parseAnnotationTarget } from \"src/lib/annotation-helpers\";\n\nimport { ParsedAnnotationTarget } from \"src/types/annotations\";\nimport { getImageServiceURI } from \"src/lib/iiif\";\nimport { OpenSeadragonImageTypes } from \"src/types/open-seadragon\";\n\nexport function addOverlaysToViewer(\n  viewer: OpenSeadragon.Viewer,\n  canvas: CanvasNormalized,\n  configOptions: OverlayOptions,\n  annotations: Annotation[] | AnnotationNormalized[],\n  overlaySelector: string,\n): void {\n  if (!viewer) return;\n\n  const scale = 1 / canvas.width;\n\n  annotations.forEach((annotation) => {\n    if (!annotation.target) return;\n\n    const parsedAnnotationTarget = parseAnnotationTarget(annotation.target);\n    const { point, rect, svg } = parsedAnnotationTarget;\n\n    if (rect) {\n      const { x, y, w, h } = rect;\n      addRectangularOverlay(\n        viewer,\n        x * scale,\n        y * scale,\n        w * scale,\n        h * scale,\n        configOptions,\n        overlaySelector,\n      );\n    }\n\n    if (point) {\n      const { x, y } = point;\n      const svg = `\n        <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"${x}\" cy=\"${y}\" r=\"20\" />\n        </svg>\n      `;\n\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n\n    if (svg) {\n      addSvgOverlay(viewer, svg, configOptions, scale, overlaySelector);\n    }\n  });\n}\n\nexport function createOpenSeadragonRect(\n  canvas: CanvasNormalized,\n  parsedAnnotationTarget: ParsedAnnotationTarget,\n  zoomLevel: number,\n) {\n  let x,\n    y,\n    w = 40,\n    h = 40;\n\n  if (parsedAnnotationTarget.rect) {\n    x = parsedAnnotationTarget.rect.x;\n    y = parsedAnnotationTarget.rect.y;\n    w = parsedAnnotationTarget.rect.w;\n    h = parsedAnnotationTarget.rect.h;\n  }\n\n  if (parsedAnnotationTarget.point) {\n    x = parsedAnnotationTarget.point.x;\n    y = parsedAnnotationTarget.point.y;\n  }\n\n  // TODO: How to handle SVG where no rect or point exists?\n  // @ts-ignore\n  if (parseAnnotationTarget.svg) {\n  }\n\n  const scale = 1 / canvas.width;\n  const rect = new OpenSeadragon.Rect(\n    x * scale - ((w * scale) / 2) * (zoomLevel - 1),\n    y * scale - ((h * scale) / 2) * (zoomLevel - 1),\n    w * scale * zoomLevel,\n    h * scale * zoomLevel,\n  );\n\n  return rect;\n}\n\n/**\n * Add a rectangular overlay to an OpenSeadragon viewer\n */\nfunction addRectangularOverlay(\n  viewer: OpenSeadragon.Viewer,\n  x: number,\n  y: number,\n  w: number,\n  h: number,\n  configOptions: OverlayOptions,\n  overlaySelector: string,\n): void {\n  const rect = new OpenSeadragon.Rect(x, y, w, h);\n  const div = document.createElement(\"div\");\n\n  if (configOptions) {\n    const { backgroundColor, opacity, borderType, borderColor, borderWidth } =\n      configOptions;\n\n    div.style.backgroundColor = backgroundColor as string;\n    div.style.opacity = opacity as string;\n    div.style.border = `${borderType} ${borderWidth} ${borderColor}`;\n    div.className = overlaySelector;\n  }\n\n  viewer.addOverlay(div, rect);\n}\n\nfunction convertSVGStringToHTML(svgString) {\n  if (!svgString) return null;\n  const template = document.createElement(\"template\");\n  template.innerHTML = svgString.trim();\n  const result = template.content.children;\n\n  return result[0];\n}\n\nexport function addSvgOverlay(\n  viewer: any,\n  svgString: string,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  const svgEl = convertSVGStringToHTML(svgString);\n  if (svgEl) {\n    for (const child of svgEl.children) {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    }\n  }\n}\n\nfunction svg_processChild(\n  viewer: any,\n  child: ChildNode,\n  configOptions: OverlayOptions,\n  scale: number,\n  overlaySelector: string,\n) {\n  if (child.nodeName === \"#text\") {\n    svg_handleTextNode(child);\n  } else {\n    const newElement = svg_handleElementNode(child, configOptions, scale);\n    const overlay = OsdSvgOverlay(viewer);\n    overlay.node().append(newElement);\n    overlay._svg?.setAttribute(\"class\", overlaySelector);\n\n    // BUG: svg with children elements aren't formated correctly.\n    child.childNodes.forEach((child) => {\n      svg_processChild(viewer, child, configOptions, scale, overlaySelector);\n    });\n  }\n}\n\nexport function svg_handleElementNode(\n  child: any,\n  configOptions: OverlayOptions,\n  scale: number,\n) {\n  let hasStrokeColor = false;\n  let hasStrokeWidth = false;\n  let hasFillColor = false;\n  let hasFillOpacity = false;\n\n  const newElement = document.createElementNS(\n    \"http://www.w3.org/2000/svg\",\n    child.nodeName,\n  );\n\n  if (child.attributes.length > 0) {\n    for (let index = 0; index < child.attributes.length; index++) {\n      const element = child.attributes[index];\n      switch (element.name) {\n        case \"fill\":\n          hasFillColor = true;\n          break;\n        case \"stroke\":\n          hasStrokeColor = true;\n          break;\n        case \"stroke-width\":\n          hasStrokeWidth = true;\n          break;\n        case \"fill-opacity\":\n          hasFillOpacity = true;\n          break;\n      }\n      newElement.setAttribute(element.name, element.textContent);\n    }\n  }\n\n  if (!hasStrokeColor) {\n    newElement.style.stroke = configOptions?.borderColor as string;\n  }\n  if (!hasStrokeWidth) {\n    newElement.style.strokeWidth = configOptions?.borderWidth as string;\n  }\n  if (!hasFillColor) {\n    newElement.style.fill = configOptions?.backgroundColor as string;\n  }\n  if (!hasFillOpacity) {\n    newElement.style.fillOpacity = configOptions?.opacity as string;\n  }\n  newElement.setAttribute(\"transform\", `scale(${scale})`);\n\n  return newElement;\n}\n\nfunction svg_handleTextNode(child: ChildNode) {\n  if (!child.textContent) {\n    return;\n  }\n  if (child.textContent.includes(\"\\n\")) {\n    return;\n  }\n  console.log(\n    \"nodeName:\",\n    child.nodeName,\n    \", textContent:\",\n    child.textContent,\n    \", childNodes.length\",\n    child.childNodes.length,\n  );\n}\n\nexport const parseImageBody = (body: IIIFExternalWebResource) => {\n  const hasImageService =\n    Array.isArray(body?.service) && body?.service.length > 0;\n\n  const uri = hasImageService ? getImageServiceURI(body?.service) : body?.id;\n  const imageType: OpenSeadragonImageTypes = hasImageService\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri,\n    imageType,\n  };\n};\n\nexport const parseSrc = (src: string, isTiledImage: boolean) => {\n  const imageType = isTiledImage\n    ? OpenSeadragonImageTypes.TiledImage\n    : OpenSeadragonImageTypes.SimpleImage;\n\n  return {\n    uri: src,\n    imageType,\n  };\n};\nexport function removeOverlaysFromViewer(\n  viewer: OpenSeadragon.Viewer,\n  overlaySelector: string,\n) {\n  if (!viewer) return;\n\n  if (!overlaySelector.startsWith(\".\")) {\n    overlaySelector = \".\" + overlaySelector;\n  }\n  const elements = document.querySelectorAll(overlaySelector);\n  if (elements) {\n    elements.forEach((element) => viewer.removeOverlay(element));\n  }\n}\n\nexport function panToTarget(openSeadragonViewer, zoomLevel, target, canvas) {\n  const parsedAnnotationTarget = parseAnnotationTarget(target);\n\n  const { point, rect, svg } = parsedAnnotationTarget;\n\n  if (point || rect || svg) {\n    const rect = createOpenSeadragonRect(\n      canvas,\n      parsedAnnotationTarget,\n      zoomLevel,\n    );\n    openSeadragonViewer?.viewport.fitBounds(rect);\n  }\n}\n\nexport function addContentSearchOverlays(\n  contentSearchVault: any,\n  contentSearch: AnnotationPageNormalized,\n  openSeadragonViewer,\n  canvas: CanvasNormalized,\n  configOptions: ViewerConfigOptions,\n) {\n  if (!contentSearch?.items) return;\n  if (contentSearch?.items.length === 0) return;\n\n  const annotations: Array<AnnotationNormalized> = [];\n  contentSearch.items.forEach((item) => {\n    const annotation = contentSearchVault.get(item.id) as AnnotationNormalized;\n\n    if (typeof annotation.target === \"string\") {\n      if (annotation.target.startsWith(canvas.id)) {\n        annotations.push(annotation as unknown as AnnotationNormalized);\n      }\n    }\n  });\n\n  if (openSeadragonViewer && configOptions.contentSearch?.overlays) {\n    addOverlaysToViewer(\n      openSeadragonViewer,\n      canvas,\n      configOptions.contentSearch.overlays,\n      annotations,\n      \"content-search-overlay\",\n    );\n  }\n}\n","import { createStitches } from \"@stitches/react\";\n\nconst hue = 209;\n\nexport const theme = {\n  colors: {\n    /*\n     * Black and dark grays in a light theme.\n     * Must contrast to 4.5 or greater with `secondary`.\n     */\n    primary: \"#1a1d1e\",\n    primaryMuted: \"#26292b\",\n    primaryAlt: \"#151718\",\n\n    /*\n     * Key brand color(s).\n     * Must contrast to 4.5 or greater with `secondary`.\n     */\n    accent: `hsl(${hue} 100% 38.2%)`,\n    accentMuted: `hsl(${hue} 80% 61.8%)`,\n    accentAlt: `hsl(${hue} 80% 30%)`,\n\n    /*\n     * White and light grays in a light theme.\n     * Must contrast to 4.5 or greater with `primary` and  `accent`.\n     */\n    secondary: \"#FFFFFF\",\n    secondaryMuted: \"#e6e8eb\",\n    secondaryAlt: \"#c1c8cd\",\n  },\n  fontSizes: {\n    1: \"12px\",\n    2: \"13px\",\n    3: \"15px\",\n    4: \"17px\",\n    5: \"19px\",\n    6: \"21px\",\n    7: \"27px\",\n    8: \"35px\",\n    9: \"59px\",\n  },\n  lineHeights: {\n    1: \"12px\",\n    2: \"13px\",\n    3: \"15px\",\n    4: \"17px\",\n    5: \"19px\",\n    6: \"21px\",\n    7: \"27px\",\n    8: \"35px\",\n    9: \"59px\",\n  },\n  sizes: {\n    1: \"5px\",\n    2: \"10px\",\n    3: \"15px\",\n    4: \"20px\",\n    5: \"25px\",\n    6: \"35px\",\n    7: \"45px\",\n    8: \"65px\",\n    9: \"80px\",\n  },\n  space: {\n    1: \"5px\",\n    2: \"10px\",\n    3: \"15px\",\n    4: \"20px\",\n    5: \"25px\",\n    6: \"35px\",\n    7: \"45px\",\n    8: \"65px\",\n    9: \"80px\",\n  },\n  radii: {\n    1: \"4px\",\n    2: \"6px\",\n    3: \"8px\",\n    4: \"12px\",\n    round: \"50%\",\n    pill: \"9999px\",\n  },\n  transitions: {\n    all: \"all 300ms cubic-bezier(0.16, 1, 0.3, 1)\",\n  },\n  zIndices: {\n    1: \"100\",\n    2: \"200\",\n    3: \"300\",\n    4: \"400\",\n    max: \"999\",\n  },\n};\n\nexport const media = {\n  xxs: \"(max-width: 349px)\",\n  xs: \"(max-width: 575px)\",\n  sm: \"(max-width: 767px)\",\n  md: \"(max-width: 991px)\",\n  lg: \"(max-width: 90rem)\",\n  xl: \"(min-width: calc(90rem + 1px))\",\n};\n\nexport type { CSS, VariantProps } from \"@stitches/react\";\n\nexport const { styled, css, keyframes, createTheme } = createStitches({\n  theme,\n  media,\n});\n","import { styled } from \"src/styles/stitches.config\";\n\nconst ErrorFallbackStyled = styled(\"div\", {\n  display: \"flex\",\n  flexDirection: \"column\",\n  alignItems: \"center\",\n});\n\nconst Headline = styled(\"p\", {\n  fontWeight: \"bold\",\n  fontSize: \"x-large\",\n});\n\nconst ErrorBody = styled(\"span\", {\n  fontSize: \"medium\",\n});\n\nexport { ErrorFallbackStyled, ErrorBody, Headline };\n","import {\n  ErrorBody,\n  ErrorFallbackStyled,\n  Headline,\n} from \"src/components/UI/ErrorFallback/ErrorFallback.styled\";\n\nimport React from \"react\";\n\ninterface ErrorFallbackProps {\n  error: Error;\n}\n\nconst ErrorFallback: React.FC<ErrorFallbackProps> = ({ error }) => {\n  const { message } = error;\n\n  return (\n    <ErrorFallbackStyled role=\"alert\">\n      <Headline data-testid=\"headline\">Something went wrong</Headline>\n      {message && <ErrorBody>{`Error message: ${message}`} </ErrorBody>}\n    </ErrorFallbackStyled>\n  );\n};\n\nexport default ErrorFallback;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Navigator = styled(\"div\", {\n  position: \"absolute !important\",\n  zIndex: \"1\",\n  top: \"1rem\",\n  left: \"1rem\",\n  width: \"161.8px\",\n  height: \"100px\",\n  backgroundColor: \"#000D\",\n  boxShadow: \"5px 5px 5px #0002\",\n  borderRadius: \"3px\",\n\n  \".displayregion\": {\n    border: \" 3px solid $accent !important\",\n    boxShadow: \"0 0 3px #0006\",\n  },\n\n  \"@sm\": {\n    width: \"123px\",\n    height: \"76px\",\n  },\n\n  \"@xs\": {\n    width: \"100px\",\n    height: \"61.8px\",\n  },\n});\n\nconst Viewport = styled(\"div\", {\n  position: \"relative\",\n  width: \"100%\",\n  height: \"100%\",\n  zIndex: \"0\",\n});\n\nconst Wrapper = styled(\"div\", {\n  width: \"100%\",\n  height: \"100%\",\n  maxHeight: \"100vh\",\n  background: \"transparent\",\n  backgroundSize: \"contain\",\n  color: \"white\",\n  position: \"relative\",\n  zIndex: \"0\",\n  overflow: \"hidden\",\n\n  variants: {\n    hasNavigator: {\n      true: {\n        [`${Navigator}`]: {\n          display: \"block\",\n        },\n      },\n      false: {\n        [`${Navigator}`]: {\n          display: \"none\",\n        },\n      },\n    },\n  },\n});\n\nexport { Navigator, Viewport, Wrapper };\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Item = styled(\"button\", {\n  display: \"flex\",\n  height: \"2rem\",\n  width: \"2rem\",\n  borderRadius: \"2rem\",\n  padding: \"0\",\n  margin: \"0\",\n  fontFamily: \"inherit\",\n  background: \"none\",\n  backgroundColor: \"$primary\",\n  border: \"none\",\n  color: \"white\",\n  cursor: \"pointer\",\n  marginLeft: \"0.618rem\",\n  filter: \"drop-shadow(2px 2px 5px #0003)\",\n  transition: \"$all\",\n  boxSizing: \"content-box !important\",\n\n  \"&:first-child\": {\n    marginLeft: \"0\",\n  },\n\n  \"@xs\": {\n    marginBottom: \"0.618rem\",\n    marginLeft: \"0\",\n\n    \"&:last-child\": {\n      marginBottom: \"0\",\n    },\n  },\n\n  svg: {\n    height: \"60%\",\n    width: \"60%\",\n    padding: \"20%\",\n    fill: \"$secondary\",\n    stroke: \"$secondary\",\n    filter: \"drop-shadow(2px 2px 5px #0003)\",\n    transition: \"$all\",\n    boxSizing: \"inherit\",\n  },\n\n  \"&:hover, &:focus\": {\n    backgroundColor: \"$accent\",\n  },\n\n  \"&[data-button=rotate-right]\": {\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"45deg\",\n      },\n    },\n  },\n\n  \"&[data-button=rotate-left]\": {\n    transform: \"scaleX(-1)\",\n\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"45deg\",\n      },\n    },\n  },\n\n  \"&[data-button=reset]\": {\n    \"&:hover, &:focus\": {\n      svg: {\n        rotate: \"-15deg\",\n      },\n    },\n  },\n});\n\nexport { Item };\n","import { Item } from \"src/components/Image/Controls/Button.styled\";\nimport React from \"react\";\n\ninterface ButtonProps {\n  className?: string;\n  id: string;\n  label: string;\n  children: React.ReactChild;\n}\n\nconst Button: React.FC<ButtonProps> = ({ className, id, label, children }) => {\n  const dataButton = label.toLowerCase().replace(/\\s/g, \"-\");\n  return (\n    <Item\n      id={id}\n      className={className}\n      data-testid=\"openseadragon-button\"\n      data-button={dataButton}\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-labelledby={`${id}-svg-title`}\n        data-testid=\"openseadragon-button-svg\"\n        focusable=\"false\"\n        viewBox=\"0 0 512 512\"\n        role=\"img\"\n      >\n        <title id={`${id}-svg-title`}>{label}</title>\n        {children}\n      </svg>\n    </Item>\n  );\n};\n\nexport default Button;\n","import { styled } from \"src/styles/stitches.config\";\n\nconst Wrapper = styled(\"div\", {\n  position: \"absolute\",\n  zIndex: \"1\",\n  top: \"1rem\",\n  right: \"1rem\",\n  display: \"flex\",\n\n  \"@xs\": {\n    flexDirection: \"column\",\n    zIndex: \"2\",\n  },\n\n  variants: {\n    hasPlaceholder: {\n      true: {\n        right: \"3.618rem\",\n\n        \"@xs\": {\n          top: \"3.618rem\",\n          right: \"1rem\",\n        },\n      },\n\n      false: {\n        right: \"1rem\",\n\n        \"@xs\": {\n          top: \"1rem\",\n          right: \"1rem\",\n        },\n      },\n    },\n  },\n});\n\nexport { Wrapper };\n","import OpenSeadragon, { Options as OpenSeadragonOptions } from \"openseadragon\";\nimport React, { useReducer } from \"react\";\n\nimport { CollectionNormalized } from \"@iiif/presentation-3\";\nimport { IncomingHttpHeaders } from \"http\";\nimport { Vault } from \"@iiif/vault\";\nimport { deepMerge } from \"src/lib/utils\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nexport type AutoScrollSettings = {\n  behavior: string; // ScrollBehavior (\"auto\" | \"instant\" | \"smooth\")\n  block: string; // ScrollLogicalPosition (\"center\" | \"end\" | \"nearest\" | \"start\")\n};\n\nexport type AutoScrollOptions = {\n  enabled: boolean;\n  settings: AutoScrollSettings;\n};\n\nexport type ViewerConfigOptions = {\n  annotationOverlays?: OverlayOptions;\n  background?: string;\n  canvasBackgroundColor?: string;\n  canvasHeight?: string;\n  contentSearch?: {\n    searchResultsLimit?: number;\n    overlays?: OverlayOptions;\n    zoomToFirst?: boolean;\n  };\n  ignoreCaptionLabels?: string[];\n  pages?: {\n    show?: boolean;\n    toggleLabel?: string;\n  };\n  informationPanel?: {\n    open?: boolean;\n    renderAbout?: boolean;\n    renderSupplementing?: boolean;\n    renderToggle?: boolean;\n    renderAnnotation?: boolean;\n    toggleLabel?: string;\n    vtt?: {\n      autoScroll?: AutoScrollOptions | AutoScrollSettings | boolean;\n    };\n    renderContentSearch?: boolean;\n    defaultTab?: string;\n  };\n  openSeadragon?: OpenSeadragonOptions;\n  requestHeaders?: IncomingHttpHeaders;\n  showDownload?: boolean;\n  headerNavigation?: string;\n  showIIIFBadge?: boolean;\n  showTitle?: boolean;\n  withCredentials?: boolean;\n  localeText?: {\n    contentSearch?: {\n      tabLabel?: string;\n      formPlaceholder?: string;\n      noSearchResults?: string;\n      loading?: string;\n      moreResults?: string;\n    };\n  };\n  initialSearch?: string;\n  initialPage?: number;\n};\n\nexport type OverlayOptions = {\n  backgroundColor?: string;\n  borderColor?: string;\n  borderType?: string;\n  borderWidth?: string;\n  opacity?: string;\n  renderOverlays?: boolean;\n  zoomLevel?: number;\n};\n\nconst defaultAutoScrollSettings: AutoScrollSettings = {\n  behavior: \"smooth\",\n  block: \"center\",\n};\n\nconst defaultConfigOptions = {\n  annotationOverlays: {\n    backgroundColor: \"#6666ff\",\n    borderColor: \"#000099\",\n    borderType: \"solid\",\n    borderWidth: \"1px\",\n    opacity: \"0.5\",\n    renderOverlays: true,\n    zoomLevel: 2,\n  },\n  background: \"transparent\",\n  canvasBackgroundColor: \"#6662\",\n  canvasHeight: \"500px\",\n  contentSearch: {\n    searchResultsLimit: 20,\n    zoomToFirst: false,\n    overlays: {\n      backgroundColor: \"#ff6666\",\n      borderColor: \"#990000\",\n      borderType: \"solid\",\n      borderWidth: \"1px\",\n      opacity: \"0.5\",\n      renderOverlays: true,\n      zoomLevel: 4,\n    },\n  },\n  ignoreCaptionLabels: [],\n  pages: {\n    show: true,\n    toggleLabel: \"Pages\",\n  },\n  informationPanel: {\n    vtt: {\n      autoScroll: {\n        enabled: true,\n        settings: defaultAutoScrollSettings,\n      },\n    },\n    open: true,\n    renderAbout: true,\n    renderSupplementing: true,\n    renderToggle: true,\n    renderAnnotation: true,\n    renderContentSearch: true,\n  },\n  openSeadragon: {},\n  requestHeaders: { \"Content-Type\": \"application/json\" },\n  showDownload: true,\n  showIIIFBadge: true,\n  showTitle: true,\n  withCredentials: false,\n  localeText: {\n    contentSearch: {\n      tabLabel: \"Search Results\",\n      formPlaceholder: \"Enter search words\",\n      noSearchResults: \"No search results\",\n      loading: \"Loading...\",\n      moreResults: \"more results\",\n    },\n  },\n};\n\nexport type CustomDisplay = {\n  display: {\n    component: React.ElementType;\n    componentProps?: Record<string, unknown>;\n  };\n  target: {\n    canvasId?: string[];\n    paintingFormat?: string[];\n  };\n};\nexport type PluginConfig = {\n  id: string;\n  imageViewer?: {\n    menu?: {\n      component: React.ElementType;\n      componentProps?: Record<string, unknown>;\n    };\n  };\n  informationPanel?: {\n    component: React.ElementType;\n    componentProps?: Record<string, unknown>;\n    label: string;\n  };\n};\n\nexport interface ViewerContextStore {\n  activeCanvas: string;\n  activeManifest: string;\n  OSDImageLoaded?: boolean;\n  collection?: CollectionNormalized | Record<string, never>;\n  configOptions: ViewerConfigOptions;\n  customDisplays: Array<CustomDisplay>;\n  plugins: Array<PluginConfig>;\n  isAutoScrollEnabled?: boolean;\n  isAutoScrolling?: boolean;\n  isInformationOpen: boolean;\n  showPageNavigation: boolean;\n  isLoaded: boolean;\n  isUserScrolling?: number | undefined;\n  vault: Vault;\n  contentSearchVault: Vault;\n  openSeadragonViewer: OpenSeadragon.Viewer | null;\n  openSeadragonId?: string;\n  viewerId?: string;\n  informationPanelCounts: object;\n}\n\nexport interface ViewerAction {\n  type: string;\n  canvasId: string;\n  collection: CollectionNormalized;\n  configOptions: ViewerConfigOptions;\n  isAutoScrollEnabled: boolean;\n  isAutoScrolling: boolean;\n  isInformationOpen: boolean;\n  showPageNavigation: boolean;\n  isLoaded: boolean;\n  isUserScrolling: number | undefined;\n  manifestId: string;\n  OSDImageLoaded?: boolean;\n  vault: Vault;\n  contentSearchVault: Vault;\n  openSeadragonViewer: OpenSeadragon.Viewer;\n  viewerId: string;\n  panel: string;\n  count: number;\n}\n\nexport function expandAutoScrollOptions(\n  value: AutoScrollOptions | AutoScrollSettings | boolean | undefined,\n): AutoScrollOptions {\n  let result: AutoScrollOptions = {\n    ...defaultConfigOptions.informationPanel.vtt.autoScroll,\n  };\n  if (typeof value === \"object\") {\n    result = \"enabled\" in value ? value : { enabled: true, settings: value };\n  }\n  if (value === false) result.enabled = false;\n  validateAutoScrollSettings(result.settings);\n  return result;\n}\n\nfunction validateAutoScrollSettings({ behavior, block }: AutoScrollSettings) {\n  const validBehaviors = [\"auto\", \"instant\", \"smooth\"];\n  const validPositions = [\"center\", \"end\", \"nearest\", \"start\"];\n  if (!validBehaviors.includes(behavior))\n    throw TypeError(`'${behavior}' not in ${validBehaviors.join(\" | \")}`);\n  if (!validPositions.includes(block))\n    throw TypeError(`'${block}' not in ${validPositions.join(\" | \")}`);\n}\n\nconst expandedAutoScrollOptions = expandAutoScrollOptions(\n  defaultConfigOptions?.informationPanel?.vtt?.autoScroll,\n);\n\nexport const defaultState: ViewerContextStore = {\n  activeCanvas: \"\",\n  activeManifest: \"\",\n  OSDImageLoaded: false,\n  collection: {},\n  configOptions: defaultConfigOptions,\n  customDisplays: [],\n  plugins: [],\n  isAutoScrollEnabled: expandedAutoScrollOptions.enabled,\n  isAutoScrolling: false,\n  isInformationOpen: defaultConfigOptions?.informationPanel?.open,\n  showPageNavigation: defaultConfigOptions?.pages?.show,\n  isLoaded: false,\n  isUserScrolling: undefined,\n  vault: new Vault(),\n  contentSearchVault: new Vault(),\n  openSeadragonViewer: null,\n  viewerId: uuidv4(),\n  informationPanelCounts: {},\n};\n\nconst ViewerStateContext =\n  React.createContext<ViewerContextStore>(defaultState);\nconst ViewerDispatchContext =\n  React.createContext<ViewerContextStore>(defaultState);\n\nfunction viewerReducer(state: ViewerContextStore, action: ViewerAction) {\n  switch (action.type) {\n    case \"updateActiveCanvas\": {\n      /**\n       * Set canvasId to empty string if it comes back undefined.\n       */\n      if (!action.canvasId) action.canvasId = \"\";\n      return {\n        ...state,\n        activeCanvas: action.canvasId,\n      };\n    }\n    case \"updateActiveManifest\": {\n      return {\n        ...state,\n        activeManifest: action.manifestId,\n      };\n    }\n    case \"updateOSDImageLoaded\": {\n      return {\n        ...state,\n        OSDImageLoaded: action.OSDImageLoaded,\n      };\n    }\n    case \"updateAutoScrollAnnotationEnabled\": {\n      return {\n        ...state,\n        isAutoScrollEnabled: action.isAutoScrollEnabled,\n      };\n    }\n    case \"updateAutoScrolling\": {\n      return {\n        ...state,\n        isAutoScrolling: action.isAutoScrolling,\n      };\n    }\n    case \"updateCollection\": {\n      return {\n        ...state,\n        collection: action.collection,\n      };\n    }\n    case \"updateConfigOptions\": {\n      return {\n        ...state,\n        configOptions: deepMerge(state.configOptions, action.configOptions),\n      };\n    }\n    case \"updateInformationOpen\": {\n      return {\n        ...state,\n        isInformationOpen: action.isInformationOpen,\n      };\n    }\n    case \"updateShowPageNavigation\": {\n      return {\n        ...state,\n        showPageNavigation: action.showPageNavigation,\n      };\n    }\n    case \"updateIsLoaded\": {\n      return {\n        ...state,\n        isLoaded: action.isLoaded,\n      };\n    }\n    case \"updateUserScrolling\": {\n      return {\n        ...state,\n        isUserScrolling: action.isUserScrolling,\n      };\n    }\n    case \"updateOpenSeadragonViewer\": {\n      return {\n        ...state,\n        openSeadragonViewer: action.openSeadragonViewer,\n      };\n    }\n    case \"updateViewerId\": {\n      return {\n        ...state,\n        viewerId: action.viewerId,\n      };\n    }\n    case \"updateInformationPanelCount\": {\n      const c = state.informationPanelCounts ?? {};\n      c[action.panel] = action.count;\n      return {\n        ...state,\n        informationPanelCounts: c,\n      };\n    }\n    default: {\n      throw new Error(`Unhandled action type: ${action.type}`);\n    }\n  }\n}\n\ninterface ViewerProviderProps {\n  initialState?: ViewerContextStore;\n  children: React.ReactNode;\n}\n\nconst ViewerProvider: React.FC<ViewerProviderProps> = ({\n  initialState = defaultState,\n  children,\n}) => {\n  const [state, dispatch] = useReducer<\n    React.Reducer<ViewerContextStore, ViewerAction>\n  >(viewerReducer, initialState);\n\n  return (\n    <ViewerStateContext.Provider value={state}>\n      <ViewerDispatchContext.Provider\n        value={dispatch as unknown as ViewerContextStore}\n      >\n        {children}\n      </ViewerDispatchContext.Provider>\n    </ViewerStateContext.Provider>\n  );\n};\n\nfunction useViewerState() {\n  const context = React.useContext(ViewerStateContext);\n  if (context === undefined) {\n    throw new Error(\"useViewerState must be used within a ViewerProvider\");\n  }\n  return context;\n}\n\nfunction useViewerDispatch() {\n  const context = React.useContext(ViewerDispatchContext);\n  if (context === undefined) {\n    throw new Error(\"useViewerDispatch must be used within a ViewerProvider\");\n  }\n  return context;\n}\n\nexport { ViewerProvider, useViewerState, useViewerDispatch };\n","import Button from \"src/components/Image/Controls/Button\";\nimport { Options } from \"openseadragon\";\nimport React from \"react\";\nimport { Wrapper } from \"src/components/Image/Controls/Controls.styled\";\nimport {\n  ViewerContextStore,\n  useViewerState,\n  useViewerDispatch,\n} from \"src/context/viewer-context\";\nimport { CanvasNormalized } from \"@iiif/presentation-3\";\n\nconst ZoomIn = () => {\n  return (\n    <path\n      strokeLinecap=\"round\"\n      strokeMiterlimit=\"10\"\n      strokeWidth=\"45\"\n      d=\"M256 112v288M400 256H112\"\n    />\n  );\n};\n\nconst ZoomOut = () => {\n  return (\n    <path\n      strokeLinecap=\"round\"\n      strokeMiterlimit=\"10\"\n      strokeWidth=\"45\"\n      d=\"M400 256H112\"\n    />\n  );\n};\n\nconst ZoomFullScreen = () => {\n  return (\n    <path\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      strokeWidth=\"32\"\n      d=\"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304\"\n    />\n  );\n};\n\nconst Reset = () => {\n  return (\n    <path d=\"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z\" />\n  );\n};\n\nconst Rotate = () => {\n  return (\n    <>\n      <path\n        fill=\"none\"\n        strokeLinecap=\"round\"\n        strokeMiterlimit=\"10\"\n        strokeWidth=\"45\"\n        d=\"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128\"\n      />\n      <path d=\"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z\" />\n    </>\n  );\n};\n\nconst Controls = ({\n  _cloverViewerHasPlaceholder,\n  config,\n}: {\n  _cloverViewerHasPlaceholder: boolean;\n  config: Options;\n}) => {\n  const viewerState: ViewerContextStore = useViewerState();\n  const {\n    activeCanvas,\n    configOptions,\n    openSeadragonViewer,\n    plugins,\n    vault,\n    activeManifest,\n  } = viewerState;\n\n  const canvas: CanvasNormalized = vault.get({\n    id: activeCanvas,\n    type: \"Canvas\",\n  });\n\n  function renderPlugins() {\n    return plugins\n      .filter((plugin) => plugin.imageViewer?.menu)\n      .map((plugin, i) => {\n        const PluginComponent = plugin.imageViewer?.menu\n          ?.component as unknown as React.ElementType;\n        return (\n          <PluginComponent\n            key={i}\n            {...plugin?.imageViewer?.menu?.componentProps}\n            activeManifest={activeManifest}\n            canvas={canvas}\n            viewerConfigOptions={configOptions}\n            openSeadragonViewer={openSeadragonViewer}\n            useViewerDispatch={useViewerDispatch}\n            useViewerState={useViewerState}\n          ></PluginComponent>\n        );\n      });\n  }\n\n  return (\n    <Wrapper\n      data-testid=\"clover-iiif-image-openseadragon-controls\"\n      hasPlaceholder={_cloverViewerHasPlaceholder}\n    >\n      {config.showZoomControl && (\n        <>\n          <Button id={config.zoomInButton as string} label=\"zoom in\">\n            <ZoomIn />\n          </Button>\n          <Button id={config.zoomOutButton as string} label=\"zoom out\">\n            <ZoomOut />\n          </Button>\n        </>\n      )}\n      {config.showFullPageControl && (\n        <Button id={config.fullPageButton as string} label=\"full page\">\n          <ZoomFullScreen />\n        </Button>\n      )}\n      {config.showRotationControl && (\n        <>\n          <Button id={config.rotateRightButton as string} label=\"rotate right\">\n            <Rotate />\n          </Button>\n          <Button id={config.rotateLeftButton as string} label=\"rotate left\">\n            <Rotate />\n          </Button>\n        </>\n      )}\n      {config.showHomeControl && (\n        <Button id={config.homeButton as string} label=\"reset\">\n          <Reset />\n        </Button>\n      )}\n      {renderPlugins()}\n    </Wrapper>\n  );\n};\n\nexport default Controls;\n","import {\n  Navigator,\n  Viewport,\n  Wrapper,\n} from \"src/components/Image/Image.styled\";\nimport OpenSeadragon, { Options } from \"openseadragon\";\nimport React, { useEffect, useRef, useState } from \"react\";\n\nimport Controls from \"src/components/Image/Controls/Controls\";\nimport { OpenSeadragonImageTypes } from \"src/types/open-seadragon\";\nimport { getInfoResponse } from \"src/lib/iiif\";\nimport { useViewerDispatch } from \"src/context/viewer-context\";\n\ninterface OSDProps {\n  _cloverViewerHasPlaceholder: boolean;\n  ariaLabel?: string | null;\n  config: Options;\n  uri: string | undefined;\n  imageType: OpenSeadragonImageTypes;\n  openSeadragonCallback?: (viewer: OpenSeadragon.Viewer) => void;\n}\n\nconst OSD: React.FC<OSDProps> = ({\n  ariaLabel,\n  config,\n  uri,\n  _cloverViewerHasPlaceholder,\n  imageType,\n  openSeadragonCallback,\n}) => {\n  const [osdUri, setOsdUri] = useState<string>();\n  const [openSeadragon, setOpenSeadragon] = useState<OpenSeadragon.Viewer>();\n  const dispatch: any = useViewerDispatch();\n\n  const initializeOSD = useRef(false);\n\n  useEffect(() => {\n    if (!initializeOSD.current) {\n      initializeOSD.current = true;\n\n      if (!openSeadragon) setOpenSeadragon(OpenSeadragon(config));\n    }\n\n    return () => openSeadragon?.destroy();\n  }, []);\n\n  useEffect(() => {\n    if (openSeadragon && openSeadragonCallback)\n      openSeadragonCallback(openSeadragon);\n  }, [openSeadragon, openSeadragonCallback]);\n\n  useEffect(() => {\n    if (openSeadragon && uri !== osdUri) {\n      openSeadragon?.forceRedraw();\n      setOsdUri(uri);\n    }\n  }, [openSeadragon, osdUri, uri]);\n\n  useEffect(() => {\n    if (osdUri && openSeadragon) {\n      switch (imageType) {\n        case \"simpleImage\":\n          openSeadragon?.addSimpleImage({\n            url: osdUri,\n          });\n          break;\n        case \"tiledImage\":\n          getInfoResponse(osdUri).then((tileSource) => {\n            try {\n              if (!tileSource)\n                throw new Error(`No tile source found for ${osdUri}`);\n\n              openSeadragon?.addTiledImage({\n                tileSource,\n                success: () => {\n                  // NOTE: need to check dispatch is a function, because when\n                  // using dev server, dispatch sometimes is set to\n                  // ViewerContext.defaultState object instead of a function\n                  if (typeof dispatch === \"function\") {\n                    dispatch({\n                      type: \"updateOSDImageLoaded\",\n                      OSDImageLoaded: true,\n                    });\n                  }\n                },\n              });\n            } catch (e) {\n              console.error(e);\n            }\n          });\n          break;\n        default:\n          openSeadragon?.close();\n          console.warn(\n            `Unable to render ${osdUri} in OpenSeadragon as type: \"${imageType}\"`,\n          );\n          break;\n      }\n    }\n  }, [imageType, osdUri]);\n\n  return (\n    <Wrapper\n      className=\"clover-iiif-image-openseadragon\"\n      data-testid=\"clover-iiif-image-openseadragon\"\n      data-openseadragon-instance={config.id}\n      hasNavigator={config.showNavigator}\n    >\n      <Controls\n        _cloverViewerHasPlaceholder={_cloverViewerHasPlaceholder}\n        config={config}\n      />\n      {config.showNavigator && (\n        <Navigator\n          id={config.navigatorId}\n          data-testid=\"clover-iiif-image-openseadragon-navigator\"\n        />\n      )}\n      <Viewport\n        id={config.id}\n        data-testid=\"clover-iiif-image-openseadragon-viewport\"\n        role=\"img\"\n        {...(ariaLabel && { \"aria-label\": ariaLabel })}\n      />\n    </Wrapper>\n  );\n};\n\nexport default OSD;\n","import { Options } from \"openseadragon\";\n\nfunction defaultOpenSeadragonConfiguration(\n  openSeadragonInstance: string,\n): Options {\n  return {\n    id: `openseadragon-${openSeadragonInstance}`,\n    navigatorId: `openseadragon-navigator-${openSeadragonInstance}`,\n    loadTilesWithAjax: true,\n    fullPageButton: `fullPage-${openSeadragonInstance}`,\n    homeButton: `reset-${openSeadragonInstance}`,\n    rotateLeftButton: `rotateLeft-${openSeadragonInstance}`,\n    rotateRightButton: `rotateRight-${openSeadragonInstance}`,\n    zoomInButton: `zoomIn-${openSeadragonInstance}`,\n    zoomOutButton: `zoomOut-${openSeadragonInstance}`,\n    showNavigator: true,\n    showFullPageControl: true,\n    showHomeControl: true,\n    showRotationControl: true,\n    showZoomControl: true,\n    navigatorBorderColor: \"transparent\",\n    gestureSettingsMouse: {\n      clickToZoom: true,\n      dblClickToZoom: true,\n      pinchToZoom: true,\n      scrollToZoom: false,\n    },\n  };\n}\n\nexport default defaultOpenSeadragonConfiguration;\n","import { InternationalString } from \"@iiif/presentation-3\";\n\nexport const getLabelEntries = (\n  label?: InternationalString,\n  lang: string = \"none\",\n) => {\n  /*\n   * If no label exists, return an empty string.\n   */\n  if (!label) return null;\n\n  /*\n   * If label is not a IIIF Presentation API 3.0 shape, return the string\n   */\n  if (typeof label === \"string\") return [label];\n\n  /*\n   * If InternationalString code does not exist on label, then\n   * return what may be there, ex: label.none[0] OR label.fr[0]\n   */\n  if (!label[lang]) {\n    const codes: Array<string> = Object.getOwnPropertyNames(label);\n    if (codes.length > 0) return label[codes[0]];\n  }\n\n  /*\n   * Return label value for InternationalString code `en`\n   */\n  if (!label[lang]) return null;\n  if (!Array.isArray(label[lang])) return null;\n\n  return label[lang] as string[];\n};\n\nexport const getLabelAsString = (\n  label: InternationalString | undefined,\n  lang: string = \"none\",\n  delimiter: string = \", \",\n) => {\n  const entries = getLabelEntries(label, lang);\n  return Array.isArray(entries) ? entries.join(`${delimiter}`) : entries;\n};\n","import { parseImageBody, parseSrc } from \"src/lib/openseadragon-helpers\";\n\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport ErrorFallback from \"src/components/UI/ErrorFallback/ErrorFallback\";\nimport { InternationalString } from \"@iiif/presentation-3\";\nimport { LabeledIIIFExternalWebResource } from \"src/types/presentation-3\";\nimport OSD from \"src/components/Image/OSD/OSD\";\nimport { Options } from \"openseadragon\";\nimport React from \"react\";\nimport defaultOpenSeadragonConfig from \"src/components/Image/OSD/defaults\";\nimport { getLabelAsString } from \"src/lib/label-helpers\";\nimport { v4 as uuidv4 } from \"uuid\";\n\ninterface CloverImageProps {\n  _cloverViewerHasPlaceholder?: boolean;\n  body?: LabeledIIIFExternalWebResource;\n  instanceId?: string;\n  isTiledImage?: boolean;\n  label?: InternationalString | string;\n  src?: string;\n  openSeadragonCallback?: (viewer: any) => void;\n  openSeadragonConfig?: Options;\n}\n\nconst CloverImage: React.FC<CloverImageProps> = ({\n  _cloverViewerHasPlaceholder = false,\n  body,\n  instanceId,\n  isTiledImage = false,\n  label,\n  src = \"\",\n  openSeadragonCallback,\n  openSeadragonConfig = {},\n}) => {\n  const instance = instanceId ? instanceId : uuidv4();\n  const ariaLabel = typeof label === \"string\" ? label : getLabelAsString(label);\n  const config = {\n    ...defaultOpenSeadragonConfig(instance),\n    ...openSeadragonConfig,\n  };\n\n  const { imageType, uri } = body\n    ? parseImageBody(body)\n    : parseSrc(src, isTiledImage);\n\n  if (!uri) return null;\n\n  return (\n    <ErrorBoundary FallbackComponent={ErrorFallback}>\n      <OSD\n        _cloverViewerHasPlaceholder={_cloverViewerHasPlaceholder}\n        ariaLabel={ariaLabel}\n        config={config}\n        imageType={imageType}\n        key={instance}\n        uri={uri}\n        openSeadragonCallback={openSeadragonCallback}\n      />\n    </ErrorBoundary>\n  );\n};\n\nexport default CloverImage;\n"],"names":["$","OpenSeadragon","svgNS","Overlay","viewer","self","p","zoom","rotation","flipped","containerSizeX","scaleX","scaleY","node","handler","getInfoResponse","id","response","json","error","getImageServiceURI","service","imageService","imageServiceURI","OpenSeadragonImageTypes","parseImageBody","body","hasImageService","uri","imageType","parseSrc","src","isTiledImage","hue","theme","media","styled","css","keyframes","createTheme","createStitches","ErrorFallbackStyled","Headline","ErrorBody","ErrorFallback","message","React","Navigator","Viewport","Wrapper","Item","Button","className","label","children","dataButton","defaultConfigOptions","expandAutoScrollOptions","value","result","validateAutoScrollSettings","behavior","block","validBehaviors","validPositions","expandedAutoScrollOptions","_b","_a","defaultState","_c","_d","Vault","uuidv4","ViewerStateContext","ViewerDispatchContext","useViewerState","context","useViewerDispatch","ZoomIn","ZoomOut","ZoomFullScreen","Reset","Rotate","Controls","_cloverViewerHasPlaceholder","config","viewerState","activeCanvas","configOptions","openSeadragonViewer","plugins","vault","activeManifest","canvas","renderPlugins","plugin","i","PluginComponent","OSD","ariaLabel","openSeadragonCallback","osdUri","setOsdUri","useState","openSeadragon","setOpenSeadragon","dispatch","initializeOSD","useRef","useEffect","tileSource","e","defaultOpenSeadragonConfiguration","openSeadragonInstance","getLabelEntries","lang","codes","getLabelAsString","delimiter","entries","CloverImage","instanceId","openSeadragonConfig","instance","defaultOpenSeadragonConfig","ErrorBoundary"],"mappings":"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"}