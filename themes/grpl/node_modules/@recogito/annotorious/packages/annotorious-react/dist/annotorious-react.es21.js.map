{"version":3,"file":"annotorious-react.es21.js","sources":["../src/openseadragon/setPosition.ts"],"sourcesContent":["import { ImageAnnotation } from '@annotorious/annotorious';\nimport OpenSeadragon from 'openseadragon';\n\nconst getAnnotationDomRect = (viewer: OpenSeadragon.Viewer, annotation: ImageAnnotation) => {\n  const viewerBounds = viewer.element.getBoundingClientRect();\n  \n  // Annotation bounds (image coordinates)\n  const { minX, minY, maxX, maxY } = annotation.target.selector.geometry.bounds;\n\n  // Annotation coordinates - viewer element coordinates\n  const topLeft = viewer.viewport.imageToViewerElementCoordinates(new OpenSeadragon.Point(minX, minY));\n  const bottomRight = viewer.viewport.imageToViewerElementCoordinates(new OpenSeadragon.Point(maxX, maxY));\n\n  // Account for viewer element offset\n  return {\n    x: topLeft.x + viewerBounds.x,\n    right: bottomRight.x + viewerBounds.x,\n    y: topLeft.y + viewerBounds.y,\n    bottom: bottomRight.y + viewerBounds.y,\n    width: bottomRight.x - topLeft.x,\n    height: bottomRight.y - topLeft.y,\n  };\n}\n\nexport const setPosition = (\n  viewer: OpenSeadragon.Viewer, \n  annotation: ImageAnnotation, \n  popup: HTMLElement,\n  sideOffset: number = 5\n) => {\n  const viewerBounds = viewer.element.getBoundingClientRect();\n  const annoBounds = getAnnotationDomRect(viewer, annotation);\n\n  // Available space above, right, below, left the annotation in the viewport\n  const availableAbove = annoBounds.y - viewerBounds.y;\n  const availableRight = viewerBounds.right - annoBounds.x;\n  const availableBelow = viewerBounds.bottom - annoBounds.bottom;\n  const availableLeft = annoBounds.x - viewerBounds.left;\n\n  // Popup element bounds\n  const popupBounds = popup.firstElementChild.getBoundingClientRect();\n\n  // Eight possible base alignment anchor points\n  //\n  //            topleft        topright\n  //            *                     *\n  // leftdown * |---------------------| * rightdown\n  //            |                     |\n  //            |                     |\n  //            |                     |\n  //   leftup * |---------------------| * rightup\n  //            *                     * \n  //            bottomleft  bottomright\n  //\n  // We'll position the popup at the cardinal direction\n  // with the highest ratio: available space vs. popup size.\n  const ratioAbove = availableAbove / popupBounds.height;\n  const ratioRight = availableRight / popupBounds.width;\n  const ratioBelow = availableBelow / popupBounds.height;\n  const ratioLeft = availableLeft / popupBounds.width;\n\n  const topleft = () => {\n    popup.style.left = `${annoBounds.x}px`;\n    popup.style.top = `${annoBounds.y - sideOffset - popupBounds.height}px`;\n  }\n\n  const topright = () => {\n    popup.style.left = `${annoBounds.right - popupBounds.width}px`;\n    popup.style.top = `${annoBounds.y - sideOffset - popupBounds.height}px`;\n  }\n\n  const leftdown = () => {\n    popup.style.left = `${annoBounds.x - popupBounds.width - sideOffset}px`;\n    popup.style.top = `${annoBounds.y}px`;\n  } \n\n  const rightdown = () => {\n    popup.style.left = `${annoBounds.right + sideOffset}px`;\n    popup.style.top = `${annoBounds.y}px`;\n  }\n\n  const leftup = () => {\n    popup.style.left = `${annoBounds.x - popupBounds.width - sideOffset}px`;\n    popup.style.top = `${annoBounds.bottom - popupBounds.height}px`;\n  }\n\n  const rightup = () => {\n    popup.style.left = `${annoBounds.x + annoBounds.width + sideOffset}px`;\n    popup.style.top = `${annoBounds.bottom - popupBounds.height}px`;\n  }\n\n  const bottomleft = () => {\n    popup.style.left = `${annoBounds.x}px`;\n    popup.style.top = `${annoBounds.bottom + sideOffset}px`;\n  }\n\n  const bottomright = () => {\n    popup.style.left = `${annoBounds.right - popupBounds.width}px`;\n    popup.style.top = `${annoBounds.bottom + sideOffset}px`;\n  }\n\n  const ratios = [ratioAbove, ratioRight, ratioBelow, ratioLeft];\n  const maxIdx = ratios.indexOf(Math.max(...ratios));\n\n  if (maxIdx === 0) {\n    // Main orientation: above\n    if (ratioRight > ratioLeft)\n      topleft();\n    else \n      topright();\n  } else if (maxIdx === 1) {\n    // Main orientation: right\n    if (ratioAbove > ratioBelow)\n      rightup();\n    else\n      rightdown();\n  } else if (maxIdx === 2) {\n    // Main orientation: below\n    if (ratioRight > ratioLeft)\n      bottomleft();\n    else\n      bottomright();\n  } else {\n    // Main orientation: left\n    if (ratioAbove > ratioBelow)\n      leftup();\n    else \n      leftdown();\n  }\n}"],"names":["getAnnotationDomRect","viewer","annotation","viewerBounds","minX","minY","maxX","maxY","topLeft","OpenSeadragon","bottomRight","setPosition","popup","sideOffset","annoBounds","availableAbove","availableRight","availableBelow","availableLeft","popupBounds","ratioAbove","ratioRight","ratioBelow","ratioLeft","topleft","topright","leftdown","rightdown","leftup","rightup","bottomleft","bottomright","ratios","maxIdx"],"mappings":"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"}