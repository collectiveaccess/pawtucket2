{"version":3,"file":"i18n.js","sources":["../../../src/i18n.ts"],"sourcesContent":["import { InternationalString } from '@iiif/presentation-3';\n\nexport function getClosestLanguage(\n  i18nLanguage: string,\n  languages: string[],\n  i18nLanguages: string[] = [],\n  strictFallback = false\n) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return undefined;\n  }\n\n  // Only one option.\n  if (languages.length === 1) {\n    return languages[0];\n  }\n\n  // Exact match.\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n\n  // Root match (en-us === en)\n  const root = i18nLanguage.indexOf('-') !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf('-')) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n\n  // All of the fall backs.\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n\n  if (!strictFallback) {\n    // Inverse root match (en === en-us)\n    const inverseRoot = languages.map((l) => (l.indexOf('-') !== -1 ? l.slice(0, l.indexOf('-')) : null));\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n\n    // Inverse root (fallback)\n    for (const lang of i18nLanguages) {\n      const root = lang.indexOf('-') !== -1 ? lang.slice(0, lang.indexOf('-')) : null;\n      const inverseIdx = root ? languages.indexOf(root) : -1;\n      if (inverseIdx !== -1) {\n        return languages[inverseIdx];\n      }\n    }\n  }\n\n  if (languages.indexOf('none') !== -1) {\n    return 'none';\n  }\n\n  // Catch some legacy\n  if (languages.indexOf('@none') !== -1) {\n    return '@none';\n  }\n\n  // Finally, fall back to the first.\n  return languages[0];\n}\n\nexport function buildLocaleString(\n  inputText: string | InternationalString | null | undefined,\n  i18nLanguage: string | undefined,\n  options: {\n    strictFallback?: boolean;\n    defaultText?: string;\n    separator?: string;\n    fallbackLanguages?: string[];\n    closest?: boolean;\n  } = {}\n) {\n  const { strictFallback = false, defaultText = '', separator = '\\n', fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest\n    ? i18nLanguage\n    : getClosestLanguage(i18nLanguage as any, languages, fallbackLanguages, strictFallback);\n\n  if (!inputText) {\n    return defaultText;\n  }\n\n  if (typeof inputText === 'string') {\n    return inputText;\n  }\n\n  const candidateText = language ? inputText[language] : undefined;\n  if (candidateText) {\n    // Slightly tolerant of typos in IIIF like: `{\"en\": \"Some value\"}`\n    if (typeof candidateText === 'string') {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n\n  return '';\n}\n\nexport function getValue(\n  inputText: string | InternationalString | null | undefined,\n  options: { defaultText?: string; separator?: string; fallbackLanguages?: string[] } = {}\n) {\n  return buildLocaleString(inputText, typeof navigator !== 'undefined' ? navigator.language : undefined, options);\n}\n"],"names":["getClosestLanguage","i18nLanguage","languages","i18nLanguages","strictFallback","root","lang","inverseIdx","l","buildLocaleString","inputText","options","defaultText","separator","fallbackLanguages","closest","language","candidateText","getValue"],"mappings":"4GAEO,SAASA,EACdC,EACAC,EACAC,EAA0B,CAAC,EAC3BC,EAAiB,GACjB,CACA,GAAI,CAACH,GAAgB,CAACC,GAAaA,EAAU,SAAW,EAC/C,OAIL,GAAAA,EAAU,SAAW,EACvB,OAAOA,EAAU,GAInB,GAAIA,EAAU,QAAQD,CAAY,IAAM,GAC/B,OAAAA,EAIT,MAAMI,EAAOJ,EAAa,QAAQ,GAAG,IAAM,GAAKA,EAAa,MAAM,EAAGA,EAAa,QAAQ,GAAG,CAAC,EAAI,KACnG,GAAII,GAAQH,EAAU,QAAQG,CAAI,IAAM,GAC/B,OAAAA,EAIT,UAAWC,KAAQH,EACjB,GAAID,EAAU,QAAQI,CAAI,IAAM,GACvB,OAAAA,EAIX,GAAI,CAACF,EAAgB,CAGb,MAAAG,EADcL,EAAU,IAAKM,GAAOA,EAAE,QAAQ,GAAG,IAAM,GAAKA,EAAE,MAAM,EAAGA,EAAE,QAAQ,GAAG,CAAC,EAAI,IAAK,EACrE,QAAQP,CAAY,EACnD,GAAIM,IAAe,GACjB,OAAOL,EAAUK,GAInB,UAAWD,KAAQH,EAAe,CAChC,MAAME,EAAOC,EAAK,QAAQ,GAAG,IAAM,GAAKA,EAAK,MAAM,EAAGA,EAAK,QAAQ,GAAG,CAAC,EAAI,KACrEC,EAAaF,EAAOH,EAAU,QAAQG,CAAI,EAAI,GACpD,GAAIE,IAAe,GACjB,OAAOL,EAAUK,EAErB,CACF,CAEA,OAAIL,EAAU,QAAQ,MAAM,IAAM,GACzB,OAILA,EAAU,QAAQ,OAAO,IAAM,GAC1B,QAIFA,EAAU,EACnB,CAEO,SAASO,EACdC,EACAT,EACAU,EAMI,CAAA,EACJ,CACM,KAAA,CAAE,eAAAP,EAAiB,GAAO,YAAAQ,EAAc,GAAI,UAAAC,EAAY;AAAA,EAAM,kBAAAC,EAAoB,CAAA,EAAI,QAAAC,CAAA,EAAYJ,EAClGT,EAAY,OAAO,KAAKQ,GAAa,CAAE,CAAA,EACvCM,EAAWD,EACbd,EACAD,EAAmBC,EAAqBC,EAAWY,EAAmBV,CAAc,EAExF,GAAI,CAACM,EACI,OAAAE,EAGL,GAAA,OAAOF,GAAc,SAChB,OAAAA,EAGH,MAAAO,EAAgBD,EAAWN,EAAUM,GAAY,OACvD,OAAIC,EAEE,OAAOA,GAAkB,SACpBA,EAEFA,EAAc,KAAKJ,CAAS,EAG9B,EACT,CAEO,SAASK,EACdR,EACAC,EAAsF,GACtF,CACO,OAAAF,EAAkBC,EAAW,OAAO,WAAc,YAAc,UAAU,SAAW,OAAWC,CAAO,CAChH"}