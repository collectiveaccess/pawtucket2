{"version":3,"file":"index.js","sources":["../../src/compat.ts","../../src/events.ts","../../src/styles.ts","../../node_modules/@atlas-viewer/iiif-image-api/dist/esm/index.mjs","../../src/thumbnail.ts","../../src/i18n.ts","../../node_modules/svg-arc-to-cubic-bezier/modules/index.js","../../node_modules/parse-svg-path/index.js","../../node_modules/abs-svg-path/index.js","../../src/annotation-targets/normalize-svg.ts","../../src/annotation-targets/bezier.ts","../../src/annotation-targets/parse-selector.ts","../../src/annotation-targets/expand-target.ts","../../src/content-state.ts","../../src/painting-annotations/parse-specific-resource.ts","../../src/painting-annotations/helper.ts","../../src/objects.ts","../../src/ranges.ts","../../src/sequences.ts"],"sourcesContent":["export type CompatVault = {\n  get: import('@iiif/vault').Vault['get'];\n  setMetaValue: import('@iiif/vault').Vault['setMetaValue'];\n  getResourceMeta: import('@iiif/vault').Vault['getResourceMeta'];\n};\n\nconst metaState: any = {};\nexport const compatVault: CompatVault = {\n  get(nonRef: any) {\n    return nonRef;\n  },\n  setMetaValue([id, meta, key], value) {\n    const oldValue = compatVault.getResourceMeta(id, meta);\n    const oldValueItem = oldValue ? oldValue[key] : undefined;\n    const newValue = typeof value === 'function' ? (value as any)(oldValueItem) : value;\n    metaState[id] = {\n      ...(metaState[id] || {}),\n      [meta]: {\n        ...((metaState[id] || {})[meta] || {}),\n        [key]: newValue,\n      },\n    };\n  },\n  getResourceMeta: ((resource: any, metaKey?: any) => {\n    const resourceMeta = metaState[resource as any] as any;\n\n    if (!resourceMeta) {\n      return undefined;\n    }\n    if (!metaKey) {\n      return resourceMeta;\n    }\n\n    return resourceMeta[metaKey];\n  }) as any,\n};\n","import type { Reference } from '@iiif/presentation-3';\nimport { compatVault, CompatVault } from './compat';\n\nexport function createEventsHelper(vault: CompatVault = compatVault) {\n  return {\n    addEventListener<T>(\n      resource: Reference<any>,\n      event: string,\n      listener: (e: any, resource: T) => void,\n      scope?: string[]\n    ) {\n      if (!resource) {\n        return;\n      }\n\n      vault.setMetaValue<Array<{ callback: any; scope?: string[] }>>(\n        [resource.id, 'eventManager', event],\n        (registeredCallbacks) => {\n          const callbacks = registeredCallbacks || [];\n          for (const registered of callbacks) {\n            if (registered.callback === listener) {\n              // @todo check for scopes matching, very edge-case as scopes should be fixed.\n              return callbacks;\n            }\n          }\n          return [...callbacks, { callback: listener, scope }];\n        }\n      );\n\n      return listener;\n    },\n\n    removeEventListener<T>(resource: Reference<any>, event: string, listener: (e: any, resource: T) => void) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue<Array<{ callback: () => void; scope?: string[] }>>(\n        [resource.id, 'eventManager', event],\n        (registeredCallbacks) => {\n          return (registeredCallbacks || []).filter((registeredCallback) => registeredCallback.callback !== listener);\n        }\n      );\n    },\n\n    getListenersAsProps(resourceOrId: string | Reference<any>, scope?: string[]) {\n      const resource = typeof resourceOrId === 'string' ? { id: resourceOrId } : resourceOrId;\n      if (!resource || !resource.id) {\n        return {};\n      }\n      const hooks = vault.getResourceMeta(resource.id, 'eventManager');\n      const props: any = {};\n      if (hooks && resource) {\n        for (const hook of Object.keys(hooks)) {\n          props[hook] = (e: any) => {\n            const fullResource = vault.get(resource);\n            for (const { callback, scope: _scope } of hooks[hook] || []) {\n              if (!_scope || (scope && _scope.indexOf(scope) !== -1)) {\n                callback(e, fullResource);\n              }\n            }\n          };\n        }\n      }\n      return props;\n    },\n  };\n}\n","import type { Vault } from '@iiif/vault';\nimport { Reference } from '@iiif/presentation-3';\nimport { compatVault, CompatVault } from './compat';\n\nexport type StyleDefinition = Record<string, any>;\n\nexport type StyledHelper<S extends StyleDefinition> = {\n  applyStyles<Style extends StyleDefinition = S>(resource: any, scope: string, styles: Style[string]): void;\n  getAppliedStyles<Style extends StyleDefinition = S>(resource: any): Style | undefined;\n};\n\nexport function createStylesHelper<S extends StyleDefinition>(vault: CompatVault = compatVault): StyledHelper<S> {\n  return {\n    applyStyles<Style extends StyleDefinition = S>(\n      resource: string | Reference<any>,\n      scope: string,\n      styles: Style[string]\n    ) {\n      const id = typeof resource === 'string' ? resource : resource.id;\n      return vault.setMetaValue<Style[string]>([id, 'styles', scope], styles);\n    },\n    getAppliedStyles<Style extends StyleDefinition = S>(resource: string | Reference<any>): Style | undefined {\n      const id = typeof resource === 'string' ? resource : resource.id;\n      return vault.getResourceMeta<{ styles: Style }, 'styles'>(id, 'styles');\n    },\n  };\n}\n","function p(i){return i.endsWith(\"info.json\")?i:i.endsWith(\"/\")?`${i}info.json`:`${i}/info.json`}const te=\"http://library.stanford.edu/iiif/image-api/compliance.html#level0\",z=\"http://library.stanford.edu/iiif/image-api/compliance.html#level1\",A=\"http://library.stanford.edu/iiif/image-api/compliance.html#level2\",ne=\"http://library.stanford.edu/iiif/image-api/conformance.html#level0\",E=\"http://library.stanford.edu/iiif/image-api/conformance.html#level1\",b=\"http://library.stanford.edu/iiif/image-api/conformance.html#level2\",re=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\",L=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\",M=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\",se=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\",W=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\",j=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\",ae=\"http://iiif.io/api/image/1/level0.json\",oe=\"http://iiif.io/api/image/1/profiles/level0.json\",$=\"http://iiif.io/api/image/1/level1.json\",C=\"http://iiif.io/api/image/1/profiles/level1.json\",P=\"http://iiif.io/api/image/1/level2.json\",B=\"http://iiif.io/api/image/1/profiles/level2.json\",fe=\"http://iiif.io/api/image/2/level0.json\",le=\"http://iiif.io/api/image/2/profiles/level0.json\",N=\"http://iiif.io/api/image/2/level1.json\",R=\"http://iiif.io/api/image/2/profiles/level1.json\",H=\"http://iiif.io/api/image/2/level2.json\",T=\"http://iiif.io/api/image/2/profiles/level2.json\",he=\"level0\",G=\"level1\",k=\"level2\",ue=\"http://iiif.io/api/image/2/level0\",Q=\"http://iiif.io/api/image/2/level1\",V=\"http://iiif.io/api/image/2/level2\",D=[V,A,b,M,j,P,B,H,T,k],U=[...D,Q,z,E,L,W,$,C,N,R,G],J=[ue,Q,V,te,z,A,ne,E,b,re,L,M,se,W,j,ae,oe,$,C,P,B,fe,le,N,R,H,T,he,G,k],Qe=J,ce={extraFormats:[\"jpg\"],extraQualities:[\"default\"],extraFeatures:[\"sizeByWhListed\"]},de={extraFormats:[\"jpg\"],extraQualities:[\"default\"],extraFeatures:[\"baseUriRedirect\",\"cors\",\"jsonldMediaType\",\"regionByPx\",\"regionSquare\",\"sizeByWhListed\",\"sizeByH\",\"sizeByW\",\"sizeByWh\"]},ge={extraFormats:[\"jpg\",\"png\"],extraQualities:[\"default\"],extraFeatures:[\"baseUriRedirect\",\"cors\",\"jsonldMediaType\",\"regionByPct\",\"regionByPx\",\"regionSquare\",\"rotationBy90s\",\"sizeByWhListed\",\"sizeByConfinedWh\",\"sizeByH\",\"sizeByPct\",\"sizeByW\",\"sizeByWh\"]},Z=[\"baseUriRedirect\",\"canonicalLinkHeader\",\"cors\",\"jsonldMediaType\",\"mirroring\",\"profileLinkHeader\",\"regionByPct\",\"regionByPx\",\"regionSquare\",\"rotationArbitrary\",\"rotationBy90s\",\"sizeByConfinedWh\",\"sizeByH\",\"sizeByPct\",\"sizeByW\",\"sizeByWh\",\"sizeUpscaling\",\"sizeByWhListed\",\"sizeByDistortedWh\",\"sizeByForcedWh\"];function pe(i){return D.indexOf(i)!==-1?ge:U.indexOf(i)!==-1?de:ce}function K(i){const e=i?Array.isArray(i.profile)?i.profile:[i.profile]:[],t={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let n of e)if(typeof n==\"string\"&&(n=pe(n)),!!n){if(n.formats)for(const r of n.formats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(n.qualities)for(const r of n.qualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(n.supports)for(const r of n.supports)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);if(n.maxHeight&&(t.maxHeight=n.maxHeight),n.maxWidth&&(t.maxWidth=n.maxWidth),n.maxArea&&(t.maxArea=n.maxArea),n.extraFormats)for(const r of n.extraFormats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(n.extraQualities)for(const r of n.extraQualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(n.extraFeatures)for(const r of n.extraFeatures)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);n.maxHeight&&(t.maxHeight=n.maxHeight),n.maxWidth&&(t.maxWidth=n.maxWidth),n.maxArea&&(t.maxArea=n.maxArea)}if(i.extraFormats)for(const n of i.extraFormats)t.extraFormats.indexOf(n)===-1&&t.extraFormats.push(n);if(i.extraFeatures)for(const n of i.extraFeatures)t.extraFeatures.indexOf(n)===-1&&t.extraFeatures.push(n);if(i.extraQualities)for(const n of i.extraQualities)t.extraQualities.indexOf(n)===-1&&t.extraQualities.push(n);return t}function me(i){try{if(i===\"full\")return{full:!0};if(i===\"square\")return{square:!0};const e=i.startsWith(\"pct:\"),n=i.substr(e?4:0).split(\",\").map(r=>parseFloat(r));return{x:n[0],y:n[1],w:n[2],h:n[3],percent:e}}catch{throw new Error(\"Expected 'full', 'square' or 'x,y,w,h'. Found \"+i)}}function xe(i){const e={upscaled:!1,max:!1,confined:!1};if(i[0]===\"^\"&&(e.upscaled=!0,i=i.slice(1)),i===\"max\"||i===\"full\")return e.max=!0,e.serialiseAsFull=i===\"full\",e;if(i[0]===\"!\"&&(e.confined=!0,i=i.slice(1)),i[0]===\"p\")return e.percentScale=parseFloat(i.slice(4)),e;const t=i.split(\",\").map(n=>n.trim());return t.length&&(t[0]!==\"\"&&(e.width=parseInt(t[0],10)),t[1]!==\"\"?(e.height=parseInt(t[1],10),e.version=2):e.version=3),e}function Ie(i){const e={angle:0};if(i[0]===\"!\"&&(e.mirror=!0,i=i.substr(1)),e.angle=parseFloat(i)%360,Number.isNaN(e.angle))throw new Error(`Invalid rotation ${i}`);return e}function ye(i,e=\"\"){const t=i.match(/^(([a-zA-Z]+):\\/\\/([^/]+))?((.*)+)/);if(!t)throw new Error(`Invalid or unknown input ${i}`);const n=t[2],r=t[3];let s=t[4];if(s[0]===\"/\"&&(s=s.substr(1)),e.length>0){if(e[0]===\"/\"&&(e=e.substr(1)),e!==s.substr(0,e.length))throw new Error(`Path does not start with prefix (path: ${s}, prefix: ${e})`);s=s.substr(e.length)}return{scheme:n,server:r,path:s,prefix:e}}function _e(i,e=\"\"){const{path:t,scheme:n,server:r,prefix:s}=ye(i,e),a=t.split(\"/\").reverse(),[o,f,u,l,...d]=a,g=d.reverse().filter(Boolean).join(\"/\");if(a.length===1||o===\"\")return{type:\"base\",scheme:n,server:r,prefix:s,identifier:g};if(o===\"info.json\"){const[,...c]=a;return{type:\"info\",scheme:n,server:r,prefix:s,identifier:c.reverse().filter(Boolean).join(\"/\")}}const m=o.split(\".\");return{type:\"image\",scheme:n,server:r,prefix:s,identifier:g,originalPath:t,region:me(l),size:xe(u),rotation:Ie(f),quality:m[0],format:m[1]}}function we(i){const e=_e(p(i.id));if(e.type!==\"info\")throw new Error(\"Invalid service URL\");const t=K(i);return{identifier:e.identifier,originalPath:\"\",server:e.server,prefix:e.prefix,scheme:e.scheme,type:\"image\",quality:t.extraQualities.indexOf(\"default\")===-1?t.extraQualities[0]:\"default\",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:\"jpg\",rotation:{angle:0}}}function Se(i,e,t){const n=t.length,r=[];for(let s=0;s<n;s++){const o=t[s].width;r.push(i/o)}return r}function ve(i,e,t){const n=t.length,r=[];for(let s=0;s<n;s++){const a=t[s];r.push({width:Math.floor(i/a),height:Math.floor(e/a)})}return r}function h(i){if(i[\"@id\"])return i[\"@id\"];if(i.id)return i.id}function w(i){if(!i||!i.profile||!h(i))return!1;const e=Array.isArray(i.profile)?i.profile:[i.profile];for(const t of e)if(typeof t==\"string\"&&J.indexOf(t)!==-1)return!0;return!1}function Fe(i){if(!w(i))return!1;const e=Array.isArray(i.profile)?i.profile:[i.profile];for(const t of e)if(typeof t==\"string\"){if(U.indexOf(t)!==-1)return!0}else{const n=[...t.supports||[],...t.extraFeatures||[]];if(n.indexOf(\"regionByPx\")!==-1&&(n.indexOf(\"sizeByW\")!==-1||n.indexOf(\"sizeByWh\")!==-1))return!0}return!1}function v(i,e){if(e&&e.profile){const t=e.profile;if(t){const n=Array.isArray(t)?t:[t];return n.includes(`level${i}`)||n.includes(`http://iiif.io/api/image/2/level${i}.json`)||n.includes(`http://iiif.io/api/image/1/level${i}.json`)||n.includes(`http://iiif.io/api/image/1/profiles/level${i}.json`)}}return!1}function F(i){return w(i)?v(0,i)?0:v(1,i)?1:v(2,i)?2:null:null}function X(i){return(i[\"@context\"]?Array.isArray(i[\"@context\"])?i[\"@context\"]:[i[\"@context\"]]:[]).indexOf(\"http://iiif.io/api/image/3/context.json\")!==-1}function Oe(i){if(!Fe(i))return[];const e=[],t=Array.isArray(i.profile)?i.profile:[i.profile],n=t.length;for(let r=0;r<n;r++){const s=t[r];if(typeof s!=\"string\"&&(s.maxHeight||s.maxWidth))return[{id:h(i),type:\"variable\",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight,level:F(i),version:i[\"@context\"]===\"http://iiif.io/api/image/3/context.json\"?3:2}]}if(i.tiles){const r=i.tiles.length;for(let s=0;s<r;s++){const a=i.tiles[s];(a.height||a.width)&&e.push({id:h(i),type:\"variable\",minHeight:0,minWidth:0,maxHeight:a.height||a.width,maxWidth:a.width,level:F(i),version:X(i)?3:2})}}return e}function Y(i){const e=/^.*\\/(full)\\/(((\\d+),(\\d+)?)|max)\\/(\\d+)\\/default\\.(jpg|png|jpeg)$/,t=i.match(e);if(t){const n=t[1],r=parseInt(t[4],10),s=parseInt(t[5],10),a=t[7];if((n===\"max\"||n===\"full\")&&r&&s&&a)return{type:\"fixed\",id:i,height:s,width:r}}return{type:\"unknown\",id:i}}function ze(i){if(i[\"@type\"])return i[\"@type\"];if(i.type)return i.type}function Ae(i){if(typeof i==\"string\")return Y(i);const e=ze(i);if(e!==\"Image\"&&e!==\"sc:Image\")return null;const t=i,n=h(t);return n?n&&t.width&&t.height?{id:n,type:\"fixed\",width:t.width,height:t.height,unsafe:!0}:Y(n):null}function Ee(i){return w(i)?(i&&i.sizes?i.sizes:[]).map(e=>({id:h(i),type:\"fixed-service\",height:e.height,width:e.width,level:F(i),version:X(i)?3:2})):[]}function q(i){const e=[],t=i.length;for(let n=0;n<t;n++){const r=Ee(i[n]);r.length&&e.push(...r);const s=Oe(i[n]);s.length&&e.push(...s)}return e}function ee(i){const e=i.service?Array.isArray(i.service)?i.service:[i.service]:[],t=e.length,n=[];for(let r=0;r<t;r++)w(e[r])&&n.push(e[r]);return n}function be(i,e=!0,t){const n=[],r=Ae(i);if(r===null)return n;const s=i;if(n.push(r),e&&s.width&&s.height){const a=[],o=ee(s);for(const f of o){const u={id:h(f),width:s.width,height:s.height};if(t.canLoadSync(u)){const l=t.loadServiceSync(u);l&&(l.height||(l.height=s.height),l.width||(l.width=s.width),a.push(...q([l])))}}if(a.length)return n.push(...a),n}return s.service&&n.push(...q(s.service)),n}function Le({x:i=0,y:e=0,w:t,h:n,full:r,square:s,percent:a}){if(r)return\"full\";if(s)return\"square\";if(typeof t>\"u\"||typeof n>\"u\")throw new Error(\"RegionParameter: invalid region\");const o=`${i},${e},${t},${n}`;return a?`pct:${o}`:o}function Me({max:i,percentScale:e,upscaled:t,confined:n,width:r,height:s,serialiseAsFull:a,version:o}){const f=[];return t&&f.push(\"^\"),i?(f.push(a?\"full\":\"max\"),f.join(\"\")):(n&&f.push(\"!\"),e&&f.push(`pct:${e}`),r&&f.push(`${r}`),f.push(\",\"),s&&o===3&&f.push(`${s}`),f.join(\"\"))}function We(i){return`${i.mirror?\"!\":\"\"}${(i.angle||0)%360}`}var Ve=Object.defineProperty,De=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,je=Object.getOwnPropertySymbols,Je=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,$e=(i,e,t)=>e in i?Ve(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,x=(i,e)=>{for(var t in e||(e={}))Je.call(e,t)&&$e(i,t,e[t]);if(je)for(var t of je(e))Ze.call(e,t)&&$e(i,t,e[t]);return i},I=(i,e)=>De(i,Ue(e));function Ce(i,e){const t=i.prefix.startsWith(\"/\")?i.prefix.substr(1):i.prefix,n=`${i.scheme}://${i.server}/${t?`${t}/`:\"\"}${i.identifier}`;if(i.type===\"base\")return n;if(i.type===\"info\")return`${n}/info.json`;let{size:r}=i;const{region:s,rotation:a,format:o,quality:f}=i;if(e){const u=e[\"@context\"]?Array.isArray(e[\"@context\"])?e[\"@context\"]:[e[\"@context\"]]:[],l=u.indexOf(\"http://iiif.io/api/image/2/context.json\")!==-1,d=u.indexOf(\"http://iiif.io/api/image/3/context.json\")!==-1;if((r.width===e.width&&!r.height||r.height===e.height&&!r.width||r.width===e.width&&r.height===e.height)&&(r=I(x({},r),{max:!0})),l&&(r.max&&!r.serialiseAsFull&&(r=I(x({},r),{serialiseAsFull:!0})),!r.max&&r.width&&r.height&&(r=I(x({},r),{height:void 0})),r=I(x({},r),{version:2})),d){if(r.max&&r.serialiseAsFull&&(r=I(x({},r),{serialiseAsFull:!1})),r.width&&!r.height&&e.width&&e.height){const g=e.height/e.width;r=I(x({},r),{height:Math.ceil(r.width*g)})}r=I(x({},r),{version:3})}}return[n,Le(s),Me(r),We(a),`${f}.${o}`].filter(Boolean).join(\"/\")}function O(i,e,t){const n=we({\"@context\":i.version===3?\"http://iiif.io/api/image/3/context.json\":\"http://iiif.io/api/image/2/context.json\",id:p(h(i)),profile:i.level===null||typeof i.level>\"u\"?\"level0\":`level${i.level}}`,type:i.version===3?\"ImageService3\":\"ImageService2\"});if(n.type!==\"image\")throw new Error(\"Invalid service\");return n.size.max=!1,n.size.width=e,n.size.height=t,{id:Ce(n),type:\"fixed\",width:e,height:t||i.height/(i.width||1)*e,unsafe:i.width>e}}function y(i){const e=i.replace(/(https?:\\/\\/)?(www.)?/i,\"\");return e.indexOf(\"/\")!==-1?e.split(\"/\")[0]:e}function Ke(i){if(!i.width||!i.height)return null;if(i.tiles){const e=i.tiles.sort((n,r)=>Math.max(...r.scaleFactors)-Math.max(...n.scaleFactors)),t=e.length;for(let n=0;n<t;n++){const r=e[n],s=r.width;if(!s)continue;const a=r.scaleFactors.length,o=r.scaleFactors.sort();for(let f=0;f<a;f++){const u=o[f];if(i.width/u<=s&&i.height/u<=s)return{id:h(i),type:\"fixed-service\",width:i.width/u|0,height:i.height/u|0,level:F(i),version:X(i)?3:2}}}}return null}function ie(i,e){if(!w(i))return[!1,\"Not a valid image service\"];e.extraFeatures=e.extraFeatures?e.extraFeatures:[];const t=K(i);if(e.exactSize){let n=!1;if(i.sizes)for(const r of i.sizes)r.width&&r.width===e.exactSize.width&&(Z.indexOf(\"sizeByW\")!==-1||r.height&&r.height===e.exactSize.height)&&(n=!0),r.height&&r.height===e.exactSize.height&&(Z.indexOf(\"sizeByH\")!==-1||r.width&&r.width===e.exactSize.width)&&(n=!0);n||(e.maxWidth=Math.max(e.maxWidth||0,e.exactSize.width||0)||void 0,e.maxHeight=Math.max(e.maxHeight||0,e.exactSize.height||0)||void 0,e.maxArea=Math.max(e.maxArea||0,(e.exactSize.width&&e.exactSize.height?e.exactSize.width*e.exactSize.height:e.maxArea)||0)||void 0,!e.exactSize.height&&e.exactSize.width?e.extraFeatures.indexOf(\"sizeByW\")===-1&&e.extraFeatures.push(\"sizeByW\"):!e.exactSize.width&&e.exactSize.height&&e.extraFeatures.indexOf(\"sizeByH\")===-1&&e.extraFeatures.push(\"sizeByH\"))}if(e.maxArea&&t.maxArea&&e.maxArea>t.maxArea)return[!1,`Max area is ${t.maxArea}`];if(e.maxWidth&&t.maxWidth&&e.maxWidth>t.maxWidth)return[!1,`Max width is ${t.maxWidth}`];if(e.maxHeight&&t.maxHeight&&e.maxHeight>t.maxHeight)return[!1,`Max height is ${t.maxHeight}`];if(e.extraFeatures){const n=[];for(const r of e.extraFeatures)t.extraFeatures.indexOf(r)===-1&&n.push(r);if(n.length)return[!1,`Missing features: ${n.join(\", \")}`]}if(e.extraFormats){const n=[];for(const r of e.extraFormats)t.extraFormats.indexOf(r)===-1&&n.push(r);if(n.length)return[!1,`Missing formats: ${n.join(\", \")}`]}if(e.extraQualities){const n=[];for(const r of e.extraQualities)t.extraQualities.indexOf(r)===-1&&n.push(r);if(n.length)return[!1,`Missing qualities: ${n.join(\", \")}`]}return[!0]}function Xe(i,e){return ie(i,{extraFormats:[e]})}function Ye(i,e){if(e.type!==\"image\")return[!0];const t=[];e.rotation.mirror&&t.push(\"mirroring\"),e.region.percent&&t.push(\"regionByPct\"),e.region.square?t.push(\"regionSquare\"):e.region.full||t.push(\"regionByPx\"),e.rotation.angle&&(e.rotation.angle%90?t.push(\"rotationArbitrary\"):t.push(\"rotationBy90s\")),e.size.confined&&t.push(\"sizeByConfinedWh\"),!e.size.width&&e.size.height&&t.push(\"sizeByH\"),e.size.percentScale&&t.push(\"sizeByPct\"),(i.sizes||[]).find(a=>a.width===e.size.width&&!e.size.height||a.height===e.size.height&&!e.size.width||a.height===e.size.height&&a.width===e.size.width)?t.push(\"sizeByWhListed\"):(e.size.width&&!e.size.height&&t.push(\"sizeByW\"),e.size.width&&e.size.height&&t.push(\"sizeByWh\")),e.size.upscaled&&t.push(\"sizeUpscaling\");const[r,s]=ie(i,{extraFeatures:t,extraQualities:[e.quality],extraFormats:[e.format],exactSize:e.size});return r?[!0]:[!1,s]}function Pe(i,e,t){const n=i.width?i.width:i.maxWidth;return t.height<=i.maxHeight&&t.width<=i.maxWidth&&t.height>=i.minHeight&&t.width>=i.minWidth&&(!e||Math.abs(t.width-n)<Math.abs(e.width-n))}function Be(i,e){const t=[],n=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},i),r=(l,d=0)=>n.explain?t.push(new Array(d).fill(0).map(g=>\"    \").join(\"\")+l().trim()):void 0,s=[],a=[];let o=null;r(()=>`Using configuration: ${JSON.stringify(n,null,2)}`);const f=(l,d)=>{if(r(()=>\"Swapping choice\",3),Pe(n,d,l)){if(n.preferFixedSize&&l.unsafe){r(()=>`We found an image that was marked as unsafe, but it was the best size. (${l.id})`,4),a.push(l);return}n.returnAllOptions&&d&&a.push(d),r(()=>`We found a new image that was the best size. (${l.id})`,4),o=l}else n.returnAllOptions&&a.push(l)};r(()=>`The input shows we have ${e.length} list(s) of candidates to choose from.`);const u=e.length;for(let l=0;l<u;l++){const d=e[l]();r(()=>`Candidate group ${l}: ${JSON.stringify(d,null,2)}`,1);const g=d.length;r(()=>`Checking candidate list number ${l} and found ${g} potential ways of creating image(s)`,1);for(let m=0;m<g;m++){const c=d[m];if(r(()=>`-> Checking candidate ${m}`,1),c.type===\"unknown\"&&n.atAnyCost&&(r(()=>`We've found an unknown image type, adding this to the \"last resort\" list`,2),s.push(c)),c.type===\"fixed\"&&(c.unsafe?(r(()=>`We've found an unsafe fixed image type, adding this to the \"last resort\" list`,2),s.push(c)):(r(()=>\"We've found a fixed size image, checking if it matches the request\",2),f(c,o))),c.type===\"fixed-service\")if(n.unsafeImageService){r(()=>\"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)\",2);const S=O(c,n.width,n.height);f(S,o)}else{r(()=>\"Checking for an image from the tile source 3\",2);const S=O(c,c.width,c.height);f(S,o)}if(c.type===\"variable\"&&c.maxWidth){const S=O({id:c.id,type:\"fixed-service\",width:c.maxWidth,height:c.maxWidth,level:c.level,version:c.version},c.maxWidth);f(S,o)}}if(o&&!n.returnAllOptions){if(o.unsafe||n.allowUnsafe)continue;r(()=>`We found a match in choice list number ${l}, no searching any more`);break}}return n.atAnyCost&&a.length===0?(r(()=>o?`We found an image! ${o.id} of type ${o.type}`:'We found no images, but \"atAnyCost\" is set, so returning that'),{best:o||s[0],fallback:s.slice(1),log:t}):n.returnAllOptions?(r(()=>\"Returning all options that we have found\"),{best:n.atAnyCost?o||a[0]||s[0]:o||a[0],fallback:[...a,...s],log:t}):(r(()=>\"Returning the best image that we found, and a fallback\"),{best:o||a[0]||null,fallback:o?a:a.slice(1),log:t})}var qe=Object.defineProperty,ei=Object.defineProperties,ii=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,ti=Object.prototype.hasOwnProperty,ni=Object.prototype.propertyIsEnumerable,Re=(i,e,t)=>e in i?qe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ri=(i,e)=>{for(var t in e||(e={}))ti.call(e,t)&&Re(i,t,e[t]);if(Ne)for(var t of Ne(e))ni.call(e,t)&&Re(i,t,e[t]);return i},si=(i,e)=>ei(i,ii(e));function He(i,e,t){const n=i>e?i:e,r=t.length,s=[];for(let a=0;a<r;a++){const o=t[a];let f=o.scaleFactors[0],u=n/f;const l=[f];for(;u>=o.width;)f=f*2,l.push(f),u=u/2;s.push(si(ri({},o),{scaleFactors:l}))}return s}function Te(i,e){if(i.length!==e.length)return!1;if(i.length===0&&e.length===0)return!0;const t=i.length;let n=!0;for(let s=0;s<t;s++){const a=i[s],o=e[s];if(a.width!==o.width||a.height!==o.height){n=!1;break}}if(n)return!0;let r=0;for(let s=0;s<t;s++)for(let a=0;a<t;a++)if(i[s].width===e[a].width&&i[s].height===e[a].height){r++;break}return r===t}function Ge(i){return v(0,i)}var _=(i,e,t)=>new Promise((n,r)=>{var s=f=>{try{o(t.next(f))}catch(u){r(u)}},a=f=>{try{o(t.throw(f))}catch(u){r(u)}},o=f=>f.done?n(f.value):Promise.resolve(f.value).then(s,a);o((t=t.apply(i,e)).next())});class ke{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(e){Object.assign(this.config,e)}sample(e,t,n=!0){const r=y(h(e)),s=p(h(e)),a=this.knownImageServers[r];return this.imageServices[s]=Object.assign(e,{real:!0}),!a&&e.tiles&&!Ge(e)?(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:n,sampledId:h(e),verified:!1,server:null,result:{context:e[\"@context\"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:Se(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0):this.verify(e)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,n=!1){const r=e==null?void 0:e.source,s=y(h(e)),a=this.knownImageServers[s];if(!a||!a.result||!((r==null?void 0:r.height)||e.height)||!((r==null?void 0:r.width)||e.width)||!n&&(a.malformed||a.verifications<this.config.verificationsRequired)||Ge(e.source))return null;const o=p(h(e));return this.imageServices[o]||(this.imageServices[o]={\"@context\":a.result.context,\"@id\":h(e),id:h(e),protocol:\"http://iiif.io/api/image\",tiles:(r==null?void 0:r.tiles)||He(e.width,e.height,a.result.sampledTiles),sizes:(r==null?void 0:r.sizes)||ve(Math.round(e.width/a.result.resourceServiceRatio),Math.round(e.height/a.result.resourceServiceRatio),a.result.sizeRatios),profile:(r==null?void 0:r.profile)||a.result.sampledProfile,height:(r==null?void 0:r.height)||e.height,width:(r==null?void 0:r.width)||e.width,real:!1}),this.imageServices[o]}getThumbnailFromResource(e,t){return _(this,arguments,function*(n,r,s=!0,a=[]){const o=n?yield this.getImageCandidates(n,s):[];return Be(r,[()=>a,()=>o])})}getImageCandidates(e,t=!0){return _(this,null,function*(){const n=e;if(t&&n.height&&n.width){const r=ee(n);for(const s of r){const a={id:h(s),width:s.width?s.width:n.width,height:s.height?s.height:n.height,source:s};yield this.loadService(a)}}return be(e,t,this)})}verify(e){return _(this,null,function*(){const t=this.predict(e,!1,!0),n=yield this.fetchService(h(e));if(!t)return!1;const r=t.height===n.height&&t.width===n.width&&t[\"@context\"]===n[\"@context\"]&&Te(t.sizes||[],n.sizes||[]);if(r){const s=y(h(e));this.knownImageServers[s].verifications+=1,this.knownImageServers[s].verifications>=this.config.verificationsRequired&&(this.knownImageServers[s].verified=!0)}return r})}canLoadSync(e){const t=typeof e==\"string\"?e:h(e),n=p(t);if(this.imageServices[n])return!0;const r=this.knownImageServers[y(t)];return r&&!r.malformed&&r.verifications>=this.config.verificationsRequired}markAsMalformed(e){return _(this,null,function*(){return this.knownImageServers[y(h(e))].malformed=!0,this.loadService(e,!0)})}fetchService(e,t=!1){return _(this,null,function*(){const n=p(e);if(this.imageServices[n]&&(!t||this.imageServices[n].real))return this.imageServices[n];if(!this.config.enableFetching)throw new Error(\"Fetching is not enabled\");const r=yield this.fetch(n).then(s=>s.json());return!r.id&&r[\"@id\"]&&(r.id=r[\"@id\"]),r.id!==e&&(r.id=e,r[\"@id\"]&&(r[\"@id\"]=e)),this.imageServices[n]=Object.assign(r,{real:!0}),this.imageServices[n]})}fetch(e,t){return _(this,null,function*(){return fetch(e,t)})}loadService(e,t=!1){return _(this,null,function*(){if(!this.config.disableThrottling){let s=!0;for(;s;)if(this.fetchingCount>=this.config.verificationsRequired)yield new Promise(a=>setTimeout(a,500));else{s=!1;break}}const n=this.knownImageServers[y(h(e))];if(n&&!n.malformed&&!t){yield n.result;const s=this.loadServiceSync(e);if(s)return s}this.fetchingCount++;const r=yield this.fetchService(h(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r})}loadServiceSync(e){const t=p(h(e));return this.imageServices[t]?this.imageServices[t]:this.predict(e)}}const ai=new ke;export{ae as IIIF_1_IMAGE_LEVEL_0,oe as IIIF_1_IMAGE_LEVEL_0_PROFILE,$ as IIIF_1_IMAGE_LEVEL_1,C as IIIF_1_IMAGE_LEVEL_1_PROFILE,P as IIIF_1_IMAGE_LEVEL_2,B as IIIF_1_IMAGE_LEVEL_2_PROFILE,fe as IIIF_2_IMAGE_LEVEL_0,ue as IIIF_2_IMAGE_LEVEL_0_NO_JSON,le as IIIF_2_IMAGE_LEVEL_0_PROFILE,N as IIIF_2_IMAGE_LEVEL_1,Q as IIIF_2_IMAGE_LEVEL_1_NO_JSON,R as IIIF_2_IMAGE_LEVEL_1_PROFILE,H as IIIF_2_IMAGE_LEVEL_2,V as IIIF_2_IMAGE_LEVEL_2_NO_JSON,T as IIIF_2_IMAGE_LEVEL_2_PROFILE,he as IIIF_3_IMAGE_LEVEL_0,G as IIIF_3_IMAGE_LEVEL_1,k as IIIF_3_IMAGE_LEVEL_2,ke as ImageServiceLoader,re as STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,L as STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,M as STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,se as STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,W as STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,j as STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,te as STANFORD_IIIF_IMAGE_COMPLIANCE_0,z as STANFORD_IIIF_IMAGE_COMPLIANCE_1,A as STANFORD_IIIF_IMAGE_COMPLIANCE_2,ne as STANFORD_IIIF_IMAGE_CONFORMANCE_0,E as STANFORD_IIIF_IMAGE_CONFORMANCE_1,b as STANFORD_IIIF_IMAGE_CONFORMANCE_2,p as canonicalServiceUrl,K as combineProfiles,we as createImageServiceRequest,Z as extraFeatures,Se as extractFixedSizeScales,ve as fixedSizesFromScales,Oe as getCustomSizeFromService,Ae as getFixedSizeFromImage,Ee as getFixedSizesFromService,h as getId,be as getImageCandidates,q as getImageCandidatesFromService,O as getImageFromTileSource,y as getImageServerFromId,ee as getImageServices,Ke as getSmallestScaleFactorAsSingleImage,ze as getType,ai as imageServiceLoader,J as imageServiceProfiles,Ce as imageServiceRequestToString,Xe as imageServiceSupportsFormat,Ye as imageServiceSupportsRequest,Y as inferSizeFromUrl,Pe as isBestMatch,w as isImageService,ce as level0,Qe as level0Support,de as level1,U as level1Support,ge as level2,D as level2Support,pe as levelToProfile,_e as parseImageServiceRequest,ye as parseImageServiceUrl,me as parseRegionParameter,Ie as parseRotationParameter,xe as parseSizeParameter,Be as pickBestFromCandidates,Le as regionParameterToString,We as rotationParameterToString,He as sampledTilesToTiles,Me as sizeParameterToString,Te as sizesMatch,ie as supports,Fe as supportsCustomSizes};\n","import {\n  AnnotationNormalized,\n  AnnotationPageNormalized,\n  CanvasNormalized,\n  ChoiceBody,\n  CollectionItemSchemas,\n  CollectionNormalized,\n  ContentResource,\n  DescriptiveNormalized,\n  ManifestNormalized,\n  Reference,\n} from '@iiif/presentation-3';\nimport {\n  FixedSizeImage,\n  FixedSizeImageService,\n  getFixedSizeFromImage,\n  ImageCandidate,\n  ImageCandidateRequest,\n  ImageServiceLoader,\n  UnknownSizeImage,\n  VariableSizeImage,\n} from '@atlas-viewer/iiif-image-api';\nimport { compatVault, CompatVault } from './compat';\n\nexport function createThumbnailHelper(\n  vault: CompatVault = compatVault,\n  dependencies: { imageServiceLoader?: ImageServiceLoader } = {}\n) {\n  const imageServiceLoader = dependencies.imageServiceLoader || new ImageServiceLoader();\n\n  async function getBestThumbnailAtSize(\n    input:\n      | string\n      | Reference<CollectionItemSchemas>\n      | Reference<'Collection'>\n      | Reference<'Manifest'>\n      | Reference<'Canvas'>\n      | Reference<'Annotation'>\n      | Reference<'AnnotationPage'>\n      | Reference<'ContentResource'>\n      | CollectionNormalized\n      | ManifestNormalized\n      | CanvasNormalized\n      | AnnotationNormalized\n      | AnnotationPageNormalized\n      | ContentResource\n      | undefined,\n    request: ImageCandidateRequest,\n    dereference?: boolean,\n    candidates: Array<ImageCandidate> = [],\n    dimensions?: { width: number; height: number }\n  ): Promise<{\n    best: null | undefined | FixedSizeImage | FixedSizeImageService | VariableSizeImage | UnknownSizeImage;\n    fallback: Array<ImageCandidate>;\n    log: string[];\n  }> {\n    const thumbnailNotFound = () =>\n      imageServiceLoader.getThumbnailFromResource(undefined as any, request, dereference, candidates);\n\n    if (!input) {\n      // We might have candidates already to pick from.\n      return await imageServiceLoader.getThumbnailFromResource(undefined as any, request, dereference, candidates);\n    }\n\n    if (typeof input === 'string') {\n      const fixed = getFixedSizeFromImage(input as any);\n      if (fixed) {\n        candidates.push(fixed);\n      }\n\n      return await imageServiceLoader.getThumbnailFromResource(undefined as any, request, dereference, candidates);\n    }\n\n    // Run through from ref, just in case.\n    const fullInput:\n      | string\n      | ManifestNormalized\n      | CollectionNormalized\n      | CanvasNormalized\n      | AnnotationNormalized\n      | AnnotationPageNormalized\n      | ContentResource\n      | undefined = vault.get(input as any, { skipSelfReturn: false }) as any;\n\n    if (typeof fullInput === 'string') {\n      return { best: getFixedSizeFromImage(fullInput as any), fallback: [], log: [] };\n    }\n\n    if (!fullInput) {\n      return await thumbnailNotFound();\n    }\n\n    const parseThumbnail = async (resource: DescriptiveNormalized) => {\n      if (resource && resource.thumbnail && resource.thumbnail.length) {\n        const thumbnail = vault.get<ContentResource>(resource.thumbnail[0]);\n        const potentialThumbnails = await imageServiceLoader.getImageCandidates(thumbnail as any, dereference);\n        if (potentialThumbnails && potentialThumbnails.length) {\n          candidates.push(...potentialThumbnails);\n        }\n      }\n    };\n\n    await parseThumbnail(fullInput as any);\n\n    switch (fullInput.type) {\n      case 'Annotation': {\n        // Grab the body.\n        const contentResources = Array.isArray(fullInput.body) ? fullInput.body : [fullInput.body];\n        // @todo this could be configuration.\n        const firstContentResources = vault.get<ContentResource>(contentResources[0]);\n        if (dimensions && !(firstContentResources as any).width) {\n          (firstContentResources as any).width = dimensions.width;\n          (firstContentResources as any).height = dimensions.height;\n        }\n\n        return await imageServiceLoader.getThumbnailFromResource(\n          firstContentResources as any,\n          request,\n          dereference,\n          candidates\n        );\n      }\n\n      case 'Canvas': {\n        const canvas = fullInput as CanvasNormalized;\n\n        return getBestThumbnailAtSize(canvas.items[0], request, dereference, candidates, {\n          width: canvas.width,\n          height: canvas.height,\n        });\n      }\n\n      // Unsupported for now.\n      case 'AnnotationPage': {\n        const annotationPage = fullInput as AnnotationPageNormalized;\n        return getBestThumbnailAtSize(annotationPage.items[0], request, dereference, candidates, dimensions);\n      }\n\n      case 'Choice': {\n        const choice: ChoiceBody = fullInput as any;\n        if (!choice.items || choice.items[0]) {\n          return await thumbnailNotFound();\n        }\n        // @todo this could also be configuration, just choosing the first choice.\n        return getBestThumbnailAtSize(choice.items[0] as any, request, dereference, candidates, dimensions);\n      }\n      case 'Collection': {\n        // This one is tricky, as the manifests may not have been loaded. But we will give it a shot.\n        const collection = fullInput as CollectionNormalized;\n        const firstManifest = collection.items[0];\n        if (!firstManifest) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstManifest, request, dereference, candidates, dimensions);\n      }\n\n      case 'Manifest': {\n        const manifest = fullInput as ManifestNormalized;\n        const firstCanvas = manifest.items[0];\n        if (!firstCanvas) {\n          return await thumbnailNotFound();\n        }\n        return getBestThumbnailAtSize(firstCanvas, request, dereference, candidates, dimensions);\n      }\n\n      case 'SpecificResource':\n      case 'Image':\n      case 'Dataset':\n      case 'Sound':\n      case 'Text':\n      case 'TextualBody':\n      case 'Video':\n        if (dimensions && !(fullInput as any).width) {\n          (fullInput as any).width = dimensions.width;\n          (fullInput as any).height = dimensions.height;\n        }\n\n        return imageServiceLoader.getThumbnailFromResource(fullInput as any, request, dereference, candidates);\n\n      // Seems unlikely these would appear, but it would be an error..\n      case 'Service': // @todo could do something with vault.\n      case 'Range':\n      case 'AnnotationCollection':\n      case 'CanvasReference':\n      case 'ContentResource':\n        return await thumbnailNotFound();\n    }\n\n    return await thumbnailNotFound();\n  }\n\n  return {\n    getBestThumbnailAtSize,\n  };\n}\n","import { InternationalString } from '@iiif/presentation-3';\n\nexport function getClosestLanguage(\n  i18nLanguage: string,\n  languages: string[],\n  i18nLanguages: string[] = [],\n  strictFallback = false\n) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return undefined;\n  }\n\n  // Only one option.\n  if (languages.length === 1) {\n    return languages[0];\n  }\n\n  // Exact match.\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n\n  // Root match (en-us === en)\n  const root = i18nLanguage.indexOf('-') !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf('-')) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n\n  // All of the fall backs.\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n\n  if (!strictFallback) {\n    // Inverse root match (en === en-us)\n    const inverseRoot = languages.map((l) => (l.indexOf('-') !== -1 ? l.slice(0, l.indexOf('-')) : null));\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n\n    // Inverse root (fallback)\n    for (const lang of i18nLanguages) {\n      const root = lang.indexOf('-') !== -1 ? lang.slice(0, lang.indexOf('-')) : null;\n      const inverseIdx = root ? languages.indexOf(root) : -1;\n      if (inverseIdx !== -1) {\n        return languages[inverseIdx];\n      }\n    }\n  }\n\n  if (languages.indexOf('none') !== -1) {\n    return 'none';\n  }\n\n  // Catch some legacy\n  if (languages.indexOf('@none') !== -1) {\n    return '@none';\n  }\n\n  // Finally, fall back to the first.\n  return languages[0];\n}\n\nexport function buildLocaleString(\n  inputText: string | InternationalString | null | undefined,\n  i18nLanguage: string | undefined,\n  options: {\n    strictFallback?: boolean;\n    defaultText?: string;\n    separator?: string;\n    fallbackLanguages?: string[];\n    closest?: boolean;\n  } = {}\n) {\n  const { strictFallback = false, defaultText = '', separator = '\\n', fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest\n    ? i18nLanguage\n    : getClosestLanguage(i18nLanguage as any, languages, fallbackLanguages, strictFallback);\n\n  if (!inputText) {\n    return defaultText;\n  }\n\n  if (typeof inputText === 'string') {\n    return inputText;\n  }\n\n  const candidateText = language ? inputText[language] : undefined;\n  if (candidateText) {\n    // Slightly tolerant of typos in IIIF like: `{\"en\": \"Some value\"}`\n    if (typeof candidateText === 'string') {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n\n  return '';\n}\n\nexport function getValue(\n  inputText: string | InternationalString | null | undefined,\n  options: { defaultText?: string; separator?: string; fallbackLanguages?: string[] } = {}\n) {\n  return buildLocaleString(inputText, typeof navigator !== 'undefined' ? navigator.language : undefined, options);\n}\n","var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar TAU = Math.PI * 2;\n\nvar mapToEllipse = function mapToEllipse(_ref, rx, ry, cosphi, sinphi, centerx, centery) {\n  var x = _ref.x,\n      y = _ref.y;\n\n  x *= rx;\n  y *= ry;\n\n  var xp = cosphi * x - sinphi * y;\n  var yp = sinphi * x + cosphi * y;\n\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  };\n};\n\nvar approxUnitArc = function approxUnitArc(ang1, ang2) {\n  // If 90 degree circular arc, use a constant\n  // as derived from http://spencermortensen.com/articles/bezier-circle\n  var a = ang2 === 1.5707963267948966 ? 0.551915024494 : ang2 === -1.5707963267948966 ? -0.551915024494 : 4 / 3 * Math.tan(ang2 / 4);\n\n  var x1 = Math.cos(ang1);\n  var y1 = Math.sin(ang1);\n  var x2 = Math.cos(ang1 + ang2);\n  var y2 = Math.sin(ang1 + ang2);\n\n  return [{\n    x: x1 - y1 * a,\n    y: y1 + x1 * a\n  }, {\n    x: x2 + y2 * a,\n    y: y2 - x2 * a\n  }, {\n    x: x2,\n    y: y2\n  }];\n};\n\nvar vectorAngle = function vectorAngle(ux, uy, vx, vy) {\n  var sign = ux * vy - uy * vx < 0 ? -1 : 1;\n\n  var dot = ux * vx + uy * vy;\n\n  if (dot > 1) {\n    dot = 1;\n  }\n\n  if (dot < -1) {\n    dot = -1;\n  }\n\n  return sign * Math.acos(dot);\n};\n\nvar getArcCenter = function getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp) {\n  var rxsq = Math.pow(rx, 2);\n  var rysq = Math.pow(ry, 2);\n  var pxpsq = Math.pow(pxp, 2);\n  var pypsq = Math.pow(pyp, 2);\n\n  var radicant = rxsq * rysq - rxsq * pypsq - rysq * pxpsq;\n\n  if (radicant < 0) {\n    radicant = 0;\n  }\n\n  radicant /= rxsq * pypsq + rysq * pxpsq;\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1);\n\n  var centerxp = radicant * rx / ry * pyp;\n  var centeryp = radicant * -ry / rx * pxp;\n\n  var centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2;\n  var centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2;\n\n  var vx1 = (pxp - centerxp) / rx;\n  var vy1 = (pyp - centeryp) / ry;\n  var vx2 = (-pxp - centerxp) / rx;\n  var vy2 = (-pyp - centeryp) / ry;\n\n  var ang1 = vectorAngle(1, 0, vx1, vy1);\n  var ang2 = vectorAngle(vx1, vy1, vx2, vy2);\n\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU;\n  }\n\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU;\n  }\n\n  return [centerx, centery, ang1, ang2];\n};\n\nvar arcToBezier = function arcToBezier(_ref2) {\n  var px = _ref2.px,\n      py = _ref2.py,\n      cx = _ref2.cx,\n      cy = _ref2.cy,\n      rx = _ref2.rx,\n      ry = _ref2.ry,\n      _ref2$xAxisRotation = _ref2.xAxisRotation,\n      xAxisRotation = _ref2$xAxisRotation === undefined ? 0 : _ref2$xAxisRotation,\n      _ref2$largeArcFlag = _ref2.largeArcFlag,\n      largeArcFlag = _ref2$largeArcFlag === undefined ? 0 : _ref2$largeArcFlag,\n      _ref2$sweepFlag = _ref2.sweepFlag,\n      sweepFlag = _ref2$sweepFlag === undefined ? 0 : _ref2$sweepFlag;\n\n  var curves = [];\n\n  if (rx === 0 || ry === 0) {\n    return [];\n  }\n\n  var sinphi = Math.sin(xAxisRotation * TAU / 360);\n  var cosphi = Math.cos(xAxisRotation * TAU / 360);\n\n  var pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2;\n  var pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2;\n\n  if (pxp === 0 && pyp === 0) {\n    return [];\n  }\n\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = Math.pow(pxp, 2) / Math.pow(rx, 2) + Math.pow(pyp, 2) / Math.pow(ry, 2);\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n  var _getArcCenter = getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp),\n      _getArcCenter2 = _slicedToArray(_getArcCenter, 4),\n      centerx = _getArcCenter2[0],\n      centery = _getArcCenter2[1],\n      ang1 = _getArcCenter2[2],\n      ang2 = _getArcCenter2[3];\n\n  // If 'ang2' == 90.0000000001, then `ratio` will evaluate to\n  // 1.0000000001. This causes `segments` to be greater than one, which is an\n  // unecessary split, and adds extra points to the bezier curve. To alleviate\n  // this issue, we round to 1.0 when the ratio is close to 1.0.\n\n\n  var ratio = Math.abs(ang2) / (TAU / 4);\n  if (Math.abs(1.0 - ratio) < 0.0000001) {\n    ratio = 1.0;\n  }\n\n  var segments = Math.max(Math.ceil(ratio), 1);\n\n  ang2 /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2));\n    ang1 += ang2;\n  }\n\n  return curves.map(function (curve) {\n    var _mapToEllipse = mapToEllipse(curve[0], rx, ry, cosphi, sinphi, centerx, centery),\n        x1 = _mapToEllipse.x,\n        y1 = _mapToEllipse.y;\n\n    var _mapToEllipse2 = mapToEllipse(curve[1], rx, ry, cosphi, sinphi, centerx, centery),\n        x2 = _mapToEllipse2.x,\n        y2 = _mapToEllipse2.y;\n\n    var _mapToEllipse3 = mapToEllipse(curve[2], rx, ry, cosphi, sinphi, centerx, centery),\n        x = _mapToEllipse3.x,\n        y = _mapToEllipse3.y;\n\n    return { x1: x1, y1: y1, x2: x2, y2: y2, x: x, y: y };\n  });\n};\n\nexport default arcToBezier;","\nmodule.exports = parse\n\n/**\n * expected argument lengths\n * @type {Object}\n */\n\nvar length = {a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0}\n\n/**\n * segment pattern\n * @type {RegExp}\n */\n\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig\n\n/**\n * parse an svg path data string. Generates an Array\n * of commands where each command is an Array of the\n * form `[command, arg1, arg2, ...]`\n *\n * @param {String} path\n * @return {Array}\n */\n\nfunction parse(path) {\n\tvar data = []\n\tpath.replace(segment, function(_, command, args){\n\t\tvar type = command.toLowerCase()\n\t\targs = parseValues(args)\n\n\t\t// overloaded moveTo\n\t\tif (type == 'm' && args.length > 2) {\n\t\t\tdata.push([command].concat(args.splice(0, 2)))\n\t\t\ttype = 'l'\n\t\t\tcommand = command == 'm' ? 'l' : 'L'\n\t\t}\n\n\t\twhile (true) {\n\t\t\tif (args.length == length[type]) {\n\t\t\t\targs.unshift(command)\n\t\t\t\treturn data.push(args)\n\t\t\t}\n\t\t\tif (args.length < length[type]) throw new Error('malformed path data')\n\t\t\tdata.push([command].concat(args.splice(0, length[type])))\n\t\t}\n\t})\n\treturn data\n}\n\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig\n\nfunction parseValues(args) {\n\tvar numbers = args.match(number)\n\treturn numbers ? numbers.map(Number) : []\n}\n","\nmodule.exports = absolutize\n\n/**\n * redefine `path` with absolute coordinates\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction absolutize(path){\n\tvar startX = 0\n\tvar startY = 0\n\tvar x = 0\n\tvar y = 0\n\n\treturn path.map(function(seg){\n\t\tseg = seg.slice()\n\t\tvar type = seg[0]\n\t\tvar command = type.toUpperCase()\n\n\t\t// is relative\n\t\tif (type != command) {\n\t\t\tseg[0] = command\n\t\t\tswitch (type) {\n\t\t\t\tcase 'a':\n\t\t\t\t\tseg[6] += x\n\t\t\t\t\tseg[7] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'v':\n\t\t\t\t\tseg[1] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'h':\n\t\t\t\t\tseg[1] += x\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tfor (var i = 1; i < seg.length;) {\n\t\t\t\t\t\tseg[i++] += x\n\t\t\t\t\t\tseg[i++] += y\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// update cursor state\n\t\tswitch (command) {\n\t\t\tcase 'Z':\n\t\t\t\tx = startX\n\t\t\t\ty = startY\n\t\t\t\tbreak\n\t\t\tcase 'H':\n\t\t\t\tx = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'V':\n\t\t\t\ty = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'M':\n\t\t\t\tx = startX = seg[1]\n\t\t\t\ty = startY = seg[2]\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tx = seg[seg.length - 2]\n\t\t\t\ty = seg[seg.length - 1]\n\t\t}\n\n\t\treturn seg\n\t})\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport arcToCurve from 'svg-arc-to-cubic-bezier';\nimport parseSvgPath from 'parse-svg-path';\nimport absSvgPath, {\n  AbsoluteCubicBezierCommand,\n  AbsoluteLineCommand,\n  AbsoluteMoveCommand,\n  AbsoluteQuadraticBezierCommand,\n} from 'abs-svg-path';\n\nexport type NormalizedSvgPathCommand =\n  | AbsoluteMoveCommand\n  | AbsoluteLineCommand\n  | AbsoluteCubicBezierCommand\n  | AbsoluteQuadraticBezierCommand;\n\nexport type NormalizedSvgPathCommandType = 'M' | 'L' | 'C' | 'Q';\n\n/** Parse an SVG path and normalize it so it only contains Moves, Lines and Cubic or Quadratic BÃ©zier curves\n *  in their absolute form. */\nexport function parseAndNormalizeSvgPath(path: string): NormalizedSvgPathCommand[] {\n  const parsed = parseSvgPath(path);\n  const absolute = absSvgPath(parsed);\n\n  let prevCmd: 'M' | 'L' | 'H' | 'V' | 'C' | 'S' | 'Q' | 'T' | 'A' | 'Z' | undefined;\n  let startX = 0;\n  let startY = 0;\n  let bezierX = 0;\n  let bezierY = 0;\n  let quadX: number | undefined;\n  let quadY: number | undefined;\n  let x = 0;\n  let y = 0;\n  const out: NormalizedSvgPathCommand[] = [];\n  for (let i = 0; i < absolute.length; i++) {\n    let seg = absolute[i];\n    const cmd = seg[0];\n    switch (cmd) {\n      case 'M':\n        startX = seg[1];\n        startY = seg[2];\n        break;\n      case 'H':\n        seg = ['L', seg[1], startY];\n        break;\n      case 'V':\n        seg = ['L', startX, seg[1]];\n        break;\n      case 'S':\n        {\n          let cx = x;\n          let cy = y;\n          if (prevCmd === 'C' || prevCmd == 'S') {\n            cx += cx - bezierX;\n            cy += cy - bezierY;\n          }\n          seg = ['C', cx, cy, seg[1], seg[2], seg[3], seg[4]];\n        }\n        break;\n      case 'T':\n        if (prevCmd === 'Q' || prevCmd == 'T') {\n          quadX = x * 2 - quadX!;\n          quadY = y * 2 - quadY!;\n        } else {\n          quadX = x;\n          quadY = y;\n        }\n        seg = ['Q', quadX, quadY, seg[1], seg[2]];\n        break;\n      case 'Q':\n        quadX = seg[1];\n        quadY = seg[2];\n        break;\n      case 'A':\n        {\n          const curves = arcToCurve({\n            px: x,\n            py: y,\n            cx: seg[6],\n            cy: seg[7],\n            rx: seg[1],\n            ry: seg[2],\n            xAxisRotation: seg[3],\n            largeArcFlag: seg[4],\n            sweepFlag: seg[5],\n          });\n          if (!curves.length) {\n            continue;\n          }\n          for (const [j, curve] of curves.entries()) {\n            seg = ['C', curve.x1, curve.y1, curve.x2, curve.y2, curve.x, curve.y];\n            if (j < curves.length - 1) {\n              out.push(seg);\n            }\n          }\n          // FIXME: Why do we need this cast?\n          seg = seg as NormalizedSvgPathCommand;\n        }\n        break;\n      case 'Z':\n        seg = ['L', startX, startY];\n        break;\n    }\n\n    prevCmd = cmd;\n    x = seg[seg.length - 2] as number;\n    y = seg[seg.length - 1] as number;\n    if (['C', 'Q', 'A'].indexOf(cmd) > -1) {\n      bezierX = seg[seg.length - 4] as number;\n      bezierY = seg[seg.length - 3] as number;\n    } else {\n      bezierX = x;\n      bezierY = y;\n    }\n    out.push(seg);\n  }\n\n  return out;\n}\n","/** Code to \"flatten\" quadratic and cubic BÃ©zier curves to polylines.\n *\n * All code in this module is based on JavaScript code by Raph Levien, published on his blog at\n * https://raphlinus.github.io/.\n * I merely changed the structure a bit, removed some unneeded parts and added some comments and type hints.\n *\n * Flattening of quadratic BÃ©zier curves:\n * - Article: https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html\n * - Code: https://github.com/raphlinus/raphlinus.github.io/blob/master/_posts/2019-12-23-flatten-quadbez.md?plain=1#L73-L212\n *\n * Flattening of cubic BÃ©zier curves: https://levien.com/tmp/flatten.html\n *\n * Note that the code in this module has a different license than the rest of the package,\n * due to the inclusion of Apache-licensed third party code.\n *\n * @license\n * Copyright 2022 Johannes Baiter <johannes.baiter@gmail.com>\n * Copyright 2019, 2022 Raph Levien <raph.levien@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport type Point = { x: number; y: number };\n\nexport function flattenQuadraticBezier(start: Point, control: Point, end: Point, tolerance = 1): Point[] {\n  return new QuadraticBezier(start, control, end).subdivide(tolerance);\n}\n\nexport function flattenCubicBezier(\n  start: Point,\n  startControl: Point,\n  end: Point,\n  endControl: Point,\n  tolerance = 1\n): Point[] {\n  return new CubicBezier(\n    new Float64Array([start.x, start.y, startControl.x, startControl.y, end.x, end.y, endControl.x, endControl.y])\n  ).subdivide(tolerance);\n}\n\nfunction hypot2(p: Point): number {\n  return p.x * p.x + p.y * p.y;\n}\n\n// Compute an approximation to int (1 + 4x^2) ^ -0.25 dx\nfunction approx_myint(x: number): number {\n  const d = 0.67;\n  return x / (1 - d + Math.pow(Math.pow(d, 4) + 0.25 * x * x, 0.25));\n}\n\n// Approximate the inverse of `approx_myint`\nfunction approx_inv_myint(x: number): number {\n  const b = 0.39;\n  return x * (1 - b + Math.sqrt(b * b + 0.25 * x * x));\n}\n\n// Parameters for a basic parabola corresponding to a quadratic bÃ©zier curve\ntype QuadraticBezierBasicParams = {\n  x0: number;\n  x2: number;\n  scale: number;\n  cross: number;\n};\n\nclass QuadraticBezier {\n  start: Point;\n  control: Point;\n  end: Point;\n\n  constructor(start: Point, control: Point, end: Point) {\n    this.start = start;\n    this.control = control;\n    this.end = end;\n  }\n\n  eval(t: number): Point {\n    const mt = 1 - t;\n    return {\n      x: this.start.x * mt * mt + 2 * this.control.x * mt * t + this.end.x * t * t,\n      y: this.start.y * mt * mt + 2 * this.control.y * mt * t + this.end.y * t * t,\n    };\n  }\n\n  mapToBasic(): QuadraticBezierBasicParams {\n    const { x: x0, y: y0 } = this.start;\n    const { x: x1, y: y1 } = this.control;\n    const { x: x2, y: y2 } = this.end;\n\n    // Determine the x values and scaling to map to y=x^2\n    const ddx = 2 * x1 - x0 - x2;\n    const ddy = 2 * y1 - y0 - y2;\n    const u0 = (x1 - x0) * ddx + (y1 - y0) * ddy;\n    const u2 = (x2 - x1) * ddx + (y2 - y1) * ddy;\n    const cross = (x2 - x0) * ddy - (y2 - y0) * ddx;\n    const paramX0 = u0 / cross;\n    const paramX2 = u2 / cross;\n\n    // There's probably a more elegant formulation of this...\n    const scale = Math.abs(cross) / (Math.hypot(ddx, ddy) * Math.abs(paramX2 - paramX0));\n\n    return { x0, x2, scale, cross };\n  }\n\n  subdivide(tolerance: number): Point[] {\n    const params = this.mapToBasic();\n    const a0 = approx_myint(params.x0);\n    const a2 = approx_myint(params.x2);\n    const count = 0.5 * Math.abs(a2 - a0) * Math.sqrt(params.scale / tolerance);\n    const n = Math.ceil(count);\n    const u0 = approx_inv_myint(a0);\n    const u2 = approx_inv_myint(a2);\n    const tValues = [0];\n    for (let i = 1; i < n; i++) {\n      const u = approx_inv_myint(a0 + ((a2 - a0) * i) / n);\n      const t = (u - u0) / (u2 - u0);\n      tValues.push(t);\n    }\n    tValues.push(1);\n    return tValues.map((t) => this.eval(t));\n  }\n}\n\nclass CubicBezier {\n  private c: Float64Array;\n\n  /// Argument is array of coordinate values [x0, y0, x1, y1, x2, y2, x3, y3].\n  constructor(coords: Float64Array) {\n    this.c = coords;\n  }\n\n  weightsum(c0: number, c1: number, c2: number, c3: number): Point {\n    const x = c0 * this.c[0] + c1 * this.c[2] + c2 * this.c[4] + c3 * this.c[6];\n    const y = c0 * this.c[1] + c1 * this.c[3] + c2 * this.c[5] + c3 * this.c[7];\n    return { x, y };\n  }\n\n  eval(t: number): Point {\n    const mt = 1 - t;\n    const c0 = mt * mt * mt;\n    const c1 = 3 * mt * mt * t;\n    const c2 = 3 * mt * t * t;\n    const c3 = t * t * t;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n\n  deriv(t: number): Point {\n    const mt = 1 - t;\n    const c0 = -3 * mt * mt;\n    const c3 = 3 * t * t;\n    const c1 = -6 * t * mt - c0;\n    const c2 = 6 * t * mt - c3;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n\n  // quadratic bezier with matching endpoints and minimum max vector error\n  midpoint_quadbez(): QuadraticBezier {\n    const p1 = this.weightsum(-0.25, 0.75, 0.75, -0.25);\n    return new QuadraticBezier({ x: this.c[0], y: this.c[1] }, p1, { x: this.c[6], y: this.c[7] });\n  }\n\n  subsegment(t0: number, t1: number): CubicBezier {\n    const c = new Float64Array(8);\n    const p0 = this.eval(t0);\n    const p3 = this.eval(t1);\n    c[0] = p0.x;\n    c[1] = p0.y;\n    const scale = (t1 - t0) / 3;\n    const d1 = this.deriv(t0);\n    c[2] = p0.x + scale * d1.x;\n    c[3] = p0.y + scale * d1.y;\n    const d2 = this.deriv(t1);\n    c[4] = p3.x - scale * d2.x;\n    c[5] = p3.y - scale * d2.y;\n    c[6] = p3.x;\n    c[7] = p3.y;\n    return new CubicBezier(c);\n  }\n\n  // Very fancy subdivision scheme\n  subdivide(tol: number) {\n    const tol1 = 0.1 * tol; // error for subdivision into quads\n    const tol2 = tol - tol1; // error for subdivision of quads into lines\n    const sqrt_tol2 = Math.sqrt(tol2);\n    const err2 = hypot2(this.weightsum(1, -3, 3, -1));\n    const n_quads = Math.ceil(Math.pow(err2 / (432 * tol1 * tol1), 1 / 6));\n    const quads = [];\n    let sum = 0;\n    for (let i = 0; i < n_quads; i++) {\n      const t0 = i / n_quads;\n      const t1 = (i + 1) / n_quads;\n      const quad = this.subsegment(t0, t1).midpoint_quadbez();\n      const params = quad.mapToBasic();\n      const a0 = approx_myint(params.x0);\n      const a2 = approx_myint(params.x2);\n      const scale = Math.sqrt(params.scale);\n      let val = Math.abs(a2 - a0) * scale;\n      if (Math.sign(params.x0) != Math.sign(params.x2)) {\n        // min x value in basic parabola to make sure we don't skip cusp\n        const xmin = sqrt_tol2 / scale;\n        const cusp_val = (sqrt_tol2 * Math.abs(a2 - a0)) / approx_myint(xmin);\n        // I *think* it will always be larger, but just in case...\n        val = Math.max(val, cusp_val);\n      }\n      quads.push({\n        quad: quad,\n        a0: a0,\n        a2: a2,\n        val: val,\n      });\n      sum += val;\n    }\n    const count = (0.5 * sum) / sqrt_tol2;\n    const n = Math.ceil(count);\n    const result = [{ x: this.c[0], y: this.c[1] }];\n    let val = 0; // sum of vals from [0..i]\n    let i = 0;\n    for (let j = 1; j < n; j++) {\n      const target = (sum * j) / n;\n      while (val + quads[i].val < target) {\n        val += quads[i].val;\n        i++;\n      }\n      const a0 = quads[i].a0;\n      const a2 = quads[i].a2;\n      // Note: we can cut down on recomputing these\n      const u0 = approx_inv_myint(a0);\n      const u2 = approx_inv_myint(a2);\n      const a = a0 + ((a2 - a0) * (target - val)) / quads[i].val;\n      const u = approx_inv_myint(a);\n      const t = (u - u0) / (u2 - u0);\n      result.push(quads[i].quad.eval(t));\n    }\n    result.push({ x: this.c[6], y: this.c[7] });\n    return result;\n  }\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport {\n  ParsedSelector,\n  SupportedSelectors,\n  TemporalSelector,\n  SvgSelector,\n  SelectorStyle,\n  SvgShapeType,\n} from './selector-types';\nimport { ImageApiSelector, Selector } from '@iiif/presentation-3';\nimport { NormalizedSvgPathCommand, NormalizedSvgPathCommandType, parseAndNormalizeSvgPath } from './normalize-svg';\nimport { flattenCubicBezier, flattenQuadraticBezier } from './bezier';\n\nconst BOX_SELECTOR =\n  /&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?)/;\n\n// Does not support 00:00:00 or 00:00 formats.\nconst TEMPORAL_SELECTOR = /&?(t=)(npt:)?([0-9]+(.[0-9]+)?)?(,([0-9]+(.[0-9]+)?))?/;\n\nconst RGBA_COLOR = /^rgba\\((\\d+),(\\d+),(\\d+),([0-9.]+)\\)$/;\n\nexport function parseSelector(\n  source: Selector | Selector[],\n  {\n    domParser,\n    svgPreprocessor,\n    iiifRenderingHints,\n  }: { domParser?: DOMParser; svgPreprocessor?: (svg: string) => string; iiifRenderingHints?: ImageApiSelector } = {}\n): ParsedSelector {\n  if (Array.isArray(source)) {\n    return resolveHints(\n      (source as Array<string | Selector>).reduce(\n        <ParseSelector>(data: ParsedSelector, nextSource: string | Selector) => {\n          const {\n            selector,\n            selectors,\n            iiifRenderingHints: newIiifRenderingHints,\n          } = parseSelector(nextSource, { domParser, svgPreprocessor, iiifRenderingHints });\n          if (selector) {\n            if (!data.selector) {\n              data.selector = selector;\n            }\n            data.selectors.push(...selectors);\n          }\n          if (newIiifRenderingHints) {\n            data.iiifRenderingHints = data.iiifRenderingHints || { type: 'ImageApiSelector' };\n            Object.assign(data.iiifRenderingHints, newIiifRenderingHints);\n          }\n          return data;\n        },\n        {\n          selector: null,\n          selectors: [],\n          iiifRenderingHints,\n        } as ParsedSelector\n      )\n    );\n  }\n\n  if (!source) {\n    return resolveHints({\n      selector: null,\n      selectors: [],\n      iiifRenderingHints,\n    });\n  }\n\n  if (typeof source === 'string') {\n    const [id, fragment] = source.split('#');\n\n    if (!fragment) {\n      // This is an unknown selector.\n      return resolveHints({\n        selector: null,\n        selectors: [],\n        iiifRenderingHints,\n      });\n    }\n\n    return parseSelector(\n      { type: 'FragmentSelector', value: fragment },\n      { svgPreprocessor, iiifRenderingHints, domParser }\n    );\n  }\n\n  if (source.type) {\n    if (source.type === 'PointSelector' && (source.t || source.t === 0)) {\n      const selector: TemporalSelector = {\n        type: 'TemporalSelector',\n        temporal: {\n          startTime: source.t,\n        },\n      };\n\n      return resolveHints({\n        selector,\n        selectors: [selector],\n        iiifRenderingHints,\n      });\n    }\n  }\n\n  if (isImageApiSelector(source)) {\n    const selectors: SupportedSelectors[] = [];\n    if (source.region) {\n      const parsedRegion = parseSelector(\n        { type: 'FragmentSelector', value: 'xywh=' + source.region },\n        { domParser, svgPreprocessor, iiifRenderingHints }\n      );\n      selectors.push(...parsedRegion.selectors);\n    }\n\n    return resolveHints({\n      selector: selectors[0],\n      selectors: selectors,\n      iiifRenderingHints: iiifRenderingHints ? { ...iiifRenderingHints, ...source } : source,\n    });\n  }\n\n  if (source.type === 'FragmentSelector') {\n    const matchBoxSelector = BOX_SELECTOR.exec(source.value);\n    if (matchBoxSelector) {\n      const selector: SupportedSelectors = {\n        type: 'BoxSelector',\n        spatial: {\n          unit: matchBoxSelector[2] === 'percent:' || matchBoxSelector[2] === 'pct:' ? 'percent' : 'pixel',\n          x: parseFloat(matchBoxSelector[3]),\n          y: parseFloat(matchBoxSelector[4]),\n          width: parseFloat(matchBoxSelector[5]),\n          height: parseFloat(matchBoxSelector[6]),\n        },\n      };\n\n      return resolveHints({\n        selector,\n        selectors: [selector],\n        iiifRenderingHints,\n      });\n    }\n\n    const matchTimeSelector = source.value.match(TEMPORAL_SELECTOR);\n    if (matchTimeSelector) {\n      const selector: TemporalSelector = {\n        type: 'TemporalSelector',\n        temporal: {\n          startTime: matchTimeSelector[4] ? parseFloat(matchTimeSelector[4]) : 0,\n          endTime: matchTimeSelector[7] ? parseFloat(matchTimeSelector[7]) : undefined,\n        },\n      };\n\n      return resolveHints({\n        selector,\n        selectors: [selector],\n        iiifRenderingHints,\n      });\n    }\n\n    return resolveHints({\n      selector: null,\n      selectors: [],\n      iiifRenderingHints,\n    });\n  }\n\n  if (source.type === 'SvgSelector' && 'value' in source) {\n    if (!domParser) {\n      if (typeof window !== 'undefined') {\n        domParser = new window.DOMParser();\n      } else {\n        console.warn(\n          'No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized.'\n        );\n      }\n    }\n    let points: [number, number][] = [];\n    let rect: [number, number, number, number] | undefined;\n    let style: SelectorStyle | undefined;\n    let svg = svgPreprocessor?.(source.value) ?? source.value;\n    let svgShape: SvgShapeType | undefined;\n    if (domParser) {\n      const svgElement: SVGElement | null = domParser\n        .parseFromString(source.value, 'image/svg+xml')\n        .querySelector('svg');\n      if (!svgElement) {\n        console.warn(`Illegal SVG selector: ${source.value}`);\n        return resolveHints({\n          selector: null,\n          selectors: [],\n          iiifRenderingHints,\n        });\n      }\n      const selectorElem = getSelectorElement(svgElement);\n      if (selectorElem) {\n        points = selectorElem.points;\n        svgShape = selectorElem.shapeType;\n        rect = [\n          Math.min(...points.map((p) => p[0])), // llx\n          Math.min(...points.map((p) => p[1])), // lly\n          Math.max(...points.map((p) => p[0])), // urx\n          Math.max(...points.map((p) => p[1])), // ury\n        ];\n        ({ style, svg } = extractStyles(selectorElem.element) ?? { svg });\n      }\n    }\n    const sel: SvgSelector = {\n      type: 'SvgSelector',\n      svg,\n      svgShape,\n      style,\n      points: points.length ? points : undefined,\n      spatial: rect\n        ? { unit: 'pixel', x: rect[0], y: rect[1], width: rect[2] - rect[0], height: rect[3] - rect[1] }\n        : undefined,\n    };\n    return resolveHints({\n      selector: sel,\n      selectors: [sel],\n      iiifRenderingHints,\n    });\n  }\n  return resolveHints({\n    selector: null,\n    selectors: [],\n    iiifRenderingHints,\n  });\n}\n\nexport type SelectorElement = {\n  element: SVGElement;\n  points: [number, number][];\n  shapeType: SvgShapeType;\n};\n\nfunction getShapeTypeFromPath(svgPath: NormalizedSvgPathCommand[]): SvgShapeType {\n  const cmdFrequencies = svgPath\n    .map((seg) => seg[0])\n    .reduce(\n      (acc: Record<NormalizedSvgPathCommandType, number>, cmd) => {\n        acc[cmd] += 1;\n        return acc;\n      },\n      { C: 0, Q: 0, L: 0, M: 0 }\n    );\n  const cmdTypes = new Set(svgPath.map((seg) => seg[0]));\n  if (cmdFrequencies.C > 0 || cmdFrequencies.Q > 0) {\n    return 'path';\n  }\n  if (cmdFrequencies.L > 0 && (cmdTypes.size === 1 || (cmdTypes.size === 2 && cmdTypes.has('M')))) {\n    // Only lines and moves: rectangle, polygon or polyline?\n    if (cmdFrequencies.L === 4) {\n      return 'rect';\n    }\n\n    // Check if the path is closed to decide if we have a polygon or a polyline\n    const lastSeg = svgPath.slice(-1)[0];\n    if (\n      (svgPath[0][0] === 'M' && lastSeg[0] === 'L' && lastSeg[1] == svgPath[0][1] && lastSeg[2] === svgPath[0][2]) ||\n      (lastSeg[1] === 0 && lastSeg[2] === 0)\n    ) {\n      return 'polygon';\n    } else {\n      return 'polyline';\n    }\n  }\n  return 'path';\n}\n\nfunction getSelectorElement(svgElem: SVGElement): SelectorElement | null {\n  for (const element of Array.from(svgElem.children) as SVGElement[]) {\n    switch (element?.tagName.toLowerCase()) {\n      case 'g':\n        {\n          // Check if any of the children in the container can be converted to points\n          const res = getSelectorElement(element as SVGElement);\n          if (res) {\n            return res;\n          }\n        }\n        continue;\n      case 'path': {\n        const p = element.getAttribute('d');\n        if (!p) {\n          continue;\n        }\n        const normalized = parseAndNormalizeSvgPath(p);\n        return { element, points: pathToPoints(normalized), shapeType: getShapeTypeFromPath(normalized) };\n      }\n      case 'circle': {\n        const cx = parseFloat(element.getAttribute('cx') ?? '0');\n        const cy = parseFloat(element.getAttribute('cy') ?? '0');\n        const r = parseFloat(element.getAttribute('r') ?? '0');\n        if (!r) {\n          continue;\n        }\n        const points: [number, number][] = [];\n        // TODO: Get rid of the degree -> radian conversion and use radians from the beginning\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const rad = (angle * Math.PI) / 180;\n          points.push([cx + r * Math.cos(rad), cy + r * Math.sin(rad)]);\n        }\n        return { element, points, shapeType: 'circle' };\n      }\n      case 'ellipse': {\n        const cx = parseFloat(element.getAttribute('cx') ?? '0');\n        const cy = parseFloat(element.getAttribute('cy') ?? '0');\n        const rx = parseFloat(element.getAttribute('rx') ?? '0');\n        const ry = parseFloat(element.getAttribute('ry') ?? '0');\n        if (!rx && !ry) {\n          continue;\n        }\n        const points: [number, number][] = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const t = Math.tan((angle / 360) * Math.PI);\n          const px = (rx * (1 - t ** 2)) / (1 + t ** 2);\n          const py = (ry * 2 * t) / (1 + t ** 2);\n          points.push([cx + px, cy + py]);\n        }\n        return { element, points, shapeType: 'ellipse' };\n      }\n      case 'line': {\n        const x0 = parseFloat(element.getAttribute('x0') ?? '0');\n        const y0 = parseFloat(element.getAttribute('y0') ?? '0');\n        const x1 = parseFloat(element.getAttribute('x1') ?? '0');\n        const y1 = parseFloat(element.getAttribute('y1') ?? '0');\n        if (x0 === x1 && y0 === y1) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x0, y0],\n            [x1, y1],\n          ],\n          shapeType: 'polyline',\n        };\n      }\n      case 'polygon':\n      case 'polyline': {\n        const points =\n          element\n            .getAttribute('points')\n            ?.split(' ')\n            .map((ps) => ps.split(',').map(parseFloat) as [number, number]) ?? [];\n        if (!points.length) {\n          continue;\n        }\n        let shapeType: SvgShapeType = 'polyline';\n        if (element.tagName.toLowerCase() === 'polygon') {\n          // A polygon is a closed path, so the last point is the same as the first.\n          points.push(points[0]);\n          shapeType = 'polygon';\n        }\n        return { element, points, shapeType };\n      }\n      case 'rect': {\n        const x = parseFloat(element.getAttribute('x') ?? '0');\n        const y = parseFloat(element.getAttribute('y') ?? '0');\n        const width = parseFloat(element.getAttribute('width') ?? '0');\n        const height = parseFloat(element.getAttribute('height') ?? '0');\n        if (!width || !height) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x, y],\n            [x + width, y],\n            [x + width, y + height],\n            [x, y + height],\n            [x, y],\n          ],\n          shapeType: 'rect',\n        };\n      }\n      default:\n        // Try next element\n        continue;\n    }\n  }\n  return null;\n}\n\nfunction pathToPoints(normalizedPath: NormalizedSvgPathCommand[]): [number, number][] {\n  const out: [number, number][] = [];\n  for (let i = 0; i < normalizedPath.length; i++) {\n    const startPoint = out[out.length - 1] ?? [0, 0];\n    const seg = normalizedPath[i];\n    switch (seg[0]) {\n      case 'M':\n      case 'L':\n        out.push([seg[1], seg[2]]);\n        continue;\n      case 'C':\n        out.push(\n          ...flattenCubicBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] },\n            { x: seg[5], y: seg[6] }\n          )\n            .map((p) => [p.x, p.y] as [number, number])\n            .slice(1) // skip first point, already part of output\n        );\n        continue;\n      case 'Q':\n        out.push(\n          ...flattenQuadraticBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] }\n          )\n            .map((p) => [p.x, p.y] as [number, number])\n            .slice(1) // skip first point, already part of output\n        );\n        continue;\n    }\n  }\n  return out;\n}\n\n/** Extract styling information from SVG selector.\n *\n * Will remove all styling information from the SVG element\n * and normalize `rgba` colors for `fill` and `stroke` to\n * `rgb` and store the opacity in `fillOpacity` and `strokeOpacity`.\n */\nfunction extractStyles(selectorElement: SVGElement): { style?: SelectorStyle; svg: string } | undefined {\n  // TODO: Can this be simplified somehow?\n  const style: SelectorStyle = {};\n  if (selectorElement.hasAttribute('fill')) {\n    style.fill = selectorElement.getAttribute('fill')!;\n    selectorElement.removeAttribute('fill');\n  } else if (selectorElement.style.fill) {\n    style.fill = selectorElement.style.fill;\n  }\n  if (style.fill) {\n    const rgbaMatch = RGBA_COLOR.exec(style.fill);\n    if (rgbaMatch) {\n      style.fillOpacity = parseFloat(rgbaMatch[4]);\n      style.fill = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute('fill-opacity')) {\n    style.fillOpacity = parseFloat(selectorElement.getAttribute('fill-opacity')!);\n    selectorElement.removeAttribute('fill-opacity');\n  } else if (selectorElement.style.fillOpacity) {\n    style.fillOpacity = parseFloat(selectorElement.style.fillOpacity);\n  }\n\n  if (selectorElement.hasAttribute('stroke')) {\n    style.stroke = selectorElement.getAttribute('stroke')!;\n    selectorElement.removeAttribute('stroke');\n  } else if (selectorElement.style.stroke) {\n    style.stroke = selectorElement.style.stroke;\n  }\n  if (style.stroke) {\n    const rgbaMatch = RGBA_COLOR.exec(style.stroke);\n    if (rgbaMatch) {\n      style.strokeOpacity = parseFloat(rgbaMatch[4]);\n      style.stroke = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute('stroke-opacity')) {\n    style.strokeOpacity = parseFloat(selectorElement.getAttribute('stroke-opacity')!);\n    selectorElement.removeAttribute('stroke-opacity');\n  } else if (selectorElement.style.strokeOpacity) {\n    style.strokeOpacity = parseFloat(selectorElement.style.strokeOpacity);\n  }\n  if (selectorElement.hasAttribute('stroke-width')) {\n    style.strokeWidth = selectorElement.getAttribute('stroke-width')!;\n    selectorElement.removeAttribute('stroke-width');\n  } else if (selectorElement.style.strokeWidth) {\n    style.strokeWidth = selectorElement.style.strokeWidth;\n  }\n  if (selectorElement.hasAttribute('stroke-dasharray')) {\n    style.strokeDasharray = selectorElement.getAttribute('stroke-dasharray')!;\n    selectorElement.removeAttribute('stroke-dasharray');\n  } else if (selectorElement.style.strokeDasharray) {\n    style.strokeDasharray = selectorElement.style.strokeDasharray;\n  }\n\n  let rootElem: SVGElement | null = selectorElement;\n  while (rootElem.tagName.toLowerCase() !== 'svg') {\n    rootElem = rootElem.parentElement as SVGElement | null;\n    if (rootElem === null) {\n      throw new Error('Could not find root SVG element');\n    }\n  }\n  return { svg: rootElem.outerHTML, style: Object.keys(style).length > 0 ? style : undefined };\n}\n\nexport function isImageApiSelector(t: unknown): t is ImageApiSelector {\n  return !!t && (t as any).type === 'iiif:ImageApiSelector' && (t as any).type === 'iiif:ImageApiSelector';\n}\n\nfunction resolveHints(supported: ParsedSelector): ParsedSelector {\n  if (supported.iiifRenderingHints) {\n    const source = supported.iiifRenderingHints;\n    if (source.rotation) {\n      const parsedRotation = parseRotation(source.rotation);\n      if (parsedRotation) {\n        if (supported.selectors.length) {\n          for (const selector of supported.selectors) {\n            selector.rotation = parsedRotation;\n          }\n        } else {\n          supported.selectors.push({\n            type: 'RotationSelector',\n            rotation: parsedRotation,\n          });\n        }\n      }\n    }\n  } else {\n    delete supported.iiifRenderingHints;\n  }\n\n  return supported;\n}\n\n/**\n * Parse rotation \"90\", \"180\", \"!90\"\n */\nexport function parseRotation(input: string) {\n  let num = parseFloat(input);\n  if (num && input.startsWith('!')) {\n    // @note we don't support mirroring..\n    num = 360 - num;\n  }\n  if (num) {\n    num = num % 360;\n  }\n  if (num !== num) {\n    return 0;\n  }\n  return num || 0;\n}\n","import { ExternalWebResource, W3CAnnotationTarget, AnnotationTarget, ImageApiSelector } from '@iiif/presentation-3';\nimport { SupportedTarget } from './target-types';\nimport { parseSelector } from './parse-selector';\n\nexport function expandTarget(\n  target: W3CAnnotationTarget | W3CAnnotationTarget[],\n  options: {\n    typeMap?: Record<string, string>;\n    domParser?: DOMParser;\n    svgPreprocessor?: (svg: string) => string;\n  } = {}\n): SupportedTarget {\n  if (Array.isArray(target)) {\n    // Don't support multiple targets for now.\n    return expandTarget(target[0]);\n  }\n\n  if (typeof target === 'string') {\n    const [id, fragment] = target.split('#');\n\n    if (!fragment) {\n      // This is an unknown selector.\n      return {\n        type: 'SpecificResource',\n        source: { id, type: (options.typeMap && (options.typeMap[id] as any)) || 'Unknown' },\n        selector: null,\n        selectors: [],\n      };\n    }\n\n    return expandTarget({\n      type: 'SpecificResource',\n      source: { id, type: 'Unknown' },\n      selector: {\n        type: 'FragmentSelector',\n        value: fragment,\n      },\n    });\n  }\n\n  // @todo, how do we want to support choices for targets.\n  if (\n    target.type === 'Choice' ||\n    target.type === 'List' ||\n    target.type === 'Composite' ||\n    target.type === 'Independents'\n  ) {\n    // we also don't support these, just choose the first.\n    return expandTarget(target.items[0]);\n  }\n\n  if (target.type === 'SpecificResource') {\n    if (target.source.type === 'Canvas' && target.source.partOf && typeof target.source.partOf === 'string') {\n      target.source.partOf = [\n        {\n          id: target.source.partOf,\n          type: 'Manifest',\n        },\n      ];\n    }\n\n    const { selector, selectors } = target.selector\n      ? parseSelector(target.selector, options)\n      : { selector: null, selectors: [] };\n\n    return {\n      type: 'SpecificResource',\n      source: target.source,\n      selector,\n      selectors,\n    };\n  }\n\n  if (target.id) {\n    if ((target as any).type === 'Canvas' && (target as any).partOf && typeof (target as any).partOf === 'string') {\n      (target as any).partOf = [\n        {\n          id: (target as any).partOf,\n          type: 'Manifest',\n        },\n      ];\n    }\n\n    const [id, fragment] = target.id.split('#');\n    if (!fragment) {\n      // This is an unknown selector.\n      return {\n        type: 'SpecificResource',\n        source: {\n          ...(target as any),\n          id,\n        },\n        selector: null,\n        selectors: [],\n      };\n    }\n\n    return expandTarget({\n      type: 'SpecificResource',\n      source: {\n        ...(target as any),\n        id,\n      },\n      selector: {\n        type: 'FragmentSelector',\n        value: fragment,\n      },\n    });\n  }\n\n  return {\n    type: 'SpecificResource',\n    source: target as ExternalWebResource,\n    selector: null,\n    selectors: [],\n  };\n}\n","import { Annotation } from '@iiif/presentation-3';\nimport { expandTarget } from './annotation-targets/expand-target';\nimport { SupportedTarget } from './annotation-targets/target-types';\n\nexport type ContentState =\n  | string\n  | (Annotation & { '@context'?: string })\n  | (StateSource & { '@context'?: string })\n  | Array<string | (Annotation & { '@context'?: string }) | (StateSource & { '@context'?: string })>;\n\nexport type StateSource = {\n  id: string;\n  type: 'Manifest' | 'Canvas' | 'Range';\n  partOf?:\n    | string\n    | { id: string; type: string }\n    | Array<{\n        id: string;\n        type: string;\n      }>;\n};\n\n// Normalised content state?\nexport type NormalisedContentState = {\n  id: string;\n  type: 'Annotation';\n  motivation: ['contentState', ...string[]];\n  target: Array<SupportedTarget>;\n  extensions: Record<string, any>;\n};\n\ntype ValidationResponse = readonly [false, { reason?: string }] | readonly [true];\n\nexport function validateContentState(annotation: ContentState, strict = false): ValidationResponse {\n  // Valid content state.\n  if (typeof annotation === 'string') {\n    if (annotation.startsWith('{')) {\n      try {\n        const parsed = JSON.parse(annotation);\n        return validateContentState(parsed);\n      } catch (err) {\n        return [false, { reason: 'Invalid JSON' }];\n      }\n    }\n    return [true];\n  }\n\n  if (Array.isArray(annotation)) {\n    for (const anno of annotation) {\n      const [valid, reason] = validateContentState(anno);\n      if (!valid && reason) {\n        return [valid, reason] as const;\n      }\n    }\n\n    return [true];\n  }\n\n  if (annotation.type === 'Annotation') {\n    // We are validating the annotation.\n    return [true];\n  }\n\n  if (strict && annotation.type === 'Canvas' && !annotation.partOf) {\n    return [false, { reason: 'Canvas without partOf cannot be loaded' }];\n  }\n\n  return [true];\n}\n\nexport function serialiseContentState(annotation: ContentState): string {\n  return encodeContentState(typeof annotation === 'string' ? annotation : JSON.stringify(annotation));\n}\n\nexport function parseContentState(state: string): ContentState;\nexport function parseContentState(state: string, async: false): ContentState;\nexport async function parseContentState(state: string, async: true): Promise<ContentState>;\nexport function parseContentState(state: string, asyncOrFetcher?: boolean): ContentState | Promise<ContentState> {\n  state = state.trim();\n\n  if (state[0] === '{') {\n    // we might have json.\n    return asyncOrFetcher ? Promise.resolve(JSON.parse(state)) : JSON.parse(state);\n  }\n\n  if (state.startsWith('http')) {\n    if (!asyncOrFetcher) {\n      throw new Error('Cannot fetch remote fetch with async=false in parseContentState');\n    }\n    // resolve.\n    return fetch(state).then((r) => r.json());\n  }\n\n  return parseContentState(decodeContentState(state), asyncOrFetcher as any);\n}\n\nexport function encodeContentState(state: string): string {\n  const uriEncoded = encodeURIComponent(state); // using built in function\n  const base64 = typeof btoa === 'undefined' ? Buffer.from(uriEncoded, 'utf-8').toString('base64') : btoa(uriEncoded); // using built in function\n  const base64url = base64.replace(/\\+/g, '-').replace(/\\//g, '_');\n  return base64url.replace(/=/g, '');\n}\n\nexport function decodeContentState(encodedContentState: string): string {\n  const base64url = restorePadding(encodedContentState);\n  const base64 = base64url.replace(/-/g, '+').replace(/_/g, '/');\n  const base64Decoded = typeof atob === 'undefined' ? Buffer.from(base64, 'base64').toString('utf-8') : atob(base64); // using built in function\n  return decodeURIComponent(base64Decoded).trim(); // using built in function\n}\n\nfunction restorePadding(s: string) {\n  // The length of the restored string must be a multiple of 4\n  const pad = s.length % 4;\n\n  if (pad === 1) {\n    throw new Error('InvalidLengthError: Input base64url string is the wrong length to determine padding');\n  }\n\n  return s + (pad ? '===='.slice(0, 4 - pad) : '');\n}\n\nexport function normaliseContentState(state: ContentState): NormalisedContentState {\n  if (!state) {\n    throw new Error('Content state is empty');\n  }\n\n  if (!Array.isArray(state)) {\n    // We have multiples.\n    // throw new Error('Content state is an [Array] and not yet supported');\n    state = [state];\n  }\n\n  let annoId = 'vault://virtual-annotation/' + new Date().getTime(); // <-- need a virtual id\n  const motivation = ['contentState'];\n  const targets = [];\n\n  for (const source of state) {\n    if (typeof source === 'string') {\n      // Note: this is unlikely to happen in conjunction with parseContentState()\n      throw new Error('Content state is a [String] type and cannot be inferred');\n    }\n\n    // If we DO have annotation, then this is all we should be returning.\n    if (source.type === 'Annotation') {\n      annoId = source.id;\n      if (Array.isArray(source.motivation)) {\n        for (const singleMotivation of source.motivation) {\n          if (motivation.indexOf(singleMotivation) === -1) {\n            motivation.push(singleMotivation);\n          }\n        }\n      }\n\n      if (Array.isArray(source.target)) {\n        for (const target of source.target) {\n          const expanded = expandTarget(target as any);\n          targets.push(expanded);\n        }\n      } else {\n        const expanded = expandTarget(source.target as any);\n        targets.push(expanded);\n      }\n\n      continue;\n    }\n\n    const target = expandTarget(source as any);\n    targets.push(target);\n  }\n\n  return {\n    id: annoId,\n    type: 'Annotation',\n    motivation: ['contentState', ...((state as any).motivation || [])],\n    target: targets,\n    extensions: {},\n  };\n}\n","import { ContentResource } from '@iiif/presentation-3';\n\nexport function parseSpecificResource(resource: ContentResource) {\n  if (resource.type === 'SpecificResource') {\n    return [resource.source, { selector: resource.selector }];\n  }\n\n  return [resource, { selector: null }];\n}\n","import { Vault } from '@iiif/vault';\nimport {\n  AnnotationNormalized,\n  AnnotationPageNormalized,\n  CanvasNormalized,\n  ContentResource,\n  IIIFExternalWebResource,\n} from '@iiif/presentation-3';\nimport { Paintables } from './types';\nimport { parseSpecificResource } from './parse-specific-resource';\nimport { compatVault, CompatVault } from '../compat';\n\nexport function createPaintingAnnotationsHelper(vault: CompatVault = compatVault) {\n  function getAllPaintingAnnotations(canvasOrId: string | CanvasNormalized | undefined | null) {\n    const canvas = canvasOrId\n      ? typeof canvasOrId === 'string'\n        ? vault.get<CanvasNormalized>(canvasOrId)\n        : canvasOrId\n      : null;\n\n    if (!canvas) {\n      return [];\n    }\n    const annotationPages = vault.get<AnnotationPageNormalized>(canvas.items);\n    const flatAnnotations: AnnotationNormalized[] = [];\n    for (const page of annotationPages) {\n      flatAnnotations.push(...vault.get<AnnotationNormalized>(page.items));\n    }\n    return flatAnnotations;\n  }\n\n  function getPaintables(\n    paintingAnnotationsOrCanvas: string | CanvasNormalized | AnnotationNormalized[],\n    enabledChoices: string[] = []\n  ): Paintables {\n    const paintingAnnotations = Array.isArray(paintingAnnotationsOrCanvas)\n      ? paintingAnnotationsOrCanvas\n      : getAllPaintingAnnotations(paintingAnnotationsOrCanvas);\n\n    const types: string[] = [];\n    let choice: Paintables['choice'] = null;\n    const items: Paintables['items'] = [];\n\n    for (const annotation of paintingAnnotations) {\n      if (annotation.type !== 'Annotation') {\n        throw new Error(`getPaintables() accept either a canvas or list of annotations`);\n      }\n      const unknownBodies = vault.get<ContentResource>(annotation.body);\n      const bodies = Array.isArray(unknownBodies) ? unknownBodies : [unknownBodies];\n      for (const unknownBody of bodies) {\n        const [body, { selector }] = parseSpecificResource(unknownBody);\n        const type = (body.type || 'unknown').toLowerCase();\n\n        // Choice\n        if (type === 'choice') {\n          const nestedBodies = vault.get<ContentResource>(body.items) as ContentResource[];\n\n          // Which are active? By default, the first, but we could push multiple here.\n          const selected = enabledChoices.length\n            ? enabledChoices.map((cid) => nestedBodies.find((b) => b.id === cid)).filter(Boolean)\n            : [nestedBodies[0]];\n\n          if (selected.length === 0) {\n            selected.push(nestedBodies[0]);\n          }\n\n          // Store choice.\n          choice = {\n            type: 'single-choice',\n            items: nestedBodies.map((b) => ({\n              id: b.id,\n              label: (b as any).label as any,\n              selected: selected.indexOf(b) !== -1,\n            })) as any[],\n            label: (unknownBody as any).label,\n          };\n\n          // @todo insert in the right order.\n          bodies.push(...(selected as any[]));\n\n          continue;\n        }\n\n        if (types.indexOf(type) === -1) {\n          types.push(type);\n        }\n\n        items.push({\n          type: type,\n          resource: body as IIIFExternalWebResource,\n          target: annotation.target,\n          selector,\n        });\n      }\n    }\n\n    return {\n      types,\n      items,\n      choice,\n    };\n  }\n\n  function extractChoices(paintingAnnotationsOrCanvas: string | CanvasNormalized | AnnotationNormalized[]) {\n    const { choice } = getPaintables(paintingAnnotationsOrCanvas);\n    return choice;\n  }\n\n  return {\n    getAllPaintingAnnotations,\n    getPaintables,\n    extractChoices,\n  };\n}\n","import { Vault } from '@iiif/vault';\nimport { Manifest, Reference } from '@iiif/presentation-3';\n\nfunction defineProperty(name: string, prototype: any, vault: Vault) {\n  prototype[DEFINED] = prototype[DEFINED] || [];\n  prototype[DEFINED].push(name);\n\n  Object.defineProperty(prototype, name, {\n    get(): any {\n      if (typeof prototype[REFS][name] === 'undefined') {\n        return undefined;\n      }\n\n      const ref = prototype[REFS][name];\n      if (!ref) {\n        return ref;\n      }\n\n      return wrapObject(vault.get(prototype[REFS][name]), vault);\n    },\n    set(items: any) {\n      const existing = prototype[REFS][name];\n      if (existing !== items) {\n        this[REFS][name] = items;\n\n        // This was a hack, but a much more clever implementation here could make very flexible editing.\n        // For example - manifest.label = \"Something\" -> manifest.label = {none: \"something\"}; etc.\n        // Although this might be better in a different library completely.\n        // if (this[REACTIVE]) {\n        //   vault.modifyEntityField({ id: prototype.id, type: prototype.type }, name, unwrapObject(items));\n        // }\n      }\n    },\n  });\n}\n\nconst REFS = Symbol.for('_refs_');\nconst REACTIVE = Symbol.for('_reactive_');\nconst DEFINED = Symbol.for('_defined_');\n\nfunction createPrototype(vault: Vault, reactive = false) {\n  const prototype = {\n    id: null,\n    [DEFINED]: [] as any[],\n    [REFS]: {},\n    [REACTIVE]: null as null | (() => void),\n\n    is(refOrObject: any) {\n      if (typeof refOrObject === 'string') {\n        return this.id === refOrObject;\n      }\n\n      if (refOrObject.id) {\n        return refOrObject.id === this.id;\n      }\n\n      return false;\n    },\n\n    reactive() {\n      if (this[REACTIVE]) {\n        return;\n      }\n\n      this[REACTIVE] = this.subscribe(() => this.refresh(), true);\n\n      return () => {\n        this.unreactive();\n      };\n    },\n\n    refresh() {\n      if (this.id) {\n        const fresh = this.unwrap();\n        for (const key of Object.keys(fresh || {})) {\n          if (this[DEFINED].includes(key)) {\n            (this as any)[REFS][key] = fresh[key as any];\n          } else {\n            (this as any)[key] = fresh[key as any];\n          }\n        }\n      }\n    },\n\n    unreactive() {\n      if (this[REACTIVE]) {\n        this[REACTIVE]();\n        this[REACTIVE] = null;\n      }\n    },\n\n    unwrap() {\n      if (!this.id) {\n        throw new Error('Invalid object');\n      }\n      return vault.get(this.id);\n    },\n\n    toPresentation3() {\n      return vault.toPresentation3(this.unwrap() as any);\n    },\n\n    toPresentation2() {\n      return vault.toPresentation2(this.unwrap() as any);\n    },\n\n    toJSON() {\n      const that = this as any;\n      return {\n        ...that,\n        items: that.items,\n        annotations: that.annotations,\n        structures: that.structures,\n        seeAlso: that.seeAlso,\n        service: that.service,\n        services: that.services,\n        rendering: that.rendering,\n        partOf: that.partOf,\n        start: that.start,\n        supplementary: that.supplementary,\n        homepage: that.homepage,\n        thumbnail: that.thumbnail,\n        placeholderCanvas: that.placeholderCanvas,\n        accompanyingCanvas: that.accompanyingCanvas,\n        provider: that.provider,\n      };\n    },\n    subscribe(subscription: (object: any, vault: Vault) => void, skipInitial = true) {\n      return vault.subscribe(\n        () => {\n          return this.id ? vault.get(this.id) : null;\n        },\n        subscription,\n        skipInitial\n      );\n    },\n  };\n\n  // Structural\n  defineProperty('items', prototype, vault);\n  defineProperty('annotations', prototype, vault);\n  defineProperty('structures', prototype, vault);\n\n  // Linking\n  defineProperty('seeAlso', prototype, vault);\n  defineProperty('service', prototype, vault);\n  defineProperty('services', prototype, vault);\n  defineProperty('rendering', prototype, vault);\n  defineProperty('partOf', prototype, vault);\n  defineProperty('start', prototype, vault);\n  defineProperty('supplementary', prototype, vault);\n  defineProperty('homepage', prototype, vault);\n\n  // Descriptive\n  defineProperty('thumbnail', prototype, vault);\n  defineProperty('placeholderCanvas', prototype, vault);\n  defineProperty('accompanyingCanvas', prototype, vault);\n  defineProperty('provider', prototype, vault);\n\n  // Annotation\n  defineProperty('body', prototype, vault);\n  defineProperty('logo', prototype, vault);\n\n  return prototype;\n}\n\nexport function unwrapObject(object: any): any {\n  if (Array.isArray(object)) {\n    return object.map((o) => unwrapObject(o)) as any;\n  }\n\n  if (!object || !object.type) {\n    return object;\n  }\n\n  return { id: object.id, type: object.type };\n}\n\nexport function wrapObject(object: any, vault: Vault, reactive = false): any {\n  if (Array.isArray(object)) {\n    return object.map((o) => wrapObject(o, vault, reactive));\n  }\n\n  if (!object || !object.type || !object.id) {\n    return object;\n  }\n\n  const prototype = createPrototype(vault, reactive);\n  const newObject = Object.create(prototype);\n\n  const wrapped =  Object.assign(newObject, object) as any;\n\n  if (reactive) {\n    wrapped.reactive();\n  }\n\n  return wrapped;\n}\n\nexport function createObjectsHelper(vault: Vault) {\n  return {\n    get(id: string | Reference | string[] | Reference[], reactive = false) {\n      return wrapObject(vault.get(id as any), vault, reactive);\n    },\n    async load(id: string | Reference<any>, json?: any): Promise<Manifest> {\n      return wrapObject(await vault.load(id, json), vault);\n    },\n    async loadManifest(id: string | Reference<any>, json?: any): Promise<Manifest> {\n      return wrapObject(await vault.loadManifest(id, json), vault);\n    },\n    async loadCollection(id: string | Reference<any>, json?: any) {\n      return wrapObject(await vault.loadCollection(id, json), vault);\n    },\n    wrapObject<T>(objectType: Reference<T>) {\n      return wrapObject(vault.get(objectType, { skipSelfReturn: false }), vault);\n    },\n    isWrapped(object: any) {\n      return !!object[DEFINED];\n    },\n  };\n}\n","import { Vault } from '@iiif/vault';\nimport { ManifestNormalized, RangeNormalized, Reference } from '@iiif/presentation-3';\nimport { CompatVault, compatVault } from './compat';\n\nexport function createRangeHelper(vault: CompatVault = compatVault) {\n  return {\n    findFirstCanvasFromRange: (range: RangeNormalized) => findFirstCanvasFromRange(vault, range),\n    findAllCanvasesInRange: (range: RangeNormalized) => findAllCanvasesInRange(vault, range),\n    findManifestSelectedRange: (manifest: ManifestNormalized, canvasId: string) =>\n      findManifestSelectedRange(vault, manifest, canvasId),\n    findSelectedRange: (range: RangeNormalized, canvasId: string) => findSelectedRange(vault, range, canvasId),\n  };\n}\n\nexport function findFirstCanvasFromRange(vault: CompatVault, range: RangeNormalized): null | Reference<'Canvas'> {\n  for (const inner of range.items) {\n    if (inner.type === 'Canvas') {\n      return inner as Reference<'Canvas'>;\n    }\n    if (inner.type === 'Range') {\n      const found = findFirstCanvasFromRange(vault, vault.get(inner));\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\n\nexport function findAllCanvasesInRange(vault: CompatVault, range: RangeNormalized): Array<Reference<'Canvas'>> {\n  const found: Reference<'Canvas'>[] = [];\n  for (const inner of range.items) {\n    if (inner.type === 'Canvas') {\n      if (inner.id.indexOf('#') !== -1) {\n        found.push({ id: inner.id.split('#')[0], type: 'Canvas' });\n      } else {\n        found.push(inner as Reference<'Canvas'>);\n      }\n    }\n    if (inner.type === 'Range') {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if ((inner as any).type === 'SpecificResource') {\n      const sourceId = typeof (inner as any).source === 'string' ? (inner as any).source : (inner as any).source.id;\n      found.push({ id: sourceId, type: 'Canvas' });\n    }\n  }\n  return found;\n}\n\nexport function findManifestSelectedRange(\n  vault: CompatVault,\n  manifest: ManifestNormalized,\n  canvasId: string\n): null | RangeNormalized {\n  for (const range of manifest.structures) {\n    const found = findSelectedRange(vault, vault.get(range), canvasId);\n    if (found) {\n      return found;\n    }\n  }\n\n  return null;\n}\n\nexport function findSelectedRange(\n  vault: CompatVault,\n  range: RangeNormalized,\n  canvasId: string\n): null | RangeNormalized {\n  for (const inner of range.items) {\n    const parsedId = inner.id?.split('#')[0];\n    if ((inner as any).type === 'SpecificResource' && (inner as any).source === canvasId) {\n      return range;\n    }\n    if (inner.type === 'Canvas' && canvasId === parsedId) {\n      return range;\n    }\n    if (inner.type === 'Range') {\n      const found = findSelectedRange(vault, vault.get(inner), canvasId);\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\n","import { CanvasNormalized, ManifestNormalized, RangeNormalized, Reference } from '@iiif/presentation-3';\nimport { findAllCanvasesInRange } from './ranges';\nimport { compatVault, CompatVault } from './compat';\n\nexport function createSequenceHelper(vault: CompatVault = compatVault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (\n      manifestOrRange: ManifestNormalized | RangeNormalized,\n      canvasId: string | null,\n      preventPaged = false\n    ) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (\n      manifestOrRange: ManifestNormalized | RangeNormalized,\n      options: { disablePaging?: boolean; skipNonPaged?: boolean } = {}\n    ) => getManifestSequence(vault, manifestOrRange, options),\n  };\n}\n\n/**\n * Get visible canvases from canvas ID\n *\n * This function returns a list of canvas references that should all be displayed\n * when the passed canvasId is visible. This should work for individual items,\n * 2-up paged view and continuous (scrolls).\n *\n * The options are listed below (from IIIF docs)\n *\n * - `unordered` - Valid on Collections, Manifests and Ranges. The Canvases included in resources that have this behavior\n *    have no inherent order, and user interfaces should avoid implying an order to the user. Disjoint with individuals,\n *    continuous, and paged.\n *\n * - `individuals` - Valid on Collections, Manifests, and Ranges. For Collections that have this behavior, each of the\n *    included Manifests are distinct objects in the given order. For Manifests and Ranges, the included Canvases are\n *    distinct views, and should not be presented in a page-turning interface. This is the default layout behavior if\n *    not specified. Disjoint with unordered, continuous, and paged.\n *\n * - `continuous`  Valid on Collections, Manifests and Ranges, which include Canvases that have at least height and\n *    width dimensions. Canvases included in resources that have this behavior are partial views and an appropriate\n *    rendering might display all of the Canvases virtually stitched together, such as a long scroll split into\n *    sections. This behavior has no implication for audio resources. The viewingDirection of the Manifest will\n *    determine the appropriate arrangement of the Canvases. Disjoint with unordered, individuals and paged.\n *\n * - `paged`  Valid on Collections, Manifests and Ranges, which include Canvases that have at least height and width\n *    dimensions. Canvases included in resources that have this behavior represent views that should be presented in\n *    a page-turning interface if one is available. The first canvas is a single view (the first recto) and thus the\n *    second canvas likely represents the back of the object in the first canvas. If this is not the case, see the\n *    behavior value non-paged. Disjoint with unordered, individuals, continuous, facing-pages and non-paged.\n *\n */\nexport function getVisibleCanvasesFromCanvasId(\n  vault: CompatVault = compatVault,\n  manifestOrRange: ManifestNormalized | RangeNormalized,\n  canvasId: string | null,\n  preventPaged = false\n): Reference<'Canvas'>[] {\n  const behavior = manifestOrRange.behavior || [];\n  const fullCanvas = canvasId ? vault.get<CanvasNormalized>(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n\n  const canvasBehavior = fullCanvas.behavior || [];\n  const isPaged = preventPaged ? false : behavior.includes('paged');\n  const isContinuous = isPaged ? false : behavior.includes('continuous');\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes('individuals');\n  const isCanvasFacingPages = canvasBehavior.includes('facing-pages');\n  const isCanvasNonPaged = canvasBehavior.includes('non-paged');\n\n  // Individuals should just be the default.\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: 'Canvas' }];\n  }\n\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n\n  // Continuous should just return all items together.\n  if (isContinuous) {\n    return manifestItems;\n  }\n\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n\n  return [{ id: fullCanvas.id, type: 'Canvas' }];\n}\n\nexport function getManifestSequence(\n  vault: CompatVault = compatVault,\n  manifestOrRange: ManifestNormalized | RangeNormalized,\n  { disablePaging, skipNonPaged }: { disablePaging?: boolean; skipNonPaged?: boolean } = {}\n): [Reference<'Canvas'>[], number[][]] {\n  const behavior = manifestOrRange.behavior || [];\n  const isPaged = behavior.includes('paged');\n  const isContinuous = isPaged ? false : behavior.includes('continuous');\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes('individuals');\n  const manifestItems =\n    manifestOrRange.type === 'Manifest' ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n\n  // Continuous should just return all items together.\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_, index) => index)]];\n  }\n\n  // Individuals should just be the default.\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_, index) => [index])];\n  }\n\n  // This is the tricky case.\n  const ordering: number[][] = [];\n  let currentOrdering: number[] = [];\n\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get<CanvasNormalized>(manifestItems[i]);\n    const canvasBehavior = canvas.behavior || [];\n    if (canvasBehavior.includes('non-paged')) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n\n    if (i === offset || canvasBehavior.includes('facing-pages')) {\n      // Flush and push a single.\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n\n    currentOrdering.push(i);\n\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n\n  if (currentOrdering.length) {\n    flush();\n  }\n\n  return [manifestItems, ordering];\n}\n"],"names":["metaState","compatVault","nonRef","id","meta","key","value","oldValue","oldValueItem","newValue","resource","metaKey","resourceMeta","createEventsHelper","vault","event","listener","scope","registeredCallbacks","callbacks","registered","registeredCallback","resourceOrId","hooks","props","hook","e","fullResource","callback","_scope","createStylesHelper","styles","p","i","te","z","A","ne","E","b","re","L","M","se","W","j","ae","oe","$","C","P","B","fe","le","N","R","H","T","he","G","k","ue","Q","V","D","U","J","ce","de","ge","pe","K","t","n","r","me","xe","Ie","ye","_e","a","o","f","l","d","g","c","m","we","Se","ve","h","w","Fe","v","F","X","Oe","Y","ze","Ae","Ee","q","ee","be","Le","Me","We","Ve","De","Ue","je","Je","Ze","$e","x","I","Ce","O","y","Pe","Be","S","qe","ei","ii","Ne","ni","Re","si","He","Te","Ge","_","ke","createThumbnailHelper","dependencies","imageServiceLoader","ImageServiceLoader","getBestThumbnailAtSize","input","request","dereference","candidates","dimensions","thumbnailNotFound","fixed","getFixedSizeFromImage","fullInput","thumbnail","potentialThumbnails","contentResources","firstContentResources","canvas","choice","firstManifest","firstCanvas","getClosestLanguage","i18nLanguage","languages","i18nLanguages","strictFallback","root","lang","inverseIdx","buildLocaleString","inputText","options","defaultText","separator","fallbackLanguages","closest","language","candidateText","getValue","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_i","_s","err","TAU","mapToEllipse","_ref","rx","ry","cosphi","sinphi","centerx","centery","xp","yp","approxUnitArc","ang1","ang2","x1","y1","x2","y2","vectorAngle","ux","uy","vx","vy","sign","dot","getArcCenter","px","py","cx","cy","largeArcFlag","sweepFlag","pxp","pyp","rxsq","rysq","pxpsq","pypsq","radicant","centerxp","centeryp","vx1","vy1","vx2","vy2","arcToBezier","_ref2","_ref2$xAxisRotation","xAxisRotation","_ref2$largeArcFlag","_ref2$sweepFlag","curves","lambda","_getArcCenter","_getArcCenter2","ratio","segments","curve","_mapToEllipse","_mapToEllipse2","_mapToEllipse3","parseSvgPath","parse","length","segment","path","data","command","args","type","parseValues","number","numbers","absSvgPath","absolutize","startX","startY","seg","parseAndNormalizeSvgPath","parsed","absolute","prevCmd","bezierX","bezierY","quadX","quadY","out","cmd","arcToCurve","flattenQuadraticBezier","start","control","end","tolerance","QuadraticBezier","flattenCubicBezier","startControl","endControl","CubicBezier","hypot2","approx_myint","approx_inv_myint","mt","x0","y0","ddx","ddy","u0","u2","cross","paramX0","paramX2","scale","params","a0","a2","count","tValues","coords","c0","c1","c2","c3","p1","t0","t1","p0","p3","d1","d2","tol","tol1","tol2","sqrt_tol2","err2","n_quads","quads","sum","quad","val","xmin","cusp_val","result","target","BOX_SELECTOR","TEMPORAL_SELECTOR","RGBA_COLOR","parseSelector","source","domParser","svgPreprocessor","iiifRenderingHints","resolveHints","nextSource","selector","selectors","newIiifRenderingHints","fragment","isImageApiSelector","parsedRegion","matchBoxSelector","matchTimeSelector","points","rect","style","svg","_a","svgShape","svgElement","selectorElem","getSelectorElement","_b","extractStyles","sel","getShapeTypeFromPath","svgPath","cmdFrequencies","acc","cmdTypes","lastSeg","svgElem","element","res","normalized","pathToPoints","_c","angle","rad","_f","_g","_h","_j","_k","_m","_l","ps","shapeType","_o","width","_p","height","_q","normalizedPath","startPoint","selectorElement","rgbaMatch","rootElem","supported","parsedRotation","parseRotation","num","expandTarget","validateContentState","annotation","strict","anno","valid","reason","serialiseContentState","encodeContentState","parseContentState","state","asyncOrFetcher","decodeContentState","uriEncoded","encodedContentState","base64","restorePadding","base64Decoded","s","pad","normaliseContentState","annoId","targets","singleMotivation","expanded","parseSpecificResource","createPaintingAnnotationsHelper","getAllPaintingAnnotations","canvasOrId","annotationPages","flatAnnotations","page","getPaintables","paintingAnnotationsOrCanvas","enabledChoices","paintingAnnotations","types","items","unknownBodies","bodies","unknownBody","body","nestedBodies","selected","cid","extractChoices","defineProperty","name","prototype","DEFINED","REFS","ref","wrapObject","REACTIVE","createPrototype","reactive","refOrObject","fresh","that","subscription","skipInitial","unwrapObject","object","newObject","wrapped","createObjectsHelper","json","objectType","createRangeHelper","range","findFirstCanvasFromRange","findAllCanvasesInRange","manifest","canvasId","findManifestSelectedRange","findSelectedRange","inner","found","sourceId","parsedId","createSequenceHelper","manifestOrRange","preventPaged","getVisibleCanvasesFromCanvasId","getManifestSequence","behavior","fullCanvas","canvasBehavior","isPaged","isContinuous","isIndividuals","isCanvasFacingPages","isCanvasNonPaged","manifestItems","ordering","canvasIndex","indexes","index","disablePaging","skipNonPaged","currentOrdering","flush","offset","flushNextPaged"],"mappings":"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"}