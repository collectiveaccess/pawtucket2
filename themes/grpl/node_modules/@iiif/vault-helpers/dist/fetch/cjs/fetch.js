"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var vt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S={exports:{}};(function(L,d){var A=Object.defineProperty,Y=(c,o,u)=>o in c?A(c,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[o]=u,j=(c,o,u)=>(Y(c,typeof o!="symbol"?o+"":o,u),u);(function(c,o){o(d)})(vt,function(c){const o="http://library.stanford.edu/iiif/image-api/compliance.html#level1",u="http://library.stanford.edu/iiif/image-api/compliance.html#level2",R="http://library.stanford.edu/iiif/image-api/conformance.html#level1",T="http://library.stanford.edu/iiif/image-api/conformance.html#level2",I="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",k="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",O="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",M="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",q="http://iiif.io/api/image/1/level1.json",P="http://iiif.io/api/image/1/profiles/level1.json",D="http://iiif.io/api/image/1/level2.json",U="http://iiif.io/api/image/1/profiles/level2.json",$="http://iiif.io/api/image/2/level1.json",_="http://iiif.io/api/image/2/profiles/level1.json",W="http://iiif.io/api/image/2/level2.json",E="http://iiif.io/api/image/2/profiles/level2.json",H="level1",F="level2",B="http://iiif.io/api/image/2/level1",N="http://iiif.io/api/image/2/level2",Z=[B,N,o,u,R,T,I,k,O,M,q,P,D,U,$,_,W,E,H,F],tt=["http://iiif.io/api/image/2/level0",B,N,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",o,u,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",R,T,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",I,k,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",O,M,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",q,P,D,U,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",$,_,W,E,"level0",H,F],G=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class b{constructor(t,i={}){j(this,"traversals"),j(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...t},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...i}}static all(t){return new b({collection:[t],manifest:[t],canvas:[t],annotationList:[t],sequence:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],layer:[t]})}traverseCollection(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(t))),this.traversals.collection)}traverseCollectionItems(t){if(this.options.mergeMemberProperties){const i=[...(t.manifests||[]).map(r=>typeof r=="string"?{"@id":r,"@type":"sc:Manifest"}:r),...(t.collections||[]).map(r=>typeof r=="string"?{"@id":r,"@type":"sc:Collection"}:r),...t.members||[]];delete t.collections,delete t.manifests,t.members=i}return t.manifests&&(t.manifests=t.manifests.map(i=>this.traverseManifest(typeof i=="string"?{"@id":i,"@type":"sc:Manifest"}:i))),t.collections&&(t.collections=t.collections.map(i=>this.traverseCollection(typeof i=="string"?{"@id":i,"@type":"sc:Collection"}:i))),t.members&&(t.members=t.members.map(i=>typeof i=="string"?i:this.traverseUnknown(i))),t}traverseManifest(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(t))),this.traversals.manifest)}traverseManifestItems(t){return t.sequences&&(t.sequences=t.sequences.map(i=>this.traverseSequence(i))),t.structures&&(t.structures=t.structures.map(i=>this.traverseRange(i))),t}traverseSequence(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(t))),this.traversals.sequence)}traverseSequenceItems(t){return t.canvases&&(t.canvases=t.canvases.map(i=>this.traverseCanvas(i))),t}traverseCanvas(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(t))),this.traversals.canvas)}traverseCanvasItems(t){return t.images&&(t.images=t.images.map(i=>this.traverseAnnotation(i))),t.otherContent&&(t.otherContent=t.otherContent.map(i=>this.traverseAnnotationList(i))),t}traverseRange(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(t))),this.traversals.range)}traverseRangeItems(t){if(this.options.mergeMemberProperties){const i=[...(t.ranges||[]).map(r=>typeof r=="string"?{"@id":r,"@type":"sc:Range"}:r),...(t.canvases||[]).map(r=>typeof r=="string"?{"@id":r,"@type":"sc:Canvas"}:r),...t.members||[]];delete t.ranges,delete t.canvases,t.members=i.length?i.map(r=>this.traverseUnknown(r)):void 0}return t}traverseAnnotationList(t){const i=typeof t=="string"?{"@id":t,"@type":"sc:AnnotationList"}:t;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(i)),this.traversals.annotationList)}traverseAnnotationListItems(t){return t.resources&&(t.resources=t.resources.map(i=>this.traverseAnnotation(i))),t}traverseAnnotation(t){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(t))),this.traversals.annotation)}traverseAnnotationItems(t){return t.resource&&(Array.isArray(t.resource)?t.resource=t.resource.map(i=>this.traverseContentResource(i)):t.resource=this.traverseContentResource(t.resource)),t.on,t}traverseLayer(t){return this.traverseType(this.traverseLinking(this.traverseLayerItems(t)),this.traversals.layer)}traverseLayerItems(t){return t.otherContent&&(t.otherContent=t.otherContent.map(i=>this.traverseAnnotationList(i))),t}traverseChoice(t){return this.traverseType(this.traverseChoiceItems(t),this.traversals.choice)}traverseChoiceItems(t){return t.default&&t.default!=="rdf:nil"&&(t.default=this.traverseContentResource(t.default)),t.item&&t.item!=="rdf:nil"&&(t.item=t.item.map(i=>this.traverseContentResource(i))),t}traverseService(t){return this.traverseType(this.traverseLinking(t),this.traversals.service)}traverseContentResource(t){return t["@type"]==="oa:Choice"?this.traverseChoice(t):this.traverseType(this.traverseDescriptive(this.traverseLinking(t)),this.traversals.contentResource)}traverseUnknown(t){if(!t["@type"]||typeof t=="string")return t;switch(function(i){if(i==null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(i))throw new Error("Array is not a valid entity");if(typeof i!="object")throw new Error(typeof i+" is not a valid entity");if(typeof i["@type"]=="string"){const r=G.indexOf(i["@type"]);if(r!==-1)return G[r]}if(i.profile)return"Service";if(i.format||i["@type"])return"ContentResource";throw new Error("Resource type is not known")}(t)){case"sc:Collection":return this.traverseCollection(t);case"sc:Manifest":return this.traverseManifest(t);case"sc:Canvas":return this.traverseCanvas(t);case"sc:Sequence":return this.traverseSequence(t);case"sc:Range":return this.traverseRange(t);case"oa:Annotation":return this.traverseAnnotation(t);case"sc:AnnotationList":return this.traverseAnnotationList(t);case"sc:Layer":return this.traverseLayer(t);case"Service":return this.traverseService(t);case"oa:Choice":return this.traverseChoice(t);case"ContentResource":return this.traverseContentResource(t)}return t.profile?this.traverseService(t):t}traverseImageResource(t){const i=Array.isArray(t),r=Array.isArray(t)?t:[t],n=[];for(const s of r)typeof s=="string"?n.push(this.traverseContentResource({"@id":s,"@type":"dctypes:Image"})):n.push(this.traverseContentResource(s));return i||this.options.convertPropsToArray?n:n[0]}traverseDescriptive(t){return t.thumbnail&&(t.thumbnail=this.traverseImageResource(t.thumbnail)),t.logo&&(t.logo=this.traverseImageResource(t.logo)),t}traverseOneOrMoreServices(t){const i=Array.isArray(t),r=Array.isArray(t)?t:[t],n=[];for(const s of r)n.push(this.traverseService(s));return i||this.options.convertPropsToArray?n:n[0]}traverseLinking(t){return t.related&&(t.related=this.traverseOneOrManyType(t.related,this.traversals.contentResource)),t.rendering&&(t.rendering=this.traverseOneOrManyType(t.rendering,this.traversals.contentResource)),t.service&&(t.service=this.traverseOneOrMoreServices(t.service)),t.seeAlso&&(t.seeAlso=this.traverseOneOrManyType(t.seeAlso,this.traversals.contentResource)),t.within&&(typeof t.within=="string"||(t.within=this.traverseOneOrManyType(t.within,this.traversals.contentResource))),t.startCanvas&&(typeof t.startCanvas=="string"?t.startCanvas=this.traverseType({"@id":t.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):t.startCanvas&&this.traverseType(t.startCanvas,this.traversals.canvas)),t.contentLayer&&(typeof t.contentLayer=="string"?t.contentLayer=this.traverseLayer({"@id":t.contentLayer,"@type":"sc:Layer"}):t.contentLayer=this.traverseLayer(t.contentLayer)),t}traverseOneOrManyType(t,i){if(!Array.isArray(t)){if(!this.options.convertPropsToArray)return this.traverseType(t,i);t=[t]}return t.map(r=>this.traverseType(r,i))}traverseType(t,i){return i.reduce((r,n)=>{const s=n(r);return s!==void 0||this.options.allowUndefinedReturn?s:r},t)}}const et="Attribution",it="http://example.org/provider",rt="Unknown";function m(e,t="none"){if(!e)return{};const i=Array.isArray(e)?e:[e],r={};for(const n of i){if(typeof n=="string"){r[t]=r[t]?r[t]:[],r[t].push(n||"");continue}if(!n["@language"]){r[t]=r[t]?r[t]:[],r[t].push(n["@value"]||"");continue}const s=n["@language"];r[s]=r[s]?r[s]:[],r[s].push(n["@value"]||"")}return r}function z(e){return Array.isArray(e)?z(e.find(t=>typeof t=="string")):tt.indexOf(e)!==-1?"level2":Z.indexOf(e)!==-1?"level1":typeof e=="string"?e:void 0}function J(e){for(const t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}const nt=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function C(e){const t=e["@id"]||e.id;let i=e["@type"]||e.type;const r=e.profile||void 0,n=e["@context"]||void 0;if(r){const s=function(a){switch(a){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(r);if(s)return s}if(n){const s=function(a){const g=Array.isArray(a)?a:[a];for(const y of g)switch(y){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(s)return s}if(i){if(Array.isArray(i)){if(i.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(i.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";i=i[0]}for(const s of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${s}:`)){i=i.slice(s.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&nt.indexOf(i)!==-1)return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||e.format==="application/pdf")return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}const st=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function at(e){const t=e.match(st);return t?t[0]:e}const ot=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function ct(e){if(e){const t=Array.isArray(e)?e:[e],i=[];for(const r of t)r==="http://iiif.io/api/presentation/2/context.json"&&i.push("http://iiif.io/api/presentation/3/context.json"),ot.indexOf(r)===-1&&i.push(r);if(t.length)return i.length===1?i[0]:i}}function l(e){for(const t in e)e[t]!==void 0&&e[t]!==null||delete e[t];return e}let K=0;function Q(e,t){const i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(K++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${K}`)}function p(e){const t=[...e.behavior||[]];let i;return e.viewingHint&&t.push(e.viewingHint),Array.isArray(e.motivation)?i=e.motivation.map(J):e.motivation&&(i=J(e.motivation)),{"@context":e["@context"]?ct(e["@context"]):void 0,id:(e["@id"]||Q(e)).trim(),type:C(e),behavior:t.length?t:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:i,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function h(e){const[t,i]=function(s,a="Rights/License",g="none"){let y=null;const V=[],ut=Array.isArray(s)?s:[s];for(const X of ut){const f=X?at(X):void 0;!f||f.indexOf("creativecommons.org")===-1&&f.indexOf("rightsstatements.org")===-1?f&&V.push({label:{[g]:[a]},value:{[g]:[f]}}):y=f.startsWith("https://")?`http://${f.slice(8)}`:f}return[y,V]}(e.license),r=[...e.metadata?(n=e.metadata,n?n.map(s=>({label:m(s.label),value:m(s.value)})):[]):[],...i];var n;return{rights:t,metadata:r.length?r:void 0,label:e.label?m(e.label):void 0,requiredStatement:e.attribution?{label:m(et),value:m(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?m(e.description):void 0,thumbnail:e.thumbnail}}function lt(e){if(!e.within)return;const t=Array.isArray(e.within)?e.within:[e.within],i=[];for(const r of t)typeof r=="string"?r&&e["@type"]==="sc:Manifest"&&i.push({id:r,type:"Collection"}):r["@id"]&&i.push({id:r["@id"],type:C(r)});return i.length?i:void 0}function v(e){const t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:it,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:m(rt)}]:void 0,partOf:lt(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?(r=e.service,Array.isArray(r)?r:[r]):void 0,supplementary:i?[i]:void 0};var r}function x(e){const t=e;return l({...p(t),...h(t),...v(t),...(i=t,{chars:i.chars,format:i.format?i.format:void 0,language:i.language})});var i}const pt=new b({collection:[function(e){return l({...p(e),...h(e),...v(e),items:e.members})}],manifest:[function(e){const t=[],i=[];for(const n of e.sequences||[])n.canvases.length&&t.push(...n.canvases),n.behavior&&i.push(...n.behavior);const r=p(e);return i.length&&(r.behavior?r.behavior.push(...i):r.behavior=i),l({...r,...h(e),...v(e),items:t,structures:e.structures})}],canvas:[function(e){return l({...p(e),...h(e),...v(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:Q(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return l({...p(e),...h(e),...v(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&e.canvases.length!==0?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return l({...p(e),...h(e),...v(e),target:function t(i){if(Array.isArray(i)){if(i.length>1)return{type:"List",items:i.map(t)};i=i[0]}if(typeof i=="string")return encodeURI(i).trim();if("@type"in i){let r;if(typeof i.full=="string")r=i.full;else if(i.full["@type"]==="dctypes:Image")r={id:i.full["@id"],type:"Image"};else{if(i.full["@type"]!=="sc:Canvas")throw new Error(`Unsupported source type on annotation: ${i.full["@type"]}`);r={id:i.full["@id"],type:"Canvas"}}return{type:"SpecificResource",source:r,selector:w(i.selector)}}return encodeURI(i["@id"]).trim()}(e.on),body:Array.isArray(e.resource)?e.resource.map(x):x(e.resource)})}],contentResource:[x],choice:[function(e){const t=[];return e.default&&e.default!=="rdf:nil"&&t.push(e.default),e.item&&e.item!=="rdf:nil"&&t.push(...e.item),{...p(e),...h(e),items:t}}],range:[function(e){return l({...p(e),...h(e),...v(e),items:e.members})}],service:[function(e){const{"@id":t,"@type":i,"@context":r,profile:n,...s}=e,a={};return t&&(a["@id"]=t),a["@type"]=C(e),a["@type"]==="unknown"&&(r&&r.length&&(a["@context"]=r),a["@type"]="Service"),n&&(a.profile=z(n)),l({...a,...s})}],layer:[function(e){return l({...p(e),...h(e),...v(e)})}]});function w(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||e["@type"]=="oa:SvgSelector")&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if(e["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:e.value};if(e["@type"]==="oa:Choice")return[w(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(w)];if(e["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in e?e.region:void 0,rotation:"rotation"in e?e.rotation:void 0};throw new Error(`Unsupported selector type: ${e["@type"]}`)}const ht=function(e){return e&&e["@context"]&&(e["@context"]==="http://iiif.io/api/presentation/2/context.json"||e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||e["@context"]==="http://www.shared-canvas.org/ns/context.json")||e["@context"]==="http://iiif.io/api/image/2/context.json"?pt.traverseUnknown(e):e};c.upgrade=ht,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})})(S,S.exports);function ft(L,d){return fetch(L,d).then(A=>A.json()).then(S.exports.upgrade)}exports.fetch=ft;
//# sourceMappingURL=fetch.js.map
