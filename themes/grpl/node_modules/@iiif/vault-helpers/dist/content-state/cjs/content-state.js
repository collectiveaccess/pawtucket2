"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var rt=function(){function t(e,n){var r=[],o=!0,s=!1,a=void 0;try{for(var i=e[Symbol.iterator](),u;!(o=(u=i.next()).done)&&(r.push(u.value),!(n&&r.length===n));o=!0);}catch(f){s=!0,a=f}finally{try{!o&&i.return&&i.return()}finally{if(s)throw a}}return r}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),L=Math.PI*2,_=function(e,n,r,o,s,a,i){var u=e.x,f=e.y;u*=n,f*=r;var h=o*u-s*f,y=s*u+o*f;return{x:h+a,y:y+i}},nt=function(e,n){var r=n===1.5707963267948966?.551915024494:n===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(n/4),o=Math.cos(e),s=Math.sin(e),a=Math.cos(e+n),i=Math.sin(e+n);return[{x:o-s*r,y:s+o*r},{x:a+i*r,y:i-a*r},{x:a,y:i}]},j=function(e,n,r,o){var s=e*o-n*r<0?-1:1,a=e*r+n*o;return a>1&&(a=1),a<-1&&(a=-1),s*Math.acos(a)},at=function(e,n,r,o,s,a,i,u,f,h,y,A){var d=Math.pow(s,2),c=Math.pow(a,2),w=Math.pow(y,2),x=Math.pow(A,2),b=d*c-d*x-c*w;b<0&&(b=0),b/=d*x+c*w,b=Math.sqrt(b)*(i===u?-1:1);var l=b*s/a*A,p=b*-a/s*y,v=h*l-f*p+(e+r)/2,g=f*l+h*p+(n+o)/2,m=(y-l)/s,M=(A-p)/a,S=(-y-l)/s,k=(-A-p)/a,T=j(1,0,m,M),F=j(m,M,S,k);return u===0&&F>0&&(F-=L),u===1&&F<0&&(F+=L),[v,g,T,F]},st=function(e){var n=e.px,r=e.py,o=e.cx,s=e.cy,a=e.rx,i=e.ry,u=e.xAxisRotation,f=u===void 0?0:u,h=e.largeArcFlag,y=h===void 0?0:h,A=e.sweepFlag,d=A===void 0?0:A,c=[];if(a===0||i===0)return[];var w=Math.sin(f*L/360),x=Math.cos(f*L/360),b=x*(n-o)/2+w*(r-s)/2,l=-w*(n-o)/2+x*(r-s)/2;if(b===0&&l===0)return[];a=Math.abs(a),i=Math.abs(i);var p=Math.pow(b,2)/Math.pow(a,2)+Math.pow(l,2)/Math.pow(i,2);p>1&&(a*=Math.sqrt(p),i*=Math.sqrt(p));var v=at(n,r,o,s,a,i,y,d,w,x,b,l),g=rt(v,4),m=g[0],M=g[1],S=g[2],k=g[3],T=Math.abs(k)/(L/4);Math.abs(1-T)<1e-7&&(T=1);var F=Math.max(Math.ceil(T),1);k/=F;for(var Q=0;Q<F;Q++)c.push(nt(S,k)),S+=k;return c.map(function(R){var D=_(R[0],a,i,x,w,m,M),K=D.x,H=D.y,U=_(R[1],a,i,x,w,m,M),P=U.x,E=U.y,V=_(R[2],a,i,x,w,m,M),tt=V.x,et=V.y;return{x1:K,y1:H,x2:P,y2:E,x:tt,y:et}})},ot=ct,B={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},it=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function ct(t){var e=[];return t.replace(it,function(n,r,o){var s=r.toLowerCase();for(o=ut(o),s=="m"&&o.length>2&&(e.push([r].concat(o.splice(0,2))),s="l",r=r=="m"?"l":"L");;){if(o.length==B[s])return o.unshift(r),e.push(o);if(o.length<B[s])throw new Error("malformed path data");e.push([r].concat(o.splice(0,B[s])))}}),e}var lt=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function ut(t){var e=t.match(lt);return e?e.map(Number):[]}var pt=ft;function ft(t){var e=0,n=0,r=0,o=0;return t.map(function(s){s=s.slice();var a=s[0],i=a.toUpperCase();if(a!=i)switch(s[0]=i,a){case"a":s[6]+=r,s[7]+=o;break;case"v":s[1]+=o;break;case"h":s[1]+=r;break;default:for(var u=1;u<s.length;)s[u++]+=r,s[u++]+=o}switch(i){case"Z":r=e,o=n;break;case"H":r=s[1];break;case"V":o=s[1];break;case"M":r=e=s[1],o=n=s[2];break;default:r=s[s.length-2],o=s[s.length-1]}return s})}function ht(t){const e=ot(t),n=pt(e);let r,o=0,s=0,a=0,i=0,u,f,h=0,y=0;const A=[];for(let d=0;d<n.length;d++){let c=n[d];const w=c[0];switch(w){case"M":o=c[1],s=c[2];break;case"H":c=["L",c[1],s];break;case"V":c=["L",o,c[1]];break;case"S":{let x=h,b=y;(r==="C"||r=="S")&&(x+=x-a,b+=b-i),c=["C",x,b,c[1],c[2],c[3],c[4]]}break;case"T":r==="Q"||r=="T"?(u=h*2-u,f=y*2-f):(u=h,f=y),c=["Q",u,f,c[1],c[2]];break;case"Q":u=c[1],f=c[2];break;case"A":{const x=st({px:h,py:y,cx:c[6],cy:c[7],rx:c[1],ry:c[2],xAxisRotation:c[3],largeArcFlag:c[4],sweepFlag:c[5]});if(!x.length)continue;for(const[b,l]of x.entries())c=["C",l.x1,l.y1,l.x2,l.y2,l.x,l.y],b<x.length-1&&A.push(c);c=c}break;case"Z":c=["L",o,s];break}r=w,h=c[c.length-2],y=c[c.length-1],["C","Q","A"].indexOf(w)>-1?(a=c[c.length-4],i=c[c.length-3]):(a=h,i=y),A.push(c)}return A}/** Code to "flatten" quadratic and cubic Bézier curves to polylines.
 *
 * All code in this module is based on JavaScript code by Raph Levien, published on his blog at
 * https://raphlinus.github.io/.
 * I merely changed the structure a bit, removed some unneeded parts and added some comments and type hints.
 *
 * Flattening of quadratic Bézier curves:
 * - Article: https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html
 * - Code: https://github.com/raphlinus/raphlinus.github.io/blob/master/_posts/2019-12-23-flatten-quadbez.md?plain=1#L73-L212
 *
 * Flattening of cubic Bézier curves: https://levien.com/tmp/flatten.html
 *
 * Note that the code in this module has a different license than the rest of the package,
 * due to the inclusion of Apache-licensed third party code.
 *
 * @license
 * Copyright 2022 Johannes Baiter <johannes.baiter@gmail.com>
 * Copyright 2019, 2022 Raph Levien <raph.levien@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yt(t,e,n,r=1){return new X(t,e,n).subdivide(r)}function vt(t,e,n,r,o=1){return new $(new Float64Array([t.x,t.y,e.x,e.y,n.x,n.y,r.x,r.y])).subdivide(o)}function dt(t){return t.x*t.x+t.y*t.y}function I(t){return t/(1-.67+Math.pow(Math.pow(.67,4)+.25*t*t,.25))}function q(t){return t*(1-.39+Math.sqrt(.39*.39+.25*t*t))}class X{constructor(e,n,r){this.start=e,this.control=n,this.end=r}eval(e){const n=1-e;return{x:this.start.x*n*n+2*this.control.x*n*e+this.end.x*e*e,y:this.start.y*n*n+2*this.control.y*n*e+this.end.y*e*e}}mapToBasic(){const{x:e,y:n}=this.start,{x:r,y:o}=this.control,{x:s,y:a}=this.end,i=2*r-e-s,u=2*o-n-a,f=(r-e)*i+(o-n)*u,h=(s-r)*i+(a-o)*u,y=(s-e)*u-(a-n)*i,A=f/y,d=h/y,c=Math.abs(y)/(Math.hypot(i,u)*Math.abs(d-A));return{x0:e,x2:s,scale:c,cross:y}}subdivide(e){const n=this.mapToBasic(),r=I(n.x0),o=I(n.x2),s=.5*Math.abs(o-r)*Math.sqrt(n.scale/e),a=Math.ceil(s),i=q(r),u=q(o),f=[0];for(let h=1;h<a;h++){const A=(q(r+(o-r)*h/a)-i)/(u-i);f.push(A)}return f.push(1),f.map(h=>this.eval(h))}}class ${constructor(e){this.c=e}weightsum(e,n,r,o){const s=e*this.c[0]+n*this.c[2]+r*this.c[4]+o*this.c[6],a=e*this.c[1]+n*this.c[3]+r*this.c[5]+o*this.c[7];return{x:s,y:a}}eval(e){const n=1-e,r=n*n*n,o=3*n*n*e,s=3*n*e*e,a=e*e*e;return this.weightsum(r,o,s,a)}deriv(e){const n=1-e,r=-3*n*n,o=3*e*e,s=-6*e*n-r,a=6*e*n-o;return this.weightsum(r,s,a,o)}midpoint_quadbez(){const e=this.weightsum(-.25,.75,.75,-.25);return new X({x:this.c[0],y:this.c[1]},e,{x:this.c[6],y:this.c[7]})}subsegment(e,n){const r=new Float64Array(8),o=this.eval(e),s=this.eval(n);r[0]=o.x,r[1]=o.y;const a=(n-e)/3,i=this.deriv(e);r[2]=o.x+a*i.x,r[3]=o.y+a*i.y;const u=this.deriv(n);return r[4]=s.x-a*u.x,r[5]=s.y-a*u.y,r[6]=s.x,r[7]=s.y,new $(r)}subdivide(e){const n=.1*e,r=e-n,o=Math.sqrt(r),s=dt(this.weightsum(1,-3,3,-1)),a=Math.ceil(Math.pow(s/(432*n*n),1/6)),i=[];let u=0;for(let c=0;c<a;c++){const w=c/a,x=(c+1)/a,b=this.subsegment(w,x).midpoint_quadbez(),l=b.mapToBasic(),p=I(l.x0),v=I(l.x2),g=Math.sqrt(l.scale);let m=Math.abs(v-p)*g;if(Math.sign(l.x0)!=Math.sign(l.x2)){const M=o/g,S=o*Math.abs(v-p)/I(M);m=Math.max(m,S)}i.push({quad:b,a0:p,a2:v,val:m}),u+=m}const f=.5*u/o,h=Math.ceil(f),y=[{x:this.c[0],y:this.c[1]}];let A=0,d=0;for(let c=1;c<h;c++){const w=u*c/h;for(;A+i[d].val<w;)A+=i[d].val,d++;const x=i[d].a0,b=i[d].a2,l=q(x),p=q(b),v=x+(b-x)*(w-A)/i[d].val,m=(q(v)-l)/(p-l);y.push(i[d].quad.eval(m))}return y.push({x:this.c[6],y:this.c[7]}),y}}const xt=/&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?),([0-9]+(?:\.[0-9]+)?)/,bt=/&?(t=)(npt:)?([0-9]+(.[0-9]+)?)?(,([0-9]+(.[0-9]+)?))?/,W=/^rgba\((\d+),(\d+),(\d+),([0-9.]+)\)$/;function z(t,{domParser:e,svgPreprocessor:n,iiifRenderingHints:r}={}){var o,s;if(Array.isArray(t))return C(t.reduce((a,i)=>{const{selector:u,selectors:f,iiifRenderingHints:h}=z(i,{domParser:e,svgPreprocessor:n,iiifRenderingHints:r});return u&&(a.selector||(a.selector=u),a.selectors.push(...f)),h&&(a.iiifRenderingHints=a.iiifRenderingHints||{type:"ImageApiSelector"},Object.assign(a.iiifRenderingHints,h)),a},{selector:null,selectors:[],iiifRenderingHints:r}));if(!t)return C({selector:null,selectors:[],iiifRenderingHints:r});if(typeof t=="string"){const[a,i]=t.split("#");return i?z({type:"FragmentSelector",value:i},{svgPreprocessor:n,iiifRenderingHints:r,domParser:e}):C({selector:null,selectors:[],iiifRenderingHints:r})}if(t.type&&t.type==="PointSelector"&&(t.t||t.t===0)){const a={type:"TemporalSelector",temporal:{startTime:t.t}};return C({selector:a,selectors:[a],iiifRenderingHints:r})}if(wt(t)){const a=[];if(t.region){const i=z({type:"FragmentSelector",value:"xywh="+t.region},{domParser:e,svgPreprocessor:n,iiifRenderingHints:r});a.push(...i.selectors)}return C({selector:a[0],selectors:a,iiifRenderingHints:r?{...r,...t}:t})}if(t.type==="FragmentSelector"){const a=xt.exec(t.value);if(a){const u={type:"BoxSelector",spatial:{unit:a[2]==="percent:"||a[2]==="pct:"?"percent":"pixel",x:parseFloat(a[3]),y:parseFloat(a[4]),width:parseFloat(a[5]),height:parseFloat(a[6])}};return C({selector:u,selectors:[u],iiifRenderingHints:r})}const i=t.value.match(bt);if(i){const u={type:"TemporalSelector",temporal:{startTime:i[4]?parseFloat(i[4]):0,endTime:i[7]?parseFloat(i[7]):void 0}};return C({selector:u,selectors:[u],iiifRenderingHints:r})}return C({selector:null,selectors:[],iiifRenderingHints:r})}if(t.type==="SvgSelector"&&"value"in t){e||(typeof window!="undefined"?e=new window.DOMParser:console.warn("No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized."));let a=[],i,u,f=(o=n==null?void 0:n(t.value))!=null?o:t.value,h;if(e){const A=e.parseFromString(t.value,"image/svg+xml").querySelector("svg");if(!A)return console.warn(`Illegal SVG selector: ${t.value}`),C({selector:null,selectors:[],iiifRenderingHints:r});const d=G(A);d&&(a=d.points,h=d.shapeType,i=[Math.min(...a.map(c=>c[0])),Math.min(...a.map(c=>c[1])),Math.max(...a.map(c=>c[0])),Math.max(...a.map(c=>c[1]))],{style:u,svg:f}=(s=At(d.element))!=null?s:{svg:f})}const y={type:"SvgSelector",svg:f,svgShape:h,style:u,points:a.length?a:void 0,spatial:i?{unit:"pixel",x:i[0],y:i[1],width:i[2]-i[0],height:i[3]-i[1]}:void 0};return C({selector:y,selectors:[y],iiifRenderingHints:r})}return C({selector:null,selectors:[],iiifRenderingHints:r})}function gt(t){const e=t.map(r=>r[0]).reduce((r,o)=>(r[o]+=1,r),{C:0,Q:0,L:0,M:0}),n=new Set(t.map(r=>r[0]));if(e.C>0||e.Q>0)return"path";if(e.L>0&&(n.size===1||n.size===2&&n.has("M"))){if(e.L===4)return"rect";const r=t.slice(-1)[0];return t[0][0]==="M"&&r[0]==="L"&&r[1]==t[0][1]&&r[2]===t[0][2]||r[1]===0&&r[2]===0?"polygon":"polyline"}return"path"}function G(t){var e,n,r,o,s,a,i,u,f,h,y,A,d,c,w,x,b;for(const l of Array.from(t.children))switch(l==null?void 0:l.tagName.toLowerCase()){case"g":{const p=G(l);if(p)return p}continue;case"path":{const p=l.getAttribute("d");if(!p)continue;const v=ht(p);return{element:l,points:mt(v),shapeType:gt(v)}}case"circle":{const p=parseFloat((e=l.getAttribute("cx"))!=null?e:"0"),v=parseFloat((n=l.getAttribute("cy"))!=null?n:"0"),g=parseFloat((r=l.getAttribute("r"))!=null?r:"0");if(!g)continue;const m=[];for(let M=0;M<=360;M+=12){const S=M*Math.PI/180;m.push([p+g*Math.cos(S),v+g*Math.sin(S)])}return{element:l,points:m,shapeType:"circle"}}case"ellipse":{const p=parseFloat((o=l.getAttribute("cx"))!=null?o:"0"),v=parseFloat((s=l.getAttribute("cy"))!=null?s:"0"),g=parseFloat((a=l.getAttribute("rx"))!=null?a:"0"),m=parseFloat((i=l.getAttribute("ry"))!=null?i:"0");if(!g&&!m)continue;const M=[];for(let S=0;S<=360;S+=12){const k=Math.tan(S/360*Math.PI),T=g*(1-k**2)/(1+k**2),F=m*2*k/(1+k**2);M.push([p+T,v+F])}return{element:l,points:M,shapeType:"ellipse"}}case"line":{const p=parseFloat((u=l.getAttribute("x0"))!=null?u:"0"),v=parseFloat((f=l.getAttribute("y0"))!=null?f:"0"),g=parseFloat((h=l.getAttribute("x1"))!=null?h:"0"),m=parseFloat((y=l.getAttribute("y1"))!=null?y:"0");if(p===g&&v===m)continue;return{element:l,points:[[p,v],[g,m]],shapeType:"polyline"}}case"polygon":case"polyline":{const p=(d=(A=l.getAttribute("points"))==null?void 0:A.split(" ").map(g=>g.split(",").map(parseFloat)))!=null?d:[];if(!p.length)continue;let v="polyline";return l.tagName.toLowerCase()==="polygon"&&(p.push(p[0]),v="polygon"),{element:l,points:p,shapeType:v}}case"rect":{const p=parseFloat((c=l.getAttribute("x"))!=null?c:"0"),v=parseFloat((w=l.getAttribute("y"))!=null?w:"0"),g=parseFloat((x=l.getAttribute("width"))!=null?x:"0"),m=parseFloat((b=l.getAttribute("height"))!=null?b:"0");if(!g||!m)continue;return{element:l,points:[[p,v],[p+g,v],[p+g,v+m],[p,v+m],[p,v]],shapeType:"rect"}}default:continue}return null}function mt(t){var n;const e=[];for(let r=0;r<t.length;r++){const o=(n=e[e.length-1])!=null?n:[0,0],s=t[r];switch(s[0]){case"M":case"L":e.push([s[1],s[2]]);continue;case"C":e.push(...vt({x:o[0],y:o[1]},{x:s[1],y:s[2]},{x:s[3],y:s[4]},{x:s[5],y:s[6]}).map(a=>[a.x,a.y]).slice(1));continue;case"Q":e.push(...yt({x:o[0],y:o[1]},{x:s[1],y:s[2]},{x:s[3],y:s[4]}).map(a=>[a.x,a.y]).slice(1));continue}}return e}function At(t){const e={};if(t.hasAttribute("fill")?(e.fill=t.getAttribute("fill"),t.removeAttribute("fill")):t.style.fill&&(e.fill=t.style.fill),e.fill){const r=W.exec(e.fill);r&&(e.fillOpacity=parseFloat(r[4]),e.fill=`rgb(${r[1]}, ${r[2]}, ${r[3]})`)}if(t.hasAttribute("fill-opacity")?(e.fillOpacity=parseFloat(t.getAttribute("fill-opacity")),t.removeAttribute("fill-opacity")):t.style.fillOpacity&&(e.fillOpacity=parseFloat(t.style.fillOpacity)),t.hasAttribute("stroke")?(e.stroke=t.getAttribute("stroke"),t.removeAttribute("stroke")):t.style.stroke&&(e.stroke=t.style.stroke),e.stroke){const r=W.exec(e.stroke);r&&(e.strokeOpacity=parseFloat(r[4]),e.stroke=`rgb(${r[1]}, ${r[2]}, ${r[3]})`)}t.hasAttribute("stroke-opacity")?(e.strokeOpacity=parseFloat(t.getAttribute("stroke-opacity")),t.removeAttribute("stroke-opacity")):t.style.strokeOpacity&&(e.strokeOpacity=parseFloat(t.style.strokeOpacity)),t.hasAttribute("stroke-width")?(e.strokeWidth=t.getAttribute("stroke-width"),t.removeAttribute("stroke-width")):t.style.strokeWidth&&(e.strokeWidth=t.style.strokeWidth),t.hasAttribute("stroke-dasharray")?(e.strokeDasharray=t.getAttribute("stroke-dasharray"),t.removeAttribute("stroke-dasharray")):t.style.strokeDasharray&&(e.strokeDasharray=t.style.strokeDasharray);let n=t;for(;n.tagName.toLowerCase()!=="svg";)if(n=n.parentElement,n===null)throw new Error("Could not find root SVG element");return{svg:n.outerHTML,style:Object.keys(e).length>0?e:void 0}}function wt(t){return!!t&&t.type==="iiif:ImageApiSelector"&&t.type==="iiif:ImageApiSelector"}function C(t){if(t.iiifRenderingHints){const e=t.iiifRenderingHints;if(e.rotation){const n=Mt(e.rotation);if(n)if(t.selectors.length)for(const r of t.selectors)r.rotation=n;else t.selectors.push({type:"RotationSelector",rotation:n})}}else delete t.iiifRenderingHints;return t}function Mt(t){let e=parseFloat(t);return e&&t.startsWith("!")&&(e=360-e),e&&(e=e%360),e!==e?0:e||0}function O(t,e={}){if(Array.isArray(t))return O(t[0]);if(typeof t=="string"){const[n,r]=t.split("#");return r?O({type:"SpecificResource",source:{id:n,type:"Unknown"},selector:{type:"FragmentSelector",value:r}}):{type:"SpecificResource",source:{id:n,type:e.typeMap&&e.typeMap[n]||"Unknown"},selector:null,selectors:[]}}if(t.type==="Choice"||t.type==="List"||t.type==="Composite"||t.type==="Independents")return O(t.items[0]);if(t.type==="SpecificResource"){t.source.type==="Canvas"&&t.source.partOf&&typeof t.source.partOf=="string"&&(t.source.partOf=[{id:t.source.partOf,type:"Manifest"}]);const{selector:n,selectors:r}=t.selector?z(t.selector,e):{selector:null,selectors:[]};return{type:"SpecificResource",source:t.source,selector:n,selectors:r}}if(t.id){t.type==="Canvas"&&t.partOf&&typeof t.partOf=="string"&&(t.partOf=[{id:t.partOf,type:"Manifest"}]);const[n,r]=t.id.split("#");return r?O({type:"SpecificResource",source:{...t,id:n},selector:{type:"FragmentSelector",value:r}}):{type:"SpecificResource",source:{...t,id:n},selector:null,selectors:[]}}return{type:"SpecificResource",source:t,selector:null,selectors:[]}}function N(t,e=!1){if(typeof t=="string"){if(t.startsWith("{"))try{const n=JSON.parse(t);return N(n)}catch{return[!1,{reason:"Invalid JSON"}]}return[!0]}if(Array.isArray(t)){for(const n of t){const[r,o]=N(n);if(!r&&o)return[r,o]}return[!0]}return t.type==="Annotation"?[!0]:e&&t.type==="Canvas"&&!t.partOf?[!1,{reason:"Canvas without partOf cannot be loaded"}]:[!0]}function St(t){return Y(typeof t=="string"?t:JSON.stringify(t))}function J(t,e){if(t=t.trim(),t[0]==="{")return e?Promise.resolve(JSON.parse(t)):JSON.parse(t);if(t.startsWith("http")){if(!e)throw new Error("Cannot fetch remote fetch with async=false in parseContentState");return fetch(t).then(n=>n.json())}return J(Z(t),e)}function Y(t){const e=encodeURIComponent(t);return(typeof btoa=="undefined"?Buffer.from(e,"utf-8").toString("base64"):btoa(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Z(t){const n=kt(t).replace(/-/g,"+").replace(/_/g,"/"),r=typeof atob=="undefined"?Buffer.from(n,"base64").toString("utf-8"):atob(n);return decodeURIComponent(r).trim()}function kt(t){const e=t.length%4;if(e===1)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return t+(e?"====".slice(0,4-e):"")}function Ct(t){if(!t)throw new Error("Content state is empty");Array.isArray(t)||(t=[t]);let e="vault://virtual-annotation/"+new Date().getTime();const n=[];for(const r of t){if(typeof r=="string")throw new Error("Content state is a [String] type and cannot be inferred");if(r.type==="Annotation"){if(e=r.id,Array.isArray(r.motivation))for(const s of r.motivation);if(Array.isArray(r.target))for(const s of r.target){const a=O(s);n.push(a)}else{const s=O(r.target);n.push(s)}continue}const o=O(r);n.push(o)}return{id:e,type:"Annotation",motivation:["contentState",...t.motivation||[]],target:n,extensions:{}}}exports.decodeContentState=Z;exports.encodeContentState=Y;exports.normaliseContentState=Ct;exports.parseContentState=J;exports.serialiseContentState=St;exports.validateContentState=N;
//# sourceMappingURL=content-state.js.map
