{"version":3,"file":"index.js","sources":["../../src/events.ts","../../src/styles.ts","../../node_modules/@atlas-viewer/iiif-image-api/dist/esm/index.mjs","../../src/thumbnail.ts","../../src/i18n.ts","../../node_modules/svg-arc-to-cubic-bezier/modules/index.js","../../node_modules/parse-svg-path/index.js","../../node_modules/abs-svg-path/index.js","../../src/annotation-targets/normalize-svg.ts","../../src/annotation-targets/bezier.ts","../../src/annotation-targets/parse-selector.ts","../../src/annotation-targets/expand-target.ts","../../src/content-state.ts","../../src/painting-annotations/parse-specific-resource.ts","../../src/painting-annotations/helper.ts","../../src/objects.ts","../../src/ranges.ts","../../src/sequences.ts"],"sourcesContent":["import type { Reference } from '@iiif/presentation-3';\nimport type { Vault } from '@iiif/vault';\n\nexport function createEventsHelper(vault: Vault) {\n  return {\n    addEventListener<T>(\n      resource: Reference<any>,\n      event: string,\n      listener: (e: any, resource: T) => void,\n      scope?: string[]\n    ) {\n      if (!resource) {\n        return;\n      }\n\n      vault.setMetaValue<Array<{ callback: any; scope?: string[] }>>(\n        [resource.id, 'eventManager', event],\n        (registeredCallbacks) => {\n          const callbacks = registeredCallbacks || [];\n          for (const registered of callbacks) {\n            if (registered.callback === listener) {\n              // @todo check for scopes matching, very edge-case as scopes should be fixed.\n              return callbacks;\n            }\n          }\n          return [...callbacks, { callback: listener, scope }];\n        }\n      );\n\n      return listener;\n    },\n\n    removeEventListener<T>(resource: Reference<any>, event: string, listener: (e: any, resource: T) => void) {\n      if (!resource) {\n        return;\n      }\n      vault.setMetaValue<Array<{ callback: () => void; scope?: string[] }>>(\n        [resource.id, 'eventManager', event],\n        (registeredCallbacks) => {\n          return (registeredCallbacks || []).filter((registeredCallback) => registeredCallback.callback !== listener);\n        }\n      );\n    },\n\n    getListenersAsProps(resourceOrId: string | Reference<any>, scope?: string[]) {\n      const resource = typeof resourceOrId === 'string' ? { id: resourceOrId } : resourceOrId;\n      if (!resource || !resource.id) {\n        return {};\n      }\n      const hooks = vault.getResourceMeta(resource.id, 'eventManager');\n      const props: any = {};\n      if (hooks && resource) {\n        for (const hook of Object.keys(hooks)) {\n          props[hook] = (e: any) => {\n            const fullResource = vault.get(resource);\n            for (const { callback, scope: _scope } of hooks[hook] || []) {\n              if (!_scope || (scope && _scope.indexOf(scope) !== -1)) {\n                callback(e, fullResource);\n              }\n            }\n          };\n        }\n      }\n      return props;\n    },\n  };\n}\n","import type { Vault } from '@iiif/vault';\nimport { Reference } from '@iiif/presentation-3';\n\nexport type StyleDefinition = Record<string, any>;\n\nexport type StyledHelper<S extends StyleDefinition> = {\n  applyStyles<Style extends StyleDefinition = S>(resource: any, scope: string, styles: Style[string]): void;\n  getAppliedStyles<Style extends StyleDefinition = S>(resource: any): Style | undefined;\n};\n\nexport function createStylesHelper<S extends StyleDefinition>(vault: Vault): StyledHelper<S> {\n  return {\n    applyStyles<Style extends StyleDefinition = S>(\n      resource: string | Reference<any>,\n      scope: string,\n      styles: Style[string]\n    ) {\n      const id = typeof resource === 'string' ? resource : resource.id;\n      return vault.setMetaValue<Style[string]>([id, 'styles', scope], styles);\n    },\n    getAppliedStyles<Style extends StyleDefinition = S>(resource: string | Reference<any>): Style | undefined {\n      const id = typeof resource === 'string' ? resource : resource.id;\n      return vault.getResourceMeta<{ styles: Style }, 'styles'>(id, 'styles');\n    },\n  };\n}\n","function p(e){return e.endsWith(\"info.json\")?e:e.endsWith(\"/\")?`${e}info.json`:`${e}/info.json`}const Y=\"http://library.stanford.edu/iiif/image-api/compliance.html#level0\",F=\"http://library.stanford.edu/iiif/image-api/compliance.html#level1\",v=\"http://library.stanford.edu/iiif/image-api/compliance.html#level2\",q=\"http://library.stanford.edu/iiif/image-api/conformance.html#level0\",O=\"http://library.stanford.edu/iiif/image-api/conformance.html#level1\",z=\"http://library.stanford.edu/iiif/image-api/conformance.html#level2\",ii=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0\",A=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1\",E=\"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2\",ei=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0\",L=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1\",b=\"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2\",ti=\"http://iiif.io/api/image/1/level0.json\",ri=\"http://iiif.io/api/image/1/profiles/level0.json\",M=\"http://iiif.io/api/image/1/level1.json\",j=\"http://iiif.io/api/image/1/profiles/level1.json\",W=\"http://iiif.io/api/image/1/level2.json\",P=\"http://iiif.io/api/image/1/profiles/level2.json\",ni=\"http://iiif.io/api/image/2/level0.json\",si=\"http://iiif.io/api/image/2/profiles/level0.json\",C=\"http://iiif.io/api/image/2/level1.json\",B=\"http://iiif.io/api/image/2/profiles/level1.json\",N=\"http://iiif.io/api/image/2/level2.json\",R=\"http://iiif.io/api/image/2/profiles/level2.json\",ai=\"level0\",$=\"level1\",H=\"level2\",oi=\"http://iiif.io/api/image/2/level0\",G=\"http://iiif.io/api/image/2/level1\",T=\"http://iiif.io/api/image/2/level2\",k=[T,v,z,E,b,W,P,N,R,H],Q=[...k,G,F,O,A,L,M,j,C,B,$],V=[oi,G,T,Y,F,v,q,O,z,ii,A,E,ei,L,b,ti,ri,M,j,W,P,ni,si,C,B,N,R,ai,$,H],Hi=V,fi={extraFormats:[\"jpg\"],extraQualities:[\"default\"],extraFeatures:[\"sizeByWhListed\"]},li={extraFormats:[\"jpg\"],extraQualities:[\"default\"],extraFeatures:[\"baseUriRedirect\",\"cors\",\"jsonldMediaType\",\"regionByPx\",\"regionSquare\",\"sizeByWhListed\",\"sizeByH\",\"sizeByW\",\"sizeByWh\"]},hi={extraFormats:[\"jpg\",\"png\"],extraQualities:[\"default\"],extraFeatures:[\"baseUriRedirect\",\"cors\",\"jsonldMediaType\",\"regionByPct\",\"regionByPx\",\"regionSquare\",\"rotationBy90s\",\"sizeByWhListed\",\"sizeByConfinedWh\",\"sizeByH\",\"sizeByPct\",\"sizeByW\",\"sizeByWh\"]},D=[\"baseUriRedirect\",\"canonicalLinkHeader\",\"cors\",\"jsonldMediaType\",\"mirroring\",\"profileLinkHeader\",\"regionByPct\",\"regionByPx\",\"regionSquare\",\"rotationArbitrary\",\"rotationBy90s\",\"sizeByConfinedWh\",\"sizeByH\",\"sizeByPct\",\"sizeByW\",\"sizeByWh\",\"sizeUpscaling\",\"sizeByWhListed\",\"sizeByDistortedWh\",\"sizeByForcedWh\"];function ui(e){return k.indexOf(e)!==-1?hi:Q.indexOf(e)!==-1?li:fi}function U(e){const i=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],t={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let r of i)if(typeof r==\"string\"&&(r=ui(r)),!!r){if(r.formats)for(const n of r.formats)t.extraFormats.indexOf(n)===-1&&t.extraFormats.push(n);if(r.qualities)for(const n of r.qualities)t.extraQualities.indexOf(n)===-1&&t.extraQualities.push(n);if(r.supports)for(const n of r.supports)t.extraFeatures.indexOf(n)===-1&&t.extraFeatures.push(n);if(r.maxHeight&&(t.maxHeight=r.maxHeight),r.maxWidth&&(t.maxWidth=r.maxWidth),r.maxArea&&(t.maxArea=r.maxArea),r.extraFormats)for(const n of r.extraFormats)t.extraFormats.indexOf(n)===-1&&t.extraFormats.push(n);if(r.extraQualities)for(const n of r.extraQualities)t.extraQualities.indexOf(n)===-1&&t.extraQualities.push(n);if(r.extraFeatures)for(const n of r.extraFeatures)t.extraFeatures.indexOf(n)===-1&&t.extraFeatures.push(n);r.maxHeight&&(t.maxHeight=r.maxHeight),r.maxWidth&&(t.maxWidth=r.maxWidth),r.maxArea&&(t.maxArea=r.maxArea)}if(e.extraFormats)for(const r of e.extraFormats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(e.extraFeatures)for(const r of e.extraFeatures)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);if(e.extraQualities)for(const r of e.extraQualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);return t}function ci(e){try{if(e===\"full\")return{full:!0};if(e===\"square\")return{square:!0};const i=e.startsWith(\"pct:\"),r=e.substr(i?4:0).split(\",\").map(n=>parseFloat(n));return{x:r[0],y:r[1],w:r[2],h:r[3],percent:i}}catch{throw new Error(\"Expected 'full', 'square' or 'x,y,w,h'. Found \"+e)}}function di(e){const i={upscaled:!1,max:!1,confined:!1};if(e[0]===\"^\"&&(i.upscaled=!0,e=e.slice(1)),e===\"max\"||e===\"full\")return i.max=!0,i.serialiseAsFull=e===\"full\",i;if(e[0]===\"!\"&&(i.confined=!0,e=e.slice(1)),e[0]===\"p\")return i.percentScale=parseFloat(e.slice(4)),i;const t=e.split(\",\").map(r=>r.trim());return t.length&&(t[0]!==\"\"&&(i.width=parseInt(t[0],10)),t[1]!==\"\"&&(i.height=parseInt(t[1],10))),i}function pi(e){const i={angle:0};if(e[0]===\"!\"&&(i.mirror=!0,e=e.substr(1)),i.angle=parseFloat(e)%360,Number.isNaN(i.angle))throw new Error(`Invalid rotation ${e}`);return i}function gi(e,i=\"\"){const t=e.match(/^(([a-zA-Z]+):\\/\\/([^/]+))?((.*)+)/);if(!t)throw new Error(`Invalid or unknown input ${e}`);const r=t[2],n=t[3];let s=t[4];if(s[0]===\"/\"&&(s=s.substr(1)),i.length>0){if(i[0]===\"/\"&&(i=i.substr(1)),i!==s.substr(0,i.length))throw new Error(`Path does not start with prefix (path: ${s}, prefix: ${i})`);s=s.substr(i.length)}return{scheme:r,server:n,path:s,prefix:i}}function mi(e,i=\"\"){const{path:t,scheme:r,server:n,prefix:s}=gi(e,i),a=t.split(\"/\").reverse(),[o,l,f,u,...I]=a,d=I.reverse().filter(Boolean).join(\"/\");if(a.length===1||o===\"\")return{type:\"base\",scheme:r,server:n,prefix:s,identifier:d};if(o===\"info.json\"){const[,...g]=a;return{type:\"info\",scheme:r,server:n,prefix:s,identifier:g.reverse().filter(Boolean).join(\"/\")}}const c=o.split(\".\");return{type:\"image\",scheme:r,server:n,prefix:s,identifier:d,originalPath:t,region:ci(u),size:di(f),rotation:pi(l),quality:c[0],format:c[1]}}function xi(e){const i=mi(p(e.id));if(i.type!==\"info\")throw new Error(\"Invalid service URL\");const t=U(e);return{identifier:i.identifier,originalPath:\"\",server:i.server,prefix:i.prefix,scheme:i.scheme,type:\"image\",quality:t.extraQualities.indexOf(\"default\")===-1?t.extraQualities[0]:\"default\",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:\"jpg\",rotation:{angle:0}}}function Ii(e,i,t){const r=t.length,n=[];for(let s=0;s<r;s++){const o=t[s].width;n.push(e/o)}return n}function _i(e,i,t){const r=t.length,n=[];for(let s=0;s<r;s++){const a=t[s];n.push({width:Math.floor(e/a),height:Math.floor(i/a)})}return n}function h(e){if(e[\"@id\"])return e[\"@id\"];if(e.id)return e.id}function _(e){if(!e||!e.profile||!h(e))return!1;const i=Array.isArray(e.profile)?e.profile:[e.profile];for(const t of i)if(typeof t==\"string\"&&V.indexOf(t)!==-1)return!0;return!1}function yi(e){if(!_(e))return!1;const i=Array.isArray(e.profile)?e.profile:[e.profile];for(const t of i)if(typeof t==\"string\"){if(Q.indexOf(t)!==-1)return!0}else{const r=[...t.supports||[],...t.extraFeatures||[]];if(r.indexOf(\"regionByPx\")!==-1&&(r.indexOf(\"sizeByW\")!==-1||r.indexOf(\"sizeByWh\")!==-1))return!0}return!1}function wi(e){if(!yi(e))return[];const i=[],t=Array.isArray(e.profile)?e.profile:[e.profile],r=t.length;for(let n=0;n<r;n++){const s=t[n];if(typeof s!=\"string\"&&(s.maxHeight||s.maxWidth))return[{id:h(e),type:\"variable\",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight}]}if(e.tiles){const n=e.tiles.length;for(let s=0;s<n;s++){const a=e.tiles[s];(a.height||a.width)&&i.push({id:h(e),type:\"variable\",minHeight:0,minWidth:0,maxHeight:a.height||a.width,maxWidth:a.width})}}return i}function J(e){const i=/^.*\\/(full)\\/(((\\d+),(\\d+)?)|max)\\/(\\d+)\\/default\\.(jpg|png|jpeg)$/,t=e.match(i);if(t){const r=t[1],n=parseInt(t[4],10),s=parseInt(t[5],10),a=t[7];if((r===\"max\"||r===\"full\")&&n&&s&&a)return{type:\"fixed\",id:e,height:s,width:n}}return{type:\"unknown\",id:e}}function Si(e){if(e[\"@type\"])return e[\"@type\"];if(e.type)return e.type}function Fi(e){if(typeof e==\"string\")return J(e);const i=Si(e);if(i!==\"Image\"&&i!==\"sc:Image\")return null;const t=e,r=h(t);return r?r&&t.width&&t.height?{id:r,type:\"fixed\",width:t.width,height:t.height,unsafe:!0}:J(r):null}function vi(e){return _(e)?(e&&e.sizes?e.sizes:[]).map(i=>({id:h(e),type:\"fixed-service\",height:i.height,width:i.width})):[]}function Z(e){const i=[],t=e.length;for(let r=0;r<t;r++){const n=vi(e[r]);n.length&&i.push(...n);const s=wi(e[r]);s.length&&i.push(...s)}return i}function K(e){const i=e.service?Array.isArray(e.service)?e.service:[e.service]:[],t=i.length,r=[];for(let n=0;n<t;n++)_(i[n])&&r.push(i[n]);return r}function Oi(e,i=!0,t){const r=[],n=Fi(e);if(n===null)return r;const s=e;if(r.push(n),i&&s.width&&s.height){const a=[],o=K(s);for(const l of o){const f={id:h(l),width:s.width,height:s.height};if(t.canLoadSync(f)){const u=t.loadServiceSync(f);u&&(u.height||(u.height=s.height),u.width||(u.width=s.width),a.push(...Z([u])))}}if(a.length)return r.push(...a),r}return s.service&&r.push(...Z(s.service)),r}function zi({x:e=0,y:i=0,w:t,h:r,full:n,square:s,percent:a}){if(n)return\"full\";if(s)return\"square\";if(typeof t>\"u\"||typeof r>\"u\")throw new Error(\"RegionParameter: invalid region\");const o=`${e},${i},${t},${r}`;return a?`pct:${o}`:o}function Ai({max:e,percentScale:i,upscaled:t,confined:r,width:n,height:s,serialiseAsFull:a}){const o=[];return t&&o.push(\"^\"),e?(o.push(a?\"full\":\"max\"),o.join(\"\")):(r&&o.push(\"!\"),i&&o.push(`pct:${i}`),n&&o.push(`${n}`),o.push(\",\"),s&&o.push(`${s}`),o.join(\"\"))}function Ei(e){return`${e.mirror?\"!\":\"\"}${(e.angle||0)%360}`}var Gi=Object.defineProperty,Ti=Object.defineProperties,ki=Object.getOwnPropertyDescriptors,Li=Object.getOwnPropertySymbols,Qi=Object.prototype.hasOwnProperty,Vi=Object.prototype.propertyIsEnumerable,bi=(e,i,t)=>i in e?Gi(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,y=(e,i)=>{for(var t in i||(i={}))Qi.call(i,t)&&bi(e,t,i[t]);if(Li)for(var t of Li(i))Vi.call(i,t)&&bi(e,t,i[t]);return e},w=(e,i)=>Ti(e,ki(i));function Mi(e,i){const t=e.prefix.startsWith(\"/\")?e.prefix.substr(1):e.prefix,r=`${e.scheme}://${e.server}/${t?`${t}/`:\"\"}${e.identifier}`;if(e.type===\"base\")return r;if(e.type===\"info\")return`${r}/info.json`;let{region:n,size:s,rotation:a,format:o,quality:l}=e;if(i){const f=i[\"@context\"]?Array.isArray(i[\"@context\"])?i[\"@context\"]:[i[\"@context\"]]:[],u=f.indexOf(\"http://iiif.io/api/image/2/context.json\")!==-1,I=f.indexOf(\"http://iiif.io/api/image/3/context.json\")!==-1;if((s.width===i.width&&!s.height||s.height===i.height&&!s.width||s.width===i.width&&s.height===i.height)&&(s=w(y({},s),{max:!0})),u&&(s.max&&!s.serialiseAsFull&&(s=w(y({},s),{serialiseAsFull:!0})),!s.max&&s.width&&s.height&&(s=w(y({},s),{height:void 0}))),I&&(s.max&&s.serialiseAsFull&&(s=w(y({},s),{serialiseAsFull:!1})),s.width&&!s.height&&i.width&&i.height)){const d=i.height/i.width;s=w(y({},s),{height:Math.ceil(s.width*d)})}}return[r,zi(n),Ai(s),Ei(a),`${l}.${o}`].filter(Boolean).join(\"/\")}function S(e,i,t){const r=xi({id:p(h(e)),profile:\"level2\",type:\"ImageService2\"});if(r.type!==\"image\")throw new Error(\"Invalid service\");return r.size.max=!1,r.size.width=i,r.size.height=t,{id:Mi(r),type:\"fixed\",width:i,height:t||e.height/(e.width||1)*i,unsafe:e.width>i}}function m(e){const i=e.replace(/(https?:\\/\\/)?(www.)?/i,\"\");return i.indexOf(\"/\")!==-1?i.split(\"/\")[0]:i}function Di(e){if(!e.width||!e.height)return null;if(e.tiles){const i=e.tiles.sort((r,n)=>Math.max(...n.scaleFactors)-Math.max(...r.scaleFactors)),t=i.length;for(let r=0;r<t;r++){const n=i[r],s=n.width;if(!s)continue;const a=n.scaleFactors.length,o=n.scaleFactors.sort();for(let l=0;l<a;l++){const f=o[l];if(e.width/f<=s&&e.height/f<=s)return{id:h(e),type:\"fixed-service\",width:e.width/f|0,height:e.height/f|0}}}}return null}function X(e,i){if(!_(e))return[!1,\"Not a valid image service\"];i.extraFeatures=i.extraFeatures?i.extraFeatures:[];const t=U(e);if(i.exactSize){let r=!1;if(e.sizes)for(const n of e.sizes)n.width&&n.width===i.exactSize.width&&(D.indexOf(\"sizeByW\")!==-1||n.height&&n.height===i.exactSize.height)&&(r=!0),n.height&&n.height===i.exactSize.height&&(D.indexOf(\"sizeByH\")!==-1||n.width&&n.width===i.exactSize.width)&&(r=!0);r||(i.maxWidth=Math.max(i.maxWidth||0,i.exactSize.width||0)||void 0,i.maxHeight=Math.max(i.maxHeight||0,i.exactSize.height||0)||void 0,i.maxArea=Math.max(i.maxArea||0,(i.exactSize.width&&i.exactSize.height?i.exactSize.width*i.exactSize.height:i.maxArea)||0)||void 0,!i.exactSize.height&&i.exactSize.width?i.extraFeatures.indexOf(\"sizeByW\")===-1&&i.extraFeatures.push(\"sizeByW\"):!i.exactSize.width&&i.exactSize.height&&i.extraFeatures.indexOf(\"sizeByH\")===-1&&i.extraFeatures.push(\"sizeByH\"))}if(i.maxArea&&t.maxArea&&i.maxArea>t.maxArea)return[!1,`Max area is ${t.maxArea}`];if(i.maxWidth&&t.maxWidth&&i.maxWidth>t.maxWidth)return[!1,`Max width is ${t.maxWidth}`];if(i.maxHeight&&t.maxHeight&&i.maxHeight>t.maxHeight)return[!1,`Max height is ${t.maxHeight}`];if(i.extraFeatures){const r=[];for(const n of i.extraFeatures)t.extraFeatures.indexOf(n)===-1&&r.push(n);if(r.length)return[!1,`Missing features: ${r.join(\", \")}`]}if(i.extraFormats){const r=[];for(const n of i.extraFormats)t.extraFormats.indexOf(n)===-1&&r.push(n);if(r.length)return[!1,`Missing formats: ${r.join(\", \")}`]}if(i.extraQualities){const r=[];for(const n of i.extraQualities)t.extraQualities.indexOf(n)===-1&&r.push(n);if(r.length)return[!1,`Missing qualities: ${r.join(\", \")}`]}return[!0]}function Ui(e,i){return X(e,{extraFormats:[i]})}function Ji(e,i){if(i.type!==\"image\")return[!0];const t=[];i.rotation.mirror&&t.push(\"mirroring\"),i.region.percent&&t.push(\"regionByPct\"),i.region.square?t.push(\"regionSquare\"):i.region.full||t.push(\"regionByPx\"),i.rotation.angle&&(i.rotation.angle%90?t.push(\"rotationArbitrary\"):t.push(\"rotationBy90s\")),i.size.confined&&t.push(\"sizeByConfinedWh\"),!i.size.width&&i.size.height&&t.push(\"sizeByH\"),i.size.percentScale&&t.push(\"sizeByPct\"),(e.sizes||[]).find(a=>a.width===i.size.width&&!i.size.height||a.height===i.size.height&&!i.size.width||a.height===i.size.height&&a.width===i.size.width)?t.push(\"sizeByWhListed\"):(i.size.width&&!i.size.height&&t.push(\"sizeByW\"),i.size.width&&i.size.height&&t.push(\"sizeByWh\")),i.size.upscaled&&t.push(\"sizeUpscaling\");const[n,s]=X(e,{extraFeatures:t,extraQualities:[i.quality],extraFormats:[i.format],exactSize:i.size});return n?[!0]:[!1,s]}function ji(e,i,t){const r=e.width?e.width:e.maxWidth;return t.height<=e.maxHeight&&t.width<=e.maxWidth&&t.height>=e.minHeight&&t.width>=e.minWidth&&(!i||Math.abs(t.width-r)<Math.abs(i.width-r))}function Wi(e,i){const t=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=[],s=[];let a=null;const o=(f,u)=>{if(ji(r,u,f)){if(r.preferFixedSize&&f.unsafe){s.push(f);return}r.returnAllOptions&&u&&s.push(u),a=f}else r.returnAllOptions&&s.push(f)},l=i.length;for(let f=0;f<l;f++){const u=i[f](),I=u.length;for(let d=0;d<I;d++){const c=u[d];if(c.type===\"unknown\"&&r.atAnyCost&&n.push(c),c.type===\"fixed\"&&(c.unsafe?n.push(c):o(c,a)),c.type===\"fixed-service\")if(r.unsafeImageService){const g=S(c,r.width,r.height);o(g,a)}else{const g=S(c,c.width,c.height);o(g,a)}if(c.type===\"variable\"&&c.maxWidth){const g=S({id:c.id,type:\"fixed-service\",width:c.maxWidth,height:c.maxWidth},c.maxWidth);o(g,a)}}if(a&&!r.returnAllOptions){if(a.unsafe||r.allowUnsafe)continue;break}}return r.atAnyCost&&s.length===0?{best:a||n[0],fallback:n.slice(1),log:t}:r.returnAllOptions?{best:r.atAnyCost?a||s[0]||n[0]:a||s[0],fallback:[...s,...n],log:t}:{best:a||s[0]||null,fallback:a?s:s.slice(1),log:t}}var Zi=Object.defineProperty,Ki=Object.defineProperties,Xi=Object.getOwnPropertyDescriptors,Pi=Object.getOwnPropertySymbols,Yi=Object.prototype.hasOwnProperty,qi=Object.prototype.propertyIsEnumerable,Ci=(e,i,t)=>i in e?Zi(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,ie=(e,i)=>{for(var t in i||(i={}))Yi.call(i,t)&&Ci(e,t,i[t]);if(Pi)for(var t of Pi(i))qi.call(i,t)&&Ci(e,t,i[t]);return e},ee=(e,i)=>Ki(e,Xi(i));function Bi(e,i,t){const r=e>i?e:i,n=t.length,s=[];for(let a=0;a<n;a++){const o=t[a];let l=o.scaleFactors[0],f=r/l;const u=[l];for(;f>=o.width;)l=l*2,u.push(l),f=f/2;s.push(ee(ie({},o),{scaleFactors:u}))}return s}function Ni(e,i){if(e.length!==i.length)return!1;if(e.length===0&&i.length===0)return!0;const t=e.length;let r=!0;for(let s=0;s<t;s++){const a=e[s],o=i[s];if(a.width!==o.width||a.height!==o.height){r=!1;break}}if(r)return!0;let n=0;for(let s=0;s<t;s++)for(let a=0;a<t;a++)if(e[s].width===i[a].width&&e[s].height===i[a].height){n++;break}return n===t}function Ri(e){if(e&&e.profile){const i=e.profile;if(i){const t=Array.isArray(i)?i:[i];return t.includes(\"level0\")||t.includes(\"http://iiif.io/api/image/2/level0.json\")||t.includes(\"http://iiif.io/api/image/1/level0.json\")||t.includes(\"http://iiif.io/api/image/1/profiles/level0.json\")}}return!1}var x=(e,i,t)=>new Promise((r,n)=>{var s=l=>{try{o(t.next(l))}catch(f){n(f)}},a=l=>{try{o(t.throw(l))}catch(f){n(f)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(e,i)).next())});class $i{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(i){Object.assign(this.config,i)}sample(i,t,r=!0){const n=m(h(i)),s=p(h(i)),a=this.knownImageServers[n];return this.imageServices[s]=Object.assign(i,{real:!0}),!a&&i.tiles&&!Ri(i)?(this.knownImageServers[n]={verifications:0,malformed:!1,root:n,preLoaded:r,sampledId:h(i),verified:!1,server:null,result:{context:i[\"@context\"]||[],sampledProfile:i.profile,resourceServiceRatio:t&&i.height?t.height/i.height:1,sampledSizes:i.sizes||[],sizeRatios:Ii(i.width,i.height,i.sizes||[]),sampledTiles:i.tiles||[]}},!0):this.verify(i)}preLoad(i,t=!0){this.knownImageServers[i.root]=i,t&&(this.knownImageServers[i.root].malformed=!1,this.knownImageServers[i.root].verifications=this.config.verificationsRequired)}predict(i,t=!1,r=!1){const n=i==null?void 0:i.source,s=m(h(i)),a=this.knownImageServers[s];if(!a||!a.result||!r&&(a.malformed||a.verifications<this.config.verificationsRequired)||Ri(i.source))return null;const o=p(h(i));return this.imageServices[o]||(this.imageServices[o]={\"@context\":a.result.context,\"@id\":h(i),id:h(i),protocol:\"http://iiif.io/api/image\",tiles:(n==null?void 0:n.tiles)||Bi(i.width,i.height,a.result.sampledTiles),sizes:(n==null?void 0:n.sizes)||_i(Math.round(i.width/a.result.resourceServiceRatio),Math.round(i.height/a.result.resourceServiceRatio),a.result.sizeRatios),profile:(n==null?void 0:n.profile)||a.result.sampledProfile,height:(n==null?void 0:n.height)||i.height,width:(n==null?void 0:n.width)||i.width,real:!1}),this.imageServices[o]}getThumbnailFromResource(i,t){return x(this,arguments,function*(r,n,s=!0,a=[]){const o=yield this.getImageCandidates(r,s);return Wi(n,[()=>a,()=>o])})}getImageCandidates(i,t=!0){return x(this,null,function*(){const r=i;if(t&&r.height&&r.width){const n=K(r);for(const s of n){const a={id:h(s),width:s.width?s.width:r.width,height:s.height?s.height:r.height,source:s};yield this.loadService(a)}}return Oi(i,t,this)})}verify(i){return x(this,null,function*(){const t=this.predict(i,!1,!0),r=yield this.fetchService(h(i));if(!t)return!1;const n=t.height===r.height&&t.width===r.width&&t[\"@context\"]===r[\"@context\"]&&Ni(t.sizes||[],r.sizes||[]);if(n){const s=m(h(i));this.knownImageServers[s].verifications+=1,this.knownImageServers[s].verifications>=this.config.verificationsRequired&&(this.knownImageServers[s].verified=!0)}return n})}canLoadSync(i){const t=typeof i==\"string\"?i:h(i),r=p(t);if(this.imageServices[r])return!0;const n=this.knownImageServers[m(t)];return n&&!n.malformed&&n.verifications>=this.config.verificationsRequired}markAsMalformed(i){return x(this,null,function*(){return this.knownImageServers[m(h(i))].malformed=!0,this.loadService(i,!0)})}fetchService(i,t=!1){return x(this,null,function*(){const r=p(i);if(this.imageServices[r]&&(!t||this.imageServices[r].real))return this.imageServices[r];if(!this.config.enableFetching)throw new Error(\"Fetching is not enabled\");const n=yield this.fetch(r).then(s=>s.json());return!n.id&&n[\"@id\"]&&(n.id=n[\"@id\"]),n.id!==i&&(n.id=i,n[\"@id\"]&&(n[\"@id\"]=i)),this.imageServices[r]=Object.assign(n,{real:!0}),this.imageServices[r]})}fetch(i,t){return x(this,null,function*(){return fetch(i,t)})}loadService(i,t=!1){return x(this,null,function*(){if(!this.config.disableThrottling){let s=!0;for(;s;)if(this.fetchingCount>=this.config.verificationsRequired)yield new Promise(a=>setTimeout(a,500));else{s=!1;break}}const r=this.knownImageServers[m(h(i))];if(r&&!r.malformed&&!t){yield r.result;const s=this.loadServiceSync(i);if(s)return s}this.fetchingCount++;const n=yield this.fetchService(h(i),t);return this.fetchingCount--,n.real&&this.sample(n,i),n})}loadServiceSync(i){const t=p(h(i));return this.imageServices[t]?this.imageServices[t]:this.predict(i)}}const te=new $i;export{ti as IIIF_1_IMAGE_LEVEL_0,ri as IIIF_1_IMAGE_LEVEL_0_PROFILE,M as IIIF_1_IMAGE_LEVEL_1,j as IIIF_1_IMAGE_LEVEL_1_PROFILE,W as IIIF_1_IMAGE_LEVEL_2,P as IIIF_1_IMAGE_LEVEL_2_PROFILE,ni as IIIF_2_IMAGE_LEVEL_0,oi as IIIF_2_IMAGE_LEVEL_0_NO_JSON,si as IIIF_2_IMAGE_LEVEL_0_PROFILE,C as IIIF_2_IMAGE_LEVEL_1,G as IIIF_2_IMAGE_LEVEL_1_NO_JSON,B as IIIF_2_IMAGE_LEVEL_1_PROFILE,N as IIIF_2_IMAGE_LEVEL_2,T as IIIF_2_IMAGE_LEVEL_2_NO_JSON,R as IIIF_2_IMAGE_LEVEL_2_PROFILE,ai as IIIF_3_IMAGE_LEVEL_0,$ as IIIF_3_IMAGE_LEVEL_1,H as IIIF_3_IMAGE_LEVEL_2,$i as ImageServiceLoader,ii as STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,A as STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,E as STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,ei as STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,L as STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,b as STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,Y as STANFORD_IIIF_IMAGE_COMPLIANCE_0,F as STANFORD_IIIF_IMAGE_COMPLIANCE_1,v as STANFORD_IIIF_IMAGE_COMPLIANCE_2,q as STANFORD_IIIF_IMAGE_CONFORMANCE_0,O as STANFORD_IIIF_IMAGE_CONFORMANCE_1,z as STANFORD_IIIF_IMAGE_CONFORMANCE_2,p as canonicalServiceUrl,U as combineProfiles,xi as createImageServiceRequest,D as extraFeatures,Ii as extractFixedSizeScales,_i as fixedSizesFromScales,wi as getCustomSizeFromService,Fi as getFixedSizeFromImage,vi as getFixedSizesFromService,h as getId,Oi as getImageCandidates,Z as getImageCandidatesFromService,S as getImageFromTileSource,m as getImageServerFromId,K as getImageServices,Di as getSmallestScaleFactorAsSingleImage,Si as getType,te as imageServiceLoader,V as imageServiceProfiles,Mi as imageServiceRequestToString,Ui as imageServiceSupportsFormat,Ji as imageServiceSupportsRequest,J as inferSizeFromUrl,ji as isBestMatch,_ as isImageService,fi as level0,Hi as level0Support,li as level1,Q as level1Support,hi as level2,k as level2Support,ui as levelToProfile,mi as parseImageServiceRequest,gi as parseImageServiceUrl,ci as parseRegionParameter,pi as parseRotationParameter,di as parseSizeParameter,Wi as pickBestFromCandidates,zi as regionParameterToString,Ei as rotationParameterToString,Bi as sampledTilesToTiles,Ai as sizeParameterToString,Ni as sizesMatch,X as supports,yi as supportsCustomSizes};\n","import {\n  AnnotationNormalized,\n  AnnotationPageNormalized,\n  CanvasNormalized,\n  ChoiceBody,\n  CollectionItemSchemas,\n  CollectionNormalized,\n  ContentResource,\n  ManifestNormalized,\n  Reference,\n} from '@iiif/presentation-3';\nimport { Vault } from '@iiif/vault';\nimport {\n  FixedSizeImage,\n  FixedSizeImageService,\n  getFixedSizeFromImage,\n  ImageCandidate,\n  ImageCandidateRequest,\n  ImageServiceLoader,\n  UnknownSizeImage,\n  VariableSizeImage,\n} from '@atlas-viewer/iiif-image-api';\n\nexport function createThumbnailHelper(vault: Vault, dependencies: { imageServiceLoader?: ImageServiceLoader } = {}) {\n  const imageServiceLoader = dependencies.imageServiceLoader || new ImageServiceLoader();\n\n  async function getBestThumbnailAtSize(\n    input:\n      | string\n      | Reference<CollectionItemSchemas>\n      | Reference<'Collection'>\n      | Reference<'Manifest'>\n      | Reference<'Canvas'>\n      | Reference<'Annotation'>\n      | Reference<'AnnotationPage'>\n      | Reference<'ContentResource'>\n      | CollectionNormalized\n      | ManifestNormalized\n      | CanvasNormalized\n      | AnnotationNormalized\n      | AnnotationPageNormalized\n      | ContentResource,\n    request: ImageCandidateRequest,\n    dereference?: boolean,\n    candidates: Array<ImageCandidate> = [],\n    dimensions?: { width: number; height: number }\n  ): Promise<{\n    best: null | undefined | FixedSizeImage | FixedSizeImageService | VariableSizeImage | UnknownSizeImage;\n    fallback: Array<ImageCandidate>;\n    log: string[];\n  }> {\n    if (typeof input === 'string') {\n      // Best shot we have.\n      return { best: getFixedSizeFromImage(input as any), fallback: [], log: [] };\n    }\n\n    // Run through from ref, just in case.\n    const fullInput:\n      | string\n      | ManifestNormalized\n      | CollectionNormalized\n      | CanvasNormalized\n      | AnnotationNormalized\n      | AnnotationPageNormalized\n      | ContentResource = vault.get(input as any) as any;\n\n    if (typeof fullInput === 'string') {\n      return { best: getFixedSizeFromImage(fullInput as any), fallback: [], log: [] };\n    }\n\n    switch (fullInput.type) {\n      case 'Annotation': {\n        // Grab the body.\n        const contentResources = fullInput.body;\n        // @todo this could be configuration.\n        const firstContentResources = vault.get<ContentResource>(contentResources[0]);\n        if (dimensions && !(firstContentResources as any).width) {\n          (firstContentResources as any).width = dimensions.width;\n          (firstContentResources as any).height = dimensions.height;\n        }\n\n        return await imageServiceLoader.getThumbnailFromResource(\n          firstContentResources as any,\n          request,\n          dereference,\n          candidates\n        );\n      }\n\n      case 'Canvas': {\n        const canvas = fullInput as CanvasNormalized;\n        // check for thumbnail resource first?\n        if (canvas.thumbnail && canvas.thumbnail.length) {\n          const thumbnail = vault.get<ContentResource>(canvas.thumbnail[0]);\n          const potentialThumbnails = await imageServiceLoader.getImageCandidates(thumbnail as any, dereference);\n          if (potentialThumbnails && potentialThumbnails.length) {\n            candidates.push(...potentialThumbnails);\n          }\n        }\n\n        return getBestThumbnailAtSize(canvas.items[0], request, dereference, candidates, {\n          width: canvas.width,\n          height: canvas.height,\n        });\n      }\n\n      // Unsupported for now.\n      case 'AnnotationPage': {\n        const annotationPage = fullInput as AnnotationPageNormalized;\n        return getBestThumbnailAtSize(annotationPage.items[0], request, dereference, candidates, dimensions);\n      }\n\n      case 'Choice': {\n        const choice: ChoiceBody = fullInput as any;\n        // @todo this could also be configuration, just choosing the first choice.\n        return getBestThumbnailAtSize(choice.items[0] as any, request, dereference, candidates, dimensions);\n      }\n      case 'Collection': {\n        // This one is tricky, as the manifests may not have been loaded. But we will give it a shot.\n        const collection = fullInput as CollectionNormalized;\n        const firstManifest = collection.items[0];\n        return getBestThumbnailAtSize(firstManifest, request, dereference, candidates, dimensions);\n      }\n\n      case 'Manifest': {\n        const manifest = fullInput as ManifestNormalized;\n        const firstCanvas = manifest.items[0];\n        return getBestThumbnailAtSize(firstCanvas, request, dereference, candidates, dimensions);\n      }\n\n      case 'SpecificResource':\n      case 'Image':\n      case 'Dataset':\n      case 'Sound':\n      case 'Text':\n      case 'TextualBody':\n      case 'Video':\n        if (dimensions && !(fullInput as any).width) {\n          (fullInput as any).width = dimensions.width;\n          (fullInput as any).height = dimensions.height;\n        }\n\n        return imageServiceLoader.getThumbnailFromResource(fullInput as any, request, dereference, candidates);\n\n      // Seems unlikely these would appear, but it would be an error..\n      case 'Service': // @todo could do something with vault.\n      case 'Range':\n      case 'AnnotationCollection':\n      case 'CanvasReference':\n      case 'ContentResource':\n        return { best: undefined, fallback: [], log: [] };\n    }\n\n    return { best: undefined, fallback: [], log: [] };\n  }\n\n  return {\n    getBestThumbnailAtSize,\n  };\n}\n","import { InternationalString } from '@iiif/presentation-3';\n\nexport function getClosestLanguage(\n  i18nLanguage: string,\n  languages: string[],\n  i18nLanguages: string[] = [],\n  strictFallback = false\n) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return undefined;\n  }\n\n  // Only one option.\n  if (languages.length === 1) {\n    return languages[0];\n  }\n\n  // Exact match.\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n\n  // Root match (en-us === en)\n  const root = i18nLanguage.indexOf('-') !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf('-')) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n\n  // All of the fall backs.\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n\n  if (!strictFallback) {\n    // Inverse root match (en === en-us)\n    const inverseRoot = languages.map((l) => (l.indexOf('-') !== -1 ? l.slice(0, l.indexOf('-')) : null));\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n\n    // Inverse root (fallback)\n    for (const lang of i18nLanguages) {\n      const root = lang.indexOf('-') !== -1 ? lang.slice(0, lang.indexOf('-')) : null;\n      const inverseIdx = root ? languages.indexOf(root) : -1;\n      if (inverseIdx !== -1) {\n        return languages[inverseIdx];\n      }\n    }\n  }\n\n  if (languages.indexOf('none') !== -1) {\n    return 'none';\n  }\n\n  // Catch some legacy\n  if (languages.indexOf('@none') !== -1) {\n    return '@none';\n  }\n\n  // Finally, fall back to the first.\n  return languages[0];\n}\n\nexport function buildLocaleString(\n  inputText: string | InternationalString | null | undefined,\n  i18nLanguage: string | undefined,\n  options: {\n    strictFallback?: boolean;\n    defaultText?: string;\n    separator?: string;\n    fallbackLanguages?: string[];\n    closest?: boolean;\n  } = {}\n) {\n  const { strictFallback = false, defaultText = '', separator = '\\n', fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest\n    ? i18nLanguage\n    : getClosestLanguage(i18nLanguage as any, languages, fallbackLanguages, strictFallback);\n\n  if (!inputText) {\n    return defaultText;\n  }\n\n  if (typeof inputText === 'string') {\n    return inputText;\n  }\n\n  const candidateText = language ? inputText[language] : undefined;\n  if (candidateText) {\n    // Slightly tolerant of typos in IIIF like: `{\"en\": \"Some value\"}`\n    if (typeof candidateText === 'string') {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n\n  return '';\n}\n\nexport function getValue(\n  inputText: string | InternationalString | null | undefined,\n  options: { defaultText?: string; separator?: string; fallbackLanguages?: string[] } = {}\n) {\n  return buildLocaleString(inputText, typeof navigator !== 'undefined' ? navigator.language : undefined, options);\n}\n","var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar TAU = Math.PI * 2;\n\nvar mapToEllipse = function mapToEllipse(_ref, rx, ry, cosphi, sinphi, centerx, centery) {\n  var x = _ref.x,\n      y = _ref.y;\n\n  x *= rx;\n  y *= ry;\n\n  var xp = cosphi * x - sinphi * y;\n  var yp = sinphi * x + cosphi * y;\n\n  return {\n    x: xp + centerx,\n    y: yp + centery\n  };\n};\n\nvar approxUnitArc = function approxUnitArc(ang1, ang2) {\n  // If 90 degree circular arc, use a constant\n  // as derived from http://spencermortensen.com/articles/bezier-circle\n  var a = ang2 === 1.5707963267948966 ? 0.551915024494 : ang2 === -1.5707963267948966 ? -0.551915024494 : 4 / 3 * Math.tan(ang2 / 4);\n\n  var x1 = Math.cos(ang1);\n  var y1 = Math.sin(ang1);\n  var x2 = Math.cos(ang1 + ang2);\n  var y2 = Math.sin(ang1 + ang2);\n\n  return [{\n    x: x1 - y1 * a,\n    y: y1 + x1 * a\n  }, {\n    x: x2 + y2 * a,\n    y: y2 - x2 * a\n  }, {\n    x: x2,\n    y: y2\n  }];\n};\n\nvar vectorAngle = function vectorAngle(ux, uy, vx, vy) {\n  var sign = ux * vy - uy * vx < 0 ? -1 : 1;\n\n  var dot = ux * vx + uy * vy;\n\n  if (dot > 1) {\n    dot = 1;\n  }\n\n  if (dot < -1) {\n    dot = -1;\n  }\n\n  return sign * Math.acos(dot);\n};\n\nvar getArcCenter = function getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp) {\n  var rxsq = Math.pow(rx, 2);\n  var rysq = Math.pow(ry, 2);\n  var pxpsq = Math.pow(pxp, 2);\n  var pypsq = Math.pow(pyp, 2);\n\n  var radicant = rxsq * rysq - rxsq * pypsq - rysq * pxpsq;\n\n  if (radicant < 0) {\n    radicant = 0;\n  }\n\n  radicant /= rxsq * pypsq + rysq * pxpsq;\n  radicant = Math.sqrt(radicant) * (largeArcFlag === sweepFlag ? -1 : 1);\n\n  var centerxp = radicant * rx / ry * pyp;\n  var centeryp = radicant * -ry / rx * pxp;\n\n  var centerx = cosphi * centerxp - sinphi * centeryp + (px + cx) / 2;\n  var centery = sinphi * centerxp + cosphi * centeryp + (py + cy) / 2;\n\n  var vx1 = (pxp - centerxp) / rx;\n  var vy1 = (pyp - centeryp) / ry;\n  var vx2 = (-pxp - centerxp) / rx;\n  var vy2 = (-pyp - centeryp) / ry;\n\n  var ang1 = vectorAngle(1, 0, vx1, vy1);\n  var ang2 = vectorAngle(vx1, vy1, vx2, vy2);\n\n  if (sweepFlag === 0 && ang2 > 0) {\n    ang2 -= TAU;\n  }\n\n  if (sweepFlag === 1 && ang2 < 0) {\n    ang2 += TAU;\n  }\n\n  return [centerx, centery, ang1, ang2];\n};\n\nvar arcToBezier = function arcToBezier(_ref2) {\n  var px = _ref2.px,\n      py = _ref2.py,\n      cx = _ref2.cx,\n      cy = _ref2.cy,\n      rx = _ref2.rx,\n      ry = _ref2.ry,\n      _ref2$xAxisRotation = _ref2.xAxisRotation,\n      xAxisRotation = _ref2$xAxisRotation === undefined ? 0 : _ref2$xAxisRotation,\n      _ref2$largeArcFlag = _ref2.largeArcFlag,\n      largeArcFlag = _ref2$largeArcFlag === undefined ? 0 : _ref2$largeArcFlag,\n      _ref2$sweepFlag = _ref2.sweepFlag,\n      sweepFlag = _ref2$sweepFlag === undefined ? 0 : _ref2$sweepFlag;\n\n  var curves = [];\n\n  if (rx === 0 || ry === 0) {\n    return [];\n  }\n\n  var sinphi = Math.sin(xAxisRotation * TAU / 360);\n  var cosphi = Math.cos(xAxisRotation * TAU / 360);\n\n  var pxp = cosphi * (px - cx) / 2 + sinphi * (py - cy) / 2;\n  var pyp = -sinphi * (px - cx) / 2 + cosphi * (py - cy) / 2;\n\n  if (pxp === 0 && pyp === 0) {\n    return [];\n  }\n\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n\n  var lambda = Math.pow(pxp, 2) / Math.pow(rx, 2) + Math.pow(pyp, 2) / Math.pow(ry, 2);\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n\n  var _getArcCenter = getArcCenter(px, py, cx, cy, rx, ry, largeArcFlag, sweepFlag, sinphi, cosphi, pxp, pyp),\n      _getArcCenter2 = _slicedToArray(_getArcCenter, 4),\n      centerx = _getArcCenter2[0],\n      centery = _getArcCenter2[1],\n      ang1 = _getArcCenter2[2],\n      ang2 = _getArcCenter2[3];\n\n  // If 'ang2' == 90.0000000001, then `ratio` will evaluate to\n  // 1.0000000001. This causes `segments` to be greater than one, which is an\n  // unecessary split, and adds extra points to the bezier curve. To alleviate\n  // this issue, we round to 1.0 when the ratio is close to 1.0.\n\n\n  var ratio = Math.abs(ang2) / (TAU / 4);\n  if (Math.abs(1.0 - ratio) < 0.0000001) {\n    ratio = 1.0;\n  }\n\n  var segments = Math.max(Math.ceil(ratio), 1);\n\n  ang2 /= segments;\n\n  for (var i = 0; i < segments; i++) {\n    curves.push(approxUnitArc(ang1, ang2));\n    ang1 += ang2;\n  }\n\n  return curves.map(function (curve) {\n    var _mapToEllipse = mapToEllipse(curve[0], rx, ry, cosphi, sinphi, centerx, centery),\n        x1 = _mapToEllipse.x,\n        y1 = _mapToEllipse.y;\n\n    var _mapToEllipse2 = mapToEllipse(curve[1], rx, ry, cosphi, sinphi, centerx, centery),\n        x2 = _mapToEllipse2.x,\n        y2 = _mapToEllipse2.y;\n\n    var _mapToEllipse3 = mapToEllipse(curve[2], rx, ry, cosphi, sinphi, centerx, centery),\n        x = _mapToEllipse3.x,\n        y = _mapToEllipse3.y;\n\n    return { x1: x1, y1: y1, x2: x2, y2: y2, x: x, y: y };\n  });\n};\n\nexport default arcToBezier;","\nmodule.exports = parse\n\n/**\n * expected argument lengths\n * @type {Object}\n */\n\nvar length = {a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0}\n\n/**\n * segment pattern\n * @type {RegExp}\n */\n\nvar segment = /([astvzqmhlc])([^astvzqmhlc]*)/ig\n\n/**\n * parse an svg path data string. Generates an Array\n * of commands where each command is an Array of the\n * form `[command, arg1, arg2, ...]`\n *\n * @param {String} path\n * @return {Array}\n */\n\nfunction parse(path) {\n\tvar data = []\n\tpath.replace(segment, function(_, command, args){\n\t\tvar type = command.toLowerCase()\n\t\targs = parseValues(args)\n\n\t\t// overloaded moveTo\n\t\tif (type == 'm' && args.length > 2) {\n\t\t\tdata.push([command].concat(args.splice(0, 2)))\n\t\t\ttype = 'l'\n\t\t\tcommand = command == 'm' ? 'l' : 'L'\n\t\t}\n\n\t\twhile (true) {\n\t\t\tif (args.length == length[type]) {\n\t\t\t\targs.unshift(command)\n\t\t\t\treturn data.push(args)\n\t\t\t}\n\t\t\tif (args.length < length[type]) throw new Error('malformed path data')\n\t\t\tdata.push([command].concat(args.splice(0, length[type])))\n\t\t}\n\t})\n\treturn data\n}\n\nvar number = /-?[0-9]*\\.?[0-9]+(?:e[-+]?\\d+)?/ig\n\nfunction parseValues(args) {\n\tvar numbers = args.match(number)\n\treturn numbers ? numbers.map(Number) : []\n}\n","\nmodule.exports = absolutize\n\n/**\n * redefine `path` with absolute coordinates\n *\n * @param {Array} path\n * @return {Array}\n */\n\nfunction absolutize(path){\n\tvar startX = 0\n\tvar startY = 0\n\tvar x = 0\n\tvar y = 0\n\n\treturn path.map(function(seg){\n\t\tseg = seg.slice()\n\t\tvar type = seg[0]\n\t\tvar command = type.toUpperCase()\n\n\t\t// is relative\n\t\tif (type != command) {\n\t\t\tseg[0] = command\n\t\t\tswitch (type) {\n\t\t\t\tcase 'a':\n\t\t\t\t\tseg[6] += x\n\t\t\t\t\tseg[7] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'v':\n\t\t\t\t\tseg[1] += y\n\t\t\t\t\tbreak\n\t\t\t\tcase 'h':\n\t\t\t\t\tseg[1] += x\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tfor (var i = 1; i < seg.length;) {\n\t\t\t\t\t\tseg[i++] += x\n\t\t\t\t\t\tseg[i++] += y\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// update cursor state\n\t\tswitch (command) {\n\t\t\tcase 'Z':\n\t\t\t\tx = startX\n\t\t\t\ty = startY\n\t\t\t\tbreak\n\t\t\tcase 'H':\n\t\t\t\tx = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'V':\n\t\t\t\ty = seg[1]\n\t\t\t\tbreak\n\t\t\tcase 'M':\n\t\t\t\tx = startX = seg[1]\n\t\t\t\ty = startY = seg[2]\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tx = seg[seg.length - 2]\n\t\t\t\ty = seg[seg.length - 1]\n\t\t}\n\n\t\treturn seg\n\t})\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport arcToCurve from 'svg-arc-to-cubic-bezier';\nimport parseSvgPath from 'parse-svg-path';\nimport absSvgPath, {\n  AbsoluteCubicBezierCommand,\n  AbsoluteLineCommand,\n  AbsoluteMoveCommand,\n  AbsoluteQuadraticBezierCommand,\n} from 'abs-svg-path';\n\nexport type NormalizedSvgPathCommand =\n  | AbsoluteMoveCommand\n  | AbsoluteLineCommand\n  | AbsoluteCubicBezierCommand\n  | AbsoluteQuadraticBezierCommand;\n\nexport type NormalizedSvgPathCommandType = 'M' | 'L' | 'C' | 'Q';\n\n/** Parse an SVG path and normalize it so it only contains Moves, Lines and Cubic or Quadratic Bézier curves\n *  in their absolute form. */\nexport function parseAndNormalizeSvgPath(path: string): NormalizedSvgPathCommand[] {\n  const parsed = parseSvgPath(path);\n  const absolute = absSvgPath(parsed);\n\n  let prevCmd: 'M' | 'L' | 'H' | 'V' | 'C' | 'S' | 'Q' | 'T' | 'A' | 'Z' | undefined;\n  let startX = 0;\n  let startY = 0;\n  let bezierX = 0;\n  let bezierY = 0;\n  let quadX: number | undefined;\n  let quadY: number | undefined;\n  let x = 0;\n  let y = 0;\n  const out: NormalizedSvgPathCommand[] = [];\n  for (let i = 0; i < absolute.length; i++) {\n    let seg = absolute[i];\n    const cmd = seg[0];\n    switch (cmd) {\n      case 'M':\n        startX = seg[1];\n        startY = seg[2];\n        break;\n      case 'H':\n        seg = ['L', seg[1], startY];\n        break;\n      case 'V':\n        seg = ['L', startX, seg[1]];\n        break;\n      case 'S':\n        {\n          let cx = x;\n          let cy = y;\n          if (prevCmd === 'C' || prevCmd == 'S') {\n            cx += cx - bezierX;\n            cy += cy - bezierY;\n          }\n          seg = ['C', cx, cy, seg[1], seg[2], seg[3], seg[4]];\n        }\n        break;\n      case 'T':\n        if (prevCmd === 'Q' || prevCmd == 'T') {\n          quadX = x * 2 - quadX!;\n          quadY = y * 2 - quadY!;\n        } else {\n          quadX = x;\n          quadY = y;\n        }\n        seg = ['Q', quadX, quadY, seg[1], seg[2]];\n        break;\n      case 'Q':\n        quadX = seg[1];\n        quadY = seg[2];\n        break;\n      case 'A':\n        {\n          const curves = arcToCurve({\n            px: x,\n            py: y,\n            cx: seg[6],\n            cy: seg[7],\n            rx: seg[1],\n            ry: seg[2],\n            xAxisRotation: seg[3],\n            largeArcFlag: seg[4],\n            sweepFlag: seg[5],\n          });\n          if (!curves.length) {\n            continue;\n          }\n          for (const [j, curve] of curves.entries()) {\n            seg = ['C', curve.x1, curve.y1, curve.x2, curve.y2, curve.x, curve.y];\n            if (j < curves.length - 1) {\n              out.push(seg);\n            }\n          }\n          // FIXME: Why do we need this cast?\n          seg = seg as NormalizedSvgPathCommand;\n        }\n        break;\n      case 'Z':\n        seg = ['L', startX, startY];\n        break;\n    }\n\n    prevCmd = cmd;\n    x = seg[seg.length - 2] as number;\n    y = seg[seg.length - 1] as number;\n    if (['C', 'Q', 'A'].indexOf(cmd) > -1) {\n      bezierX = seg[seg.length - 4] as number;\n      bezierY = seg[seg.length - 3] as number;\n    } else {\n      bezierX = x;\n      bezierY = y;\n    }\n    out.push(seg);\n  }\n\n  return out;\n}\n","/** Code to \"flatten\" quadratic and cubic Bézier curves to polylines.\n *\n * All code in this module is based on JavaScript code by Raph Levien, published on his blog at\n * https://raphlinus.github.io/.\n * I merely changed the structure a bit, removed some unneeded parts and added some comments and type hints.\n *\n * Flattening of quadratic Bézier curves:\n * - Article: https://raphlinus.github.io/graphics/curves/2019/12/23/flatten-quadbez.html\n * - Code: https://github.com/raphlinus/raphlinus.github.io/blob/master/_posts/2019-12-23-flatten-quadbez.md?plain=1#L73-L212\n *\n * Flattening of cubic Bézier curves: https://levien.com/tmp/flatten.html\n *\n * Note that the code in this module has a different license than the rest of the package,\n * due to the inclusion of Apache-licensed third party code.\n *\n * @license\n * Copyright 2022 Johannes Baiter <johannes.baiter@gmail.com>\n * Copyright 2019, 2022 Raph Levien <raph.levien@gmail.com>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport type Point = { x: number; y: number };\n\nexport function flattenQuadraticBezier(start: Point, control: Point, end: Point, tolerance = 1): Point[] {\n  return new QuadraticBezier(start, control, end).subdivide(tolerance);\n}\n\nexport function flattenCubicBezier(\n  start: Point,\n  startControl: Point,\n  end: Point,\n  endControl: Point,\n  tolerance = 1\n): Point[] {\n  return new CubicBezier(\n    new Float64Array([start.x, start.y, startControl.x, startControl.y, end.x, end.y, endControl.x, endControl.y])\n  ).subdivide(tolerance);\n}\n\nfunction hypot2(p: Point): number {\n  return p.x * p.x + p.y * p.y;\n}\n\n// Compute an approximation to int (1 + 4x^2) ^ -0.25 dx\nfunction approx_myint(x: number): number {\n  const d = 0.67;\n  return x / (1 - d + Math.pow(Math.pow(d, 4) + 0.25 * x * x, 0.25));\n}\n\n// Approximate the inverse of `approx_myint`\nfunction approx_inv_myint(x: number): number {\n  const b = 0.39;\n  return x * (1 - b + Math.sqrt(b * b + 0.25 * x * x));\n}\n\n// Parameters for a basic parabola corresponding to a quadratic bézier curve\ntype QuadraticBezierBasicParams = {\n  x0: number;\n  x2: number;\n  scale: number;\n  cross: number;\n};\n\nclass QuadraticBezier {\n  start: Point;\n  control: Point;\n  end: Point;\n\n  constructor(start: Point, control: Point, end: Point) {\n    this.start = start;\n    this.control = control;\n    this.end = end;\n  }\n\n  eval(t: number): Point {\n    const mt = 1 - t;\n    return {\n      x: this.start.x * mt * mt + 2 * this.control.x * mt * t + this.end.x * t * t,\n      y: this.start.y * mt * mt + 2 * this.control.y * mt * t + this.end.y * t * t,\n    };\n  }\n\n  mapToBasic(): QuadraticBezierBasicParams {\n    const { x: x0, y: y0 } = this.start;\n    const { x: x1, y: y1 } = this.control;\n    const { x: x2, y: y2 } = this.end;\n\n    // Determine the x values and scaling to map to y=x^2\n    const ddx = 2 * x1 - x0 - x2;\n    const ddy = 2 * y1 - y0 - y2;\n    const u0 = (x1 - x0) * ddx + (y1 - y0) * ddy;\n    const u2 = (x2 - x1) * ddx + (y2 - y1) * ddy;\n    const cross = (x2 - x0) * ddy - (y2 - y0) * ddx;\n    const paramX0 = u0 / cross;\n    const paramX2 = u2 / cross;\n\n    // There's probably a more elegant formulation of this...\n    const scale = Math.abs(cross) / (Math.hypot(ddx, ddy) * Math.abs(paramX2 - paramX0));\n\n    return { x0, x2, scale, cross };\n  }\n\n  subdivide(tolerance: number): Point[] {\n    const params = this.mapToBasic();\n    const a0 = approx_myint(params.x0);\n    const a2 = approx_myint(params.x2);\n    const count = 0.5 * Math.abs(a2 - a0) * Math.sqrt(params.scale / tolerance);\n    const n = Math.ceil(count);\n    const u0 = approx_inv_myint(a0);\n    const u2 = approx_inv_myint(a2);\n    const tValues = [0];\n    for (let i = 1; i < n; i++) {\n      const u = approx_inv_myint(a0 + ((a2 - a0) * i) / n);\n      const t = (u - u0) / (u2 - u0);\n      tValues.push(t);\n    }\n    tValues.push(1);\n    return tValues.map((t) => this.eval(t));\n  }\n}\n\nclass CubicBezier {\n  private c: Float64Array;\n\n  /// Argument is array of coordinate values [x0, y0, x1, y1, x2, y2, x3, y3].\n  constructor(coords: Float64Array) {\n    this.c = coords;\n  }\n\n  weightsum(c0: number, c1: number, c2: number, c3: number): Point {\n    const x = c0 * this.c[0] + c1 * this.c[2] + c2 * this.c[4] + c3 * this.c[6];\n    const y = c0 * this.c[1] + c1 * this.c[3] + c2 * this.c[5] + c3 * this.c[7];\n    return { x, y };\n  }\n\n  eval(t: number): Point {\n    const mt = 1 - t;\n    const c0 = mt * mt * mt;\n    const c1 = 3 * mt * mt * t;\n    const c2 = 3 * mt * t * t;\n    const c3 = t * t * t;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n\n  deriv(t: number): Point {\n    const mt = 1 - t;\n    const c0 = -3 * mt * mt;\n    const c3 = 3 * t * t;\n    const c1 = -6 * t * mt - c0;\n    const c2 = 6 * t * mt - c3;\n    return this.weightsum(c0, c1, c2, c3);\n  }\n\n  // quadratic bezier with matching endpoints and minimum max vector error\n  midpoint_quadbez(): QuadraticBezier {\n    const p1 = this.weightsum(-0.25, 0.75, 0.75, -0.25);\n    return new QuadraticBezier({ x: this.c[0], y: this.c[1] }, p1, { x: this.c[6], y: this.c[7] });\n  }\n\n  subsegment(t0: number, t1: number): CubicBezier {\n    const c = new Float64Array(8);\n    const p0 = this.eval(t0);\n    const p3 = this.eval(t1);\n    c[0] = p0.x;\n    c[1] = p0.y;\n    const scale = (t1 - t0) / 3;\n    const d1 = this.deriv(t0);\n    c[2] = p0.x + scale * d1.x;\n    c[3] = p0.y + scale * d1.y;\n    const d2 = this.deriv(t1);\n    c[4] = p3.x - scale * d2.x;\n    c[5] = p3.y - scale * d2.y;\n    c[6] = p3.x;\n    c[7] = p3.y;\n    return new CubicBezier(c);\n  }\n\n  // Very fancy subdivision scheme\n  subdivide(tol: number) {\n    const tol1 = 0.1 * tol; // error for subdivision into quads\n    const tol2 = tol - tol1; // error for subdivision of quads into lines\n    const sqrt_tol2 = Math.sqrt(tol2);\n    const err2 = hypot2(this.weightsum(1, -3, 3, -1));\n    const n_quads = Math.ceil(Math.pow(err2 / (432 * tol1 * tol1), 1 / 6));\n    const quads = [];\n    let sum = 0;\n    for (let i = 0; i < n_quads; i++) {\n      const t0 = i / n_quads;\n      const t1 = (i + 1) / n_quads;\n      const quad = this.subsegment(t0, t1).midpoint_quadbez();\n      const params = quad.mapToBasic();\n      const a0 = approx_myint(params.x0);\n      const a2 = approx_myint(params.x2);\n      const scale = Math.sqrt(params.scale);\n      let val = Math.abs(a2 - a0) * scale;\n      if (Math.sign(params.x0) != Math.sign(params.x2)) {\n        // min x value in basic parabola to make sure we don't skip cusp\n        const xmin = sqrt_tol2 / scale;\n        const cusp_val = (sqrt_tol2 * Math.abs(a2 - a0)) / approx_myint(xmin);\n        // I *think* it will always be larger, but just in case...\n        val = Math.max(val, cusp_val);\n      }\n      quads.push({\n        quad: quad,\n        a0: a0,\n        a2: a2,\n        val: val,\n      });\n      sum += val;\n    }\n    const count = (0.5 * sum) / sqrt_tol2;\n    const n = Math.ceil(count);\n    const result = [{ x: this.c[0], y: this.c[1] }];\n    let val = 0; // sum of vals from [0..i]\n    let i = 0;\n    for (let j = 1; j < n; j++) {\n      const target = (sum * j) / n;\n      while (val + quads[i].val < target) {\n        val += quads[i].val;\n        i++;\n      }\n      const a0 = quads[i].a0;\n      const a2 = quads[i].a2;\n      // Note: we can cut down on recomputing these\n      const u0 = approx_inv_myint(a0);\n      const u2 = approx_inv_myint(a2);\n      const a = a0 + ((a2 - a0) * (target - val)) / quads[i].val;\n      const u = approx_inv_myint(a);\n      const t = (u - u0) / (u2 - u0);\n      result.push(quads[i].quad.eval(t));\n    }\n    result.push({ x: this.c[6], y: this.c[7] });\n    return result;\n  }\n}\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport {\n  ParsedSelector,\n  SupportedSelectors,\n  TemporalSelector,\n  SvgSelector,\n  SelectorStyle,\n  SvgShapeType,\n} from './selector-types';\nimport { Selector } from '@iiif/presentation-3';\nimport { NormalizedSvgPathCommand, NormalizedSvgPathCommandType, parseAndNormalizeSvgPath } from './normalize-svg';\nimport { flattenCubicBezier, flattenQuadraticBezier } from './bezier';\n\nconst BOX_SELECTOR =\n  /&?(xywh=)?(pixel:|percent:|pct:)?([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?),([0-9]+(?:\\.[0-9]+)?)/;\n\n// Does not support 00:00:00 or 00:00 formats.\nconst TEMPORAL_SELECTOR = /&?(t=)(npt:)?([0-9]+(.[0-9]+)?)?(,([0-9]+(.[0-9]+)?))?/;\n\nconst RGBA_COLOR = /^rgba\\((\\d+),(\\d+),(\\d+),([0-9.]+)\\)$/;\n\nexport function parseSelector(\n  source: Selector | Selector[],\n  { domParser, svgPreprocessor }: { domParser?: DOMParser; svgPreprocessor?: (svg: string) => string } = {}\n): ParsedSelector {\n  if (Array.isArray(source)) {\n    return (source as Array<string | Selector>).reduce(\n      <ParseSelector>(data: ParsedSelector, nextSource: string | Selector) => {\n        const { selector, selectors } = parseSelector(nextSource);\n        if (selector) {\n          if (!data.selector) {\n            data.selector = selector;\n          }\n          data.selectors.push(...selectors);\n        }\n        return data;\n      },\n      {\n        selector: null,\n        selectors: [],\n      } as ParsedSelector\n    );\n  }\n\n  if (!source) {\n    return {\n      selector: null,\n      selectors: [],\n    };\n  }\n\n  if (typeof source === 'string') {\n    const [id, fragment] = source.split('#');\n\n    if (!fragment) {\n      // This is an unknown selector.\n      return {\n        selector: null,\n        selectors: [],\n      };\n    }\n\n    return parseSelector({ type: 'FragmentSelector', value: fragment });\n  }\n\n  if (source.type === 'PointSelector' && (source.t || source.t === 0)) {\n    const selector: TemporalSelector = {\n      type: 'TemporalSelector',\n      temporal: {\n        startTime: source.t,\n      },\n    };\n\n    return {\n      selector,\n      selectors: [selector],\n    };\n  }\n\n  if (source.type === 'FragmentSelector') {\n    const matchBoxSelector = BOX_SELECTOR.exec(source.value);\n    if (matchBoxSelector) {\n      const selector: SupportedSelectors = {\n        type: 'BoxSelector',\n        spatial: {\n          unit: matchBoxSelector[2] === 'percent:' || matchBoxSelector[2] === 'pct:' ? 'percent' : 'pixel',\n          x: parseFloat(matchBoxSelector[3]),\n          y: parseFloat(matchBoxSelector[4]),\n          width: parseFloat(matchBoxSelector[5]),\n          height: parseFloat(matchBoxSelector[6]),\n        },\n      };\n\n      return {\n        selector,\n        selectors: [selector],\n      };\n    }\n\n    const matchTimeSelector = source.value.match(TEMPORAL_SELECTOR);\n    if (matchTimeSelector) {\n      const selector: TemporalSelector = {\n        type: 'TemporalSelector',\n        temporal: {\n          startTime: matchTimeSelector[4] ? parseFloat(matchTimeSelector[4]) : 0,\n          endTime: matchTimeSelector[7] ? parseFloat(matchTimeSelector[7]) : undefined,\n        },\n      };\n\n      return {\n        selector,\n        selectors: [selector],\n      };\n    }\n\n    return {\n      selector: null,\n      selectors: [],\n    };\n  }\n\n  if (source.type === 'SvgSelector' && 'value' in source) {\n    if (!domParser) {\n      if (typeof window !== 'undefined') {\n        domParser = new window.DOMParser();\n      } else {\n        console.warn(\n          'No DOMParser available, cannot parse SVG selector, `points`, `spatial` and `style` will be unavailable and the SVG will not be normalized.'\n        );\n      }\n    }\n    let points: [number, number][] = [];\n    let rect: [number, number, number, number] | undefined;\n    let style: SelectorStyle | undefined;\n    let svg = svgPreprocessor?.(source.value) ?? source.value;\n    let svgShape: SvgShapeType | undefined;\n    if (domParser) {\n      const svgElement: SVGElement | null = domParser\n        .parseFromString(source.value, 'image/svg+xml')\n        .querySelector('svg');\n      if (!svgElement) {\n        console.warn(`Illegal SVG selector: ${source.value}`);\n        return {\n          selector: null,\n          selectors: [],\n        };\n      }\n      const selectorElem = getSelectorElement(svgElement);\n      if (selectorElem) {\n        points = selectorElem.points;\n        svgShape = selectorElem.shapeType;\n        rect = [\n          Math.min(...points.map((p) => p[0])), // llx\n          Math.min(...points.map((p) => p[1])), // lly\n          Math.max(...points.map((p) => p[0])), // urx\n          Math.max(...points.map((p) => p[1])), // ury\n        ];\n        ({ style, svg } = extractStyles(selectorElem.element) ?? { svg });\n      }\n    }\n    const sel: SvgSelector = {\n      type: 'SvgSelector',\n      svg,\n      svgShape,\n      style,\n      points: points.length ? points : undefined,\n      spatial: rect\n        ? { unit: 'pixel', x: rect[0], y: rect[1], width: rect[2] - rect[0], height: rect[3] - rect[1] }\n        : undefined,\n    };\n    return {\n      selector: sel,\n      selectors: [sel],\n    };\n  }\n  return {\n    selector: null,\n    selectors: [],\n  };\n}\n\nexport type SelectorElement = {\n  element: SVGElement;\n  points: [number, number][];\n  shapeType: SvgShapeType;\n};\n\nfunction getShapeTypeFromPath(svgPath: NormalizedSvgPathCommand[]): SvgShapeType {\n  const cmdFrequencies = svgPath\n    .map((seg) => seg[0])\n    .reduce(\n      (acc: Record<NormalizedSvgPathCommandType, number>, cmd) => {\n        acc[cmd] += 1;\n        return acc;\n      },\n      { C: 0, Q: 0, L: 0, M: 0 }\n    );\n  const cmdTypes = new Set(svgPath.map((seg) => seg[0]));\n  if (cmdFrequencies.C > 0 || cmdFrequencies.Q > 0) {\n    return 'path';\n  }\n  if (cmdFrequencies.L > 0 && (cmdTypes.size === 1 || (cmdTypes.size === 2 && cmdTypes.has('M')))) {\n    // Only lines and moves: rectangle, polygon or polyline?\n    if (cmdFrequencies.L === 4) {\n      return 'rect';\n    }\n\n    // Check if the path is closed to decide if we have a polygon or a polyline\n    const lastSeg = svgPath.slice(-1)[0];\n    if (\n      (svgPath[0][0] === 'M' && lastSeg[0] === 'L' && lastSeg[1] == svgPath[0][1] && lastSeg[2] === svgPath[0][2]) ||\n      (lastSeg[1] === 0 && lastSeg[2] === 0)\n    ) {\n      return 'polygon';\n    } else {\n      return 'polyline';\n    }\n  }\n  return 'path';\n}\n\nfunction getSelectorElement(svgElem: SVGElement): SelectorElement | null {\n  for (const element of Array.from(svgElem.children) as SVGElement[]) {\n    switch (element?.tagName.toLowerCase()) {\n      case 'g':\n        {\n          // Check if any of the children in the container can be converted to points\n          const res = getSelectorElement(element as SVGElement);\n          if (res) {\n            return res;\n          }\n        }\n        continue;\n      case 'path': {\n        const p = element.getAttribute('d');\n        if (!p) {\n          continue;\n        }\n        const normalized = parseAndNormalizeSvgPath(p);\n        return { element, points: pathToPoints(normalized), shapeType: getShapeTypeFromPath(normalized) };\n      }\n      case 'circle': {\n        const cx = parseFloat(element.getAttribute('cx') ?? '0');\n        const cy = parseFloat(element.getAttribute('cy') ?? '0');\n        const r = parseFloat(element.getAttribute('r') ?? '0');\n        if (!r) {\n          continue;\n        }\n        const points: [number, number][] = [];\n        // TODO: Get rid of the degree -> radian conversion and use radians from the beginning\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const rad = (angle * Math.PI) / 180;\n          points.push([cx + r * Math.cos(rad), cy + r * Math.sin(rad)]);\n        }\n        return { element, points, shapeType: 'circle' };\n      }\n      case 'ellipse': {\n        const cx = parseFloat(element.getAttribute('cx') ?? '0');\n        const cy = parseFloat(element.getAttribute('cy') ?? '0');\n        const rx = parseFloat(element.getAttribute('rx') ?? '0');\n        const ry = parseFloat(element.getAttribute('ry') ?? '0');\n        if (!rx && !ry) {\n          continue;\n        }\n        const points: [number, number][] = [];\n        for (let angle = 0; angle <= 360; angle += 12) {\n          const t = Math.tan((angle / 360) * Math.PI);\n          const px = (rx * (1 - t ** 2)) / (1 + t ** 2);\n          const py = (ry * 2 * t) / (1 + t ** 2);\n          points.push([cx + px, cy + py]);\n        }\n        return { element, points, shapeType: 'ellipse' };\n      }\n      case 'line': {\n        const x0 = parseFloat(element.getAttribute('x0') ?? '0');\n        const y0 = parseFloat(element.getAttribute('y0') ?? '0');\n        const x1 = parseFloat(element.getAttribute('x1') ?? '0');\n        const y1 = parseFloat(element.getAttribute('y1') ?? '0');\n        if (x0 === x1 && y0 === y1) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x0, y0],\n            [x1, y1],\n          ],\n          shapeType: 'polyline',\n        };\n      }\n      case 'polygon':\n      case 'polyline': {\n        const points =\n          element\n            .getAttribute('points')\n            ?.split(' ')\n            .map((ps) => ps.split(',').map(parseFloat) as [number, number]) ?? [];\n        if (!points.length) {\n          continue;\n        }\n        let shapeType: SvgShapeType = 'polyline';\n        if (element.tagName.toLowerCase() === 'polygon') {\n          // A polygon is a closed path, so the last point is the same as the first.\n          points.push(points[0]);\n          shapeType = 'polygon';\n        }\n        return { element, points, shapeType };\n      }\n      case 'rect': {\n        const x = parseFloat(element.getAttribute('x') ?? '0');\n        const y = parseFloat(element.getAttribute('y') ?? '0');\n        const width = parseFloat(element.getAttribute('width') ?? '0');\n        const height = parseFloat(element.getAttribute('height') ?? '0');\n        if (!width || !height) {\n          continue;\n        }\n        return {\n          element,\n          points: [\n            [x, y],\n            [x + width, y],\n            [x + width, y + height],\n            [x, y + height],\n            [x, y],\n          ],\n          shapeType: 'rect',\n        };\n      }\n      default:\n        // Try next element\n        continue;\n    }\n  }\n  return null;\n}\n\nfunction pathToPoints(normalizedPath: NormalizedSvgPathCommand[]): [number, number][] {\n  const out: [number, number][] = [];\n  for (let i = 0; i < normalizedPath.length; i++) {\n    const startPoint = out[out.length - 1] ?? [0, 0];\n    const seg = normalizedPath[i];\n    switch (seg[0]) {\n      case 'M':\n      case 'L':\n        out.push([seg[1], seg[2]]);\n        continue;\n      case 'C':\n        out.push(\n          ...flattenCubicBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] },\n            { x: seg[5], y: seg[6] }\n          )\n            .map((p) => [p.x, p.y] as [number, number])\n            .slice(1) // skip first point, already part of output\n        );\n        continue;\n      case 'Q':\n        out.push(\n          ...flattenQuadraticBezier(\n            { x: startPoint[0], y: startPoint[1] },\n            { x: seg[1], y: seg[2] },\n            { x: seg[3], y: seg[4] }\n          )\n            .map((p) => [p.x, p.y] as [number, number])\n            .slice(1) // skip first point, already part of output\n        );\n        continue;\n    }\n  }\n  return out;\n}\n\n/** Extract styling information from SVG selector.\n *\n * Will remove all styling information from the SVG element\n * and normalize `rgba` colors for `fill` and `stroke` to\n * `rgb` and store the opacity in `fillOpacity` and `strokeOpacity`.\n */\nfunction extractStyles(selectorElement: SVGElement): { style?: SelectorStyle; svg: string } | undefined {\n  // TODO: Can this be simplified somehow?\n  const style: SelectorStyle = {};\n  if (selectorElement.hasAttribute('fill')) {\n    style.fill = selectorElement.getAttribute('fill')!;\n    selectorElement.removeAttribute('fill');\n  } else if (selectorElement.style.fill) {\n    style.fill = selectorElement.style.fill;\n  }\n  if (style.fill) {\n    const rgbaMatch = RGBA_COLOR.exec(style.fill);\n    if (rgbaMatch) {\n      style.fillOpacity = parseFloat(rgbaMatch[4]);\n      style.fill = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute('fill-opacity')) {\n    style.fillOpacity = parseFloat(selectorElement.getAttribute('fill-opacity')!);\n    selectorElement.removeAttribute('fill-opacity');\n  } else if (selectorElement.style.fillOpacity) {\n    style.fillOpacity = parseFloat(selectorElement.style.fillOpacity);\n  }\n\n  if (selectorElement.hasAttribute('stroke')) {\n    style.stroke = selectorElement.getAttribute('stroke')!;\n    selectorElement.removeAttribute('stroke');\n  } else if (selectorElement.style.stroke) {\n    style.stroke = selectorElement.style.stroke;\n  }\n  if (style.stroke) {\n    const rgbaMatch = RGBA_COLOR.exec(style.stroke);\n    if (rgbaMatch) {\n      style.strokeOpacity = parseFloat(rgbaMatch[4]);\n      style.stroke = `rgb(${rgbaMatch[1]}, ${rgbaMatch[2]}, ${rgbaMatch[3]})`;\n    }\n  }\n  if (selectorElement.hasAttribute('stroke-opacity')) {\n    style.strokeOpacity = parseFloat(selectorElement.getAttribute('stroke-opacity')!);\n    selectorElement.removeAttribute('stroke-opacity');\n  } else if (selectorElement.style.strokeOpacity) {\n    style.strokeOpacity = parseFloat(selectorElement.style.strokeOpacity);\n  }\n  if (selectorElement.hasAttribute('stroke-width')) {\n    style.strokeWidth = selectorElement.getAttribute('stroke-width')!;\n    selectorElement.removeAttribute('stroke-width');\n  } else if (selectorElement.style.strokeWidth) {\n    style.strokeWidth = selectorElement.style.strokeWidth;\n  }\n  if (selectorElement.hasAttribute('stroke-dasharray')) {\n    style.strokeDasharray = selectorElement.getAttribute('stroke-dasharray')!;\n    selectorElement.removeAttribute('stroke-dasharray');\n  } else if (selectorElement.style.strokeDasharray) {\n    style.strokeDasharray = selectorElement.style.strokeDasharray;\n  }\n\n  let rootElem: SVGElement | null = selectorElement;\n  while (rootElem.tagName.toLowerCase() !== 'svg') {\n    rootElem = rootElem.parentElement as SVGElement | null;\n    if (rootElem === null) {\n      throw new Error('Could not find root SVG element');\n    }\n  }\n  return { svg: rootElem.outerHTML, style: Object.keys(style).length > 0 ? style : undefined };\n}\n","import { ExternalWebResource, W3CAnnotationTarget } from '@iiif/presentation-3';\nimport { SupportedTarget } from './target-types';\nimport { parseSelector } from './parse-selector';\n\nexport function expandTarget(\n  target: W3CAnnotationTarget | W3CAnnotationTarget[],\n  options: {\n    typeMap?: Record<string, string>;\n    domParser?: DOMParser;\n    svgPreprocessor?: (svg: string) => string;\n  } = {}\n): SupportedTarget {\n  if (Array.isArray(target)) {\n    // Don't support multiple targets for now.\n    return expandTarget(target[0]);\n  }\n\n  if (typeof target === 'string') {\n    const [id, fragment] = target.split('#');\n\n    if (!fragment) {\n      // This is an unknown selector.\n      return {\n        type: 'SpecificResource',\n        source: { id, type: (options.typeMap && (options.typeMap[id] as any)) || 'Unknown' },\n        selector: null,\n        selectors: [],\n      };\n    }\n\n    return expandTarget({\n      type: 'SpecificResource',\n      source: { id, type: 'Unknown' },\n      selector: {\n        type: 'FragmentSelector',\n        value: fragment,\n      },\n    });\n  }\n\n  // @todo, how do we want to support choices for targets.\n  if (\n    target.type === 'Choice' ||\n    target.type === 'List' ||\n    target.type === 'Composite' ||\n    target.type === 'Independents'\n  ) {\n    // we also don't support these, just choose the first.\n    return expandTarget(target.items[0]);\n  }\n\n  if (target.type === 'SpecificResource') {\n    if (target.source.type === 'Canvas' && target.source.partOf && typeof target.source.partOf === 'string') {\n      target.source.partOf = [\n        {\n          id: target.source.partOf,\n          type: 'Manifest',\n        },\n      ];\n    }\n\n    const { selector, selectors } = target.selector\n      ? parseSelector(target.selector, options)\n      : { selector: null, selectors: [] };\n\n    return {\n      type: 'SpecificResource',\n      source: target.source,\n      selector,\n      selectors,\n    };\n  }\n\n  if (target.id) {\n    if ((target as any).type === 'Canvas' && (target as any).partOf && typeof (target as any).partOf === 'string') {\n      (target as any).partOf = [\n        {\n          id: (target as any).partOf,\n          type: 'Manifest',\n        },\n      ];\n    }\n\n    const [id, fragment] = target.id.split('#');\n    if (!fragment) {\n      // This is an unknown selector.\n      return {\n        type: 'SpecificResource',\n        source: {\n          ...(target as any),\n          id,\n        },\n        selector: null,\n        selectors: [],\n      };\n    }\n\n    return expandTarget({\n      type: 'SpecificResource',\n      source: {\n        ...(target as any),\n        id,\n      },\n      selector: {\n        type: 'FragmentSelector',\n        value: fragment,\n      },\n    });\n  }\n\n  return {\n    type: 'SpecificResource',\n    source: target as ExternalWebResource,\n    selector: null,\n    selectors: [],\n  };\n}\n","import { Annotation } from '@iiif/presentation-3';\nimport { expandTarget } from './annotation-targets/expand-target';\nimport { SupportedTarget } from './annotation-targets/target-types';\n\nexport type ContentState =\n  | string\n  | (Annotation & { '@context'?: string })\n  | (StateSource & { '@context'?: string })\n  | Array<string | (Annotation & { '@context'?: string }) | (StateSource & { '@context'?: string })>;\n\nexport type StateSource = {\n  id: string;\n  type: 'Manifest' | 'Canvas' | 'Range';\n  partOf?:\n    | string\n    | { id: string; type: string }\n    | Array<{\n        id: string;\n        type: string;\n      }>;\n};\n\n// Normalised content state?\nexport type NormalisedContentState = {\n  id: string;\n  type: 'Annotation';\n  motivation: ['contentState', ...string[]];\n  target: Array<SupportedTarget>;\n  extensions: Record<string, any>;\n};\n\ntype ValidationResponse = readonly [false, { reason?: string }] | readonly [true];\n\nexport function validateContentState(annotation: ContentState, strict = false): ValidationResponse {\n  // Valid content state.\n  if (typeof annotation === 'string') {\n    if (annotation.startsWith('{')) {\n      try {\n        const parsed = JSON.parse(annotation);\n        return validateContentState(parsed);\n      } catch (err) {\n        return [false, { reason: 'Invalid JSON' }];\n      }\n    }\n    return [true];\n  }\n\n  if (Array.isArray(annotation)) {\n    for (const anno of annotation) {\n      const [valid, reason] = validateContentState(anno);\n      if (!valid && reason) {\n        return [valid, reason] as const;\n      }\n    }\n\n    return [true];\n  }\n\n  if (annotation.type === 'Annotation') {\n    // We are validating the annotation.\n    return [true];\n  }\n\n  if (strict && annotation.type === 'Canvas' && !annotation.partOf) {\n    return [false, { reason: 'Canvas without partOf cannot be loaded' }];\n  }\n\n  return [true];\n}\n\nexport function serialiseContentState(annotation: ContentState): string {\n  return encodeContentState(typeof annotation === 'string' ? annotation : JSON.stringify(annotation));\n}\n\nexport function parseContentState(state: string): ContentState;\nexport function parseContentState(state: string, async: false): ContentState;\nexport async function parseContentState(state: string, async: true): Promise<ContentState>;\nexport function parseContentState(state: string, asyncOrFetcher?: boolean): ContentState | Promise<ContentState> {\n  state = state.trim();\n\n  if (state[0] === '{') {\n    // we might have json.\n    return asyncOrFetcher ? Promise.resolve(JSON.parse(state)) : JSON.parse(state);\n  }\n\n  if (state.startsWith('http')) {\n    if (!asyncOrFetcher) {\n      throw new Error('Cannot fetch remote fetch with async=false in parseContentState');\n    }\n    // resolve.\n    return fetch(state).then((r) => r.json());\n  }\n\n  return parseContentState(decodeContentState(state), asyncOrFetcher as any);\n}\n\nexport function encodeContentState(state: string): string {\n  const uriEncoded = encodeURIComponent(state); // using built in function\n  const base64 = typeof btoa === 'undefined' ? Buffer.from(uriEncoded, 'utf-8').toString('base64') : btoa(uriEncoded); // using built in function\n  const base64url = base64.replace(/\\+/g, '-').replace(/\\//g, '_');\n  return base64url.replace(/=/g, '');\n}\n\nexport function decodeContentState(encodedContentState: string): string {\n  const base64url = restorePadding(encodedContentState);\n  const base64 = base64url.replace(/-/g, '+').replace(/_/g, '/');\n  const base64Decoded = typeof atob === 'undefined' ? Buffer.from(base64, 'base64').toString('utf-8') : atob(base64); // using built in function\n  return decodeURIComponent(base64Decoded).trim(); // using built in function\n}\n\nfunction restorePadding(s: string) {\n  // The length of the restored string must be a multiple of 4\n  const pad = s.length % 4;\n\n  if (pad === 1) {\n    throw new Error('InvalidLengthError: Input base64url string is the wrong length to determine padding');\n  }\n\n  return s + (pad ? '===='.slice(0, 4 - pad) : '');\n}\n\nexport function normaliseContentState(state: ContentState): NormalisedContentState {\n  if (!state) {\n    throw new Error('Content state is empty');\n  }\n\n  if (!Array.isArray(state)) {\n    // We have multiples.\n    // throw new Error('Content state is an [Array] and not yet supported');\n    state = [state];\n  }\n\n  let annoId = 'vault://virtual-annotation/' + new Date().getTime(); // <-- need a virtual id\n  const motivation = ['contentState'];\n  const targets = [];\n\n  for (const source of state) {\n    if (typeof source === 'string') {\n      // Note: this is unlikely to happen in conjunction with parseContentState()\n      throw new Error('Content state is a [String] type and cannot be inferred');\n    }\n\n    // If we DO have annotation, then this is all we should be returning.\n    if (source.type === 'Annotation') {\n      annoId = source.id;\n      if (Array.isArray(source.motivation)) {\n        for (const singleMotivation of source.motivation) {\n          if (motivation.indexOf(singleMotivation) === -1) {\n            motivation.push(singleMotivation);\n          }\n        }\n      }\n\n      if (Array.isArray(source.target)) {\n        for (const target of source.target) {\n          const expanded = expandTarget(target as any);\n          targets.push(expanded);\n        }\n      } else {\n        const expanded = expandTarget(source.target as any);\n        targets.push(expanded);\n      }\n\n      continue;\n    }\n\n    const target = expandTarget(source as any);\n    targets.push(target);\n  }\n\n  return {\n    id: annoId,\n    type: 'Annotation',\n    motivation: ['contentState', ...((state as any).motivation || [])],\n    target: targets,\n    extensions: {},\n  };\n}\n","import { ContentResource } from '@iiif/presentation-3';\n\nexport function parseSpecificResource(resource: ContentResource) {\n  if (resource.type === 'SpecificResource') {\n    return [resource.source, { selector: resource.selector }];\n  }\n\n  return [resource, { selector: null }];\n}\n","import { Vault } from '@iiif/vault';\nimport {\n  AnnotationNormalized,\n  AnnotationPageNormalized,\n  CanvasNormalized,\n  ContentResource,\n  IIIFExternalWebResource,\n} from '@iiif/presentation-3';\nimport { Paintables } from './types';\nimport { parseSpecificResource } from './parse-specific-resource';\n\nexport function createPaintingAnnotationsHelper(vault: Vault) {\n  function getAllPaintingAnnotations(canvasOrId: string | CanvasNormalized | undefined | null) {\n    const canvas = canvasOrId\n      ? typeof canvasOrId === 'string'\n        ? vault.get<CanvasNormalized>(canvasOrId)\n        : canvasOrId\n      : null;\n\n    if (!canvas) {\n      return [];\n    }\n    const annotationPages = vault.get<AnnotationPageNormalized>(canvas.items);\n    const flatAnnotations: AnnotationNormalized[] = [];\n    for (const page of annotationPages) {\n      flatAnnotations.push(...vault.get<AnnotationNormalized>(page.items));\n    }\n    return flatAnnotations;\n  }\n\n  function getPaintables(\n    paintingAnnotationsOrCanvas: string | CanvasNormalized | AnnotationNormalized[],\n    enabledChoices: string[] = []\n  ): Paintables {\n    const paintingAnnotations = Array.isArray(paintingAnnotationsOrCanvas)\n      ? paintingAnnotationsOrCanvas\n      : getAllPaintingAnnotations(paintingAnnotationsOrCanvas);\n\n    const types: string[] = [];\n    let choice: Paintables['choice'] = null;\n    const items: Paintables['items'] = [];\n\n    for (const annotation of paintingAnnotations) {\n      if (annotation.type !== 'Annotation') {\n        throw new Error(`getPaintables() accept either a canvas or list of annotations`);\n      }\n      const bodies = vault.get<ContentResource>(annotation.body);\n      for (const unknownBody of bodies) {\n        const [body, { selector }] = parseSpecificResource(unknownBody);\n        const type = (body.type || 'unknown').toLowerCase();\n\n        // Choice\n        if (type === 'choice') {\n          const nestedBodies = vault.get<ContentResource>(body.items) as ContentResource[];\n\n          // Which are active? By default, the first, but we could push multiple here.\n          const selected = enabledChoices.length\n            ? enabledChoices.map((cid) => nestedBodies.find((b) => b.id === cid)).filter(Boolean)\n            : [nestedBodies[0]];\n\n          if (selected.length === 0) {\n            selected.push(nestedBodies[0]);\n          }\n\n          // Store choice.\n          choice = {\n            type: 'single-choice',\n            items: nestedBodies.map((b) => ({\n              id: b.id,\n              label: (b as any).label as any,\n              selected: selected.indexOf(b) !== -1,\n            })) as any[],\n            label: (unknownBody as any).label,\n          };\n\n          // @todo insert in the right order.\n          bodies.push(...(selected as any[]));\n\n          continue;\n        }\n\n        if (types.indexOf(type) === -1) {\n          types.push(type);\n        }\n\n        items.push({\n          type: type,\n          resource: body as IIIFExternalWebResource,\n          target: annotation.target,\n          selector,\n        });\n      }\n    }\n\n    return {\n      types,\n      items,\n      choice,\n    };\n  }\n\n  function extractChoices(paintingAnnotationsOrCanvas: string | CanvasNormalized | AnnotationNormalized[]) {\n    const { choice } = getPaintables(paintingAnnotationsOrCanvas);\n    return choice;\n  }\n\n  return {\n    getAllPaintingAnnotations,\n    getPaintables,\n    extractChoices,\n  };\n}\n","import { Vault } from '@iiif/vault';\nimport { Manifest, Reference } from '@iiif/presentation-3';\n\nfunction defineProperty(name: string, prototype: any, vault: Vault) {\n  prototype[DEFINED] = prototype[DEFINED] || [];\n  prototype[DEFINED].push(name);\n\n  Object.defineProperty(prototype, name, {\n    get(): any {\n      if (typeof prototype[REFS][name] === 'undefined') {\n        return undefined;\n      }\n\n      const ref = prototype[REFS][name];\n      if (!ref) {\n        return ref;\n      }\n\n      return wrapObject(vault.get(prototype[REFS][name]), vault);\n    },\n    set(items: any) {\n      const existing = prototype[REFS][name];\n      if (existing !== items) {\n        this[REFS][name] = items;\n\n        // This was a hack, but a much more clever implementation here could make very flexible editing.\n        // For example - manifest.label = \"Something\" -> manifest.label = {none: \"something\"}; etc.\n        // Although this might be better in a different library completely.\n        // if (this[REACTIVE]) {\n        //   vault.modifyEntityField({ id: prototype.id, type: prototype.type }, name, unwrapObject(items));\n        // }\n      }\n    },\n  });\n}\n\nconst REFS = Symbol.for('_refs_');\nconst REACTIVE = Symbol.for('_reactive_');\nconst DEFINED = Symbol.for('_defined_');\n\nfunction createPrototype(vault: Vault, reactive = false) {\n  const prototype = {\n    id: null,\n    [DEFINED]: [] as any[],\n    [REFS]: {},\n    [REACTIVE]: null as null | (() => void),\n\n    is(refOrObject: any) {\n      if (typeof refOrObject === 'string') {\n        return this.id === refOrObject;\n      }\n\n      if (refOrObject.id) {\n        return refOrObject.id === this.id;\n      }\n\n      return false;\n    },\n\n    reactive() {\n      if (this[REACTIVE]) {\n        return;\n      }\n\n      this[REACTIVE] = this.subscribe(() => this.refresh(), true);\n\n      return () => {\n        this.unreactive();\n      };\n    },\n\n    refresh() {\n      if (this.id) {\n        const fresh = this.unwrap();\n        for (const key of Object.keys(fresh || {})) {\n          if (this[DEFINED].includes(key)) {\n            (this as any)[REFS][key] = fresh[key as any];\n          } else {\n            (this as any)[key] = fresh[key as any];\n          }\n        }\n      }\n    },\n\n    unreactive() {\n      if (this[REACTIVE]) {\n        this[REACTIVE]();\n        this[REACTIVE] = null;\n      }\n    },\n\n    unwrap() {\n      if (!this.id) {\n        throw new Error('Invalid object');\n      }\n      return vault.get(this.id);\n    },\n\n    toPresentation3() {\n      return vault.toPresentation3(this.unwrap() as any);\n    },\n\n    toPresentation2() {\n      return vault.toPresentation2(this.unwrap() as any);\n    },\n\n    toJSON() {\n      const that = this as any;\n      return {\n        ...that,\n        items: that.items,\n        annotations: that.annotations,\n        structures: that.structures,\n        seeAlso: that.seeAlso,\n        service: that.service,\n        services: that.services,\n        rendering: that.rendering,\n        partOf: that.partOf,\n        start: that.start,\n        supplementary: that.supplementary,\n        homepage: that.homepage,\n        thumbnail: that.thumbnail,\n        placeholderCanvas: that.placeholderCanvas,\n        accompanyingCanvas: that.accompanyingCanvas,\n        provider: that.provider,\n      };\n    },\n    subscribe(subscription: (object: any, vault: Vault) => void, skipInitial = true) {\n      return vault.subscribe(\n        () => {\n          return this.id ? vault.get(this.id) : null;\n        },\n        subscription,\n        skipInitial\n      );\n    },\n  };\n\n  // Structural\n  defineProperty('items', prototype, vault);\n  defineProperty('annotations', prototype, vault);\n  defineProperty('structures', prototype, vault);\n\n  // Linking\n  defineProperty('seeAlso', prototype, vault);\n  defineProperty('service', prototype, vault);\n  defineProperty('services', prototype, vault);\n  defineProperty('rendering', prototype, vault);\n  defineProperty('partOf', prototype, vault);\n  defineProperty('start', prototype, vault);\n  defineProperty('supplementary', prototype, vault);\n  defineProperty('homepage', prototype, vault);\n\n  // Descriptive\n  defineProperty('thumbnail', prototype, vault);\n  defineProperty('placeholderCanvas', prototype, vault);\n  defineProperty('accompanyingCanvas', prototype, vault);\n  defineProperty('provider', prototype, vault);\n\n  // Annotation\n  defineProperty('body', prototype, vault);\n  defineProperty('logo', prototype, vault);\n\n  return prototype;\n}\n\nexport function unwrapObject(object: any): any {\n  if (Array.isArray(object)) {\n    return object.map((o) => unwrapObject(o)) as any;\n  }\n\n  if (!object || !object.type) {\n    return object;\n  }\n\n  return { id: object.id, type: object.type };\n}\n\nexport function wrapObject(object: any, vault: Vault, reactive = false): any {\n  if (Array.isArray(object)) {\n    return object.map((o) => wrapObject(o, vault, reactive));\n  }\n\n  if (!object || !object.type || !object.id) {\n    return object;\n  }\n\n  const prototype = createPrototype(vault, reactive);\n  const newObject = Object.create(prototype);\n\n  const wrapped =  Object.assign(newObject, object) as any;\n\n  if (reactive) {\n    wrapped.reactive();\n  }\n\n  return wrapped;\n}\n\nexport function createObjectsHelper(vault: Vault) {\n  return {\n    get(id: string | Reference | string[] | Reference[], reactive = false) {\n      return wrapObject(vault.get(id as any), vault, reactive);\n    },\n    async load(id: string | Reference<any>, json?: any): Promise<Manifest> {\n      return wrapObject(await vault.load(id, json), vault);\n    },\n    async loadManifest(id: string | Reference<any>, json?: any): Promise<Manifest> {\n      return wrapObject(await vault.loadManifest(id, json), vault);\n    },\n    async loadCollection(id: string | Reference<any>, json?: any) {\n      return wrapObject(await vault.loadCollection(id, json), vault);\n    },\n    wrapObject<T>(objectType: Reference<T>) {\n      return wrapObject(vault.get(objectType, { skipSelfReturn: false }), vault);\n    },\n    isWrapped(object: any) {\n      return !!object[DEFINED];\n    },\n  };\n}\n","import { Vault } from '@iiif/vault';\nimport { ManifestNormalized, RangeNormalized, Reference } from '@iiif/presentation-3';\n\nexport function createRangeHelper(vault: Vault) {\n  return {\n    findFirstCanvasFromRange: (range: RangeNormalized) => findFirstCanvasFromRange(vault, range),\n    findAllCanvasesInRange: (range: RangeNormalized) => findAllCanvasesInRange(vault, range),\n    findManifestSelectedRange: (manifest: ManifestNormalized, canvasId: string) =>\n      findManifestSelectedRange(vault, manifest, canvasId),\n    findSelectedRange: (range: RangeNormalized, canvasId: string) => findSelectedRange(vault, range, canvasId),\n  };\n}\n\nexport function findFirstCanvasFromRange(vault: Vault, range: RangeNormalized): null | Reference<'Canvas'> {\n  for (const inner of range.items) {\n    if (inner.type === 'Canvas') {\n      return inner as Reference<'Canvas'>;\n    }\n    if (inner.type === 'Range') {\n      const found = findFirstCanvasFromRange(vault, vault.get(inner));\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\n\nexport function findAllCanvasesInRange(vault: Vault, range: RangeNormalized): Array<Reference<'Canvas'>> {\n  const found: Reference<'Canvas'>[] = [];\n  for (const inner of range.items) {\n    if (inner.type === 'Canvas') {\n      if (inner.id.indexOf('#') !== -1) {\n        found.push({ id: inner.id.split('#')[0], type: 'Canvas' });\n      } else {\n        found.push(inner as Reference<'Canvas'>);\n      }\n    }\n    if (inner.type === 'Range') {\n      found.push(...findAllCanvasesInRange(vault, vault.get(inner)));\n    }\n    if ((inner as any).type === 'SpecificResource') {\n      const sourceId = typeof (inner as any).source === 'string' ? (inner as any).source : (inner as any).source.id;\n      found.push({ id: sourceId, type: 'Canvas' });\n    }\n  }\n  return found;\n}\n\nexport function findManifestSelectedRange(\n  vault: Vault,\n  manifest: ManifestNormalized,\n  canvasId: string\n): null | RangeNormalized {\n  for (const range of manifest.structures) {\n    const found = findSelectedRange(vault, vault.get(range), canvasId);\n    if (found) {\n      return found;\n    }\n  }\n\n  return null;\n}\n\nexport function findSelectedRange(vault: Vault, range: RangeNormalized, canvasId: string): null | RangeNormalized {\n  for (const inner of range.items) {\n    const parsedId = inner.id?.split('#')[0];\n    if ((inner as any).type === 'SpecificResource' && (inner as any).source === canvasId) {\n      return range;\n    }\n    if (inner.type === 'Canvas' && canvasId === parsedId) {\n      return range;\n    }\n    if (inner.type === 'Range') {\n      const found = findSelectedRange(vault, vault.get(inner), canvasId);\n      if (found) {\n        return found;\n      }\n    }\n  }\n  return null;\n}\n","import { CanvasNormalized, ManifestNormalized, RangeNormalized, Reference } from '@iiif/presentation-3';\nimport { Vault } from '@iiif/vault';\nimport { findAllCanvasesInRange } from './ranges';\n\nexport function createSequenceHelper(vault: Vault) {\n  return {\n    getVisibleCanvasesFromCanvasId: (\n      manifestOrRange: ManifestNormalized | RangeNormalized,\n      canvasId: string | null,\n      preventPaged = false\n    ) => getVisibleCanvasesFromCanvasId(vault, manifestOrRange, canvasId, preventPaged),\n    getManifestSequence: (\n      manifestOrRange: ManifestNormalized | RangeNormalized,\n      options: { disablePaging?: boolean; skipNonPaged?: boolean } = {}\n    ) => getManifestSequence(vault, manifestOrRange, options),\n  };\n}\n\n/**\n * Get visible canvases from canvas ID\n *\n * This function returns a list of canvas references that should all be displayed\n * when the passed canvasId is visible. This should work for individual items,\n * 2-up paged view and continuous (scrolls).\n *\n * The options are listed below (from IIIF docs)\n *\n * - `unordered` - Valid on Collections, Manifests and Ranges. The Canvases included in resources that have this behavior\n *    have no inherent order, and user interfaces should avoid implying an order to the user. Disjoint with individuals,\n *    continuous, and paged.\n *\n * - `individuals` - Valid on Collections, Manifests, and Ranges. For Collections that have this behavior, each of the\n *    included Manifests are distinct objects in the given order. For Manifests and Ranges, the included Canvases are\n *    distinct views, and should not be presented in a page-turning interface. This is the default layout behavior if\n *    not specified. Disjoint with unordered, continuous, and paged.\n *\n * - `continuous`  Valid on Collections, Manifests and Ranges, which include Canvases that have at least height and\n *    width dimensions. Canvases included in resources that have this behavior are partial views and an appropriate\n *    rendering might display all of the Canvases virtually stitched together, such as a long scroll split into\n *    sections. This behavior has no implication for audio resources. The viewingDirection of the Manifest will\n *    determine the appropriate arrangement of the Canvases. Disjoint with unordered, individuals and paged.\n *\n * - `paged`  Valid on Collections, Manifests and Ranges, which include Canvases that have at least height and width\n *    dimensions. Canvases included in resources that have this behavior represent views that should be presented in\n *    a page-turning interface if one is available. The first canvas is a single view (the first recto) and thus the\n *    second canvas likely represents the back of the object in the first canvas. If this is not the case, see the\n *    behavior value non-paged. Disjoint with unordered, individuals, continuous, facing-pages and non-paged.\n *\n */\nexport function getVisibleCanvasesFromCanvasId(\n  vault: Vault,\n  manifestOrRange: ManifestNormalized | RangeNormalized,\n  canvasId: string | null,\n  preventPaged = false\n): Reference<'Canvas'>[] {\n  const behavior = manifestOrRange.behavior;\n  const fullCanvas = canvasId ? vault.get<CanvasNormalized>(canvasId) : null;\n  if (!fullCanvas) {\n    return [];\n  }\n\n  const canvasBehavior = fullCanvas.behavior;\n  const isPaged = preventPaged ? false : behavior.includes('paged');\n  const isContinuous = isPaged ? false : behavior.includes('continuous');\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes('individuals');\n  const isCanvasFacingPages = canvasBehavior.includes('facing-pages');\n  const isCanvasNonPaged = canvasBehavior.includes('non-paged');\n\n  // Individuals should just be the default.\n  if (isCanvasFacingPages || isCanvasNonPaged || isIndividuals || preventPaged) {\n    return [{ id: fullCanvas.id, type: 'Canvas' }];\n  }\n\n  const [manifestItems, ordering] = getManifestSequence(vault, manifestOrRange);\n\n  // Continuous should just return all items together.\n  if (isContinuous) {\n    return manifestItems;\n  }\n\n  const canvasIndex = manifestItems.findIndex((r) => r.id === canvasId);\n  if (canvasIndex === -1) {\n    return [];\n  }\n\n  for (const indexes of ordering) {\n    if (indexes.includes(canvasIndex)) {\n      return indexes.map((index) => manifestItems[index]);\n    }\n  }\n\n  return [{ id: fullCanvas.id, type: 'Canvas' }];\n}\n\nexport function getManifestSequence(\n  vault: Vault,\n  manifestOrRange: ManifestNormalized | RangeNormalized,\n  { disablePaging, skipNonPaged }: { disablePaging?: boolean; skipNonPaged?: boolean } = {}\n): [Reference<'Canvas'>[], number[][]] {\n  const behavior = manifestOrRange.behavior;\n  const isPaged = behavior.includes('paged');\n  const isContinuous = isPaged ? false : behavior.includes('continuous');\n  const isIndividuals = isPaged || isContinuous ? false : behavior.includes('individuals');\n  const manifestItems =\n    manifestOrRange.type === 'Manifest' ? manifestOrRange.items : findAllCanvasesInRange(vault, manifestOrRange);\n\n  // Continuous should just return all items together.\n  if (isContinuous) {\n    return [manifestItems, [manifestItems.map((_, index) => index)]];\n  }\n\n  // Individuals should just be the default.\n  if (isIndividuals || !isPaged || disablePaging) {\n    return [manifestItems, manifestItems.map((_, index) => [index])];\n  }\n\n  // This is the tricky case.\n  const ordering: number[][] = [];\n  let currentOrdering: number[] = [];\n\n  const flush = () => {\n    if (currentOrdering.length) {\n      ordering.push([...currentOrdering]);\n      currentOrdering = [];\n    }\n  };\n\n  let offset = 0;\n  let flushNextPaged = false;\n  for (let i = 0; i < manifestItems.length; i++) {\n    const canvas = vault.get<CanvasNormalized>(manifestItems[i]);\n    if (canvas.behavior.includes('non-paged')) {\n      if (i === offset) {\n        offset++;\n      }\n      if (!skipNonPaged) {\n        flush();\n        ordering.push([i]);\n        flush();\n      }\n      continue;\n    }\n\n    if (i === offset || canvas.behavior.includes('facing-pages')) {\n      // Flush and push a single.\n      if (currentOrdering.length) {\n        flushNextPaged = true;\n      }\n      flush();\n      ordering.push([i]);\n      flush();\n      continue;\n    }\n\n    currentOrdering.push(i);\n\n    if (flushNextPaged) {\n      flush();\n      flushNextPaged = false;\n      continue;\n    }\n\n    if (currentOrdering.length > 1) {\n      flush();\n    }\n  }\n\n  if (currentOrdering.length) {\n    flush();\n  }\n\n  return [manifestItems, ordering];\n}\n"],"names":["createEventsHelper","vault","resource","event","listener","scope","registeredCallbacks","callbacks","registered","registeredCallback","resourceOrId","hooks","props","hook","e","fullResource","callback","_scope","createStylesHelper","styles","id","p","Y","F","v","q","O","z","ii","A","E","ei","L","b","ti","ri","M","j","W","P","ni","si","C","B","N","R","ai","$","H","oi","G","T","k","Q","V","fi","li","hi","ui","U","i","t","n","ci","r","di","pi","gi","s","mi","a","o","l","f","u","I","d","g","c","xi","Ii","_i","h","_","yi","wi","J","Si","Fi","vi","Z","K","Oi","zi","Ai","Ei","Gi","Ti","ki","Li","Qi","Vi","bi","y","w","Mi","S","m","ji","Wi","Zi","Ki","Xi","Pi","Yi","qi","Ci","ie","ee","Bi","Ni","Ri","x","$i","createThumbnailHelper","dependencies","imageServiceLoader","ImageServiceLoader","getBestThumbnailAtSize","input","request","dereference","candidates","dimensions","getFixedSizeFromImage","fullInput","contentResources","firstContentResources","canvas","thumbnail","potentialThumbnails","firstManifest","firstCanvas","getClosestLanguage","i18nLanguage","languages","i18nLanguages","strictFallback","root","lang","inverseIdx","buildLocaleString","inputText","options","defaultText","separator","fallbackLanguages","closest","language","candidateText","getValue","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_s","err","TAU","mapToEllipse","_ref","rx","ry","cosphi","sinphi","centerx","centery","xp","yp","approxUnitArc","ang1","ang2","x1","y1","x2","y2","vectorAngle","ux","uy","vx","vy","sign","dot","getArcCenter","px","py","cx","cy","largeArcFlag","sweepFlag","pxp","pyp","rxsq","rysq","pxpsq","pypsq","radicant","centerxp","centeryp","vx1","vy1","vx2","vy2","arcToBezier","_ref2","_ref2$xAxisRotation","xAxisRotation","_ref2$largeArcFlag","_ref2$sweepFlag","curves","lambda","_getArcCenter","_getArcCenter2","ratio","segments","curve","_mapToEllipse","_mapToEllipse2","_mapToEllipse3","parseSvgPath","parse","length","segment","path","data","command","args","type","parseValues","number","numbers","absSvgPath","absolutize","startX","startY","seg","parseAndNormalizeSvgPath","parsed","absolute","prevCmd","bezierX","bezierY","quadX","quadY","out","cmd","arcToCurve","flattenQuadraticBezier","start","control","end","tolerance","QuadraticBezier","flattenCubicBezier","startControl","endControl","CubicBezier","hypot2","approx_myint","approx_inv_myint","mt","x0","y0","ddx","ddy","u0","u2","cross","paramX0","paramX2","scale","params","a0","a2","count","tValues","coords","c0","c1","c2","c3","p1","t0","t1","p0","p3","d1","d2","tol","tol1","tol2","sqrt_tol2","err2","n_quads","quads","sum","quad","val","xmin","cusp_val","result","target","BOX_SELECTOR","TEMPORAL_SELECTOR","RGBA_COLOR","parseSelector","source","domParser","svgPreprocessor","nextSource","selector","selectors","fragment","matchBoxSelector","matchTimeSelector","points","rect","style","svg","_a","svgShape","svgElement","selectorElem","getSelectorElement","_b","extractStyles","sel","getShapeTypeFromPath","svgPath","cmdFrequencies","acc","cmdTypes","lastSeg","svgElem","element","res","normalized","pathToPoints","_c","angle","rad","_f","_g","_h","_j","_k","_m","_l","ps","shapeType","_o","width","_p","height","_q","normalizedPath","startPoint","selectorElement","rgbaMatch","rootElem","expandTarget","validateContentState","annotation","strict","anno","valid","reason","serialiseContentState","encodeContentState","parseContentState","state","asyncOrFetcher","decodeContentState","uriEncoded","encodedContentState","base64","restorePadding","base64Decoded","pad","normaliseContentState","annoId","targets","singleMotivation","expanded","parseSpecificResource","createPaintingAnnotationsHelper","getAllPaintingAnnotations","canvasOrId","annotationPages","flatAnnotations","page","getPaintables","paintingAnnotationsOrCanvas","enabledChoices","paintingAnnotations","types","choice","items","bodies","unknownBody","body","nestedBodies","selected","cid","extractChoices","defineProperty","name","prototype","DEFINED","REFS","ref","wrapObject","REACTIVE","createPrototype","reactive","refOrObject","fresh","key","that","subscription","skipInitial","unwrapObject","object","newObject","wrapped","createObjectsHelper","json","objectType","createRangeHelper","range","findFirstCanvasFromRange","findAllCanvasesInRange","manifest","canvasId","findManifestSelectedRange","findSelectedRange","inner","found","sourceId","parsedId","createSequenceHelper","manifestOrRange","preventPaged","getVisibleCanvasesFromCanvasId","getManifestSequence","behavior","fullCanvas","canvasBehavior","isPaged","isContinuous","isIndividuals","isCanvasFacingPages","isCanvasNonPaged","manifestItems","ordering","canvasIndex","indexes","index","disablePaging","skipNonPaged","currentOrdering","flush","offset","flushNextPaged"],"mappings":"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"}