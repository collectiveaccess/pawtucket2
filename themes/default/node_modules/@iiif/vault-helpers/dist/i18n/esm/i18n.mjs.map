{"version":3,"file":"i18n.mjs","sources":["../../../src/i18n.ts"],"sourcesContent":["import { InternationalString } from '@iiif/presentation-3';\n\nexport function getClosestLanguage(\n  i18nLanguage: string,\n  languages: string[],\n  i18nLanguages: string[] = [],\n  strictFallback = false\n) {\n  if (!i18nLanguage || !languages || languages.length === 0) {\n    return undefined;\n  }\n\n  // Only one option.\n  if (languages.length === 1) {\n    return languages[0];\n  }\n\n  // Exact match.\n  if (languages.indexOf(i18nLanguage) !== -1) {\n    return i18nLanguage;\n  }\n\n  // Root match (en-us === en)\n  const root = i18nLanguage.indexOf('-') !== -1 ? i18nLanguage.slice(0, i18nLanguage.indexOf('-')) : null;\n  if (root && languages.indexOf(root) !== -1) {\n    return root;\n  }\n\n  // All of the fall backs.\n  for (const lang of i18nLanguages) {\n    if (languages.indexOf(lang) !== -1) {\n      return lang;\n    }\n  }\n\n  if (!strictFallback) {\n    // Inverse root match (en === en-us)\n    const inverseRoot = languages.map((l) => (l.indexOf('-') !== -1 ? l.slice(0, l.indexOf('-')) : null));\n    const inverseIdx = inverseRoot.indexOf(i18nLanguage);\n    if (inverseIdx !== -1) {\n      return languages[inverseIdx];\n    }\n\n    // Inverse root (fallback)\n    for (const lang of i18nLanguages) {\n      const root = lang.indexOf('-') !== -1 ? lang.slice(0, lang.indexOf('-')) : null;\n      const inverseIdx = root ? languages.indexOf(root) : -1;\n      if (inverseIdx !== -1) {\n        return languages[inverseIdx];\n      }\n    }\n  }\n\n  if (languages.indexOf('none') !== -1) {\n    return 'none';\n  }\n\n  // Catch some legacy\n  if (languages.indexOf('@none') !== -1) {\n    return '@none';\n  }\n\n  // Finally, fall back to the first.\n  return languages[0];\n}\n\nexport function buildLocaleString(\n  inputText: string | InternationalString | null | undefined,\n  i18nLanguage: string | undefined,\n  options: {\n    strictFallback?: boolean;\n    defaultText?: string;\n    separator?: string;\n    fallbackLanguages?: string[];\n    closest?: boolean;\n  } = {}\n) {\n  const { strictFallback = false, defaultText = '', separator = '\\n', fallbackLanguages = [], closest } = options;\n  const languages = Object.keys(inputText || {});\n  const language = closest\n    ? i18nLanguage\n    : getClosestLanguage(i18nLanguage as any, languages, fallbackLanguages, strictFallback);\n\n  if (!inputText) {\n    return defaultText;\n  }\n\n  if (typeof inputText === 'string') {\n    return inputText;\n  }\n\n  const candidateText = language ? inputText[language] : undefined;\n  if (candidateText) {\n    // Slightly tolerant of typos in IIIF like: `{\"en\": \"Some value\"}`\n    if (typeof candidateText === 'string') {\n      return candidateText;\n    }\n    return candidateText.join(separator);\n  }\n\n  return '';\n}\n\nexport function getValue(\n  inputText: string | InternationalString | null | undefined,\n  options: { defaultText?: string; separator?: string; fallbackLanguages?: string[] } = {}\n) {\n  return buildLocaleString(inputText, typeof navigator !== 'undefined' ? navigator.language : undefined, options);\n}\n"],"names":["root","inverseIdx"],"mappings":"AAEO,SAAS,mBACd,cACA,WACA,gBAA0B,CAAC,GAC3B,iBAAiB,OACjB;AACA,MAAI,CAAC,gBAAgB,CAAC,aAAa,UAAU,WAAW,GAAG;AAClD,WAAA;AAAA,EACT;AAGI,MAAA,UAAU,WAAW,GAAG;AAC1B,WAAO,UAAU;AAAA,EACnB;AAGA,MAAI,UAAU,QAAQ,YAAY,MAAM,IAAI;AACnC,WAAA;AAAA,EACT;AAGA,QAAM,OAAO,aAAa,QAAQ,GAAG,MAAM,KAAK,aAAa,MAAM,GAAG,aAAa,QAAQ,GAAG,CAAC,IAAI;AACnG,MAAI,QAAQ,UAAU,QAAQ,IAAI,MAAM,IAAI;AACnC,WAAA;AAAA,EACT;AAGA,aAAW,QAAQ,eAAe;AAChC,QAAI,UAAU,QAAQ,IAAI,MAAM,IAAI;AAC3B,aAAA;AAAA,IACT;AAAA,EACF;AAEA,MAAI,CAAC,gBAAgB;AAEnB,UAAM,cAAc,UAAU,IAAI,CAAC,MAAO,EAAE,QAAQ,GAAG,MAAM,KAAK,EAAE,MAAM,GAAG,EAAE,QAAQ,GAAG,CAAC,IAAI,IAAK;AAC9F,UAAA,aAAa,YAAY,QAAQ,YAAY;AACnD,QAAI,eAAe,IAAI;AACrB,aAAO,UAAU;AAAA,IACnB;AAGA,eAAW,QAAQ,eAAe;AAChC,YAAMA,QAAO,KAAK,QAAQ,GAAG,MAAM,KAAK,KAAK,MAAM,GAAG,KAAK,QAAQ,GAAG,CAAC,IAAI;AAC3E,YAAMC,cAAaD,QAAO,UAAU,QAAQA,KAAI,IAAI;AACpD,UAAIC,gBAAe,IAAI;AACrB,eAAO,UAAUA;AAAAA,MACnB;AAAA,IACF;AAAA,EACF;AAEA,MAAI,UAAU,QAAQ,MAAM,MAAM,IAAI;AAC7B,WAAA;AAAA,EACT;AAGA,MAAI,UAAU,QAAQ,OAAO,MAAM,IAAI;AAC9B,WAAA;AAAA,EACT;AAGA,SAAO,UAAU;AACnB;AAEO,SAAS,kBACd,WACA,cACA,UAMI,CAAA,GACJ;AACM,QAAA,EAAE,iBAAiB,OAAO,cAAc,IAAI,YAAY,MAAM,oBAAoB,CAAA,GAAI,QAAA,IAAY;AACxG,QAAM,YAAY,OAAO,KAAK,aAAa,CAAE,CAAA;AAC7C,QAAM,WAAW,UACb,eACA,mBAAmB,cAAqB,WAAW,mBAAmB,cAAc;AAExF,MAAI,CAAC,WAAW;AACP,WAAA;AAAA,EACT;AAEI,MAAA,OAAO,cAAc,UAAU;AAC1B,WAAA;AAAA,EACT;AAEM,QAAA,gBAAgB,WAAW,UAAU,YAAY;AACvD,MAAI,eAAe;AAEb,QAAA,OAAO,kBAAkB,UAAU;AAC9B,aAAA;AAAA,IACT;AACO,WAAA,cAAc,KAAK,SAAS;AAAA,EACrC;AAEO,SAAA;AACT;AAEO,SAAS,SACd,WACA,UAAsF,IACtF;AACO,SAAA,kBAAkB,WAAW,OAAO,cAAc,cAAc,UAAU,WAAW,QAAW,OAAO;AAChH;;"}